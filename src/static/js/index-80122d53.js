import{f as getWebhookUrl,g as getInfo,u as update,h as getIntegrateList,i as delIntegrate,j as copy,k as exportData,l as updateState}from"./integrate-cef8009f.js";import{u as useTable,B as BasicTable}from"./useTable-dc8c9d84.js";import{T as TableAction}from"./TableAction-adbe36f2.js";import{eg as buildBitUUID,d as defineComponent,j as createVNode,e as resolveComponent,m as createTextVNode,c3 as Form,u as useI18n,r as ref,ad as reactive,M as computed,bk as pick,w as watch,o as openBlock,g as createElementBlock,V as mergeProps,l as withCtx,aN as ModalClose,a4 as createBaseVNode,k as unref,aH as Modal,n as nextTick,ac as useAppStore,a0 as toRefs,ae as isRef,i as withDirectives,F as Fragment,q as createCommentVNode,p as createBlock,h as renderList,v as vShow,ab as ScrollContainer,eh as useCopyToClipboard,ah as useMessage,fk as getMenuSelectorForm,c as cloneDeep,t as toDisplayString,af as normalizeClass,cb as isEmpty,aP as omit,a7 as onMounted,ef as PlusOutlined,T as useDesign,dj as logoImg,bN as DownOutlined,ea as downloadByUrl}from"./index-920db443.js";import{u as useModal,b as useModalInner,B as BasicModal}from"./index-143f5813.js";import{u as usePopup}from"./index-9c138ba5.js";import{u as useDrawer,B as BasicDrawer}from"./index-999abbee.js";import{p as getVisualDevFormList,a as getConfigData}from"./visualDev-8f54ab4b.js";import{_ as _sfc_main$g}from"./MsgModal.vue_vue_type_script_setup_true_lang-65704aaa.js";import{_ as _sfc_main$f}from"./index-c37d2476.js";import{B as BatchModal,_ as _sfc_main$h}from"./WebhookRequestModal.vue_vue_type_style_index_0_lang-1411d0ba.js";import{g as getSystemList}from"./system-4f24c0ce.js";import{S as SelectInterface}from"./index-7e2f1b8c.js";import{M as MsgTemplateDetail}from"./MsgTemplateDetail-001aea8e.js";import{_ as _sfc_main$i}from"./FlowModal.vue_vue_type_script_setup_true_lang-b2e7f9ad.js";import{d as dyOptionsList}from"./config-06ca91cd.js";import{f as getFlowFormInfo}from"./template-c6142676.js";import{M as MinusOutlined}from"./Main.vue_vue_type_style_index_0_lang-0afb53a3.js";import{_ as _sfc_main$j}from"./Form.vue_vue_type_script_setup_true_lang-d60806cc.js";import{_ as _sfc_main$k}from"./ExecutionQueue.vue_vue_type_script_setup_true_lang-675ee1f2.js";import Log from"./Log-1e9c66b2.js";import"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./upperFirst-2cd1a2f7.js";import"./useTabs-ceeccdba.js";import"./log-2a5f2c26.js";import"./uniqBy-e868edd7.js";import"./useWindowSizeFn-05f906e2.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./sendConfig-5e58278e.js";import"./BasicLeftTree-cd55d444.js";import"./billRule-0363563b.js";import"./import-e198d900.js";import"./tip-b30e67af.js";import"./dataSource-ed26da12.js";import"./dataModel-ea807f46.js";import"./index-3b5bee70.js";import"./CopyOutlined-8d46c8b2.js";import"./define-8efdf20f.js";import"./msgTemplate-ce5c0fa7.js";import"./task-ee77df5a.js";import"./componentMap-7e15a185.js";import"./formValidate-c8ab8d29.js";import"./LogDetail.vue_vue_type_style_index_0_lang-edb52bcd.js";const index="",propPanel="",defaultStartForm={title:"触发动作设置",formType:1,formId:"",formName:"",formFieldList:[],interfaceTemplateJson:[],triggerEvent:1,ruleList:[],ruleMatchLogic:"and",msgUserType:[1],msgUserIds:[],failMsgConfig:{on:3,msgId:"",msgName:"",templateJson:[]},startMsgConfig:{on:3,msgId:"",msgName:"",templateJson:[]},startTime:null,cron:"",endTimeType:1,endLimit:1,endTime:null,webhookUrl:"",webhookGetFieldsUrl:"",webhookRandomStr:""},nodeConfig={defaultStartForm:defaultStartForm,start:{type:"start",content:"请设置触发事件",properties:defaultStartForm},getData:{type:"getData",content:"请设置想要获取的数据",properties:{title:"获取数据",formType:1,formId:"",formName:"",formFieldList:[],interfaceTemplateJson:[],ruleList:[],ruleMatchLogic:"and"}},addData:{type:"addData",content:"请设置新增数据",properties:{title:"新增数据",enableFlow:0,flowId:"",formId:"",formName:"",formFieldList:[],transferList:[],ruleList:[],ruleMatchLogic:"and",addRule:0}},updateData:{type:"updateData",content:"请设置更新数据",properties:{title:"更新数据",enableFlow:0,flowId:"",formId:"",formName:"",formFieldList:[],transferList:[],ruleList:[],ruleMatchLogic:"and",unFoundRule:0}},deleteData:{type:"deleteData",content:"请设置删除数据",properties:{title:"删除数据",formId:"",formName:"",formFieldList:[],ruleList:[],ruleMatchLogic:"and",deleteRule:0}},dataInterface:{type:"dataInterface",content:"请设置数据接口",properties:{title:"数据接口",formId:"",formName:"",templateJson:[]}},message:{type:"message",content:"请设置消息通知",properties:{title:"消息通知",msgUserIds:[],msgId:"",msgName:"",templateJson:[]}},launchFlow:{type:"launchFlow",content:"请设置发起审批",properties:{title:"发起审批",flowId:"",flowName:"",formFieldList:[],transferList:[],initiator:[]}},empty:{type:"empty",content:"",properties:{}}},isEmptyArray=e=>!Array.isArray(e)||0===e.length;class NodeUtils{static isConditionNode(e){return e&&"condition"===e.type}static isInterflowNode(e){return e&&"approver"===e.type&&e.isInterflow}static isBranchFlowNode(e){return e&&"approver"===e.type&&e.isBranchFlow}static isStartNode(e){return e&&"start"===e.type}static isGetDataNode(e){return e&&"getData"===e.type}static isAddDataNode(e){return e&&"addData"===e.type}static isUpdateDataNode(e){return e&&"updateData"===e.type}static isDeleteDataNode(e){return e&&"deleteData"===e.type}static isDataInterfaceNode(e){return e&&"dataInterface"===e.type}static isMessageNode(e){return e&&"message"===e.type}static isLaunchFlowNode(e){return e&&"launchFlow"===e.type}static createNode(e,t){let o=JSON.parse(JSON.stringify(nodeConfig[e]));return o.nodeId=buildBitUUID(),o.prevId=t,o}static getPreviousNode(e,t){if(t.nodeId===e)return t;if(t.childNode){let o=this.getPreviousNode(e,t.childNode);if(o)return o}if(t.conditionNodes)for(let o of t.conditionNodes){let t=this.getPreviousNode(e,o);if(t)return t}}static deleteNode(e,t,o=!0){let a=this.getPreviousNode(e.prevId,t);if(o&&"empty"===a.type){if(this.isConditionNode(e)||this.isInterflowNode(e)||this.isBranchFlowNode(e)){const o=2===a.conditionNodes.length,n=o?a:e;this.deleteNode(n,t,o)}else isEmptyArray(a.conditionNodes)&&this.deleteNode(a,t),this.deleteNode(e,t,!1);return}let n=(e,t)=>{e.childNode=t.childNode,isEmptyArray(e.conditionNodes)&&(e.conditionNodes=t.conditionNodes),e.childNode&&(e.childNode.prevId=e.nodeId),e.conditionNodes&&e.conditionNodes.forEach((t=>t.prevId=e.nodeId))};if(this.isConditionNode(e)||this.isInterflowNode(e)||this.isBranchFlowNode(e)){let t=a.conditionNodes,o=t.findIndex((t=>t.nodeId===e.nodeId));if(t.length>2)t.splice(o,1);else{let e=t[+!o];if(delete a.conditionNodes,delete a.conditionType,a.childNode){let t=e;for(;t.childNode;)t=t.childNode;t.childNode=a.childNode,t.childNode.prevId=t.nodeId}n(a,e),a.childNode&&"empty"===a.childNode.type&&this.deleteNode(a.childNode,a)}t.forEach(((e,t)=>e.properties.priority=t))}else n(a,e)}static addApprovalNode(e,t,o=void 0){let a=e.childNode;o=o||this.createNode("addData",e.nodeId),e.childNode=o,a&&(o.childNode=a,a.prevId=o.nodeId);let n=e.conditionNodes;Array.isArray(n)&&!t&&n.length&&(o.conditionNodes=n.map((e=>(e.prevId=o.nodeId,e))),delete e.conditionNodes),a&&"empty"===a.type&&"empty"!==o.type&&0===a.conditionNodes.length&&this.deleteNode(a,e)}static addEmptyNode(e,t){let o=this.createNode("empty",e.nodeId);return this.addApprovalNode(e,!0,o),o}static addAddDataNode(e,t){this.addApprovalNode(e,t,this.createNode("addData",e.nodeId))}static addUpdateDataNode(e,t){this.addApprovalNode(e,t,this.createNode("updateData",e.nodeId))}static addDeleteDataNode(e,t){this.addApprovalNode(e,t,this.createNode("deleteData",e.nodeId))}static addDataInterfaceNode(e,t){this.addApprovalNode(e,t,this.createNode("dataInterface",e.nodeId))}static addMessageNode(e,t){this.addApprovalNode(e,t,this.createNode("message",e.nodeId))}static addLaunchFlowNode(e,t){this.addApprovalNode(e,t,this.createNode("launchFlow",e.nodeId))}static appendConditionNode(e){const t=e.conditionNodes;let o=this.createNode("condition",e.nodeId),a=t.findIndex((e=>e.properties.isDefault));o.properties.priority=t.length,a>-1?(t.splice(-1,0,o),o.properties.priority=t.length-2,t[t.length-1].properties.priority=t.length-1):t.push(o),this.setDefaultCondition(o,e)}static appendInterflowNode(e){const t=e.conditionNodes;let o=this.createNode("interflow",e.nodeId),a=t.findIndex((e=>e.properties.isDefault));o.properties.priority=t.length,a>-1?(t.splice(-1,0,o),o.properties.priority=t.length-2,t[t.length-1].properties.priority=t.length-1):t.push(o)}static appendBranchFlowNode(e){const t=e.conditionNodes;let o=this.createNode("branchFlow",e.nodeId),a=t.findIndex((e=>e.properties.isDefault));o.properties.priority=t.length,a>-1?(t.splice(-1,0,o),o.properties.priority=t.length-2,t[t.length-1].properties.priority=t.length-1):t.push(o)}static appendBranch(e,t){let o=e;if(Array.isArray(e.conditionNodes)&&e.conditionNodes.length)if(t)o=this.addEmptyNode(o,!0);else{let e=this.addEmptyNode(o,!0);e.conditionNodes=o.conditionNodes,e.conditionType="condition",e.conditionNodes.forEach((t=>{t.prevId=e.nodeId}))}let a=[this.createNode("condition",o.nodeId),this.createNode("condition",o.nodeId)].map(((e,t)=>(e.properties.priority=t,e)));o.conditionNodes=a,o.conditionType="condition"}static appendInterflowBranch(e,t){let o=e;if(Array.isArray(e.conditionNodes)&&e.conditionNodes.length)if(t)o=this.addEmptyNode(o,!0);else{let e=this.addEmptyNode(o,!0);e.conditionNodes=o.conditionNodes,e.conditionType="interflow",e.conditionNodes.forEach((t=>{t.prevId=e.nodeId}))}let a=[this.createNode("interflow",o.nodeId),this.createNode("interflow",o.nodeId)];o.conditionNodes=a,o.conditionType="interflow"}static appendBranchFlowBranch(e,t){let o=e;if(Array.isArray(e.conditionNodes)&&e.conditionNodes.length)if(t)o=this.addEmptyNode(o,!0);else{let e=this.addEmptyNode(o,!0);e.conditionNodes=o.conditionNodes,e.conditionType="branchFlow",e.conditionNodes.forEach((t=>{t.prevId=e.nodeId}))}let a=[this.createNode("branchFlow",o.nodeId),this.createNode("branchFlow",o.nodeId)];o.conditionNodes=a,o.conditionType="branchFlow"}static resortPriorityByCNode(e,t,o){if(e.properties.isDefault)return void(e.properties.priority=t);let a=this.getPreviousNode(e.prevId,o),n=e.properties.priority;if(a.conditionNodes[n].properties.isDefault)return void(e.properties.priority=t);let r=a.conditionNodes.splice(n,1,e)[0];r.properties.priority=t,a.conditionNodes[t]=r}static increasePriority(e,t){if(e.properties.isDefault)return;let o=this.getPreviousNode(e.prevId,t).conditionNodes,a=o.findIndex((t=>t===e));a&&(o[a-1].properties.priority=a,o[a].properties.priority=a-1,o[a-1]=o.splice(a,1,o[a-1])[0])}static decreasePriority(e,t){let o=this.getPreviousNode(e.prevId,t).conditionNodes,a=o.findIndex((t=>t.nodeId===e.nodeId));if(a<o.length-1){let e=o[a+1];if(e.properties.isDefault)return;e.properties.priority=a,o[a].properties.priority=a+1,o[a+1]=o.splice(a,1,o[a+1])[0]}}static setDefaultCondition(e,t){const o="其他情况进入此流程",a=this.getPreviousNode(e.prevId,t).conditionNodes,n=e=>e.properties&&(e.properties.initiator||!isEmptyArray(e.properties.conditions)),r=e=>{e.properties.isDefault=!1,e.content===o&&(e.content="请设置条件")};let l=0;a.slice(0,-1).forEach((e=>{n(e)&&l++,r(e)}));const i=a[a.length-1];var s;l>0&&!n(i)?((s=i).properties.isDefault=!0,s.content=o):r(i)}static checkNode(e,t){let o=!0;const a=e.properties;return this.isStartNode(e)&&(1==a.integrateType&&!a.formId||2==a.integrateType&&(!a.cron||!a.startTime)||3==a.integrateType&&!a.formFieldList.length)&&(o=!1),this.isGetDataNode(e)&&!a.formId&&(o=!1),this.isAddDataNode(e)&&!a.formId&&(o=!1),this.isUpdateDataNode(e)&&!a.formId&&(o=!1),this.isDeleteDataNode(e)&&!a.formId&&(o=!1),this.isDataInterfaceNode(e)&&!a.formId&&(o=!1),this.isLaunchFlowNode(e)&&!a.flowId&&(o=!1),this.isMessageNode(e)&&(!a.msgId||!a.msgUserIds.length)&&(o=!1),o}static checkAllNode(e){let t=!0;const o=(e,t,a)=>{!this.checkNode(e,a)&&t(),e.childNode&&o(e.childNode,t,a),isEmptyArray(e.conditionNodes)||e.conditionNodes.forEach((a=>o(a,t,e)))};return o(e,(()=>t=!1)),t}}function getMockData(e=1){let t=NodeUtils.createNode("start");return t.properties.integrateType=e,2==e&&(t.content="请设置定时触发器",t.properties.title="定时触发设置",t.childNode=NodeUtils.createNode("getData",t.nodeId)),3==e&&(t.content="请设置触发方式",t.properties.title="webhook触发设置"),t}const isCondition=e=>"condition"===e.type||"approver"===e.type&&(e.isInterflow||e.isBranchFlow),notEmptyArray=e=>Array.isArray(e)&&e.length>0,hasBranch=e=>notEmptyArray(e.conditionNodes),stopPro=e=>e&&e.stopPropagation(),_sfc_main$e=defineComponent({props:{data:{type:Object,required:!0},formInfo:{type:Object},verifyMode:{type:Boolean,default:!0},isPreview:{type:Boolean,default:!1}},emits:["emits"],setup(e,{emit:t}){const o=t=>function(t){const o=["flow-path-card"];return t.state&&o.push(t.state),o.push(t.type+"-node"),createVNode("section",{class:o.join(" "),onClick:i.bind(null,"edit",t)},[createVNode("header",{class:"header"},[createVNode("div",{class:"title-box",style:"height: 100%;width:190px;"},[createVNode("span",{class:"title-text"},[t.properties.title])]),!e.isPreview&&"getData"!==t.type&&createVNode("div",{class:"actions"},[createVNode("i",{class:"icon-ym icon-ym-nav-close icon",onClick:i.bind(null,"deleteNode",t,e.data)},null)])]),createVNode("div",{class:"body"},[createVNode("span",{class:"text"},[t.content])])])}(t),a={start:o,addData:o,updateData:o,deleteData:o,dataInterface:o,message:o,getData:o,launchFlow:o,interflow:o,branchFlow:o,empty:e=>"",condition:function(t){return createVNode("section",{class:"flow-path-card condition",onClick:i.bind(null,"edit",t)},[createVNode("header",{class:"header"},[createVNode("div",{class:"title-box",style:"height:20px;width:160px;"},[createVNode("span",{class:"title-text"},[t.properties.title]),createVNode(resolveComponent("a-input"),{value:t.properties.title,"onUpdate:value":e=>t.properties.title=e,class:"title-input",onClick:e=>stopPro(e)},null)]),!e.isPreview&&"getData"!==t.type&&createVNode("div",{class:"actions"},[createVNode("i",{class:"icon-ym icon-ym-nav-close icon",onClick:i.bind(null,"deleteNode",t,e.data)},null)])]),createVNode("div",{class:"body"},[createVNode("div",{class:"text"},[t.content])])])}};function n(t,o=!1){if(e.isPreview||"getData"===t?.childNode?.type)return createVNode("div",{class:"add-node-btn-box flex justify-center"},null);if("empty"===t.type&&!o)return"";const a={content:()=>createVNode("div",{class:"add-popover-main"},[createVNode("div",{class:"condition-box"},[createVNode("div",{class:"condition-item"},[createVNode("div",{class:"condition-icon addData",onClick:i.bind(null,"addAddDataNode",t,o)},[createVNode("i",{class:"icon-ym icon-ym-btn-add"},null)]),createTextVNode("新增数据")]),createVNode("div",{class:"condition-item"},[createVNode("div",{class:"condition-icon updateData",onClick:i.bind(null,"addUpdateDataNode",t,o)},[createVNode("i",{class:"icon-ym icon-ym-Refresh"},null)]),createTextVNode("更新数据")]),createVNode("div",{class:"condition-item"},[createVNode("div",{class:"condition-icon deleteData",onClick:i.bind(null,"addDeleteDataNode",t,o)},[createVNode("i",{class:"icon-ym icon-ym-delete"},null)]),createTextVNode("删除数据")]),createVNode("div",{class:"condition-item"},[createVNode("div",{class:"condition-icon dataInterface",onClick:i.bind(null,"addDataInterfaceNode",t,o)},[createVNode("i",{class:"icon-ym icon-ym-options"},null)]),createTextVNode("数据接口")]),createVNode("div",{class:"condition-item"},[createVNode("div",{class:"condition-icon message",onClick:i.bind(null,"addMessageNode",t,o)},[createVNode("i",{class:"icon-ym icon-ym-xitong"},null)]),createTextVNode("消息通知")]),createVNode("div",{class:"condition-item"},[createVNode("div",{class:"condition-icon launchFlow",onClick:i.bind(null,"addLaunchFlowNode",t,o)},[createVNode("i",{class:"icon-ym icon-ym-launch"},null)]),createTextVNode("发起审批")])])])};return createVNode("div",{class:"add-node-btn-box flex justify-center"},[createVNode("div",{class:"add-node-btn"},[createVNode(resolveComponent("a-popover"),{placement:"right",trigger:"click",overlayClassName:"add-popover"},{default:()=>[createVNode("button",{class:"btn",type:"button"},[createVNode("i",{class:"icon-ym icon-ym-btn-add icon"},null)])],...a})])])}function r(t){return e.isPreview?createVNode("span",{class:"line"},null):NodeUtils.isConditionNode(t.conditionNodes[0])?createVNode("button",{onClick:i.bind(null,"appendConditionNode",t),class:"btn"},[createTextVNode("添加条件")]):NodeUtils.isInterflowNode(t.conditionNodes[0])?createVNode("button",{onClick:i.bind(null,"appendInterflowNode",t),class:"btn"},[createTextVNode("添加分流")]):NodeUtils.isBranchFlowNode(t.conditionNodes[0])?createVNode("button",{onClick:i.bind(null,"appendBranchFlowNode",t),class:"btn"},[createTextVNode("添加分支")]):void 0}function l(t){if(!t)return;const o=e.verifyMode&&!1===NodeUtils.checkNode(t);let s=[],d="",c=createVNode("div",{class:"node-wrap"},[createVNode("div",{class:`node-wrap-box ${t.type} ${NodeUtils.isInterflowNode(t)?"interflow":""}\n                ${NodeUtils.isBranchFlowNode(t)?"branchFlow":""} ${o?"error":""}`},[!e.isPreview&&createVNode(resolveComponent("a-tooltip"),{title:"请完善配置"},{default:()=>[createVNode("div",{class:"error-tip",onClick:i.bind(null,"edit",t)},[createTextVNode("!!!")])]}),a[t.type](t),n(t)])]);return hasBranch(t)&&(d=createVNode("div",{class:"branch-wrap"},[createVNode("div",{class:"branch-box-wrap"},[createVNode("div",{class:"branch-box flex justify-center relative"},[r(t),t.conditionNodes.map((e=>l(e)))])]),n(t,!0)])),isCondition(t)?createVNode("div",{class:"col-box"},[createVNode("div",{class:"center-line"},null),createVNode("div",{class:"top-cover-line"},null),createVNode("div",{class:"bottom-cover-line"},null),c,d,l(t.childNode)]):(s.push(c),d&&s.push(d),t.childNode&&s.push(l(t.childNode)),s)}function i(e,...o){stopPro(o[o.length-1]);if(["appendBranch","appendBranchFlowBranch","appendInterflowBranch","addTimerNode"].includes(e)&&o[o.length-2])return;const a={event:e,args:o.slice(0,-1)};t("emits",a)}return()=>createVNode("div",{style:"display: inline-flex; flex-direction: column; align-items: center;"},[e.data&&l(e.data),createVNode("section",{class:"end-node"},[createTextVNode("结束")])])}}),_hoisted_1$c={class:"common-container"},_hoisted_2$a={class:"jnpf-content-wrapper"},_hoisted_3$a={class:"jnpf-content-wrapper-center"},_hoisted_4$7={class:"jnpf-content-wrapper-content"},_sfc_main$d=defineComponent({inheritAttrs:!1,__name:"FormListModal",props:{value:{default:""},title:{type:String,default:""},placeholder:{type:String,default:"请选择"},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!0},size:{type:String,default:"default"},enableFlow:{default:""}},emits:["update:value","change"],setup(e,{emit:t}){const o=e,a=t,n=Form.useInjectFormItemContext(),{t:r}=useI18n(),l=ref(void 0),i=ref(!1),s=ref([]),d=reactive({type:"1",isRelease:"1,2",enableFlow:o.enableFlow,webType:1}),[c,{getForm:f,getSelectRows:m,setSelectedRowKeys:u,getSelectRowKeys:p}]=useTable({api:getVisualDevFormList,columns:[{title:"表单名称",dataIndex:"fullName"},{title:"表单编码",dataIndex:"enCode"},{title:"表单类型",dataIndex:"enableFlow",width:100,customRender:({record:e})=>"1"==e.enableFlow?"流程表单":"普通表单"}],immediate:!1,useSearchForm:!0,formConfig:{baseColProps:{span:8},schemas:[{field:"keyword",label:r("common.keyword"),component:"Input",componentProps:{placeholder:r("common.enterKeyword"),submitOnPressEnter:!0}}]},tableSetting:{size:!1,setting:!1},isCanResizeParent:!0,resizeHeightOffset:-74,rowSelection:{type:"radio"}}),N=computed((()=>({...pick(o,["disabled","size","allowClear","placeholder"]),fieldNames:{label:"fullName",value:"id"},open:!1,showSearch:!1,showArrow:!0})));function C(){s.value=[],a("change","",{})}async function g(){o.disabled||(d.enableFlow=o.enableFlow,i.value=!0,nextTick((()=>{f().resetFields(),u(l.value?[l.value]:[])})))}function h(){i.value=!1}function _(){if(!p().length&&!m().length)return;if(!m().length)return a("update:value",l.value),a("change",l.value,s.value[0]),n.onFieldChange(),void h();const e=m()[0];s.value=m(),l.value=e.id,a("update:value",e.id),a("change",e.id,e),n.onFieldChange(),h()}return watch((()=>o.value),(e=>{var t;t=e,l.value=t||void 0,s.value=[{id:l.value,fullName:o.title}]}),{immediate:!0}),(e,t)=>{const o=resolveComponent("a-select");return openBlock(),createElementBlock("div",_hoisted_1$c,[createVNode(o,mergeProps({value:l.value,"onUpdate:value":t[0]||(t[0]=e=>l.value=e)},N.value,{options:s.value,onChange:C,onClick:g}),null,16,["value","options"]),createVNode(unref(Modal),{open:i.value,"onUpdate:open":t[1]||(t[1]=e=>i.value=e),title:"表单选择",width:800,class:"common-container-modal",onOk:_,onCancel:h,maskClosable:!1},{closeIcon:withCtx((()=>[createVNode(ModalClose,{canFullscreen:!1,onCancel:h})])),default:withCtx((()=>[createBaseVNode("div",_hoisted_2$a,[createBaseVNode("div",_hoisted_3$a,[createBaseVNode("div",_hoisted_4$7,[createVNode(unref(BasicTable),{onRegister:unref(c),searchInfo:d,class:"jnpf-sub-table"},null,8,["onRegister","searchInfo"])])])])])),_:1},8,["open"])])}}}),sourceTypeOptions=[{id:1,fullName:"字段"},{id:2,fullName:"自定义"}],msgUserOptions=[{id:1,fullName:"创建人"},{id:2,fullName:"超级管理员"},{id:3,fullName:"自定义"}],noticeOptions=[{id:3,fullName:"默认"},{id:1,fullName:"自定义"},{id:0,fullName:"关闭"}],logicOptions=[{id:"and",fullName:"且"},{id:"or",fullName:"或"}],symbolOptions=[{id:">=",fullName:"大于等于"},{id:">",fullName:"大于"},{id:"==",fullName:"等于"},{id:"<=",fullName:"小于等于"},{id:"<",fullName:"小于"},{id:"<>",fullName:"不等于"},{id:"like",fullName:"包含"},{id:"notLike",fullName:"不包含"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],notSupportList=["relationFormAttr","popupAttr","uploadFile","uploadImg","colorPicker","editor","link","button","text","alert","table"],_hoisted_1$b={class:"common-pane"},_hoisted_2$9={class:"mb-10px"},_hoisted_3$9={class:"condition-main"},_hoisted_4$6={class:"condition-list"},_hoisted_5$5=["onClick"],_sfc_main$c=defineComponent({name:"startNode",inheritAttrs:!1,__name:"StartNode",props:["formConf","integrateType","formFieldsOptions","getFormFieldList","formInfo"],setup(e,{expose:t}){t({initCondition:function(){if(1!=o.integrateType)return;r.value?.init({conditionList:o.formConf.ruleList||[],matchLogic:o.formConf.ruleMatchLogic,fieldOptions:unref(g)})},submitCondition:function(){const e=r.value?.confirm();return e||!1}});const o=e,{createMessage:a}=useMessage(),n=useAppStore(),r=ref(),l=[{id:1,fullName:"新增数据"},{id:2,fullName:"修改数据"},{id:3,fullName:"删除数据"}],i=[{id:1,fullName:"触发次数"},{id:2,fullName:"指定时间"},{id:3,fullName:"不结束"}],s="failMsgConfig",d="startMsgConfig",c=reactive({activeKey:"1"}),{activeKey:f}=toRefs(c),[m,{openModal:u}]=useModal(),[p,{openModal:N}]=useModal(),C=computed((()=>n.getSysConfigInfo)),g=computed((()=>o.formConf.formFieldList.filter((e=>e.id.indexOf("-")<0))));function h(e,t){if(!e||o.formConf.formId!==e){if(!e)return o.formConf.formName="",o.formConf.formId="",void(o.formConf.formFieldList=[]);o.getFormFieldList(e,"start"),o.formConf.formName=t.fullName,o.formConf.formId=e,o.formConf.ruleList=[]}}function _(e,t,a){if(!t)return o.formConf[e].msgId="",o.formConf[e].msgName="",void(o.formConf[e].templateJson=[]);o.formConf[e].msgId!==t&&(o.formConf[e].msgId=t,o.formConf[e].msgName=a.fullName,o.formConf[e].templateJson=a.templateJson||[])}function v(e){e||(o.formConf.endLimit=1)}function y(){o.formConf.formFieldList.push({id:"",fullName:"",label:""})}function V(e){const t=e.map((e=>({...e,label:e.fullName?e.id+"("+e.fullName+")":e.id})));if(!o.formConf.formFieldList.length)return o.formConf.formFieldList=t;for(let a=0;a<t.length;a++){const e=t[a];if(e.id){const t=o.formConf.formFieldList.findIndex((t=>t.id===e.id));t<0?o.formConf.formFieldList.push(e):o.formConf.formFieldList[t]=e}else o.formConf.formFieldList.push(e)}}function w(e){e.label=e.fullName?e.id+"("+e.fullName+")":e.id}return(t,n)=>{const c=resolveComponent("a-tab-pane"),g=resolveComponent("a-tabs"),k=resolveComponent("a-form-item"),x=resolveComponent("jnpf-radio"),b=resolveComponent("BasicHelp"),F=resolveComponent("jnpf-date-picker"),B=resolveComponent("jnpf-cron"),D=resolveComponent("jnpf-select"),I=resolveComponent("a-input-number"),L=resolveComponent("a-input"),T=resolveComponent("a-col"),M=resolveComponent("a-row"),$=resolveComponent("a-form"),U=resolveComponent("jnpf-users-select");return openBlock(),createElementBlock("section",_hoisted_1$b,[createVNode(g,{activeKey:unref(f),"onUpdate:activeKey":n[0]||(n[0]=e=>isRef(f)?f.value=e:null),size:"small",class:"pane-tabs"},{default:withCtx((()=>[createVNode(c,{key:"1",tab:1==e.integrateType?"表单配置":2==e.integrateType?"触发配置":"webhook配置"},null,8,["tab"]),createVNode(c,{key:"2",tab:"通知配置"})])),_:1},8,["activeKey"]),createVNode(unref(ScrollContainer),{class:"config-content"},{default:withCtx((()=>[withDirectives(createVNode($,{colon:!1,layout:"vertical",model:e.formConf,class:"config-form"},{default:withCtx((()=>[1==e.integrateType?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(k,null,{label:withCtx((()=>n[16]||(n[16]=[createTextVNode("触发表单")]))),default:withCtx((()=>[createVNode(_sfc_main$d,{value:e.formConf.formId,title:e.formConf.formName,enableFlow:"0",allowClear:!1,onChange:h,placeholder:"请选择"},null,8,["value","title"])])),_:1}),createVNode(k,{label:"触发事件"},{default:withCtx((()=>[createVNode(x,{value:e.formConf.triggerEvent,"onUpdate:value":n[1]||(n[1]=t=>e.formConf.triggerEvent=t),options:l},null,8,["value"])])),_:1}),createVNode(k,null,{label:withCtx((()=>[n[17]||(n[17]=createTextVNode("触发条件")),createVNode(b,{text:"满足以下条件，触发执行动作。"})])),default:withCtx((()=>[createVNode(_sfc_main$f,{ref_key:"conditionMainRef",ref:r,bordered:""},null,512)])),_:1})],64)):createCommentVNode("",!0),2==e.integrateType?(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(k,{label:"触发开始时间"},{default:withCtx((()=>[createVNode(F,{value:e.formConf.startTime,"onUpdate:value":n[2]||(n[2]=t=>e.formConf.startTime=t),format:"YYYY-MM-DD HH:mm:ss",placeholder:"选择开始时间"},null,8,["value"])])),_:1}),createVNode(k,{label:"触发规则"},{default:withCtx((()=>[createVNode(k,null,{default:withCtx((()=>[n[18]||(n[18]=createBaseVNode("div",{class:"ant-form-item-label"},[createBaseVNode("label",{class:"ant-form-item-no-colon"},"Cron表达式")],-1)),createVNode(B,{value:e.formConf.cron,"onUpdate:value":n[3]||(n[3]=t=>e.formConf.cron=t)},null,8,["value"])])),_:1,__:[18]})])),_:1}),createVNode(k,{label:"触发结束时间"},{default:withCtx((()=>[createVNode(D,{value:e.formConf.endTimeType,"onUpdate:value":n[4]||(n[4]=t=>e.formConf.endTimeType=t),options:i,class:"mb-10px"},null,8,["value"]),1===e.formConf.endTimeType?(openBlock(),createBlock(I,{key:0,value:e.formConf.endLimit,"onUpdate:value":n[5]||(n[5]=t=>e.formConf.endLimit=t),placeholder:"次数",min:1,precision:0,addonAfter:"次后结束",onChange:v},null,8,["value"])):createCommentVNode("",!0),2===e.formConf.endTimeType?(openBlock(),createBlock(F,{key:1,value:e.formConf.endTime,"onUpdate:value":n[6]||(n[6]=t=>e.formConf.endTime=t),format:"YYYY-MM-DD HH:mm:ss",placeholder:"选择结束时间"},null,8,["value"])):createCommentVNode("",!0)])),_:1})],64)):createCommentVNode("",!0),3==e.integrateType?(openBlock(),createElementBlock(Fragment,{key:2},[createVNode(k,{label:"webhook URL"},{default:withCtx((()=>[n[19]||(n[19]=createBaseVNode("p",{class:"common-tip mb-10px"},"系统生成的URL，用来接收请求字段！",-1)),createVNode(L,{value:C.value.jnpfDomain+e.formConf.webhookUrl,readonly:""},{addonAfter:withCtx((()=>[createBaseVNode("span",{class:"cursor-pointer",onClick:n[7]||(n[7]=t=>function(e){const{isSuccessRef:t}=useCopyToClipboard(e);unref(t)&&a.success("复制成功")}(C.value.jnpfDomain+e.formConf.webhookUrl))},"复制链接")])),_:1},8,["value"])])),_:1,__:[19]}),createVNode(k,{label:"添加接口字段"},{default:withCtx((()=>[createBaseVNode("div",_hoisted_2$9,[createBaseVNode("span",{class:"link-text mr-20px inline-block",onClick:y},n[20]||(n[20]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("自定义添加")])),createBaseVNode("span",{class:"link-text mr-20px inline-block",onClick:n[8]||(n[8]=e=>unref(u)(!0,{}))},n[21]||(n[21]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("从JSON格式添加 ")])),createBaseVNode("span",{class:"link-text mr-20px inline-block",onClick:n[9]||(n[9]=t=>unref(N)(!0,{url:e.formConf.webhookGetFieldsUrl,randomStr:e.formConf.webhookRandomStr,id:e.formInfo.id}))},n[22]||(n[22]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("从请求接口添加 ")]))]),createBaseVNode("div",_hoisted_3$9,[createBaseVNode("div",_hoisted_4$6,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.formConf.formFieldList,((e,t)=>(openBlock(),createBlock(M,{gutter:8,key:t,class:"mt-10px"},{default:withCtx((()=>[createVNode(T,{span:10},{default:withCtx((()=>[createVNode(L,{value:e.id,"onUpdate:value":t=>e.id=t,placeholder:"字段",onChange:t=>w(e)},null,8,["value","onUpdate:value","onChange"])])),_:2},1024),createVNode(T,{span:13},{default:withCtx((()=>[createVNode(L,{value:e.fullName,"onUpdate:value":t=>e.fullName=t,placeholder:"字段说明",onChange:t=>w(e)},null,8,["value","onUpdate:value","onChange"])])),_:2},1024),createVNode(T,{span:1,class:"text-center"},{default:withCtx((()=>[createBaseVNode("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e){o.formConf.formFieldList.splice(e,1)}(t)},null,8,_hoisted_5$5)])),_:2},1024)])),_:2},1024)))),128))])])])),_:1})],64)):createCommentVNode("",!0)])),_:1},8,["model"]),[[vShow,"1"===unref(f)]]),withDirectives(createBaseVNode("div",null,[createVNode($,{colon:!1,model:e.formConf,layout:"vertical",class:"config-form"},{default:withCtx((()=>[createVNode(k,{label:"通知人"},{default:withCtx((()=>[createVNode(D,{value:e.formConf.msgUserType,"onUpdate:value":n[10]||(n[10]=t=>e.formConf.msgUserType=t),options:unref(msgUserOptions),multiple:""},null,8,["value","options"])])),_:1}),e.formConf.msgUserType.includes(3)?(openBlock(),createBlock(k,{key:0},{default:withCtx((()=>[n[23]||(n[23]=createBaseVNode("div",{class:"ant-form-item-label"},[createBaseVNode("label",{class:"ant-form-item-no-colon"},"选择用户")],-1)),createVNode(U,{value:e.formConf.msgUserIds,"onUpdate:value":n[11]||(n[11]=t=>e.formConf.msgUserIds=t),multiple:""},null,8,["value"])])),_:1,__:[23]})):createCommentVNode("",!0),createVNode(k,null,{label:withCtx((()=>[n[24]||(n[24]=createTextVNode("执行失败")),createVNode(b,{text:"执行失败时发送通知！"})])),default:withCtx((()=>[createVNode(D,{value:e.formConf.failMsgConfig.on,"onUpdate:value":n[12]||(n[12]=t=>e.formConf.failMsgConfig.on=t),options:unref(noticeOptions)},null,8,["value","options"])])),_:1}),1===e.formConf.failMsgConfig.on?(openBlock(),createBlock(k,{key:1},{default:withCtx((()=>[n[25]||(n[25]=createBaseVNode("div",{class:"ant-form-item-label"},[createBaseVNode("label",{class:"ant-form-item-no-colon"},"发送配置")],-1)),createVNode(_sfc_main$g,{value:e.formConf.failMsgConfig.msgId,title:e.formConf.failMsgConfig.msgName,messageSource:"3",onChange:n[13]||(n[13]=(e,t)=>_(s,e,t))},null,8,["value","title"])])),_:1,__:[25]})):createCommentVNode("",!0),createVNode(k,null,{label:withCtx((()=>[n[26]||(n[26]=createTextVNode("开始执行")),createVNode(b,{text:"开始执行时发送通知！"})])),default:withCtx((()=>[createVNode(D,{value:e.formConf.startMsgConfig.on,"onUpdate:value":n[14]||(n[14]=t=>e.formConf.startMsgConfig.on=t),options:unref(noticeOptions)},null,8,["value","options"])])),_:1}),1===e.formConf.startMsgConfig.on?(openBlock(),createBlock(k,{key:2},{default:withCtx((()=>[n[27]||(n[27]=createBaseVNode("div",{class:"ant-form-item-label"},[createBaseVNode("label",{class:"ant-form-item-no-colon"},"发送配置")],-1)),createVNode(_sfc_main$g,{value:e.formConf.startMsgConfig.msgId,title:e.formConf.startMsgConfig.msgName,messageSource:"3",onChange:n[15]||(n[15]=(e,t)=>_(d,e,t))},null,8,["value","title"])])),_:1,__:[27]})):createCommentVNode("",!0)])),_:1},8,["model"])],512),[[vShow,"2"===unref(f)]])])),_:1}),createVNode(BatchModal,{onRegister:unref(m),onConfirm:V},null,8,["onRegister"]),createVNode(_sfc_main$h,{onRegister:unref(p),onConfirm:V},null,8,["onRegister"])])}}}),_hoisted_1$a={class:"common-container"},_hoisted_2$8={class:"jnpf-content-wrapper"},_hoisted_3$8={class:"jnpf-content-wrapper-center"},_hoisted_4$5={class:"jnpf-content-wrapper-content"},_sfc_main$b=defineComponent({inheritAttrs:!1,__name:"MenuListModal",props:{value:{default:""},title:{type:String,default:""},placeholder:{type:String,default:"请选择"},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!0},size:{type:String,default:"default"},enableFlow:{default:""}},emits:["update:value","change"],setup(e,{emit:t}){const o=e,a=t,n=Form.useInjectFormItemContext(),{t:r}=useI18n(),l=ref(void 0),i=ref(!1),s=ref([]),[d,{getForm:c,getSelectRows:f,setSelectedRowKeys:m,getSelectRowKeys:u}]=useTable({api:getMenuSelectorForm,columns:[{title:"应用名称",dataIndex:"systemName"},{title:"菜单名称",dataIndex:"fullName"},{title:"编码",dataIndex:"enCode"},{title:"类型",dataIndex:"typeName",width:60}],immediate:!1,useSearchForm:!0,formConfig:{baseColProps:{span:8},schemas:[{field:"keyword",label:r("common.keyword"),component:"Input",componentProps:{placeholder:r("common.enterKeyword"),submitOnPressEnter:!0}},{field:"systemId",label:"应用",component:"Select"}]},tableSetting:{size:!1,setting:!1},isCanResizeParent:!0,resizeHeightOffset:-74,rowSelection:{type:"radio"}}),p=computed((()=>({...pick(o,["disabled","size","allowClear","placeholder"]),fieldNames:{label:"fullName",value:"id"},open:!1,showSearch:!1,showArrow:!0})));function N(){s.value=[],a("change","",{})}async function C(){o.disabled||(i.value=!0,nextTick((()=>{c().resetFields(),m(l.value?[l.value]:[]),getSystemList({enabledMark:1}).then((e=>{const t=(e.data?.list||[]).filter((e=>!e.mainSystem));c().updateSchema({field:"systemId",componentProps:{options:t}})}))})))}function g(){i.value=!1}function h(){if(!u().length&&!f().length)return;if(!f().length)return a("update:value",l.value),a("change",l.value,s.value[0]),n.onFieldChange(),void g();const e=f()[0];s.value=f(),l.value=e.id,a("update:value",e.id),a("change",e.id,e),n.onFieldChange(),g()}return watch((()=>o.value),(e=>{var t;t=e,l.value=t||void 0,s.value=[{id:l.value,fullName:o.title}]}),{immediate:!0}),(e,t)=>{const o=resolveComponent("a-select");return openBlock(),createElementBlock("div",_hoisted_1$a,[createVNode(o,mergeProps({value:l.value,"onUpdate:value":t[0]||(t[0]=e=>l.value=e)},p.value,{options:s.value,onChange:N,onClick:C}),null,16,["value","options"]),createVNode(unref(Modal),{open:i.value,"onUpdate:open":t[1]||(t[1]=e=>i.value=e),title:"菜单选择",width:800,class:"common-container-modal",onOk:h,onCancel:g,maskClosable:!1},{closeIcon:withCtx((()=>[createVNode(ModalClose,{canFullscreen:!1,onCancel:g})])),default:withCtx((()=>[createBaseVNode("div",_hoisted_2$8,[createBaseVNode("div",_hoisted_3$8,[createBaseVNode("div",_hoisted_4$5,[createVNode(unref(BasicTable),{onRegister:unref(d),class:"jnpf-sub-table"},null,8,["onRegister"])])])])])),_:1},8,["open"])])}}}),_hoisted_1$9={class:"common-pane"},_hoisted_2$7={class:"condition-main"},_hoisted_3$7=["onClick"],_hoisted_4$4={class:"condition-main condition-main-bordered"},_hoisted_5$4={key:0,class:"mb-10px"},_hoisted_6$3={class:"condition-item-title"},_hoisted_7$2=["onClick"],_hoisted_8$2={class:"condition-item-content"},_hoisted_9$2={class:"condition-item-cap"},_hoisted_10$1=["onClick"],_hoisted_11$1=["onClick"],_sfc_main$a=defineComponent({name:"addDataNode",inheritAttrs:!1,__name:"AddDataNode",props:["formConf","integrateType","formFieldsOptions","usedFormItems","getFormFieldList"],setup(e){const t=e,{createMessage:o}=useMessage(),a=[{id:0,fullName:"不新增数据"},{id:1,fullName:"新增一条数据"}],n={field:"",symbol:"==",fieldValueType:1,fieldValue:void 0,jnpfKey:"",fieldValueJnpfKey:"",cellKey:+new Date},r={logic:"and",groups:[n]},l=computed((()=>t.formConf.formFieldList.filter((e=>e.id.indexOf("-")<0&&!notSupportList.includes(e.__config__.jnpfKey)))));function i(e,o){if(!e||t.formConf.id!==e){if(t.formConf.ruleList=[cloneDeep(r)],t.formConf.flowId="",!e)return t.formConf.formName="",t.formConf.id="",t.formConf.formId="",t.formConf.flowId="",t.formConf.formFieldList=[],void(t.formConf.transferList=[]);t.formConf.formName=o.fullName,t.formConf.id=e,t.formConf.formId=o.formId,t.formConf.flowId=o.flowId,t.formConf.transferList=[],t.getFormFieldList(o.formId,"addData",!1,!1)}}function s(e){if(t.formConf.ruleList.length<=1)return o.error("必须保留一个条件");t.formConf.ruleList.splice(e,1)}function d(e){let o=[];for(let a=0;a<t.formConf.transferList.length;a++){const n=t.formConf.transferList[a];n.targetField&&e!==a&&o.push(n.targetField)}return t.formConf.formFieldList.filter((e=>!o.includes(e.id)))}return(c,f)=>{const m=resolveComponent("a-form-item"),u=resolveComponent("a-col"),p=resolveComponent("a-row"),N=resolveComponent("jnpf-select"),C=resolveComponent("a-input"),g=resolveComponent("BasicHelp"),h=resolveComponent("jnpf-radio"),_=resolveComponent("a-form");return openBlock(),createElementBlock("section",_hoisted_1$9,[createVNode(unref(ScrollContainer),{class:"config-content"},{default:withCtx((()=>[createVNode(_,{colon:!1,layout:"vertical",model:e.formConf,class:"config-form"},{default:withCtx((()=>[createVNode(m,{label:"目标表单"},{default:withCtx((()=>[createVNode(_sfc_main$b,{value:e.formConf.id,title:e.formConf.formName,allowClear:!1,onChange:i,placeholder:"请选择"},null,8,["value","title"])])),_:1}),createVNode(m,{label:"字段设置",class:"!flex-nowrap"},{default:withCtx((()=>[createBaseVNode("div",_hoisted_2$7,[createVNode(p,{gutter:8},{default:withCtx((()=>[createVNode(u,{span:7},{default:withCtx((()=>f[4]||(f[4]=[createTextVNode("选择目标表单字段")]))),_:1,__:[4]}),createVNode(u,{span:3}),createVNode(u,{span:14},{default:withCtx((()=>f[5]||(f[5]=[createTextVNode("设置触发表单字段或自定义值 ")]))),_:1,__:[5]})])),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.formConf.transferList,((o,a)=>(openBlock(),createBlock(p,{gutter:8,key:a,class:"mt-10px"},{default:withCtx((()=>[createVNode(u,{span:7},{default:withCtx((()=>[createVNode(N,{value:o.targetField,"onUpdate:value":e=>o.targetField=e,options:d(a),placeholder:"请选择",showSearch:"",allowClear:"",disabled:o.required,fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options","disabled"])])),_:2},1024),createVNode(u,{span:3,class:"leading-32px"},{default:withCtx((()=>f[6]||(f[6]=[createTextVNode("的值设为")]))),_:1,__:[6]}),createVNode(u,{span:5},{default:withCtx((()=>[createVNode(N,{value:o.sourceType,"onUpdate:value":e=>o.sourceType=e,options:unref(sourceTypeOptions),onChange:e=>o.sourceValue=""},null,8,["value","onUpdate:value","options","onChange"])])),_:2},1024),createVNode(u,{span:8},{default:withCtx((()=>[1===o.sourceType?(openBlock(),createBlock(N,{key:0,value:o.sourceValue,"onUpdate:value":e=>o.sourceValue=e,options:e.formFieldsOptions,placeholder:"请选择",showSearch:"",allowClear:"",fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options"])):createCommentVNode("",!0),2===o.sourceType?(openBlock(),createBlock(C,{key:1,value:o.sourceValue,"onUpdate:value":e=>o.sourceValue=e,placeholder:"请输入",allowClear:""},null,8,["value","onUpdate:value"])):createCommentVNode("",!0)])),_:2},1024),o.required?createCommentVNode("",!0):(openBlock(),createBlock(u,{key:0,span:1,class:"text-center"},{default:withCtx((()=>[createBaseVNode("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e){t.formConf.transferList.splice(e,1)}(a)},null,8,_hoisted_3$7)])),_:2},1024))])),_:2},1024)))),128)),createBaseVNode("span",{class:"link-text mt-10px inline-block",onClick:f[0]||(f[0]=e=>{t.formConf.transferList.push({targetField:"",targetFieldLabel:"",sourceType:1,sourceValue:"",required:!1})})},f[7]||(f[7]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("添加字段")]))])])),_:1}),1!=e.integrateType?(openBlock(),createBlock(m,{key:0,class:"!flex-nowrap"},{label:withCtx((()=>[f[8]||(f[8]=createTextVNode("唯一性验证")),createVNode(g,{text:"判断目标表单与触发表单是否同一条数据"})])),default:withCtx((()=>[createBaseVNode("div",_hoisted_4$4,[e.formConf.ruleList?.length?(openBlock(),createElementBlock("div",_hoisted_5$4,[createVNode(h,{value:e.formConf.ruleMatchLogic,"onUpdate:value":f[1]||(f[1]=t=>e.formConf.ruleMatchLogic=t),options:unref(logicOptions),optionType:"button","button-style":"solid"},null,8,["value","options"])])):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.formConf.ruleList,((a,r)=>(openBlock(),createElementBlock("div",{class:"condition-item",key:r},[createBaseVNode("div",_hoisted_6$3,[f[9]||(f[9]=createBaseVNode("div",null,"条件组",-1)),createBaseVNode("i",{class:"icon-ym icon-ym-nav-close",onClick:e=>s(r)},null,8,_hoisted_7$2)]),createBaseVNode("div",_hoisted_8$2,[createBaseVNode("div",_hoisted_9$2,[f[10]||(f[10]=createTextVNode(" 以下条件全部执行： ")),createVNode(h,{value:a.logic,"onUpdate:value":e=>a.logic=e,options:unref(logicOptions),optionType:"button","button-style":"solid",size:"small"},null,8,["value","onUpdate:value","options"])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(a.groups,((a,i)=>(openBlock(),createBlock(p,{gutter:8,key:r+i,class:"mb-10px"},{default:withCtx((()=>[createVNode(u,{span:8},{default:withCtx((()=>[createVNode(N,{value:a.field,"onUpdate:value":e=>a.field=e,options:l.value,placeholder:"请选择目标表单字段",showSearch:"",allowClear:"",fieldNames:{options:"options1"},onChange:(e,o)=>function(e,o,a,r,l){if(!o)return e.jnpfKey="",void(2==e.fieldValueType&&(e.fieldValue=void 0,e.fieldValueJnpfKey=""));e.jnpfKey=a.__config__.jnpfKey;const i=cloneDeep(n);for(let t of Object.keys(i))i[t]=e[t];2==(e={...i,...a}).fieldValueType&&(e.fieldValue=void 0,e.fieldValueJnpfKey=""),t.formConf.ruleList[r].groups[l]=e}(a,e,o,r,i)},null,8,["value","onUpdate:value","options","onChange"])])),_:2},1024),createVNode(u,{span:5},{default:withCtx((()=>[createVNode(N,{class:"w-full",value:a.symbol,"onUpdate:value":e=>a.symbol=e,placeholder:"运算符号",options:unref(symbolOptions),disabled:""},null,8,["value","onUpdate:value","options"])])),_:2},1024),createVNode(u,{span:10},{default:withCtx((()=>[createVNode(N,{value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,options:e.usedFormItems,placeholder:"请选择触发表单字段",showSearch:"",allowClear:"",fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options"])])),_:2},1024),createVNode(u,{span:1,class:"text-center"},{default:withCtx((()=>[createBaseVNode("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e,a){if(t.formConf.ruleList.length<=1&&t.formConf.ruleList[0].groups.length<=1)return o.error("必须保留一个条件");t.formConf.ruleList[e].groups.splice(a,1),t.formConf.ruleList[e].groups.length||s(e)}(r,i)},null,8,_hoisted_10$1)])),_:2},1024)])),_:2},1024)))),128)),createBaseVNode("span",{class:"link-text inline-block",onClick:e=>function(e){t.formConf.ruleList[e].groups.push(cloneDeep(n))}(r)},f[11]||(f[11]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("添加条件")]),8,_hoisted_11$1)])])))),128)),createBaseVNode("span",{class:"link-text inline-block",onClick:f[2]||(f[2]=e=>{t.formConf.ruleList.push(cloneDeep(r))})},f[12]||(f[12]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("添加条件组")]))])])),_:1})):createCommentVNode("",!0),1!=e.integrateType?(openBlock(),createBlock(m,{key:1,label:"数据存在时"},{default:withCtx((()=>[createVNode(h,{value:e.formConf.addRule,"onUpdate:value":f[3]||(f[3]=t=>e.formConf.addRule=t),options:a},null,8,["value"])])),_:1})):createCommentVNode("",!0)])),_:1},8,["model"])])),_:1})])}}}),_hoisted_1$8={class:"common-pane"},_hoisted_2$6={class:"condition-main"},_hoisted_3$6=["onClick"],_hoisted_4$3={class:"condition-main condition-main-bordered"},_hoisted_5$3={key:0,class:"mb-10px"},_hoisted_6$2={class:"condition-item-title"},_hoisted_7$1=["onClick"],_hoisted_8$1={class:"condition-item-content"},_hoisted_9$1={class:"condition-item-cap"},_hoisted_10=["onClick"],_hoisted_11=["onClick"],_sfc_main$9=defineComponent({name:"addDataNode",inheritAttrs:!1,__name:"UpdateDataNode",props:["formConf","integrateType","formFieldsOptions","usedFormItems","getFormFieldList","flowOptions"],setup(e,{expose:t}){t({initCondition:function(){if(1!=o.integrateType)return;a.value?.init({conditionList:o.formConf.ruleList||[],matchLogic:o.formConf.ruleMatchLogic,fieldOptions:unref(s)})},submitCondition:function(){const e=a.value?.confirm();return e||!1}});const o=e,a=ref(),{createMessage:n}=useMessage(),r=[{id:0,fullName:"跳过不更新"},{id:1,fullName:"新增一条数据"}],l={field:"",symbol:"==",fieldValueType:1,fieldValue:void 0,jnpfKey:"",fieldValueJnpfKey:"",cellKey:+new Date},i={logic:"and",groups:[l]},s=computed((()=>o.formConf.formFieldList.filter((e=>e.id.indexOf("-")<0&&!notSupportList.includes(e.__config__.jnpfKey)))));function d(e,t){if(!e||o.formConf.id!==e){if(o.formConf.transferList=[],1!=o.integrateType?o.formConf.ruleList=[cloneDeep(i)]:o.formConf.ruleList=[],o.formConf.flowId="",!e)return o.formConf.formName="",o.formConf.id="",o.formConf.formId="",o.formConf.flowId="",o.formConf.enableFlow=0,void(o.formConf.formFieldList=[]);o.formConf.formName=t.fullName,o.formConf.id=e,o.formConf.formId=t.formId,o.formConf.flowId=t.flowId,o.formConf.enableFlow=t.enableFlow,o.getFormFieldList(t.formId,"updateData",!1,!1)}}function c(e){if(1!=o.integrateType&&o.formConf.ruleList.length<=1)return n.error("必须保留一个条件");o.formConf.ruleList.splice(e,1),o.formConf.ruleList[e].groups.length||c(e)}function f(e){let t=[];for(let a=0;a<o.formConf.transferList.length;a++){const n=o.formConf.transferList[a];n.targetField&&e!==a&&t.push(n.targetField)}return o.formConf.formFieldList.filter((e=>!t.includes(e.id)))}return(t,m)=>{const u=resolveComponent("a-form-item"),p=resolveComponent("a-col"),N=resolveComponent("a-row"),C=resolveComponent("jnpf-select"),g=resolveComponent("a-input"),h=resolveComponent("BasicHelp"),_=resolveComponent("jnpf-radio"),v=resolveComponent("a-form");return openBlock(),createElementBlock("section",_hoisted_1$8,[createVNode(unref(ScrollContainer),{class:"config-content"},{default:withCtx((()=>[createVNode(v,{colon:!1,layout:"vertical",model:e.formConf,class:"config-form"},{default:withCtx((()=>[createVNode(u,{label:"目标表单"},{default:withCtx((()=>[createVNode(_sfc_main$b,{value:e.formConf.id,title:e.formConf.formName,allowClear:!1,onChange:d,placeholder:"请选择"},null,8,["value","title"])])),_:1}),createVNode(u,{label:"更新字段",class:"!flex-nowrap"},{default:withCtx((()=>[createBaseVNode("div",_hoisted_2$6,[createVNode(N,{gutter:8},{default:withCtx((()=>[createVNode(p,{span:7},{default:withCtx((()=>m[4]||(m[4]=[createTextVNode("选择目标表单字段")]))),_:1,__:[4]}),createVNode(p,{span:3}),createVNode(p,{span:14},{default:withCtx((()=>m[5]||(m[5]=[createTextVNode("设置触发表单字段或自定义值 ")]))),_:1,__:[5]})])),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.formConf.transferList,((t,a)=>(openBlock(),createBlock(N,{gutter:8,key:a,class:"mt-10px"},{default:withCtx((()=>[createVNode(p,{span:7},{default:withCtx((()=>[createVNode(C,{value:t.targetField,"onUpdate:value":e=>t.targetField=e,options:f(a),placeholder:"请选择",showSearch:"",allowClear:"",disabled:t.required,fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options","disabled"])])),_:2},1024),createVNode(p,{span:3,class:"leading-32px"},{default:withCtx((()=>m[6]||(m[6]=[createTextVNode("的值设为")]))),_:1,__:[6]}),createVNode(p,{span:5},{default:withCtx((()=>[createVNode(C,{value:t.sourceType,"onUpdate:value":e=>t.sourceType=e,options:unref(sourceTypeOptions),onChange:e=>t.sourceValue=""},null,8,["value","onUpdate:value","options","onChange"])])),_:2},1024),createVNode(p,{span:8},{default:withCtx((()=>[1===t.sourceType?(openBlock(),createBlock(C,{key:0,value:t.sourceValue,"onUpdate:value":e=>t.sourceValue=e,options:e.formFieldsOptions,placeholder:"请选择",showSearch:"",allowClear:"",fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options"])):createCommentVNode("",!0),2===t.sourceType?(openBlock(),createBlock(g,{key:1,value:t.sourceValue,"onUpdate:value":e=>t.sourceValue=e,placeholder:"请输入",allowClear:""},null,8,["value","onUpdate:value"])):createCommentVNode("",!0)])),_:2},1024),t.required?createCommentVNode("",!0):(openBlock(),createBlock(p,{key:0,span:1,class:"text-center"},{default:withCtx((()=>[createBaseVNode("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e){o.formConf.transferList.splice(e,1)}(a)},null,8,_hoisted_3$6)])),_:2},1024))])),_:2},1024)))),128)),createBaseVNode("span",{class:"link-text mt-10px inline-block",onClick:m[0]||(m[0]=e=>{o.formConf.transferList.push({targetField:"",targetFieldLabel:"",sourceType:1,sourceValue:"",required:!1})})},m[7]||(m[7]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("添加字段")]))])])),_:1}),1==e.integrateType?(openBlock(),createBlock(u,{key:0,label:"更新条件",class:"!flex-nowrap"},{default:withCtx((()=>[createVNode(_sfc_main$f,{ref_key:"conditionMainRef",ref:a,bordered:"",showFieldValueType:"",valueFieldOptions:e.usedFormItems},null,8,["valueFieldOptions"])])),_:1})):createCommentVNode("",!0),1!=e.integrateType?(openBlock(),createBlock(u,{key:1,class:"!flex-nowrap"},{label:withCtx((()=>[m[8]||(m[8]=createTextVNode("唯一性验证")),createVNode(h,{text:"判断目标表单与触发表单是否同一条数据"})])),default:withCtx((()=>[createBaseVNode("div",_hoisted_4$3,[e.formConf.ruleList?.length?(openBlock(),createElementBlock("div",_hoisted_5$3,[createVNode(_,{value:e.formConf.ruleMatchLogic,"onUpdate:value":m[1]||(m[1]=t=>e.formConf.ruleMatchLogic=t),options:unref(logicOptions),optionType:"button","button-style":"solid"},null,8,["value","options"])])):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.formConf.ruleList,((t,a)=>(openBlock(),createElementBlock("div",{class:"condition-item",key:a},[createBaseVNode("div",_hoisted_6$2,[m[9]||(m[9]=createBaseVNode("div",null,"条件组",-1)),createBaseVNode("i",{class:"icon-ym icon-ym-nav-close",onClick:e=>c(a)},null,8,_hoisted_7$1)]),createBaseVNode("div",_hoisted_8$1,[createBaseVNode("div",_hoisted_9$1,[m[10]||(m[10]=createTextVNode(" 以下条件全部执行： ")),createVNode(_,{value:t.logic,"onUpdate:value":e=>t.logic=e,options:unref(logicOptions),optionType:"button","button-style":"solid",size:"small"},null,8,["value","onUpdate:value","options"])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(t.groups,((t,r)=>(openBlock(),createBlock(N,{gutter:8,key:a+r,class:"mb-10px"},{default:withCtx((()=>[createVNode(p,{span:8},{default:withCtx((()=>[createVNode(C,{value:t.field,"onUpdate:value":e=>t.field=e,options:s.value,placeholder:"请选择目标表单字段",showSearch:"",allowClear:"",fieldNames:{options:"options1"},onChange:(e,n)=>function(e,t,a,n,r){if(!t)return e.jnpfKey="",void(2==e.fieldValueType&&(e.fieldValue=void 0,e.fieldValueJnpfKey=""));e.jnpfKey=a.__config__.jnpfKey;const i=cloneDeep(l);for(let o of Object.keys(i))i[o]=e[o];2==(e={...i,...a}).fieldValueType&&(e.fieldValue=void 0,e.fieldValueJnpfKey=""),o.formConf.ruleList[n].groups[r]=e}(t,e,n,a,r)},null,8,["value","onUpdate:value","options","onChange"])])),_:2},1024),createVNode(p,{span:5},{default:withCtx((()=>[createVNode(C,{class:"w-full",value:t.symbol,"onUpdate:value":e=>t.symbol=e,placeholder:"运算符号",options:unref(symbolOptions),disabled:""},null,8,["value","onUpdate:value","options"])])),_:2},1024),createVNode(p,{span:10},{default:withCtx((()=>[createVNode(C,{value:t.fieldValue,"onUpdate:value":e=>t.fieldValue=e,options:e.usedFormItems,placeholder:"请选择触发表单字段",showSearch:"",allowClear:"",fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options"])])),_:2},1024),createVNode(p,{span:1,class:"text-center"},{default:withCtx((()=>[createBaseVNode("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e,t){1!=o.integrateType&&o.formConf.ruleList.length<=1&&o.formConf.ruleList[0].groups.length<=1?n.error("必须保留一个条件"):(o.formConf.ruleList[e].groups.splice(t,1),o.formConf.ruleList[e].groups.length||c(e))}(a,r)},null,8,_hoisted_10)])),_:2},1024)])),_:2},1024)))),128)),createBaseVNode("span",{class:"link-text inline-block",onClick:e=>function(e){o.formConf.ruleList[e].groups.push(cloneDeep(l))}(a)},m[11]||(m[11]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("添加条件")]),8,_hoisted_11)])])))),128)),createBaseVNode("span",{class:"link-text inline-block",onClick:m[2]||(m[2]=e=>{o.formConf.ruleList.push(cloneDeep(i))})},m[12]||(m[12]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("添加条件组")]))])])),_:1})):createCommentVNode("",!0),createVNode(u,null,{label:withCtx((()=>[m[13]||(m[13]=createTextVNode("未找到数据时")),createVNode(h,{text:"找到数据的直接更新，未找到数据的配置以下动作！"})])),default:withCtx((()=>[createVNode(_,{value:e.formConf.unFoundRule,"onUpdate:value":m[3]||(m[3]=t=>e.formConf.unFoundRule=t),options:r},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1})])}}}),_hoisted_1$7={class:"common-pane"},_hoisted_2$5={class:"condition-main condition-main-bordered"},_hoisted_3$5={key:0,class:"mb-10px"},_hoisted_4$2={class:"condition-item-title"},_hoisted_5$2=["onClick"],_hoisted_6$1={class:"condition-item-content"},_hoisted_7={class:"condition-item-cap"},_hoisted_8=["onClick"],_hoisted_9=["onClick"],_sfc_main$8=defineComponent({name:"deleteDataNode",inheritAttrs:!1,__name:"DeleteDataNode",props:["formConf","integrateType","formFieldsOptions","usedFormItems","getFormFieldList"],setup(e,{expose:t}){t({initCondition:function(){if(1!=o.integrateType)return;a.value?.init({conditionList:o.formConf.ruleList||[],matchLogic:o.formConf.ruleMatchLogic,fieldOptions:unref(s)})},submitCondition:function(){const e=a.value?.confirm();return e||!1}});const o=e,a=ref(),{createMessage:n}=useMessage(),r=[{id:0,fullName:"删除未找到的数据"},{id:1,fullName:"删除已找到的数据"}],l={field:"",symbol:"==",fieldValueType:1,fieldValue:void 0,jnpfKey:"",fieldValueJnpfKey:"",cellKey:+new Date},i={logic:"and",groups:[l]},s=computed((()=>o.formConf.formFieldList.filter((e=>e.id.indexOf("-")<0&&!notSupportList.includes(e.__config__.jnpfKey)))));function d(e,t){if(!e||o.formConf.id!==e){if(o.formConf.transferList=[],1!=o.integrateType?o.formConf.ruleList=[cloneDeep(i)]:o.formConf.ruleList=[],!e)return o.formConf.formName="",o.formConf.id="",o.formConf.formId="",o.formConf.flowId="",void(o.formConf.formFieldList=[]);o.formConf.formName=t.fullName,o.formConf.id=e,o.formConf.formId=t.formId,o.formConf.flowId=t.flowId,o.getFormFieldList(t.formId,"deleteData",!1,!1)}}function c(e){if(1!=o.integrateType&&o.formConf.ruleList.length<=1)return n.error("必须保留一个条件");o.formConf.ruleList.splice(e,1)}return(t,f)=>{const m=resolveComponent("a-form-item"),u=resolveComponent("BasicHelp"),p=resolveComponent("jnpf-radio"),N=resolveComponent("jnpf-select"),C=resolveComponent("a-col"),g=resolveComponent("a-row"),h=resolveComponent("a-form");return openBlock(),createElementBlock("section",_hoisted_1$7,[createVNode(unref(ScrollContainer),{class:"config-content"},{default:withCtx((()=>[createVNode(h,{colon:!1,layout:"vertical",model:e.formConf,class:"config-form"},{default:withCtx((()=>[createVNode(m,{label:"目标表单"},{default:withCtx((()=>[createVNode(_sfc_main$b,{value:e.formConf.id,title:e.formConf.formName,allowClear:!1,onChange:d,placeholder:"请选择"},null,8,["value","title"])])),_:1}),1==e.integrateType?(openBlock(),createBlock(m,{key:0,label:"删除条件",class:"!flex-nowrap"},{default:withCtx((()=>[createVNode(_sfc_main$f,{ref_key:"conditionMainRef",ref:a,bordered:"",showFieldValueType:"",valueFieldOptions:e.usedFormItems},null,8,["valueFieldOptions"])])),_:1})):createCommentVNode("",!0),1!=e.integrateType?(openBlock(),createBlock(m,{key:1,class:"!flex-nowrap"},{label:withCtx((()=>[f[3]||(f[3]=createTextVNode("唯一性验证")),createVNode(u,{text:"判断目标表单与触发表单是否同一条数据"})])),default:withCtx((()=>[createBaseVNode("div",_hoisted_2$5,[e.formConf.ruleList?.length?(openBlock(),createElementBlock("div",_hoisted_3$5,[createVNode(p,{value:e.formConf.ruleMatchLogic,"onUpdate:value":f[0]||(f[0]=t=>e.formConf.ruleMatchLogic=t),options:unref(logicOptions),optionType:"button","button-style":"solid"},null,8,["value","options"])])):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.formConf.ruleList,((t,a)=>(openBlock(),createElementBlock("div",{class:"condition-item",key:a},[createBaseVNode("div",_hoisted_4$2,[f[4]||(f[4]=createBaseVNode("div",null,"条件组",-1)),createBaseVNode("i",{class:"icon-ym icon-ym-nav-close",onClick:e=>c(a)},null,8,_hoisted_5$2)]),createBaseVNode("div",_hoisted_6$1,[createBaseVNode("div",_hoisted_7,[f[5]||(f[5]=createTextVNode(" 以下条件全部执行： ")),createVNode(p,{value:t.logic,"onUpdate:value":e=>t.logic=e,options:unref(logicOptions),optionType:"button","button-style":"solid",size:"small"},null,8,["value","onUpdate:value","options"])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(t.groups,((t,r)=>(openBlock(),createBlock(g,{gutter:8,key:a+r,class:"mb-10px"},{default:withCtx((()=>[createVNode(C,{span:8},{default:withCtx((()=>[createVNode(N,{value:t.field,"onUpdate:value":e=>t.field=e,options:s.value,placeholder:"请选择目标表单字段",showSearch:"",allowClear:"",fieldNames:{options:"options1"},onChange:(e,n)=>function(e,t,a,n,r){if(!t)return e.jnpfKey="",void(2==e.fieldValueType&&(e.fieldValue=void 0,e.fieldValueJnpfKey=""));e.jnpfKey=a.__config__.jnpfKey;const i=cloneDeep(l);for(let o of Object.keys(i))i[o]=e[o];2==(e={...i,...a}).fieldValueType&&(e.fieldValue=void 0,e.fieldValueJnpfKey=""),o.formConf.ruleList[n].groups[r]=e}(t,e,n,a,r)},null,8,["value","onUpdate:value","options","onChange"])])),_:2},1024),createVNode(C,{span:5},{default:withCtx((()=>[createVNode(N,{class:"w-full",value:t.symbol,"onUpdate:value":e=>t.symbol=e,placeholder:"运算符号",options:unref(symbolOptions),disabled:""},null,8,["value","onUpdate:value","options"])])),_:2},1024),createVNode(C,{span:10},{default:withCtx((()=>[createVNode(N,{value:t.fieldValue,"onUpdate:value":e=>t.fieldValue=e,options:e.usedFormItems,placeholder:"请选择触发表单字段",showSearch:"",allowClear:"",fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options"])])),_:2},1024),createVNode(C,{span:1,class:"text-center"},{default:withCtx((()=>[createBaseVNode("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e,t){1!=o.integrateType&&o.formConf.ruleList.length<=1&&o.formConf.ruleList[0].groups.length<=1?n.error("必须保留一个条件"):(o.formConf.ruleList[e].groups.splice(t,1),o.formConf.ruleList[e].groups.length||c(e))}(a,r)},null,8,_hoisted_8)])),_:2},1024)])),_:2},1024)))),128)),createBaseVNode("span",{class:"link-text inline-block",onClick:e=>function(e){o.formConf.ruleList[e].groups.push(cloneDeep(l))}(a)},f[6]||(f[6]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("添加条件")]),8,_hoisted_9)])])))),128)),createBaseVNode("span",{class:"link-text inline-block",onClick:f[1]||(f[1]=e=>{o.formConf.ruleList.push(cloneDeep(i))})},f[7]||(f[7]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("添加条件组")]))])])),_:1})):createCommentVNode("",!0),1!=e.integrateType?(openBlock(),createBlock(m,{key:2,label:"删除内容"},{default:withCtx((()=>[createVNode(p,{value:e.formConf.deleteRule,"onUpdate:value":f[2]||(f[2]=t=>e.formConf.deleteRule=t),options:r},null,8,["value"])])),_:1})):createCommentVNode("",!0)])),_:1},8,["model"])])),_:1})])}}}),_hoisted_1$6={class:"common-pane"},_sfc_main$7=defineComponent({name:"dataInterfaceNode",inheritAttrs:!1,__name:"DataInterfaceNode",props:["formConf","integrateType","formFieldsOptions","getFormFieldList"],setup(e){const t=e;function o(e,o){if(!e||t.formConf.formId!==e)return e?void(t.formConf.formId!==e&&(t.formConf.formName=o.fullName,t.formConf.formId=e,t.formConf.templateJson=(o.templateJson||[]).map((e=>({...e,sourceType:1,relationField:""}))))):(t.formConf.formName="",t.formConf.formId="",void(t.formConf.templateJson=[]))}function a(e,o){if(!e)return;let a=t.formFieldsOptions.filter((t=>t.id===e));if(!a.length)return;let n=a[0];o.isSubTable=!(!n.__config__||!n.__config__.isSubTable)&&n.__config__.isSubTable}return(t,n)=>{const r=resolveComponent("a-form-item"),l=resolveComponent("a-form");return openBlock(),createElementBlock("section",_hoisted_1$6,[createVNode(unref(ScrollContainer),{class:"config-content"},{default:withCtx((()=>[createVNode(l,{colon:!1,layout:"vertical",model:e.formConf,class:"config-form"},{default:withCtx((()=>[createVNode(r,{label:"执行数据接口"},{default:withCtx((()=>[createVNode(unref(SelectInterface),{value:e.formConf.formId,title:e.formConf.formName,templateJson:e.formConf.templateJson,fieldOptions:e.formFieldsOptions,sourceType:3,allowClear:!1,onChange:o,onFieldChange:a},null,8,["value","title","templateJson","fieldOptions"])])),_:1})])),_:1},8,["model"])])),_:1})])}}}),_hoisted_1$5={class:"common-pane"},_hoisted_2$4=["onClick"],_hoisted_3$4=["title"],_sfc_main$6=defineComponent({name:"messageNode",inheritAttrs:!1,__name:"MessageNode",props:["formConf","integrateType","formFieldsOptions","getFormFieldList"],setup(e){const t=e,[o,{openModal:a}]=useModal(),n=[{width:50,title:"序号",align:"center",customRender:({index:e})=>e+1},{title:"模板名称",dataIndex:"msgTemplateName",key:"msgTemplateName",width:140},{title:"参数名称",dataIndex:"paramJson",key:"paramJson"},{title:"参数值",dataIndex:"field",key:"field",width:190}];return(r,l)=>{const i=resolveComponent("jnpf-users-select"),s=resolveComponent("a-form-item"),d=resolveComponent("jnpf-select"),c=resolveComponent("a-table"),f=resolveComponent("a-form");return openBlock(),createElementBlock("section",_hoisted_1$5,[createVNode(unref(ScrollContainer),{class:"config-content"},{default:withCtx((()=>[createVNode(f,{colon:!1,layout:"vertical",model:e.formConf,class:"config-form"},{default:withCtx((()=>[createVNode(s,{label:"接收人"},{default:withCtx((()=>[createVNode(i,{value:e.formConf.msgUserIds,"onUpdate:value":l[0]||(l[0]=t=>e.formConf.msgUserIds=t),placeholder:"请选择",multiple:""},null,8,["value"])])),_:1}),createVNode(s,{label:"通知内容"},{default:withCtx((()=>[l[3]||(l[3]=createBaseVNode("div",{class:"ant-form-item-label"},[createBaseVNode("label",{class:"ant-form-item-no-colon"},"发送配置")],-1)),createVNode(_sfc_main$g,{value:e.formConf.msgId,title:e.formConf.msgName,messageSource:"3",onChange:l[1]||(l[1]=(e,o)=>function(e,o){if(!e)return t.formConf.msgId="",t.formConf.msgName="",void(t.formConf.templateJson=[]);t.formConf.msgId!==e&&(t.formConf.msgId=e,t.formConf.msgName=o.fullName,t.formConf.templateJson=o.templateJson||[])}(e,o))},null,8,["value","title"]),l[4]||(l[4]=createBaseVNode("div",{class:"ant-form-item-label mt-12px"},[createBaseVNode("label",{class:"ant-form-item-no-colon"},"参数设置")],-1)),createVNode(c,{"data-source":e.formConf.templateJson,columns:n,size:"small",pagination:!1},{bodyCell:withCtx((({column:o,record:n})=>["msgTemplateName"===o.key?(openBlock(),createElementBlock("p",{key:0,class:"link-text",onClick:e=>{return t=n.templateId,void a(!0,{id:t});var t}},toDisplayString(n.msgTemplateName),9,_hoisted_2$4)):createCommentVNode("",!0),"paramJson"===o.key?(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(n.paramJson,((e,t)=>(openBlock(),createElementBlock("div",{class:"parameter-box",title:e.field+"("+e.fieldName+")",key:t},toDisplayString(e.field)+"("+toDisplayString(e.fieldName)+") ",9,_hoisted_3$4)))),128)):createCommentVNode("",!0),"field"===o.key?(openBlock(!0),createElementBlock(Fragment,{key:2},renderList(n.paramJson,((o,a)=>(openBlock(),createBlock(d,{value:o.relationField,"onUpdate:value":e=>o.relationField=e,placeholder:"请选择",options:e.formFieldsOptions,allowClear:"",showSearch:"",fieldNames:{label:"label",options:"options1"},optionLabelProp:"label",class:normalizeClass(["!w-170px",{"!mt-8px":a>0}]),onChange:e=>function(e,o){if(!e)return;let a=t.formFieldsOptions.filter((t=>t.id===e));if(!a.length)return;let n=a[0];o.isSubTable=!(!n.__config__||!n.__config__.isSubTable)&&n.__config__.isSubTable}(e,o),key:a},null,8,["value","onUpdate:value","options","class","onChange"])))),128)):createCommentVNode("",!0)])),emptyText:withCtx((()=>l[2]||(l[2]=[createBaseVNode("p",{class:"leading-60px"},"暂无数据",-1)]))),_:1},8,["data-source"])])),_:1,__:[3,4]})])),_:1},8,["model"])])),_:1}),createVNode(MsgTemplateDetail,{onRegister:unref(o)},null,8,["onRegister"])])}}}),_hoisted_1$4={class:"common-pane"},_sfc_main$5=defineComponent({name:"addDataNode",inheritAttrs:!1,__name:"GetDataNode",props:["formConf","integrateType","formFieldsOptions","getFormFieldList"],setup(e,{expose:t}){t({initCondition:s,submitCondition:function(){const e=a.value?.confirm();return e||!1}});const o=e,a=ref();function n(){i(),s()}function r(e,t){if(!e||o.formConf.id!==t.id){if(!e)return n();o.formConf.formName=t.fullName,o.formConf.id=e,o.formConf.formId=t.formId,o.formConf.flowId=t.flowId,o.formConf.ruleList=[],o.getFormFieldList(t.formId,"getData",!1,!1)}}function l(e,t){if(!e)return i();if(o.formConf.formId===e)return;o.formConf.formName=t.fullName,o.formConf.formId=e,o.formConf.ruleList=[];const a=t.fieldJson?JSON.parse(t.fieldJson):[];o.formConf.formFieldList=a.map((e=>({...e,id:e.defaultValue,fullName:e.field,label:e.field?e.defaultValue+"("+e.field+")":e.defaultValue}))),o.formConf.interfaceTemplateJson=(t.templateJson||[]).map((e=>({...e,sourceType:2,relationField:""})))}function i(){o.formConf.formName="",o.formConf.id="",o.formConf.formId="",o.formConf.flowId="",o.formConf.formFieldList=[],o.formConf.ruleList=[],o.formConf.interfaceTemplateJson=[]}function s(){1==o.formConf.formType&&a.value?.init({conditionList:o.formConf.ruleList||[],matchLogic:o.formConf.ruleMatchLogic,fieldOptions:o.formConf.formFieldList})}return(t,o)=>{const i=resolveComponent("BasicHelp"),s=resolveComponent("a-radio"),d=resolveComponent("a-radio-group"),c=resolveComponent("a-form-item"),f=resolveComponent("a-form");return openBlock(),createElementBlock("section",_hoisted_1$4,[createVNode(unref(ScrollContainer),{class:"config-content"},{default:withCtx((()=>[createVNode(f,{colon:!1,layout:"vertical",model:e.formConf,class:"config-form"},{default:withCtx((()=>[createVNode(c,{label:"获取方式"},{default:withCtx((()=>[createVNode(d,{value:e.formConf.formType,"onUpdate:value":o[0]||(o[0]=t=>e.formConf.formType=t),class:"common-radio formType-radio",onChange:n},{default:withCtx((()=>[createVNode(s,{value:1},{default:withCtx((()=>[o[1]||(o[1]=createTextVNode("从菜单中获取")),createVNode(i,{text:"获取流程数据时：只获取已完成的流程数据"})])),_:1,__:[1]}),createVNode(s,{value:3},{default:withCtx((()=>o[2]||(o[2]=[createTextVNode("从数据接口中获取")]))),_:1,__:[2]})])),_:1},8,["value"]),1==e.formConf.formType?(openBlock(),createBlock(_sfc_main$b,{key:0,value:e.formConf.id,title:e.formConf.formName,allowClear:!1,onChange:r,placeholder:"请选择"},null,8,["value","title"])):createCommentVNode("",!0),3==e.formConf.formType?(openBlock(),createBlock(unref(SelectInterface),{key:1,value:e.formConf.formId,title:e.formConf.formName,templateJson:e.formConf.interfaceTemplateJson,type:2,showSystemFormId:!1,allowClear:!1,onChange:l},null,8,["value","title","templateJson"])):createCommentVNode("",!0)])),_:1}),1==e.formConf.formType?(openBlock(),createBlock(c,{key:0,class:"!flex-nowrap"},{label:withCtx((()=>[o[3]||(o[3]=createTextVNode("获取条件")),createVNode(i,{text:"满足以下条件，触发执行动作。"})])),default:withCtx((()=>[createVNode(_sfc_main$f,{ref_key:"conditionMainRef",ref:a,bordered:""},null,512)])),_:1})):createCommentVNode("",!0)])),_:1},8,["model"])])),_:1})])}}}),_hoisted_1$3={class:"common-pane"},_hoisted_2$3={class:"ant-form-item"},_hoisted_3$3={class:"ant-form-item-label mt-12px"},_hoisted_4$1={class:"ant-form-item-no-colon"},_hoisted_5$1={class:"condition-main"},_hoisted_6=["onClick"],_sfc_main$4=defineComponent({name:"launchFlowNode",inheritAttrs:!1,__name:"LaunchFlowNode",props:["formConf","integrateType","formFieldsOptions","usedFormItems","getFlowFormFieldList","flowOptions"],setup(e){const t=e,o={logic:"and",groups:[{field:"",symbol:"==",fieldValueType:1,fieldValue:void 0,jnpfKey:"",fieldValueJnpfKey:"",cellKey:+new Date}]};function a(e,a){if(t.formConf.ruleList=[cloneDeep(o)],!e)return t.formConf.flowName="",t.formConf.flowId="",t.formConf.formFieldList=[],void(t.formConf.transferList=[]);t.formConf.flowName=a.fullName,t.formConf.flowId=e,t.formConf.transferList=[],t.getFlowFormFieldList(e,"launchFlow")}function n(e){let o=[];for(let a=0;a<t.formConf.transferList.length;a++){const n=t.formConf.transferList[a];n.targetField&&e!==a&&o.push(n.targetField)}return t.formConf.formFieldList.filter((e=>!o.includes(e.id)))}return(o,r)=>{const l=resolveComponent("a-form-item"),i=resolveComponent("BasicHelp"),s=resolveComponent("a-col"),d=resolveComponent("a-row"),c=resolveComponent("jnpf-select"),f=resolveComponent("a-input"),m=resolveComponent("jnpf-user-select"),u=resolveComponent("a-form");return openBlock(),createElementBlock("section",_hoisted_1$3,[createVNode(unref(ScrollContainer),{class:"config-content"},{default:withCtx((()=>[createVNode(u,{colon:!1,layout:"vertical",model:e.formConf,class:"config-form"},{default:withCtx((()=>[createVNode(l,{label:"选择流程"},{default:withCtx((()=>[createVNode(_sfc_main$i,{value:e.formConf.flowId,title:e.formConf.flowName,onChange:a,placeholder:"请选择",allowClear:!1},null,8,["value","title"])])),_:1}),createBaseVNode("div",_hoisted_2$3,[createBaseVNode("div",_hoisted_3$3,[createBaseVNode("label",_hoisted_4$1,[r[2]||(r[2]=createTextVNode("自动发起审批")),createVNode(i,{text:"流程发起的下一节点设置候选人时无法自动发起审批"})])])]),createVNode(l,{label:"字段设置",class:"!flex-nowrap"},{default:withCtx((()=>[createBaseVNode("div",_hoisted_5$1,[createVNode(d,{gutter:8},{default:withCtx((()=>[createVNode(s,{span:7},{default:withCtx((()=>r[3]||(r[3]=[createTextVNode("选择目标表单字段")]))),_:1,__:[3]}),createVNode(s,{span:3}),createVNode(s,{span:14},{default:withCtx((()=>r[4]||(r[4]=[createTextVNode("设置触发表单字段或自定义值 ")]))),_:1,__:[4]})])),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.formConf.transferList,((o,a)=>(openBlock(),createBlock(d,{gutter:8,key:a,class:"mt-10px"},{default:withCtx((()=>[createVNode(s,{span:7},{default:withCtx((()=>[createVNode(c,{value:o.targetField,"onUpdate:value":e=>o.targetField=e,options:n(a),placeholder:"请选择",showSearch:"",allowClear:"",disabled:o.required,fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options","disabled"])])),_:2},1024),createVNode(s,{span:3,class:"leading-32px"},{default:withCtx((()=>r[5]||(r[5]=[createTextVNode("的值设为")]))),_:1,__:[5]}),createVNode(s,{span:5},{default:withCtx((()=>[createVNode(c,{value:o.sourceType,"onUpdate:value":e=>o.sourceType=e,options:unref(sourceTypeOptions),onChange:e=>o.sourceValue=""},null,8,["value","onUpdate:value","options","onChange"])])),_:2},1024),createVNode(s,{span:8},{default:withCtx((()=>[1===o.sourceType?(openBlock(),createBlock(c,{key:0,value:o.sourceValue,"onUpdate:value":e=>o.sourceValue=e,options:e.formFieldsOptions,placeholder:"请选择",showSearch:"",allowClear:"",fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options"])):createCommentVNode("",!0),2===o.sourceType?(openBlock(),createBlock(f,{key:1,value:o.sourceValue,"onUpdate:value":e=>o.sourceValue=e,placeholder:"请输入",allowClear:""},null,8,["value","onUpdate:value"])):createCommentVNode("",!0)])),_:2},1024),o.required?createCommentVNode("",!0):(openBlock(),createBlock(s,{key:0,span:1,class:"text-center"},{default:withCtx((()=>[createBaseVNode("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e){t.formConf.transferList.splice(e,1)}(a)},null,8,_hoisted_6)])),_:2},1024))])),_:2},1024)))),128)),createBaseVNode("span",{class:"link-text mt-10px inline-block",onClick:r[0]||(r[0]=e=>{t.formConf.transferList.push({targetField:"",targetFieldLabel:"",sourceType:1,sourceValue:"",required:!1})})},r[6]||(r[6]=[createBaseVNode("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),createTextVNode("添加字段")]))])])),_:1}),createVNode(l,null,{label:withCtx((()=>[r[7]||(r[7]=createTextVNode("发起人")),createVNode(i,{text:"多个审批人时产生多条流程实例"})])),default:withCtx((()=>[createVNode(m,{value:e.formConf.initiator,"onUpdate:value":r[1]||(r[1]=t=>e.formConf.initiator=t),multiple:"",placeholder:"请选择"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1})])}}}),_sfc_main$3=defineComponent({__name:"index",props:["value","processData","formInfo"],emits:["cancel","confirm"],setup(__props,{emit:__emit}){const props=__props,emit=__emit,{createMessage:createMessage}=useMessage(),[registerDrawer,{openDrawer:openDrawer,closeDrawer:closeDrawer}]=useDrawer(),state=reactive({properties:{},activeKey:"1",startForm:cloneDeep(nodeConfig.defaultStartForm),addDataForm:{},updateDataForm:{},deleteDataForm:{},dataInterfaceForm:{},messageForm:{},getDataForm:{},launchFlowForm:{}}),{properties:properties,startForm:startForm}=toRefs(state),startNodeRef=ref(),getDataNodeRef=ref(),updateDataNodeRef=ref(),deleteDataNodeRef=ref(),integrateType=computed((()=>props.formInfo?.type||1)),formFieldsOptions=computed((()=>{const e=cloneDeep(2!=unref(integrateType)?props.processData.properties.formFieldList||[]:props.processData.childNode.properties.formFieldList||[]);if(!isDataInterfaceNode()&&!isGetDataNode()){e.some((e=>"@formId"===e.id))||e.unshift({fullName:"@表单ID",id:"@formId",label:"@formId(@表单ID)"})}return e})),usedFormItems=computed((()=>unref(formFieldsOptions).filter((e=>e.id.indexOf("-")<0)))),getBindValue=computed((()=>({...props,integrateType:unref(integrateType),formFieldsOptions:unref(formFieldsOptions),usedFormItems:unref(usedFormItems),getFormFieldList:getFormFieldList,getFlowFormFieldList:getFlowFormFieldList})));function initCommonNodeData(key){"start"!==key&&(state[key+"Form"]={});let properties=cloneDeep(props.value.properties);Object.assign(state[key+"Form"],properties),nextTick((async()=>{if(("getData"===key||["start","updateData","deleteData"].includes(key)&&1==unref(integrateType))&&unref(eval(key+"NodeRef"))?.initCondition(),2==unref(integrateType)&&["addData","updateData","deleteData"].includes(key)&&!state[key+"Form"].ruleList.length){const e={field:"",symbol:"==",fieldValueType:1,fieldValue:void 0,jnpfKey:"",fieldValueJnpfKey:"",cellKey:+new Date},t={logic:"and",groups:[e]};state[key+"Form"].ruleList.push(cloneDeep(t))}if(3==unref(integrateType)&&"start"===key&&!state[key+"Form"].webhookUrl){const e=await getWebhookUrl(props.formInfo.id);if(!e)return;state[key+"Form"].webhookUrl=e.data.webhookUrl,state[key+"Form"].webhookGetFieldsUrl=e.data.requestUrl,state[key+"Form"].webhookRandomStr=e.data.randomStr}}))}function startNodeConfirm(){if(1==unref(integrateType)){if(!state.startForm.formId)return createMessage.error("请选择触发表单");const e=startNodeRef.value?.submitCondition();if(!e)return;if(1===state.startForm.failMsgConfig.on&&!state.startForm.failMsgConfig.msgId)return createMessage.error("请选择执行失败发送配置");if(1===state.startForm.startMsgConfig.on&&!state.startForm.startMsgConfig.msgId)return createMessage.error("请选择开始执行发送配置");state.startForm.ruleList=e.conditionList||[],state.startForm.ruleMatchLogic=e.matchLogic,Object.assign(state.properties,state.startForm);const t=1==state.startForm.triggerEvent?"新增数据":2==state.startForm.triggerEvent?"修改数据":"删除数据",o=`当[${state.startForm.formName}]表单[${t}]成功时`;emit("confirm",state.properties,o)}else if(2==unref(integrateType)){if(!state.startForm.startTime)return createMessage.error("请选择触发开始时间");if(!state.startForm.cron)return createMessage.error("请设置Cron表达式");if(2==state.startForm.endTimeType&&!state.startForm.endTime)return createMessage.error("请选择触发结束时间");if(1===state.startForm.failMsgConfig.on&&!state.startForm.failMsgConfig.msgId)return createMessage.error("请选择执行失败发送配置");if(1===state.startForm.startMsgConfig.on&&!state.startForm.startMsgConfig.msgId)return createMessage.error("请选择开始执行发送配置");Object.assign(state.properties,state.startForm),emit("confirm",state.properties,state.startForm.cron)}else{if(!state.startForm.formFieldList.length)return createMessage.error("请设置接口字段");if(!formFieldListExist())return;if(1===state.startForm.failMsgConfig.on&&!state.startForm.failMsgConfig.msgId)return createMessage.error("请选择执行失败发送配置");if(1===state.startForm.startMsgConfig.on&&!state.startForm.startMsgConfig.msgId)return createMessage.error("请选择开始执行发送配置");Object.assign(state.properties,state.startForm),emit("confirm",state.properties,"已设置")}closeDrawer()}function addDataNodeConfirm(){if(!state.addDataForm.formId)return createMessage.error("请选择目标表单");if(state.addDataForm.enableFlow&&!state.addDataForm.flowId)return createMessage.error("请选择流程");if(!transferExist("addData"))return;if(1!=unref(integrateType)&&!conditionExist("addData"))return;Object.assign(state.properties,state.addDataForm);const e=`在[${state.addDataForm.formName}]表单中新增数据`;emit("confirm",state.properties,e),closeDrawer()}function updateDataNodeConfirm(){if(!state.updateDataForm.formId)return createMessage.error("请选择目标表单");if(state.updateDataForm.enableFlow&&!state.updateDataForm.flowId)return createMessage.error("请选择流程");if(!transferExist("updateData"))return;if(1==unref(integrateType)){const e=updateDataNodeRef.value?.submitCondition();if(!e)return;state.updateDataForm.ruleList=e.conditionList||[],state.updateDataForm.ruleMatchLogic=e.matchLogic}else if(!conditionExist("updateData"))return;Object.assign(state.properties,state.updateDataForm);const e=`在[${state.updateDataForm.formName}]表单中更新数据`;emit("confirm",state.properties,e),closeDrawer()}function deleteDataNodeConfirm(){if(!state.deleteDataForm.formId)return createMessage.error("请选择目标表单");if(1==unref(integrateType)){const e=deleteDataNodeRef.value?.submitCondition();if(!e)return;state.deleteDataForm.ruleList=e.conditionList||[],state.deleteDataForm.ruleMatchLogic=e.matchLogic}else if(!conditionExist("deleteData"))return;Object.assign(state.properties,state.deleteDataForm);const e=`在[${state.deleteDataForm.formName}]表单中删除数据`;emit("confirm",state.properties,e),closeDrawer()}function dataInterfaceNodeConfirm(){if(!state.dataInterfaceForm.formId)return createMessage.error("请选择执行数据接口");Object.assign(state.properties,state.dataInterfaceForm);const e=`执行[${state.dataInterfaceForm.formName}]数据接口`;emit("confirm",state.properties,e),closeDrawer()}function messageNodeConfirm(){if(!state.messageForm.msgUserIds.length)return createMessage.error("请选择接收人");if(!state.messageForm.msgId)return createMessage.error("请选择发送配置");Object.assign(state.properties,state.messageForm);const e=`执行[${state.messageForm.msgName}]的消息通知`;emit("confirm",state.properties,e),closeDrawer()}function getDataNodeConfirm(){const e=3==state.getDataForm.formType?"请选择数据接口":"请选择表单";if(!state.getDataForm.formId)return createMessage.error(e);if(3!=state.getDataForm.formType){const e=getDataNodeRef.value?.submitCondition();if(!e)return;state.getDataForm.ruleList=e.conditionList||[],state.getDataForm.ruleMatchLogic=e.matchLogic}Object.assign(state.properties,state.getDataForm);const t=`从[${state.getDataForm.formName}]中获取数据`;emit("confirm",state.properties,t),closeDrawer()}function launchFlowNodeConfirm(){if(!state.launchFlowForm.flowId)return createMessage.error("请选择流程");if(!state.launchFlowForm.initiator.length)return createMessage.error("请选择发起人");if(!transferExist("launchFlow"))return;Object.assign(state.properties,state.launchFlowForm);const e=`发起[${state.launchFlowForm.flowName}]流程`;emit("confirm",state.properties,e),closeDrawer()}function getFormFieldList(id,form){getConfigData(id).then((res=>{const{formData:formData}=res.data;let formJson={},fieldList=[];formData&&(formJson=JSON.parse(formData)),fieldList=formJson.fields||[];let list=transformFieldList(fieldList);state[form+"Form"].formFieldList=list.map((e=>({...e,label:e.fullName?e.id+"("+e.fullName+")":e.id}))),"addData"===form&&updateTransferList(form),("getData"===form||["start","updateData","deleteData"].includes(form)&&1==unref(integrateType))&&unref(eval(form+"NodeRef"))?.initCondition()}))}function getFlowFormFieldList(e,t){getFlowFormInfo(e).then((e=>{let{type:o=1,formData:a}=e.data,n={},r=[];a&&(n=JSON.parse(a)),r=2==o?transformFormJson(n):n.fields;let l=transformFieldList(r);state[t+"Form"].formFieldList=l.map((e=>({...e,label:e.fullName?e.id+"("+e.fullName+")":e.id}))),"launchFlow"===t&&updateTransferList(t)}))}function transformFormJson(e){return e.map((e=>({__config__:{label:e.filedName,jnpfKey:e.jnpfKey||"",required:e.required||!1},__vModel__:e.filedId,multiple:e.multiple||!1})))}function transformFieldList(e){let t=[];const o=(e,a)=>{if(e){if(e.__vModel__&&"table"!==e.__config__.jnpfKey){const o=a&&a.__config__&&"table"===a.__config__.jnpfKey,n={id:o?a.__vModel__+"-"+e.__vModel__:e.__vModel__,fullName:o?a.__config__.label+"-"+e.__config__.label:e.__config__.label,...e,disabled:!1},r=n.__config__;dyOptionsList.includes(r.jnpfKey)&&"static"!==r.dataType&&delete n.options,t.push(n)}Array.isArray(e)&&e.forEach((e=>o(e,a))),e.__config__&&e.__config__.children&&Array.isArray(e.__config__.children)&&o(e.__config__.children,e)}};return o(e),t}function updateTransferList(e){const t=state[e+"Form"].formFieldList;let o=[];for(let a=0;a<t.length;a++)t[a].__config__?.required&&o.push({targetField:t[a].id,targetFieldLabel:t[a].fullName,sourceType:1,sourceValue:"",required:!0});state[e+"Form"].transferList=o}function transferExist(e){const t=state[e+"Form"].transferList;let o=!0;for(let a=0;a<t.length;a++){const e=t[a];if(e.required){if(!e.sourceValue){createMessage.warning(`${e.targetFieldLabel}的值不能为空`),o=!1;break}}else if(!e.targetField){createMessage.warning("目标表单字段不能为空"),o=!1;break}}return o}function conditionExist(e){const t=state[e+"Form"].ruleList;let o=!0;e:for(let a=0;a<t.length;a++){const n=t[a];let r="";1==unref(integrateType)&&("updateData"===e&&(r="更新条件"),"deleteData"===e&&(r="删除条件")),2==unref(integrateType)&&(r="目标表单");for(let e=0;e<n.groups.length;e++){const t=n.groups[e];if(!t.field){createMessage.warning(`${r}字段不能为空`),o=!1;break e}if(!["null","notNull"].includes(t.symbol)&&(!t.fieldValue||isEmpty(t.fieldValue))&&(!["inputNumber","calculate"].includes(t.jnpfKey)||["inputNumber","calculate"].includes(t.jnpfKey)&&0!==t.fieldValue)){createMessage.warning(`${t.fullName}的值不能为空`),o=!1;break e}}}return o}function formFieldListExist(){const e=state.startForm.formFieldList;let t=!0;for(let o=0;o<e.length;o++){const a=e[o];if(!a.id){createMessage.warning(`第${o+1}行字段不能为空`),t=!1;break}if(!a.fullName){createMessage.warning(`第${o+1}行字段说明不能为空`),t=!1;break}}return t}function isStartNode(){return!!props.value&&NodeUtils.isStartNode(props.value)}function isAddDataNode(){return!!props.value&&NodeUtils.isAddDataNode(props.value)}function isUpdateDataNode(){return!!props.value&&NodeUtils.isUpdateDataNode(props.value)}function isDeleteDataNode(){return!!props.value&&NodeUtils.isDeleteDataNode(props.value)}function isDataInterfaceNode(){return!!props.value&&NodeUtils.isDataInterfaceNode(props.value)}function isMessageNode(){return!!props.value&&NodeUtils.isMessageNode(props.value)}function isGetDataNode(){return!!props.value&&NodeUtils.isGetDataNode(props.value)}function isLaunchFlowNode(){return!!props.value&&NodeUtils.isLaunchFlowNode(props.value)}function onDrawerOpenChange(e){if(!e)return state.startForm=cloneDeep(nodeConfig.defaultStartForm),void emit("cancel");isStartNode()&&initCommonNodeData("start"),isAddDataNode()&&initCommonNodeData("addData"),isUpdateDataNode()&&initCommonNodeData("updateData"),isDeleteDataNode()&&initCommonNodeData("deleteData"),isDataInterfaceNode()&&initCommonNodeData("dataInterface"),isMessageNode()&&initCommonNodeData("message"),isGetDataNode()&&initCommonNodeData("getData"),isLaunchFlowNode()&&initCommonNodeData("launchFlow")}function handleOk(){isStartNode()&&startNodeConfirm(),isAddDataNode()&&addDataNodeConfirm(),isUpdateDataNode()&&updateDataNodeConfirm(),isDeleteDataNode()&&deleteDataNodeConfirm(),isDataInterfaceNode()&&dataInterfaceNodeConfirm(),isMessageNode()&&messageNodeConfirm(),isGetDataNode()&&getDataNodeConfirm(),isLaunchFlowNode()&&launchFlowNodeConfirm()}return watch((()=>props.value),(e=>{e&&e.properties&&(state.properties=cloneDeep(e.properties),openDrawer())})),(e,t)=>(openBlock(),createBlock(unref(BasicDrawer),{class:"full-drawer propPanel-drawer",onRegister:unref(registerDrawer),width:620,onOpenChange:onDrawerOpenChange,title:unref(properties).title,showFooter:"",maskClosable:!1,onOk:handleOk},{default:withCtx((()=>[__props.value&&isStartNode()?(openBlock(),createBlock(_sfc_main$c,mergeProps({key:0,ref_key:"startNodeRef",ref:startNodeRef},getBindValue.value,{formConf:unref(startForm),formInfo:__props.formInfo}),null,16,["formConf","formInfo"])):createCommentVNode("",!0),__props.value&&isAddDataNode()?(openBlock(),createBlock(_sfc_main$a,mergeProps({key:1},getBindValue.value,{formConf:state.addDataForm}),null,16,["formConf"])):createCommentVNode("",!0),__props.value&&isUpdateDataNode()?(openBlock(),createBlock(_sfc_main$9,mergeProps({key:2,ref_key:"updateDataNodeRef",ref:updateDataNodeRef},getBindValue.value,{formConf:state.updateDataForm}),null,16,["formConf"])):createCommentVNode("",!0),__props.value&&isDeleteDataNode()?(openBlock(),createBlock(_sfc_main$8,mergeProps({key:3,ref_key:"deleteDataNodeRef",ref:deleteDataNodeRef},getBindValue.value,{formConf:state.deleteDataForm}),null,16,["formConf"])):createCommentVNode("",!0),__props.value&&isDataInterfaceNode()?(openBlock(),createBlock(_sfc_main$7,mergeProps({key:4},getBindValue.value,{formConf:state.dataInterfaceForm}),null,16,["formConf"])):createCommentVNode("",!0),__props.value&&isMessageNode()?(openBlock(),createBlock(_sfc_main$6,mergeProps({key:5},getBindValue.value,{formConf:state.messageForm}),null,16,["formConf"])):createCommentVNode("",!0),__props.value&&isGetDataNode()?(openBlock(),createBlock(_sfc_main$5,mergeProps({key:6,ref_key:"getDataNodeRef",ref:getDataNodeRef},getBindValue.value,{formConf:state.getDataForm}),null,16,["formConf"])):createCommentVNode("",!0),__props.value&&isLaunchFlowNode()?(openBlock(),createBlock(_sfc_main$4,mergeProps({key:7},getBindValue.value,{formConf:state.launchFlowForm}),null,16,["formConf"])):createCommentVNode("",!0)])),_:1},8,["onRegister","title"]))}}),_hoisted_1$2={class:"process-flow-container"},_hoisted_2$2={class:"scale-slider"},_hoisted_3$2={class:"btn"},_hoisted_4={class:"num"},_hoisted_5={class:"btn"},_sfc_main$2=defineComponent({__name:"Main",props:["conf","formInfo"],setup(e,{expose:t}){t({getData:function(){return new Promise(((e,t)=>{a.verifyMode=!0,NodeUtils.checkAllNode(a.data)?e({data:a.data}):t({msg:""})}))}});const o=e,a=reactive({verifyMode:!1,data:null,scaleVal:100,step:5,key:+new Date,activeData:null}),{data:n,scaleVal:r,step:l,key:i,activeData:s}=toRefs(a),d=computed((()=>({...omit(o,"conf"),data:a.data,verifyMode:a.verifyMode})));function c({event:e,args:t}){"edit"!==e?(NodeUtils[e](...t),f()):a.activeData=t[0]}function f(){a.key=+new Date}function m(e){a.scaleVal<0||a.scaleVal>200||200===a.scaleVal&&a.scaleVal+e>200||0===a.scaleVal&&a.scaleVal+e<0||(a.scaleVal+=e)}function u(e,t){a.activeData.content=t||"请设置",a.activeData.properties=e,p(),f()}function p(){a.activeData=null}return onMounted((()=>{null!==o.conf&&"object"==typeof o.conf&&"{}"!==JSON.stringify(o.conf)?a.data=o.conf:a.data=getMockData(o.formInfo.type||1)})),(t,o)=>(openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$2,[createBaseVNode("span",_hoisted_3$2,[createVNode(unref(MinusOutlined),{onClick:o[0]||(o[0]=e=>m(-unref(l)))})]),createBaseVNode("span",_hoisted_4,toDisplayString(unref(r))+"%",1),createBaseVNode("span",_hoisted_5,[createVNode(unref(PlusOutlined),{onClick:o[1]||(o[1]=e=>m(unref(l)))})])]),unref(n)?(openBlock(),createBlock(_sfc_main$e,mergeProps({key:0},d.value,{onEmits:c,key:unref(i),style:{transform:`scale(${unref(r)/100})`}}),null,16,["style"])):createCommentVNode("",!0),createVNode(_sfc_main$3,{value:unref(s),processData:unref(n),formInfo:e.formInfo,onConfirm:u,onCancel:p},null,8,["value","processData","formInfo"])]))}}),_hoisted_1$1={class:"jnpf-full-modal-header"},_hoisted_2$1={class:"header-title"},_hoisted_3$1={class:"header-txt"},_sfc_main$1=defineComponent({__name:"index",emits:["register","reload"],setup(e,{emit:t}){const o=reactive({dataForm:{},btnLoading:!1,formInfo:{},templateJson:null,loading:!0}),{formInfo:a,templateJson:n,btnLoading:r,loading:l}=toRefs(o),{t:i}=useI18n(),s=ref(),{createMessage:d}=useMessage(),{prefixCls:c}=useDesign("basic-integrate-process"),[f,{closeModal:m,changeLoading:u}]=useModalInner((function(e){if(!e.id)return;o.loading=!0,u(!0),getInfo(e.id).then((e=>{o.formInfo=e.data,o.templateJson=e.data.templateJson?JSON.parse(e.data.templateJson):null,nextTick((()=>{u(!1),o.loading=!1}))})).catch((()=>{u(!1),o.loading=!1}))}));return(e,t)=>{const u=resolveComponent("a-tooltip"),p=resolveComponent("a-step"),N=resolveComponent("a-steps"),C=resolveComponent("a-button"),g=resolveComponent("a-space");return openBlock(),createBlock(unref(BasicModal),mergeProps(e.$attrs,{onRegister:unref(f),defaultFullscreen:"",footer:null,closable:!1,keyboard:!1,class:["jnpf-full-modal full-modal designer-modal process-designer-modal",`${unref(c)}`]}),{title:withCtx((()=>[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[t[2]||(t[2]=createBaseVNode("img",{src:logoImg,class:"header-logo"},null,-1)),t[3]||(t[3]=createBaseVNode("span",{class:"header-dot"},null,-1)),createVNode(u,{title:unref(a).fullName},{default:withCtx((()=>[createBaseVNode("p",_hoisted_3$1,toDisplayString(unref(a).fullName),1)])),_:1},8,["title"])]),createVNode(N,{current:1,type:"navigation",size:"small",class:"header-steps tab-steps"},{default:withCtx((()=>[createVNode(p,{title:"系统集成设计"})])),_:1}),createVNode(g,{class:"options",size:10},{default:withCtx((()=>[createVNode(C,{shape:"round",type:"primary",onClick:t[0]||(t[0]=e=>{unref(s).getData().then((e=>{o.templateJson=e.data;let t={...o.formInfo,templateJson:JSON.stringify(o.templateJson)};o.btnLoading=!0,update(t).then((e=>{o.btnLoading=!1,d.success(e.msg)})).catch((()=>{o.btnLoading=!1}))})).catch((e=>{e.msg&&d.warning(e.msg)}))}),loading:unref(r)},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(i)("common.saveText")),1)])),_:1},8,["loading"]),createVNode(C,{shape:"round",onClick:t[1]||(t[1]=e=>unref(m)())},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(i)("common.closeText")),1)])),_:1})])),_:1})])])),default:withCtx((()=>[unref(l)?createCommentVNode("",!0):(openBlock(),createBlock(_sfc_main$2,{key:0,ref_key:"integrateProcess",ref:s,conf:unref(n),formInfo:unref(a)},null,8,["conf","formInfo"]))])),_:1},16,["onRegister","class"])}}}),_hoisted_1={class:"jnpf-content-wrapper"},_hoisted_2={class:"jnpf-content-wrapper-center"},_hoisted_3={class:"jnpf-content-wrapper-content"},_sfc_main=defineComponent({name:"onlineDev-integrate",__name:"index",setup(e){const{createMessage:t}=useMessage(),{t:o}=useI18n(),[a,{openModal:n}]=useModal(),[r,{openModal:l}]=useModal(),[i,{openDrawer:s}]=useDrawer(),[d,{openPopup:c}]=usePopup(),f=[{fullName:"事件触发",id:1},{fullName:"定时触发",id:2},{fullName:"webhook触发",id:3}],[m,{reload:u}]=useTable({api:getIntegrateList,columns:[{title:"名称",dataIndex:"fullName",width:200},{title:"编码",dataIndex:"enCode",width:180},{title:"类型",dataIndex:"type",width:110,align:"center"},{title:"创建人",dataIndex:"creatorUser",width:120},{title:"创建时间",dataIndex:"creatorTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"最后修改时间",dataIndex:"lastModifyTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"状态",dataIndex:"enabledMark",width:80,align:"center"}],useSearchForm:!0,formConfig:{schemas:[{field:"keyword",label:o("common.keyword"),component:"Input",componentProps:{placeholder:o("common.enterKeyword"),submitOnPressEnter:!0}},{field:"type",label:"类型",component:"Select",componentProps:{placeholder:"请选择",options:f}},{field:"enabledMark",label:"状态",component:"Select",componentProps:{placeholder:"请选择",options:[{fullName:"启用",id:1},{fullName:"禁用",id:0}]}}]},actionColumn:{width:180,title:"操作",dataIndex:"action"}});function p(e){return[{label:o("common.editText"),onClick:g.bind(null,e.id)},{label:1==e.enabledMark?"禁用":"启用",color:"error",modelConfirm:{content:`此操作将${1==e.enabledMark?"禁用":"启用"}该集成助手，是否继续?`,onOk:w.bind(null,e.id)}},{label:"设计",onClick:_.bind(null,e.id)}]}function N(e){return[{label:"日志",onClick:V.bind(null,e.id,e.fullName)},{label:o("common.copyText"),modelConfirm:{content:"您确定要复制该集成助手, 是否继续?",onOk:v.bind(null,e.id)}},{label:o("common.exportText"),modelConfirm:{content:"您确定要导出该集成助手, 是否继续?",onOk:y.bind(null,e.id)}},{label:o("common.delText"),modelConfirm:{onOk:h.bind(null,e.id)}}]}function C({key:e}){g("",e)}function g(e="",t){n(!0,{id:e,type:t})}function h(e){delIntegrate(e).then((e=>{t.success(e.msg),u()}))}function _(e){l(!0,{id:e})}function v(e){copy(e).then((e=>{t.success(e.msg),u()}))}function y(e){exportData(e).then((e=>{downloadByUrl({url:e.data.url})}))}function V(e,t){c(!0,{id:e,fullName:t})}function w(e){updateState(e).then((e=>{t.success(e.msg),u()}))}function k(e){_(e)}return(e,t)=>{const n=resolveComponent("a-tooltip"),l=resolveComponent("a-alert"),c=resolveComponent("a-menu-item"),g=resolveComponent("a-menu"),h=resolveComponent("a-button"),v=resolveComponent("a-dropdown"),y=resolveComponent("jnpf-upload-btn"),V=resolveComponent("a-tag");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createVNode(unref(BasicTable),{onRegister:unref(m)},{toolbar:withCtx((()=>[createVNode(n,{placement:"top"},{title:withCtx((()=>t[1]||(t[1]=[createBaseVNode("span",null,"执行队列",-1)]))),default:withCtx((()=>[createBaseVNode("i",{class:"icon-ym icon-ym-generator-slider cursor-pointer text-18px",onClick:t[0]||(t[0]=e=>unref(s)(!0))})])),_:1})])),headerTop:withCtx((()=>[createVNode(l,{message:"请使用【任务流程】功能来搭建业务编排，集成助手版块停止更新，后续将下架！",showIcon:"",type:"warning",class:"mt-10px"})])),tableTitle:withCtx((()=>[createVNode(v,null,{overlay:withCtx((()=>[createVNode(g,{onClick:C},{default:withCtx((()=>[(openBlock(),createElementBlock(Fragment,null,renderList(f,(e=>createVNode(c,{key:e.id},{default:withCtx((()=>[createTextVNode(toDisplayString(e.fullName),1)])),_:2},1024))),64))])),_:1})])),default:withCtx((()=>[createVNode(h,{type:"primary",preIcon:"icon-ym icon-ym-btn-add"},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(o)("common.addText")),1),createVNode(unref(DownOutlined))])),_:1})])),_:1}),createVNode(y,{url:"/api/visualdev/Integrate/Actions/Import",accept:".bi",onOnSuccess:unref(u)},null,8,["onOnSuccess"])])),bodyCell:withCtx((({column:e,record:t})=>["type"===e.key?(openBlock(),createElementBlock(Fragment,{key:0},[createTextVNode(toDisplayString(1===t.type?"事件触发":2===t.type?"定时触发":"webhook触发"),1)],64)):createCommentVNode("",!0),"enabledMark"===e.key?(openBlock(),createBlock(V,{key:1,color:1===t.enabledMark?"success":"error"},{default:withCtx((()=>[createTextVNode(toDisplayString(1==t.enabledMark?"启用":"禁用"),1)])),_:2},1032,["color"])):createCommentVNode("",!0),"action"===e.key?(openBlock(),createBlock(unref(TableAction),{key:2,actions:p(t),dropDownActions:N(t)},null,8,["actions","dropDownActions"])):createCommentVNode("",!0)])),_:1},8,["onRegister"])])]),createVNode(_sfc_main$j,{onRegister:unref(a),onReload:unref(u),onDesign:_},null,8,["onRegister","onReload"]),createVNode(unref(_sfc_main$1),{onRegister:unref(r),onReload:unref(u)},null,8,["onRegister","onReload"]),createVNode(_sfc_main$k,{onRegister:unref(i)},null,8,["onRegister"]),createVNode(Log,{onRegister:unref(d),onUpdateNodes:k},null,8,["onRegister"])])}}});export{_sfc_main as default};
