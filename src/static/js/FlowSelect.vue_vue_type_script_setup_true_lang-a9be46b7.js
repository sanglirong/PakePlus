import{g as e,a}from"./template-c6142676.js";import{d as l,ad as t,c3 as o,u as n,aD as s,r as u,M as i,bk as r,k as c,w as d,c as p,e as f,o as m,g as y,j as g,V as v,l as w,aN as h,a4 as b,m as S,t as k,aH as C,n as R,ah as z}from"./index-920db443.js";import{B as Q}from"./BasicLeftTree-cd55d444.js";const _={class:"common-container"},j={class:"jnpf-content-wrapper"},x={class:"jnpf-content-wrapper-left"},T={class:"jnpf-content-wrapper-center"},K={class:"jnpf-content-wrapper-content"},I={class:"jnpf-common-search-box jnpf-common-search-box-modal"},A=l({inheritAttrs:!1,__name:"FlowSelect",props:{value:{default:[]},popupTitle:{type:String,default:"选择流程"},placeholder:{type:String,default:"请选择"},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!0},multiple:{type:Boolean,default:!0},size:{type:String,default:"default"},entrustType:{type:Number,default:0},toUserId:{type:Array,default:[]}},emits:["update:value","change"],setup(l,{emit:A}){const D=l,F=t({list:[],listQuery:{keyword:"",currentPage:1,pageSize:20},loading:!1,total:0,selectedRowKeys:[],selectedRows:[]}),N=A,P=o.useInjectFormItemContext(),{t:U}=n(),B=s(),{createMessage:E}=z(),q=u(void 0),H=u(!1),L=u([]),M=[{title:"流程名称",dataIndex:"fullName"},{title:"流程编码",dataIndex:"enCode"}],O=t({category:"",isDelegate:1,isAuthority:1,delegateUser:""}),$=u(null),J=u(!1),V=u([]),G=u(null),W=u(),X=u(null),Y=.7*window.innerHeight-52-39-56,Z=i((()=>({...r(D,["disabled","size","allowClear","placeholder"]),fieldNames:{label:"fullName",value:"id"},open:!1,mode:D.multiple?"multiple":"",showSearch:!1,showArrow:!0}))),ee=i((()=>({type:D.multiple?"checkbox":"radio",selectedRowKeys:F.selectedRowKeys,onChange:re}))),ae=i((()=>({columns:M,rowSelection:c(ee),loading:F.loading,size:"small",rowKey:"id",scroll:{y:Y},pagination:{current:F.listQuery.currentPage,pageSize:F.listQuery.pageSize,size:"small",defaultPageSize:F.listQuery.pageSize,showTotal:e=>U("component.table.total",{total:e}),showSizeChanger:!0,pageSizeOptions:["20","50","80","100"],showQuickJumper:!0,total:F.total},class:"jnpf-basic-table"})));function le(e,a){e&&e.length?(L.value=a,N("update:value",e),N("change","",L.value)):(L.value=[],N("update:value",[]),N("change","",[]),F.selectedRowKeys=[],F.selectedRows=[]),P.onFieldChange()}async function te(){if(D.disabled)return;if(!D.toUserId?.length)return E.error(0===D.entrustType?"请先选择受委托人":"请先选择代理人");H.value=!0,J.value=!0;const e=await B.getDictionaryData("businessType");V.value=[{id:"",encode:"all",fullName:"全部流程"},...e],O.category=V.value[0].id,O.isAuthority=0===D.entrustType?1:0;const a=c($);a?.setSelectedKeys([O.category]),J.value=!1,F.loading=!0,ie();const l=X.value?.$el;l.querySelector(".ant-table-body").style.height=`${Y}px`}function oe(){F.loading=!0;const e={...F.listQuery,...c(O),isLaunch:1};a(e).then((e=>{F.list=e.data.list||[],F.total=e.data.pagination.total,F.loading=!1})).catch((()=>{F.loading=!1}))}function ne(e){O.category!==e&&(O.category=e,R((()=>oe())))}function se(){H.value=!1}function ue(){F.listQuery.currentPage=1,F.listQuery.pageSize=F.listQuery.pageSize,de(),R((()=>oe()))}function ie(){(function(){const e=c(W);if(!e)throw new Error("form is null!");return e})().resetFields(),F.listQuery.keyword="",ue()}function re(e,a){F.selectedRowKeys=e,F.selectedRows=a}function ce(e){F.listQuery.currentPage=e.current,F.listQuery.pageSize=e.pageSize,de(),R((()=>oe()))}function de(){G.value||(G.value=[]);const e=F.selectedRows;for(let a=0;a<e.length;a++){const l=e[a];G.value.some((e=>e.id===l.id))||G.value.push(l)}G.value=G.value.filter((a=>!(F.list.some((e=>e.id===a.id))&&!e.some((e=>e.id===a.id)))))}function pe(){de(),L.value=G.value,q.value=c(G).map((e=>e.id)),N("update:value",c(q)),N("change",c(q),c(G)),P.onFieldChange(),se()}return d((()=>D.value),(()=>{!function(){if(!D.value||!D.value.length)return q.value=[],L.value=[],G.value=null,F.selectedRowKeys=[],void(F.selectedRows=[]);const a=D.value;e(a).then((e=>{const a=e.data,l=a.map((e=>e.id));q.value=l,L.value=p(a),G.value=p(a),F.selectedRowKeys=l,F.selectedRows=p(a)}))}()}),{immediate:!0}),(e,a)=>{const t=f("a-select"),o=f("a-input"),n=f("a-form-item"),s=f("a-col"),u=f("a-button"),i=f("a-row"),r=f("a-form"),d=f("a-table");return m(),y("div",_,[g(t,v({value:q.value,"onUpdate:value":a[0]||(a[0]=e=>q.value=e)},Z.value,{options:L.value,onChange:le,onClick:te}),null,16,["value","options"]),g(c(C),{open:H.value,"onUpdate:open":a[2]||(a[2]=e=>H.value=e),title:l.popupTitle,width:1e3,class:"common-container-modal",onOk:pe,onCancel:se,maskClosable:!1},{closeIcon:w((()=>[g(h,{canFullscreen:!1,onCancel:se})])),default:w((()=>[b("div",j,[b("div",x,[g(c(Q),{ref_key:"leftTreeRef",ref:$,showSearch:!1,treeData:V.value,loading:J.value,onSelect:ne},null,8,["treeData","loading"])]),b("div",T,[b("div",K,[b("div",I,[g(r,{colon:!1,labelAlign:"right",model:F.listQuery,ref_key:"formElRef",ref:W},{default:w((()=>[g(i,{gutter:10},{default:w((()=>[g(s,{span:8},{default:w((()=>[g(n,{label:c(U)("common.keyword"),name:"keyword"},{default:w((()=>[g(o,{value:F.listQuery.keyword,"onUpdate:value":a[1]||(a[1]=e=>F.listQuery.keyword=e),placeholder:c(U)("common.enterKeyword"),allowClear:"",onPressEnter:ue},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),g(s,{span:8},{default:w((()=>[g(n,{label:" "},{default:w((()=>[g(u,{type:"primary",class:"mr-2",onClick:ue},{default:w((()=>[S(k(c(U)("common.queryText")),1)])),_:1}),g(u,{onClick:ie},{default:w((()=>[S(k(c(U)("common.resetText")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])]),g(d,v({"data-source":F.list},ae.value,{onChange:ce,ref_key:"tableElRef",ref:X}),null,16,["data-source"])])])])])),_:1},8,["open","title"])])}}});export{A as _};
