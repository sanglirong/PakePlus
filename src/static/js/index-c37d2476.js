import{d as e,c3 as l,aD as a,r as t,ad as i,e4 as n,M as o,bk as d,w as s,e as u,o as r,g as c,j as p,V as f,l as m,aN as v,a4 as y,k as g,F as b,t as h,m as k,q as w,aH as C,u as N,n as T,e5 as x,p as _,h as L,c as V,ah as U,aw as S,a0 as F,dD as I,ae as j,i as J,v as K,e6 as D,e7 as R,e8 as O,e9 as z,ea as P,eb as M,am as A,di as Y,aY as E,ec as q,dn as B,ci as $,af as H,cb as Q,aA as W,aR as G,bN as Z,cl as X,ab as ee,U as le,ed as ae,a9 as te,ee as ie,e1 as ne,ef as oe,dF as de,eg as se,eh as ue,ei as re,ej as ce,a3 as pe}from"./index-920db443.js";import{B as fe}from"./BasicLeftTree-cd55d444.js";import{u as me,B as ve}from"./useTable-dc8c9d84.js";import{g as ye}from"./billRule-0363563b.js";import{J as ge,_ as be}from"./componentMap-c91676b4.js";import{b as he,u as ke,B as we}from"./index-143f5813.js";import{n as Ce,d as Ne}from"./config-06ca91cd.js";import{_ as Te,a as xe}from"./import-e198d900.js";import{_ as _e,a as Le}from"./tip-b30e67af.js";import{u as Ve,B as Ue}from"./useForm-1d28ee0b.js";import{g as Se}from"./dataSource-ed26da12.js";import{g as Fe,a as Ie}from"./dataModel-ea807f46.js";import{a as je,B as Je,u as Ke}from"./index-999abbee.js";import{M as De}from"./index-3b5bee70.js";import{C as Re}from"./CopyOutlined-8d46c8b2.js";const Oe={class:"common-container"},ze={class:"jnpf-content-wrapper"},Pe={class:"jnpf-content-wrapper-left"},Me={class:"jnpf-content-wrapper-center"},Ae={class:"jnpf-content-wrapper-content"},Ye={class:"required-sign"},Ee=e({inheritAttrs:!1,__name:"InterfaceModal",props:{value:{default:""},title:{type:String,default:""},popupTitle:{type:String,default:"数据接口"},dataType:{type:String,default:""},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!0},size:{type:String,default:"default"},sourceType:{type:Number,default:1}},emits:["update:value","change"],setup(e,{emit:T}){const x=e,_=T,L=l.useInjectFormItemContext(),{t:V}=N(),U=a(),S=t(void 0),F=t(!1),I=t([]),j=i({category:"",sourceType:x.sourceType}),J=t(null),K=t(!1),D=t([]),[R,{getForm:O,getSelectRows:z,setSelectedRowKeys:P,getSelectRowKeys:M}]=me({api:n,columns:[{title:"名称",dataIndex:"fullName"},{title:"编码",dataIndex:"enCode"},{title:"类型",dataIndex:"type",width:100}],immediate:!1,useSearchForm:!0,formConfig:{baseColProps:{span:8},schemas:[{field:"keyword",label:V("common.keyword"),component:"Input",componentProps:{placeholder:V("common.enterKeyword"),submitOnPressEnter:!0}},{field:"type",label:"类型",component:"Select",componentProps:{options:[{id:"2",fullName:"静态数据"},{id:"1",fullName:"SQL操作"},{id:"3",fullName:"API操作"}]}}]},tableSetting:{size:!1,setting:!1},isCanResizeParent:!0,resizeHeightOffset:-74,rowSelection:{type:"radio"},afterFetch:e=>e.map((e=>{let l=e.parameterJson?JSON.parse(e.parameterJson):[];return l||(l=[]),{...e,templateJson:l}}))}),[A]=me({columns:[{title:"参数名称",dataIndex:"field",key:"field"},{title:"参数类型",dataIndex:"dataType",key:"dataType"},{title:"默认值",dataIndex:"defaultValue",key:"defaultValue",ellipsis:!1}],pagination:!1,showTableSetting:!1,canResize:!1,scroll:{x:void 0}}),Y=[{fullName:"字符串",id:"varchar"},{fullName:"整型",id:"int"},{fullName:"日期时间",id:"datetime"},{fullName:"浮点",id:"decimal"},{fullName:"长整型",id:"bigint"},{fullName:"文本",id:"text"}],E=o((()=>({...d(x,["disabled","size","allowClear"]),fieldNames:{label:"fullName",value:"id"},placeholder:"请选择",open:!1,showSearch:!1,showArrow:!0})));function q(e){let l=Y.filter((l=>l.id==e))[0];return l&&l.fullName?l.fullName:""}function B(e){S.value=e||void 0,I.value=[{id:S.value,fullName:x.title}]}function $(){I.value=[],_("change","",{})}async function H(){if(x.disabled)return;if(F.value=!0,K.value=!0,D.value=await U.getDictionaryData("DataInterfaceType"),!D.value.length)return K.value=!1;j.category=D.value[0].id;const e=g(J);e?.setSelectedKeys([j.category]),K.value=!1,O().resetFields(),P(S.value?[S.value]:[])}function Q(e){e&&j.category!==e&&(j.category=e,j.sourceType=x.sourceType,O().resetFields())}function W(){F.value=!1}function G(){if(!M().length&&!z().length)return;if(!z().length)return _("update:value",S.value),_("change",S.value,I.value[0]),L.onFieldChange(),void W();const e=z()[0];I.value=z(),S.value=e.id,_("update:value",e.id),_("change",e.id,e),L.onFieldChange(),W()}return s((()=>x.value),(e=>{B(e)}),{immediate:!0}),s((()=>x.title),(()=>{B(x.value)})),(l,a)=>{const t=u("a-select");return r(),c("div",Oe,[p(t,f({value:S.value,"onUpdate:value":a[0]||(a[0]=e=>S.value=e)},E.value,{options:I.value,onChange:$,onClick:H}),null,16,["value","options"]),p(g(C),{open:F.value,"onUpdate:open":a[1]||(a[1]=e=>F.value=e),title:e.popupTitle,width:1e3,class:"common-container-modal",onOk:G,onCancel:W,maskClosable:!1},{closeIcon:m((()=>[p(v,{canFullscreen:!1,onCancel:W})])),default:m((()=>[y("div",ze,[y("div",Pe,[p(g(fe),{ref_key:"leftTreeRef",ref:J,showSearch:!1,treeData:D.value,loading:K.value,onSelect:Q},null,8,["treeData","loading"])]),y("div",Me,[y("div",Ae,[p(g(ve),{onRegister:g(R),searchInfo:j,class:"jnpf-sub-table"},{expandedRowRender:m((({record:e})=>[p(g(ve),{onRegister:g(A),"data-source":e.templateJson},{bodyCell:m((({column:e,record:l})=>["field"===e.key?(r(),c(b,{key:0},[y("span",Ye,h(l.required?"*":""),1),k(" "+h(l.field)+h(l.fieldName?"("+l.fieldName+")":""),1)],64)):w("",!0),"dataType"===e.key?(r(),c(b,{key:1},[k(h(q(l.dataType)),1)],64)):w("",!0)])),_:2},1032,["onRegister","data-source"])])),_:1},8,["onRegister","searchInfo"])])])])])),_:1},8,["open","title"])])}}}),qe={class:"common-container"},Be={class:"jnpf-content-wrapper"},$e={class:"jnpf-content-wrapper-left"},He={class:"jnpf-content-wrapper-center"},Qe={class:"jnpf-content-wrapper-content"},We=e({inheritAttrs:!1,__name:"BillRuleModal",props:{value:{default:""},title:{type:String,default:""},popupTitle:{type:String,default:"模板"},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!0},size:{type:String,default:"default"}},emits:["update:value","change"],setup(e,{emit:n}){const b=e,h=n,k=l.useInjectFormItemContext(),{t:w}=N(),x=a(),_=t(void 0),L=t(!1),V=t([]),U=i({categoryId:""}),S=t(null),F=t(!1),I=t([]),[j,{getForm:J,getSelectRows:K,setSelectedRowKeys:D,getSelectRowKeys:R}]=me({api:ye,columns:[{title:"业务名称",dataIndex:"fullName"},{title:"业务编码",dataIndex:"enCode"}],immediate:!1,useSearchForm:!0,formConfig:{baseColProps:{span:8},schemas:[{field:"keyword",label:w("common.keyword"),component:"Input",componentProps:{placeholder:w("common.enterKeyword"),submitOnPressEnter:!0}}]},rowKey:"enCode",tableSetting:{size:!1,setting:!1},isCanResizeParent:!0,resizeHeightOffset:-74,rowSelection:{type:"radio"}}),O=o((()=>({...d(b,["disabled","size","allowClear"]),fieldNames:{label:"fullName",value:"id"},placeholder:"请选择",open:!1,showSearch:!1,showArrow:!0})));function z(){V.value=[],h("change","",{})}async function P(){if(b.disabled)return;L.value=!0,F.value=!0;const e=await x.getDictionaryData("businessType");I.value=[{id:"0",fullName:"业务分类",children:e}],U.categoryId="",T((()=>{const e=g(S);e?.setSelectedKeys(["0"]),F.value=!1,J().resetFields(),D(_.value?[_.value]:[])}))}function M(e){e&&U.categoryId!==e&&(U.categoryId="0"===e?"":e,J().resetFields())}function A(){L.value=!1}function Y(){if(!R().length&&!K().length)return;if(!K().length)return h("update:value",_.value),h("change",_.value,V.value[0]),k.onFieldChange(),void A();const e=K()[0];V.value=K(),_.value=e.enCode,h("update:value",e.enCode),h("change",e.enCode,e),k.onFieldChange(),A()}return s((()=>b.value),(e=>{var l;l=e,_.value=l||void 0,V.value=[{id:_.value,fullName:b.title}]}),{immediate:!0}),(l,a)=>{const t=u("a-select");return r(),c("div",qe,[p(t,f({value:_.value,"onUpdate:value":a[0]||(a[0]=e=>_.value=e)},O.value,{options:V.value,onChange:z,onClick:P}),null,16,["value","options"]),p(g(C),{open:L.value,"onUpdate:open":a[1]||(a[1]=e=>L.value=e),title:e.popupTitle,width:1e3,class:"common-container-modal",onOk:Y,onCancel:A,maskClosable:!1},{closeIcon:m((()=>[p(v,{canFullscreen:!1,onCancel:A})])),default:m((()=>[y("div",Be,[y("div",$e,[p(g(fe),{ref_key:"leftTreeRef",ref:S,showSearch:!1,treeData:I.value,loading:F.value,onSelect:M},null,8,["treeData","loading"])]),y("div",He,[y("div",Qe,[p(g(ve),{onRegister:g(j),searchInfo:U,class:"jnpf-sub-table"},null,8,["onRegister","searchInfo"])])])])])),_:1},8,["open","title"])])}}}),Ge={class:"add-main"},Ze=e({__name:"PreviewModal",emits:["register","previewPc"],setup(e,{emit:l}){const a=l,[n,{closeModal:o}]=he((function(e){b.type=e.type||"",b.id=e.id,b.fullName=e.fullName||"",b.isRelease=e.isRelease||0,b.previewType=0})),[d,{openModal:s}]=ke(),c=x(),v=t(""),b=i({type:"",id:"",fullName:"",previewType:0,isRelease:0});return(e,l)=>{const t=u("a-tab-pane"),i=u("a-tabs"),h=u("jnpf-qrcode");return r(),_(g(we),f(e.$attrs,{onRegister:g(n),title:"预览",footer:null,width:600,class:"jnpf-add-modal jnpf-preview-modal"}),{default:m((()=>["webDesign"===b.type||"flow"===b.type?(r(),_(i,{key:0,activeKey:b.previewType,"onUpdate:activeKey":l[0]||(l[0]=e=>b.previewType=e),size:"small"},{default:m((()=>[(r(),_(t,{key:0,tab:"设计中"})),b.isRelease?(r(),_(t,{key:1,tab:"已发布"})):w("",!0)])),_:1},8,["activeKey"])):w("",!0),y("div",Ge,[y("div",{class:"add-item add-item-left",onClick:l[1]||(l[1]=e=>function(){if(o(),"webDesign"!==b.type)setTimeout((()=>{a("previewPc",{id:b.id,previewType:b.previewType})}),300);else{if(!b.id)return;c(`/previewModel?isPreview=1&id=${b.id}&previewType=${b.previewType}`)}}())},l[3]||(l[3]=[y("i",{class:"add-icon icon-ym icon-ym-pc"},null,-1),y("div",{class:"add-txt"},[y("p",{class:"add-title"},"Web预览")],-1)])),y("div",{class:"add-item",onClick:l[2]||(l[2]=e=>function(){let e={t:"flow"===b.type?"WFP":"webDesign"===b.type?"ADP":b.type,id:b.id};"report"===b.type&&(e.fullName=b.fullName),"webDesign"!=b.type&&"flow"!==b.type||(e.previewType=b.previewType),v.value=JSON.stringify(e),o(),s(!0)}())},l[4]||(l[4]=[y("i",{class:"add-icon icon-ym icon-ym-mobile"},null,-1),y("div",{class:"add-txt"},[y("p",{class:"add-title"},"App预览")],-1)]))]),p(g(we),f(e.$attrs,{onRegister:g(d),title:"预览",footer:null,width:400,class:"jnpf-qrcode-modal"}),{default:m((()=>[p(h,{staticText:v.value,width:280},null,8,["staticText"]),l[5]||(l[5]=y("p",{class:"tip"},"打开手机APP扫码预览",-1))])),_:1,__:[5]},16,["onRegister"])])),_:1},16,["onRegister"])}}}),Xe=e({__name:"ExportModal",emits:["register","download"],setup(e,{emit:l}){const a=l,[i,{changeOkLoading:n}]=he((function(e){v.value=!e.showExportSelected&&0!=e.showExportSelected||e.showExportSelected,S.value=V(e.columnList).filter((e=>!Ce.includes(e.__config__.jnpfKey))),C.value=e.selectIds||[],s.value=0,F.value=S.value.map((e=>e.id)),J(F.value)})),{createMessage:o}=U(),{t:d}=N(),s=t(0),v=t(!1),C=t([]),T=t(!1),x=t(!1),S=t([]),F=t([]),I=t([]);function j(e){const l=e.target.checked;F.value=l?S.value.map((e=>e.id)):I.value,T.value=!l&&!!I.value.length}function J(e){const l=e.length;x.value=l===S.value.length,T.value=!!l&&l<S.value.length}function K(){if(!F.value.length)return o.warning("请至少选择一个导出字段");n(!0);const e={dataType:s.value,selectKey:F.value,selectIds:C.value};a("download",e)}return(e,l)=>{const a=u("a-radio"),t=u("a-radio-group"),n=u("a-form-item"),o=u("a-checkbox"),N=u("a-checkbox-group"),V=u("a-form");return r(),_(g(we),f(e.$attrs,{onRegister:g(i),title:g(d)("common.exportText"),okText:g(d)("common.exportText"),onOk:K,destroyOnClose:"",class:"export-modal"}),{default:m((()=>[p(V,{colon:!1,labelAlign:"left",labelCol:{style:{width:"90px"}}},{default:m((()=>[l[7]||(l[7]=y("div",{class:"export-line"},[y("p",{class:"export-label"},"导出方式")],-1)),p(n,null,{default:m((()=>[p(t,{value:s.value,"onUpdate:value":l[0]||(l[0]=e=>s.value=e)},{default:m((()=>[p(a,{value:0},{default:m((()=>l[3]||(l[3]=[k("当前页面数据")]))),_:1,__:[3]}),p(a,{value:1},{default:m((()=>l[4]||(l[4]=[k("全部页面数据")]))),_:1,__:[4]}),v.value?(r(),_(a,{key:0,value:2,disabled:!C.value||!C.value.length},{default:m((()=>l[5]||(l[5]=[k("当前选择数据")]))),_:1,__:[5]},8,["disabled"])):w("",!0)])),_:1},8,["value"])])),_:1}),l[8]||(l[8]=y("div",{class:"export-line"},[y("p",{class:"export-label"},[k("导出数据"),y("span",null,"请选择导出字段")])],-1)),p(o,{indeterminate:T.value,checked:x.value,"onUpdate:checked":l[1]||(l[1]=e=>x.value=e),onChange:j},{default:m((()=>l[6]||(l[6]=[k("全选")]))),_:1,__:[6]},8,["indeterminate","checked"]),p(N,{value:F.value,"onUpdate:value":l[2]||(l[2]=e=>F.value=e),class:"options-list",onChange:J},{default:m((()=>[(r(!0),c(b,null,L(S.value,(e=>(r(),_(o,{key:e.id,value:e.id,class:"options-item"},{default:m((()=>[k(h(e.fullName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1,__:[7,8]})])),_:1},16,["onRegister","title","okText"])}}}),el={class:"header-steps"},ll={class:"import-main"},al={class:"upload"},tl={class:"up_right"},il={class:"upload"},nl={class:"up_right"},ol={class:"import-main"},dl={key:0,class:"child-table-column"},sl={key:0,class:"cell"},ul={key:1,class:"cell"},rl={class:"import-main"},cl={key:0,class:"success"},pl={class:"success-tip"},fl={key:1,class:"unsuccess"},ml={class:"upload error-show"},vl={class:"up_right"},yl={class:"tip success-tip"},gl={class:"tip error-tip"},bl={class:"conTips"},hl={key:0,class:"child-table-column"},kl=["title"],wl=e({__name:"ImportModal",emits:["register","reload"],setup(e,{emit:l}){const a=l,[t,{closeModal:n}]=he((function(e){E.actionUrl=`/api/${e.url||"visualdev/OnlineDev"}/Uploader`,E.apiUrl=e.url||`visualdev/OnlineDev/${e.modelId}`,E.menuId=e.menuId,E.flowId=e.flowId||"",E.activeStep=0,E.fileName="",E.fileList=[],E.btnLoading=!1,E.skipPreview=!1})),{createMessage:d,createConfirm:s}=U(),{t:v}=N(),C={title:"序号",dataIndex:"index",align:"center",width:50,customRender:({index:e})=>e+1},T={title:"操作",dataIndex:"action",align:"center",width:50,fixed:"right"},x={title:"异常原因",dataIndex:"errorsInfo",width:150,fixed:"right"},Y=S(),E=i({activeStep:0,fileName:"",fileList:[],btnLoading:!1,list:[],result:{},resultList:[],actionUrl:"",apiUrl:"",columns:[],resultColumns:[],columnsChildList:[],resultColumnsChildList:[],flowId:"",menuId:"",skipPreview:!1}),{activeStep:q,fileName:B,fileList:$,btnLoading:H,list:Q,result:W,resultList:G,columns:Z,resultColumns:X,skipPreview:ee}=F(E),le=o((()=>Y.apiUrl+E.actionUrl)),ae=o((()=>({Authorization:I()})));function te(){0!=E.activeStep&&(E.activeStep-=1)}function ie(){if(0==E.activeStep)return E.fileList.length&&E.fileName?E.skipPreview?ne():(E.btnLoading=!0,void R(E.apiUrl,{fileName:E.fileName}).then((e=>{E.list=e.data.dataRow||[];const l=e.data.headerRow||[];E.resultColumns=oe(l),de(E.resultColumns),E.resultColumnsChildList=E.resultColumns.filter((e=>"table"===e.jnpfKey&&e.children&&e.children.length));const a=V(l);for(let t=0;t<a.length;t++)a[t].children?.length&&"table"==a[t]?.jnpfKey&&a[t].children.push({title:"操作",dataIndex:"delete",width:50,isChild:!0});E.columns=[C,...a,T],de(E.columns),E.columnsChildList=E.columns.filter((e=>"table"===e.jnpfKey&&e.children&&e.children.length)),E.btnLoading=!1,E.activeStep+=1})).catch((()=>{E.btnLoading=!1}))):d.warning("请先上传文件");if(1==E.activeStep){if(!E.list.length)return d.warning("导入数据为空");ne()}}function ne(){E.btnLoading=!0;let e={list:E.list||[]};E.flowId&&(e.flowId=E.flowId),E.skipPreview&&(e={...e,type:E.skipPreview,fileName:E.fileName}),O(E.apiUrl,e).then((e=>{if(E.result=e.data,E.resultList=e.data.failResult,E.activeStep+=1,E.skipPreview){E.activeStep=2;const l=e.data.headerRow||[];E.resultColumns=oe(l),de(E.resultColumns),E.resultColumnsChildList=E.resultColumns.filter((e=>"table"===e.jnpfKey&&e.children&&e.children.length))}E.btnLoading=!1})).catch((()=>{E.btnLoading=!1}))}function oe(e){const l=e=>{for(let a=0;a<e.length;a++)e[a]={...e[a],title:e[a].fullName,dataIndex:e[a].id,width:150},e[a].children?.length&&l(e[a].children)};return l(e),[C,...e,x]}function de(e){e.forEach((e=>{e.children&&e.children.length&&"table"==e?.jnpfKey&&e.children.forEach(((l,a)=>{l.isChild=!0,l.customCell=0==a?()=>({rowspan:1,colspan:e.children.length,class:"child-table-box"}):()=>({rowspan:0,colspan:0})}))}))}function se({file:e}){"error"!==e.status?"done"===e.status&&(200===e.response.code?E.fileName=e.response.data.name:d.error(e.response.msg)):d.error("上传失败")}function ue(e){const l=e.name.replace(/.+\./,"");if(!(-1!==["xls","xlsx"].indexOf(l.toLowerCase())))return d.error("文件格式不正确"),D.LIST_IGNORE;return!!(e.size/1024<500)||(d.error("文件大小超过500KB"),D.LIST_IGNORE)}function re(e){return new Promise(((l,a)=>{s({iconType:"warning",title:v("common.tipTitle"),content:`确定移除${e.name}?`,onOk:()=>{E.fileName="",l()},onCancel:()=>{a()}})}))}function ce(e=!1){n(),e&&a("reload")}return(e,l)=>{const a=u("a-step"),i=u("a-steps"),n=u("a-button"),o=u("a-switch"),d=u("a-form-item"),s=u("a-input"),C=u("a-table");return r(),_(g(we),f(e.$attrs,{onRegister:g(t),title:"批量导入",width:1e3,"show-cancel-btn":!1,"show-ok-btn":!1,destroyOnClose:"",class:"jnpf-import-modal"}),{insertFooter:m((()=>[0==g(q)?(r(),_(n,{key:0,onClick:l[5]||(l[5]=e=>ce())},{default:m((()=>[k(h(g(v)("common.cancelText")),1)])),_:1})):w("",!0),1===g(q)?(r(),_(n,{key:1,onClick:te},{default:m((()=>[k(h(g(v)("common.prev")),1)])),_:1})):w("",!0),g(q)<2?(r(),_(n,{key:2,type:"primary",onClick:ie,loading:g(H),disabled:0===g(q)&&!g(B)},{default:m((()=>[k(h(g(v)("common.next")),1)])),_:1},8,["loading","disabled"])):(r(),_(n,{key:3,type:"primary",onClick:l[6]||(l[6]=e=>ce(!0))},{default:m((()=>l[24]||(l[24]=[k("关闭")]))),_:1,__:[24]}))])),default:m((()=>[y("div",el,[p(i,{current:g(q),"onUpdate:current":l[0]||(l[0]=e=>j(q)?q.value=e:null),type:"navigation",size:"small"},{default:m((()=>[p(a,{title:"上传文件",disabled:""}),p(a,{title:"数据预览",disabled:""}),p(a,{title:"导入数据",disabled:""})])),_:1},8,["current"])]),J(y("div",ll,[y("div",al,[l[10]||(l[10]=y("div",{class:"up_left"},[y("img",{src:Te})],-1)),y("div",tl,[l[8]||(l[8]=y("p",{class:"title"},"上传填好的数据表",-1)),l[9]||(l[9]=y("p",{class:"tip"},"文件后缀名必须是xls或xlsx，文件大小不超过500KB，最多支持导入1000条数据",-1)),p(g(D),{"file-list":g($),"onUpdate:fileList":l[1]||(l[1]=e=>j($)?$.value=e:null),class:"upload-area",accept:".xls,.xlsx","max-count":1,action:le.value,headers:ae.value,"before-upload":ue,onRemove:re,onChange:se},{default:m((()=>[p(n,{type:"link"},{default:m((()=>l[7]||(l[7]=[k("上传文件")]))),_:1,__:[7]})])),_:1},8,["file-list","action","headers"])])]),y("div",il,[l[14]||(l[14]=y("div",{class:"up_left"},[y("img",{src:xe})],-1)),y("div",nl,[l[12]||(l[12]=y("p",{class:"title"},"填写导入数据信息",-1)),l[13]||(l[13]=y("p",{class:"tip"},"请按照数据模板的格式准备导入数据，模板中的表头名称不可更改，表头行不能删除",-1)),p(n,{type:"link",onClick:l[2]||(l[2]=e=>{z(E.apiUrl,{menuId:E.menuId}).then((e=>{P({url:e.data?.url})}))})},{default:m((()=>l[11]||(l[11]=[k("下载模板")]))),_:1,__:[11]})])]),p(d,{colon:!1,label:"跳过数据预览"},{default:m((()=>[p(o,{checked:g(ee),"onUpdate:checked":l[3]||(l[3]=e=>j(ee)?ee.value=e:null)},null,8,["checked"])])),_:1})],512),[[K,0==g(q)]]),J(y("div",ol,[p(C,{"data-source":g(Q),columns:g(Z),size:"small",bordered:"",pagination:!1,scroll:{x:"max-content",y:"420px"},class:"import-preview-table"},{bodyCell:m((({column:e,record:a,index:t})=>["index"===e.dataIndex?(r(),c(b,{key:0},[k(h(t+1),1)],64)):"action"===e.dataIndex?(r(),_(n,{key:1,class:"action-btn",type:"link",color:"error",onClick:e=>function(e){E.list.splice(e,1)}(t),size:"small"},{default:m((()=>l[15]||(l[15]=[k("删除")]))),_:2,__:[15]},1032,["onClick"])):e.isChild?(r(!0),c(b,{key:2},L(E.columnsChildList,(t=>(r(),c(b,null,[t.children&&t.children[0]&&e.dataIndex===t.children[0]?.dataIndex&&e.isChild?(r(),c("div",dl,[(r(!0),c(b,null,L(a[t.dataIndex],((e,i)=>(r(),c("tr",{class:"child-table__row",key:i},[(r(!0),c(b,null,L(t.children,((o,d)=>(r(),c("td",{key:d,style:A({width:`${o.width}px`})},["delete"===o.dataIndex?(r(),c("div",sl,[p(n,{class:"action-btn",type:"link",color:"error",onClick:e=>function(e,l){e.splice(l,1)}(a[t.dataIndex],i),size:"small"},{default:m((()=>l[16]||(l[16]=[k(" 删除 ")]))),_:2,__:[16]},1032,["onClick"])])):(r(),c("div",ul,[p(s,{value:e[o.dataIndex],"onUpdate:value":l=>e[o.dataIndex]=l},null,8,["value","onUpdate:value"])]))],4)))),128))])))),128))])):w("",!0)],64)))),256)):(r(),_(s,{key:3,value:a[e.dataIndex],"onUpdate:value":l=>a[e.dataIndex]=l},null,8,["value","onUpdate:value"]))])),_:1},8,["data-source","columns"])],512),[[K,1==g(q)]]),J(y("div",rl,[g(W).resultType?w("",!0):(r(),c("div",cl,[l[17]||(l[17]=y("img",{src:_e},null,-1)),l[18]||(l[18]=y("p",{class:"success-title"},"批量导入成功",-1)),y("p",pl,"您已成功导入"+h(g(W).snum)+"条数据",1)])),g(W).resultType?(r(),c("div",fl,[y("div",ml,[l[21]||(l[21]=y("div",{class:"up_left"},[y("img",{src:Le})],-1)),y("div",vl,[y("p",yl,[l[19]||(l[19]=k(" 正常数据条数：")),y("span",null,h(g(W).snum)+"条",1)]),y("p",gl,[l[20]||(l[20]=k(" 异常数据条数：")),y("span",null,h(g(W).fnum)+"条",1)])])]),y("div",bl,[l[23]||(l[23]=y("p",null,"以下文件数据为导入异常数据",-1)),p(n,{type:"link",preIcon:"icon-ym icon-ym-btn-download",onClick:l[4]||(l[4]=e=>{M(E.apiUrl,{list:E.resultList,menuId:E.menuId}).then((e=>{P({url:e.data?.url})}))})},{default:m((()=>l[22]||(l[22]=[k("导出异常数据")]))),_:1,__:[22]})]),p(C,{"data-source":g(G),columns:g(X),size:"small",bordered:"",pagination:!1,scroll:{x:"max-content",y:"205px"}},{bodyCell:m((({column:e,record:l})=>[(r(!0),c(b,null,L(E.resultColumnsChildList,(a=>(r(),c(b,null,[a.children&&a.children[0]&&e.dataIndex===a.children[0]?.dataIndex&&e.isChild?(r(),c("div",hl,[(r(!0),c(b,null,L(l[a.dataIndex],((e,l)=>(r(),c("tr",{class:"child-table__row",key:l},[(r(!0),c(b,null,L(a.children,((l,a)=>(r(),c("td",{key:a,style:A({width:`${l.width}px`})},[y("div",{class:"cell",title:e[l.dataIndex]},h(e[l.dataIndex]),9,kl)],4)))),128))])))),128))])):w("",!0)],64)))),256))])),_:1},8,["data-source","columns"])])):w("",!0)],512),[[K,2==g(q)]])])),_:1},16,["onRegister"])}}});function Cl(e){return Y.post({url:"/api/system/AdvancedQuery",data:e})}function Nl(e){return Y.put({url:"/api/system/AdvancedQuery/"+e.id,data:e})}const Tl={key:0,class:"mb-10px"},xl={class:"condition-item-title"},_l=["onClick"],Ll={class:"condition-item-cap"},Vl={key:3,class:"pt-3px"},Ul=["onClick"],Sl=["onClick"],Fl={class:"query-noData"},Il={class:"noData-txt"},jl=e({__name:"ConditionMain",props:{bordered:{type:Boolean,default:!1},isSuperQuery:{type:Boolean,default:!1},defaultAddEmpty:{type:Boolean,default:!1},showFieldValueType:{type:Boolean,default:!1},valueFieldOptions:{type:Array,default:()=>[]},compact:{type:Boolean,default:!1},isCustomFieldValueType:{type:Boolean,default:!1}},emits:["confirm"],setup(e,{expose:l,emit:a}){const t=e;l({init:function(e){te(e);const l=e.fieldOptions.filter((e=>!o.includes(e.__config__.jnpfKey)));G.fieldOptions=ie(l),!G.conditionList.length&&t.defaultAddEmpty&&ne()},confirm:function(){return!!function(){let e=!0;for(let l=0;l<G.conditionList.length;l++){const a=G.conditionList[l];for(let l=0;l<a.groups.length;l++){const t=a.groups[l];if(!t.field)return n.warning("条件字段不能为空"),void(e=!1);if(!t.symbol)return n.warning("条件符号不能为空"),void(e=!1);if(!["null","notNull"].includes(t.symbol)&&(!t.fieldValue&&0!==t.fieldValue||Q(t.fieldValue)))return n.warning("数据值不能为空"),void(e=!1)}}return e}()&&{matchLogic:G.matchLogic,conditionList:V(G.conditionList)}},updateConditionList:te});const{createMessage:n}=U(),o=["relationFormAttr","popupAttr","uploadFile","uploadImg","colorPicker","editor","link","button","text","alert","table","sign","signature"],d={field:"",symbol:"",jnpfKey:"",fieldValueType:!t.showFieldValueType||t.isCustomFieldValueType?2:1,fieldValue:void 0,fieldValueJnpfKey:"",cellKey:+new Date},f={logic:"and",groups:[d]},v=[{id:1,fullName:"字段"},{id:2,fullName:"自定义"}],h=[{id:"and",fullName:"且"},{id:"or",fullName:"或"}],C=[{id:"==",fullName:"等于"},{id:"<>",fullName:"不等于"},{id:"like",fullName:"包含"},{id:"notLike",fullName:"不包含"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],N=[{id:">=",fullName:"大于等于"},{id:">",fullName:"大于"},{id:"==",fullName:"等于"},{id:"<=",fullName:"小于等于"},{id:"<",fullName:"小于"},{id:"<>",fullName:"不等于"},{id:"between",fullName:"介于"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],T=[{id:"==",fullName:"等于"},{id:"<>",fullName:"不等于"},{id:"in",fullName:"包含任意一个"},{id:"notIn",fullName:"不包含任意一个"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],x=[{id:"==",fullName:"等于"},{id:"<>",fullName:"不等于"}],S=[{id:"like",fullName:"包含"},{id:"notLike",fullName:"不包含"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],I=[...x,{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],D=["calculate","inputNumber","rate","slider","datePicker","timePicker","createTime","modifyTime"],R=["radio","checkbox","select","treeSelect","cascader","areaSelect","organizeSelect","depSelect","posSelect","userSelect","usersSelect","roleSelect","groupSelect","createUser","modifyUser","currOrganize","currPosition","popupTableSelect"],O=["datePicker","createTime","modifyTime"],z=["organizeSelect","currOrganize"],P=["depSelect"],M=["posSelect","currPosition"],A=["userSelect","createUser","modifyUser"],Y=["switch"],W=["relationForm","popupSelect"],G=i({conditionList:[],fieldOptions:[],matchLogic:"and"}),{conditionList:Z,fieldOptions:X,matchLogic:ee}=F(G),le=a,ae=E((e=>{le("confirm",e)}),300);function te(e){G.conditionList=V(e.conditionList||[]),G.matchLogic=e.matchLogic||"and"}function ie(e){return e.forEach((e=>{e.disabled=!1;const l=e.__config__;if(Ne.includes(l.jnpfKey)&&("dictionary"===l.dataType&&l.dictionaryType&&(e.options=[],q(l.dictionaryType).then((l=>{e.options=l.data.list}))),"dynamic"===l.dataType&&l.propsUrl)){e.options=[];const a={paramList:B(l.templateJson)};$(l.propsUrl,a).then((l=>{e.options=Array.isArray(l.data)?l.data:[]}))}})),e}function ne(){G.conditionList.push(V(f))}function oe(e){G.conditionList.splice(e,1)}function de({symbol:e,jnpfKey:l}){const a=[{id:2,fullName:"自定义"}];return[...z,...P,...M,...A].includes(l)||"between"!=e&&O.includes(l)?[...a,{id:4,fullName:"系统变量"}]:a}return s([()=>G.conditionList,()=>G.matchLogic],(()=>{t.compact&&ae({conditionList:G.conditionList,matchLogic:G.matchLogic})}),{deep:!0}),(l,a)=>{const i=u("jnpf-radio"),n=u("jnpf-select"),o=u("a-col"),s=u("jnpf-number-range"),f=u("jnpf-input-number"),U=u("jnpf-switch"),F=u("jnpf-color-picker"),E=u("jnpf-time-range"),q=u("jnpf-time-picker"),B=u("jnpf-date-range"),$=u("jnpf-date-picker"),Q=u("jnpf-organize-select"),le=u("jnpf-dep-select"),ae=u("jnpf-role-select"),te=u("jnpf-group-select"),ie=u("jnpf-pos-select"),se=u("jnpf-user-select"),ue=u("jnpf-users-select"),re=u("jnpf-area-select"),ce=u("jnpf-cascader"),pe=u("jnpf-tree-select"),fe=u("jnpf-popup-select"),me=u("jnpf-auto-complete"),ve=u("a-input"),ye=u("a-row"),be=u("a-divider");return r(),c("div",{class:H(["condition-main",{"condition-main-bordered":e.bordered,"condition-main-compact":e.compact}])},[g(Z).length?(r(),c("div",Tl,[p(i,{value:g(ee),"onUpdate:value":a[0]||(a[0]=e=>j(ee)?ee.value=e:null),options:h,optionType:"button","button-style":"solid"},null,8,["value"])])):w("",!0),(r(!0),c(b,null,L(g(Z),((l,u)=>(r(),c("div",{class:"condition-item",key:u},[y("div",xl,[a[2]||(a[2]=y("div",null,"条件组",-1)),y("i",{class:"icon-ym icon-ym-nav-close",onClick:e=>oe(u)},null,8,_l)]),y("div",{class:H(["condition-item-content",{"!px-5px":e.compact}])},[y("div",Ll,[a[3]||(a[3]=k(" 以下条件全部执行： ")),p(i,{value:l.logic,"onUpdate:value":e=>l.logic=e,options:h,optionType:"button","button-style":"solid",size:"small"},null,8,["value","onUpdate:value"])]),(r(!0),c(b,null,L(l.groups,((a,i)=>(r(),_(ye,{gutter:e.compact?2:8,key:u+i,class:"mb-10px"},{default:m((()=>[p(o,{span:6},{default:m((()=>[p(n,{value:a.field,"onUpdate:value":e=>a.field=e,options:g(X),showSearch:"",allowClear:"",fieldNames:{options:"options1"},onChange:(e,l)=>function(e,l,a,t,i){a.cellKey=+new Date,1!=a.fieldValueType&&(a.fieldValue=void 0,a.fieldValueJnpfKey="");const n=V(d);for(let d of Object.keys(n))n[d]=a[d];if(!e)return a.jnpfKey="",a.symbol=void 0,void(a.disabled=!1);a={...n,...l};const o=l.__config__;a.jnpfKey!=o.jnpfKey&&(a.symbol=void 0),a.jnpfKey=l.__config__?.jnpfKey||"",a.disabled=["null","notNull"].includes(a.symbol),a.multiple=["in","notIn"].includes(a.symbol),G.conditionList[t].groups[i]=a}(e,l,a,u,i)},null,8,["value","onUpdate:value","options","onChange"])])),_:2},1024),p(o,{span:5},{default:m((()=>{return[p(n,{value:a.symbol,"onUpdate:value":e=>a.symbol=e,placeholder:"运算符号",options:(e=a.jnpfKey,Y.includes(e)?x:W.includes(e)?I:D.includes(e)?N:R.includes(e)?T:"location"==e?S:C),dropdownMatchSelectWidth:!1,onChange:(e,l)=>function(e,l,a){a.fieldValue=void 0,a.disabled=["null","notNull"].includes(e),a.multiple=["in","notIn"].includes(e),t.showFieldValueType&&(["null","notNull"].includes(e)||"between"==e&&O.includes(a.jnpfKey))&&(a.fieldValueType=!t.showFieldValueType||t.isCustomFieldValueType?2:1,a.fieldValueJnpfKey="")}(e,0,a)},null,8,["value","onUpdate:value","options","onChange"])];var e})),_:2},1024),e.showFieldValueType?(r(),_(o,{key:0,span:4},{default:m((()=>[p(n,{value:a.fieldValueType,"onUpdate:value":e=>a.fieldValueType=e,options:e.isCustomFieldValueType?de(a):v,disabled:a.disabled,onChange:e=>a.fieldValue=void 0},null,8,["value","onUpdate:value","options","disabled","onChange"])])),_:2},1024)):w("",!0),1===a.fieldValueType?(r(),_(o,{key:1,span:8},{default:m((()=>[p(n,{value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,options:e.valueFieldOptions,showSearch:"",allowClear:"",fieldNames:{options:"children"},disabled:a.disabled},null,8,["value","onUpdate:value","options","disabled"])])),_:2},1024)):w("",!0),2==a.fieldValueType?(r(),_(o,{key:2,span:e.showFieldValueType?8:12},{default:m((()=>["inputNumber"===a.jnpfKey?(r(),c(b,{key:0},["between"==a.symbol?(r(),_(s,{key:0,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,precision:a.precision,disabled:a.disabled},null,8,["value","onUpdate:value","precision","disabled"])):(r(),_(f,{key:1,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,precision:a.precision,disabled:a.disabled,placeholder:"请输入"},null,8,["value","onUpdate:value","precision","disabled"]))],64)):"calculate"===a.jnpfKey?(r(),c(b,{key:1},["between"==a.symbol?(r(),_(s,{key:0,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,precision:a.precision||0,disabled:a.disabled},null,8,["value","onUpdate:value","precision","disabled"])):(r(),_(f,{key:1,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,precision:a.precision||0,disabled:a.disabled,placeholder:"请输入"},null,8,["value","onUpdate:value","precision","disabled"]))],64)):["rate","slider"].includes(a.jnpfKey)?(r(),c(b,{key:2},["between"==a.symbol?(r(),_(s,{key:0,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,precision:"rate"==a.jnpfKey&&a.allowHalf?1:0,disabled:a.disabled},null,8,["value","onUpdate:value","precision","disabled"])):(r(),_(f,{key:1,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,precision:"rate"==a.jnpfKey&&a.allowHalf?1:0,disabled:a.disabled,placeholder:"请输入"},null,8,["value","onUpdate:value","precision","disabled"]))],64)):"switch"===a.jnpfKey?(r(),c("div",Vl,[p(U,{value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,disabled:a.disabled},null,8,["value","onUpdate:value","disabled"])])):"colorPicker"===a.jnpfKey?(r(),_(F,{key:4,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,size:"small",disabled:a.disabled},null,8,["value","onUpdate:value","disabled"])):"timePicker"===a.jnpfKey?(r(),c(b,{key:5},["between"==a.symbol?(r(),_(E,{key:0,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,format:a.format,allowClear:"",disabled:a.disabled},null,8,["value","onUpdate:value","format","disabled"])):(r(),_(q,{key:1,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,format:a.format,allowClear:"",disabled:a.disabled},null,8,["value","onUpdate:value","format","disabled"]))],64)):["datePicker","createTime","modifyTime"].includes(a.jnpfKey)?(r(),c(b,{key:6},["between"==a.symbol?(r(),_(B,{key:0,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,format:a.format||"YYYY-MM-DD HH:mm:ss",allowClear:"",disabled:a.disabled},null,8,["value","onUpdate:value","format","disabled"])):(r(),_($,{key:1,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,format:a.format||"YYYY-MM-DD HH:mm:ss",allowClear:"",disabled:a.disabled},null,8,["value","onUpdate:value","format","disabled"]))],64)):["organizeSelect","currOrganize"].includes(a.jnpfKey)?(r(),_(Q,{key:7,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,allowClear:"",selectType:a.selectType,ableIds:a.ableIds,multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","selectType","ableIds","multiple","disabled"])):["depSelect"].includes(a.jnpfKey)?(r(),_(le,{key:8,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,allowClear:"",selectType:a.selectType,ableIds:a.ableIds,multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","selectType","ableIds","multiple","disabled"])):"roleSelect"===a.jnpfKey?(r(),_(ae,{key:9,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,allowClear:"",selectType:a.selectType,ableIds:a.ableIds,multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","selectType","ableIds","multiple","disabled"])):"groupSelect"===a.jnpfKey?(r(),_(te,{key:10,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,allowClear:"",selectType:a.selectType,ableIds:a.ableIds,multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","selectType","ableIds","multiple","disabled"])):"posSelect"===a.jnpfKey?(r(),_(ie,{key:11,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,allowClear:"",selectType:a.selectType,ableIds:a.ableIds,multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","selectType","ableIds","multiple","disabled"])):"currPosition"===a.jnpfKey?(r(),_(ie,{key:12,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,allowClear:"",multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","multiple","disabled"])):["createUser","modifyUser"].includes(a.jnpfKey)?(r(),_(se,{key:13,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,allowClear:"",multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","multiple","disabled"])):["userSelect"].includes(a.jnpfKey)?(r(),_(se,{key:14,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,allowClear:"",selectType:"all"!=a.selectType&&"custom"!=a.selectType?"all":a.selectType,ableIds:a.ableIds,multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","selectType","ableIds","multiple","disabled"])):["usersSelect"].includes(a.jnpfKey)?(r(),_(ue,{key:15,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,allowClear:"",selectType:a.selectType,ableIds:a.ableIds,multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","selectType","ableIds","multiple","disabled"])):"areaSelect"===a.jnpfKey?(r(),_(re,{value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,level:a.level,allowClear:"",multiple:a.multiple,disabled:a.disabled,key:l.cellKey},null,8,["value","onUpdate:value","level","multiple","disabled"])):["select","radio","checkbox"].includes(a.jnpfKey)?(r(),_(n,{key:17,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,showSearch:"",allowClear:"",options:a.options,fieldNames:a.props,multiple:a.multiple||"checkbox"===a.jnpfKey,disabled:a.disabled},null,8,["value","onUpdate:value","options","fieldNames","multiple","disabled"])):"cascader"===a.jnpfKey?(r(),_(ce,{key:18,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,options:a.options,fieldNames:a.props,showAllLevels:a.showAllLevels,showSearch:"",allowClear:"",placeholder:"请选择",multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","options","fieldNames","showAllLevels","multiple","disabled"])):"treeSelect"===a.jnpfKey?(r(),_(pe,{key:19,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,options:a.options,fieldNames:a.props,showSearch:"",allowClear:"",placeholder:"请选择",multiple:a.multiple,disabled:a.disabled},null,8,["value","onUpdate:value","options","fieldNames","multiple","disabled"])):"relationForm"===a.jnpfKey?(r(),_(g(ge),{key:20,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,placeholder:"请选择",modelId:a.modelId,allowClear:"",columnOptions:a.columnOptions,relationField:a.relationField,hasPage:a.hasPage,pageSize:a.pageSize,popupType:a.popupType,popupTitle:a.popupTitle,popupWidth:a.popupWidth,disabled:a.disabled,queryType:a.queryType,propsValue:a.propsValue},null,8,["value","onUpdate:value","modelId","columnOptions","relationField","hasPage","pageSize","popupType","popupTitle","popupWidth","disabled","queryType","propsValue"])):"popupSelect"===a.jnpfKey||"popupTableSelect"===a.jnpfKey?(r(),_(fe,{key:21,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,placeholder:"请选择",interfaceId:a.interfaceId,allowClear:"",multiple:a.multiple,columnOptions:a.columnOptions,propsValue:a.propsValue,templateJson:a.templateJson,relationField:a.relationField,hasPage:a.hasPage,pageSize:a.pageSize,popupType:a.popupType,popupTitle:a.popupTitle,popupWidth:a.popupWidth,disabled:a.disabled},null,8,["value","onUpdate:value","interfaceId","multiple","columnOptions","propsValue","templateJson","relationField","hasPage","pageSize","popupType","popupTitle","popupWidth","disabled"])):"autoComplete"===a.jnpfKey?(r(),_(me,{key:22,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,placeholder:"请输入",allowClear:"",interfaceId:a.interfaceId,relationField:a.relationField,templateJson:a.templateJson,total:a.total,disabled:a.disabled},null,8,["value","onUpdate:value","interfaceId","relationField","templateJson","total","disabled"])):(r(),_(ve,{key:23,value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,placeholder:"请输入",allowClear:"",disabled:a.disabled},null,8,["value","onUpdate:value","disabled"]))])),_:2},1032,["span"])):w("",!0),4===a.fieldValueType?(r(),_(o,{key:3,span:8},{default:m((()=>{return[p(n,{value:a.fieldValue,"onUpdate:value":e=>a.fieldValue=e,options:(e=a.jnpfKey,O.includes(e)?[{id:"@currentTime",fullName:"当前时间"}]:M.includes(e)?[{id:"@positionId",fullName:"当前岗位"}]:z.includes(e)?[{id:"@organizeId",fullName:"当前组织"},{id:"@organizationAndSuborganization",fullName:"当前组织及子组织"},{id:"@branchManageOrganize",fullName:"当前分管组织"}]:P.includes(e)?[{id:"@depId",fullName:"当前部门"},{id:"@depAndSubordinates",fullName:"当前部门及下级部门"}]:A.includes(e)?[{id:"@userId",fullName:"当前用户"},{id:"@userAndSubordinates",fullName:"当前用户及下属"}]:[]),allowClear:""},null,8,["value","onUpdate:value","options"])];var e})),_:2},1024)):w("",!0),p(o,{span:1,class:"text-center"},{default:m((()=>[y("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e,l){G.conditionList[e].groups.splice(l,1),G.conditionList[e].groups.length||oe(e)}(u,i)},null,8,Ul)])),_:2},1024)])),_:2},1032,["gutter"])))),128)),y("span",{class:"link-text inline-block",onClick:e=>function(e){G.conditionList[e].groups.push(V(d))}(u)},a[4]||(a[4]=[y("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),k("添加条件")]),8,Sl)],2)])))),128)),J(y("div",Fl,[a[6]||(a[6]=y("img",{src:"/static/png/query-noData-bdc8c8ba.png",class:"noData-img"},null,-1)),y("div",Il,[a[5]||(a[5]=y("span",null,"没有任何查询条件",-1)),p(be,{type:"vertical"}),y("span",{class:"link-text",onClick:ne},"点击新增")])],512),[[K,!g(Z).length&&e.isSuperQuery]]),J(y("span",{class:"link-text inline-block",onClick:a[1]||(a[1]=e=>ne())},a[7]||(a[7]=[y("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),k("添加条件组 ")]),512),[[K,g(Z).length||!e.isSuperQuery]])],2)}}}),Jl={key:0,class:"plan-list"},Kl=["onClick"],Dl={class:"plan-list-name"},Rl=["onClick"],Ol={key:1,class:"noData-txt"},zl=e({__name:"SuperQueryModal",emits:["register","superQuery"],setup(e,{emit:l}){const a=l,[n,{closeModal:d,changeLoading:s}]=he((function(e){P.popoverVisible=!1,P.hidePlan=e.hidePlan||!1,s(!0),P.fieldOptions=V(e.columnOptions),z.value?.init({conditionList:P.conditionList,matchLogic:P.matchLogic,fieldOptions:P.fieldOptions}),B()})),[v,{openModal:w,closeModal:C,setModalProps:x}]=ke(),[S,{resetFields:I,validate:J}]=Ve({labelWidth:80,schemas:[{field:"fullName",label:"方案名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"}]}]}),{createMessage:K,createConfirm:D}=U(),{t:R}=N(),O=W(),z=t(),P=i({planList:[],conditionList:[{logic:"and",groups:[{field:"",symbol:"",jnpfKey:"",fieldValueType:2,fieldValue:void 0,fieldValueJnpfKey:"",cellKey:+new Date}]}],popoverVisible:!1,fieldOptions:[],matchLogic:"and",hidePlan:!1}),{planList:M,popoverVisible:A,hidePlan:E}=F(P),q=o((()=>O.meta.modelId||""));function B(){if(!g(q))return s(!1);var e;(e=g(q),Y.get({url:`/api/system/AdvancedQuery/${e}/List`})).then((e=>{P.planList=e.data.list,s(!1)}))}function $(){const e=z.value?.confirm();if(e){if(P.conditionList=e.conditionList||[],P.matchLogic=e.matchLogic,!P.conditionList.length)return K.error("请添加条件");w(),T((()=>{I()}))}}function H(e,l){(function(e){return Y.delete({url:"/api/system/AdvancedQuery/"+e})})(e).then((e=>{K.success(e.msg),P.planList.splice(l,1)}))}async function Q(){const e=await J();if(!e)return;const l=e.fullName;if(!P.planList.some((e=>e.fullName===l)))return ee(l);const a=P.planList.filter((e=>e.fullName===l));D({iconType:"warning",title:R("common.tipTitle"),content:`${a[0].fullName}已存在, 是否覆盖方案?`,onOk:()=>{ee(l,a[0].id)}})}function ee(e,l=""){x({confirmLoading:!0});const a={id:l,fullName:e,moduleId:g(q),matchLogic:P.matchLogic,conditionJson:JSON.stringify(P.conditionList)};(a.id?Nl:Cl)(a).then((e=>{C(),x({confirmLoading:!1}),K.success(e.msg),B()})).catch((()=>{x({confirmLoading:!1})}))}function le(){const e=z.value?.confirm();if(!e)return;P.conditionList=e.conditionList||[],P.matchLogic=e.matchLogic;const l={matchLogic:P.matchLogic,conditionList:P.conditionList};let t=JSON.stringify(l);P.conditionList.length||(t=""),a("superQuery",t),d()}return(e,l)=>{const a=u("a-button"),t=u("a-popover"),i=u("a-space");return r(),_(g(we),f(e.$attrs,{onRegister:g(n),title:g(R)("common.superQuery"),okText:g(R)("common.queryText"),width:"700px",onOk:le,destroyOnClose:"",class:"jnpf-super-query-modal jnpf-condition-modal"}),G({default:m((()=>[p(jl,{ref_key:"conditionMainRef",ref:z,isSuperQuery:"",showFieldValueType:"",isCustomFieldValueType:"",class:"super-query-main"},null,512),p(g(we),f(e.$attrs,{onRegister:g(v),title:"保存方案",onOk:Q}),{default:m((()=>[p(g(Ue),{onRegister:g(S)},null,8,["onRegister"])])),_:1},16,["onRegister"])])),_:2},[g(E)?void 0:{name:"insertFooter",fn:m((()=>[p(i,{size:10,class:"float-left"},{default:m((()=>[p(a,{onClick:$},{default:m((()=>l[1]||(l[1]=[k("保存方案")]))),_:1,__:[1]}),p(t,{placement:"bottom",trigger:"click",overlayClassName:"plan-popover",open:g(A),"onUpdate:open":l[0]||(l[0]=e=>j(A)?A.value=e:null)},{content:m((()=>[g(M).length?(r(),c("div",Jl,[(r(!0),c(b,null,L(g(M),((e,l)=>(r(),c("div",{class:"plan-list-item",key:l,onClick:l=>function(e){P.matchLogic=e.matchLogic,P.conditionList=e.conditionJson?JSON.parse(e.conditionJson):[],z.value?.updateConditionList({conditionList:P.conditionList,matchLogic:P.matchLogic}),P.popoverVisible=!1}(e)},[y("p",Dl,h(e.fullName),1),y("i",{class:"icon-ym icon-ym-nav-close",onClick:X((a=>H(e.id,l)),["stop"])},null,8,Rl)],8,Kl)))),128))])):(r(),c("div",Ol,"暂无数据"))])),default:m((()=>[p(a,null,{default:m((()=>[l[2]||(l[2]=k("方案选择")),p(g(Z))])),_:1,__:[2]})])),_:1},8,["open"])])),_:1})])),key:"0"}]),1040,["onRegister","title","okText"])}}}),Pl={class:"template-search"},Ml={class:"template-list"},Al=["onClick"],Yl=e({__name:"SelectFlowModal",emits:["register","change"],setup(e,{emit:l}){const a=i({flowList:[],keyword:""}),t=l,[n,{closeModal:d}]=he((function(e){a.keyword="",a.flowList=e.flowList||[]})),{t:s}=N(),v=o((()=>a.keyword?a.flowList.filter((e=>-1!==e.fullName.indexOf(a.keyword))):a.flowList));return(e,l)=>{const i=u("a-input-search"),o=u("jnpf-empty");return r(),_(g(we),f(e.$attrs,{onRegister:g(n),title:"请选择流程",width:"400px",footer:null,destroyOnClose:"",class:"jnpf-flow-list-modal"}),{default:m((()=>[y("div",Pl,[p(i,{placeholder:g(s)("common.enterKeyword"),allowClear:"",value:a.keyword,"onUpdate:value":l[0]||(l[0]=e=>a.keyword=e)},null,8,["placeholder","value"])]),y("div",Ml,[p(g(ee),null,{default:m((()=>[(r(!0),c(b,null,L(v.value,(e=>(r(),c("div",{class:"template-item",key:e.id,onClick:l=>function(e){t("change",e),d()}(e)},h(e.fullName),9,Al)))),128)),v.value.length?w("",!0):(r(),_(o,{key:0}))])),_:1})])])),_:1},16,["onRegister"])}}});const El={class:"common-container"},ql={class:"jnpf-content-wrapper"},Bl={class:"jnpf-content-wrapper-center"},$l={class:"jnpf-content-wrapper-content"},Hl=e({inheritAttrs:!1,__name:"TableSelect",props:{value:{default:""},title:{type:String,default:""},placeholder:{type:String,default:"请选择"},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!0},size:{type:String,default:"default"},linkId:{type:String,default:"0"}},emits:["update:value","change"],setup(e,{emit:a}){const i=e,n=a,b=le({excludeDefaultKeys:!1}),h=l.useInjectFormItemContext(),{t:k}=N(),w=t(void 0),x=t(!1),_=t([]),[L,{getForm:V,getSelectRows:U,setSelectedRowKeys:S,getSelectRowKeys:F}]=me({api:Fe,columns:[{title:"表名",dataIndex:"table"},{title:"说明",dataIndex:"tableName"}],rowKey:"table",immediate:!1,useSearchForm:!0,formConfig:{baseColProps:{span:8},schemas:[{field:"keyword",label:k("common.keyword"),component:"Input",componentProps:{placeholder:k("common.enterKeyword"),submitOnPressEnter:!0}}]},tableSetting:{size:!1,setting:!1},isCanResizeParent:!0,resizeHeightOffset:-73,rowSelection:{type:"radio",columnWidth:50}}),I=o((()=>({linkId:i.linkId}))),j=o((()=>({...d(i,["disabled","size","allowClear","placeholder"]),fieldNames:{label:"tableName",value:"table"},open:!1,showSearch:!1,showArrow:!0,class:g(b).class?"w-full "+g(b).class:"w-full"})));function J(){_.value=[],n("change","",{})}async function K(){i.disabled||(x.value=!0,T((()=>{V().resetFields(),S(w.value?[w.value]:[])})))}function D(){x.value=!1}function R(){if(!F().length&&!U().length)return;if(!U().length)return n("update:value",w.value),n("change",w.value,_.value[0]),h.onFieldChange(),void D();const e=U()[0];_.value=U(),w.value=e.table,n("update:value",e.table),n("change",e.table,e),h.onFieldChange(),D()}return s((()=>i.value),(e=>{var l;l=e,w.value=l||void 0,_.value=[{table:w.value,tableName:i.title}]}),{immediate:!0}),(e,l)=>{const a=u("a-select");return r(),c("div",El,[p(a,f({value:w.value,"onUpdate:value":l[0]||(l[0]=e=>w.value=e)},j.value,{options:_.value,onChange:J,onClick:K}),null,16,["value","options"]),p(g(C),{open:x.value,"onUpdate:open":l[1]||(l[1]=e=>x.value=e),title:"数据选择",width:800,class:"common-container-modal",onOk:R,onCancel:D,maskClosable:!1},{closeIcon:m((()=>[p(v,{canFullscreen:!1,onCancel:D})])),default:m((()=>[y("div",ql,[y("div",Bl,[y("div",$l,[p(g(ve),{onRegister:g(L),searchInfo:I.value,class:"jnpf-sub-table"},null,8,["onRegister","searchInfo"])])])])])),_:1},8,["open"])])}}}),Ql={class:"px-20px pb-20px"},Wl={class:"condition-main"},Gl=["onClick"],Zl={class:"condition-main overflow-auto"},Xl={key:0,class:"mb-10px"},ea={class:"condition-item-title"},la=["onClick"],aa={class:"condition-item-content"},ta={class:"condition-item-cap"},ia=["onClick"],na=["onClick"],oa=e({__name:"RelationConfigDrawer",props:{linkId:{type:String,default:"0"},sysVariableList:{type:Array,default:()=>[]},getTableConfigTree:{type:Function}},emits:["register","confirm"],setup(e,{emit:l}){const a=e,t=l,n=[{id:"and",fullName:"且"},{id:"or",fullName:"或"}],d=[{id:"text",fullName:"text"},{id:"double",fullName:"double"},{id:"bigint",fullName:"bigint"},{id:"date",fullName:"date"},{id:"time",fullName:"time"}],s=[{id:"==",fullName:"等于"},{id:"<>",fullName:"不等于"},{id:"like",fullName:"包含"},{id:"notLike",fullName:"不包含"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],v=[{id:">=",fullName:"大于等于"},{id:">",fullName:"大于"},{id:"==",fullName:"等于"},{id:"<=",fullName:"小于等于"},{id:"<",fullName:"小于"},{id:"<>",fullName:"不等于"},{id:"between",fullName:"介于"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],C=[{id:1,fullName:"固定值"},{id:2,fullName:"系统参数"}],N=[{id:1,fullName:"左连接",icon:"icon-ym icon-ym-left-join"},{id:2,fullName:"右连接",icon:"icon-ym icon-ym-right-join"},{id:3,fullName:"内连接",icon:"icon-ym icon-ym-inner-join"},{id:4,fullName:"全连接",icon:"icon-ym icon-ym-full-join"}],T={field:"",dataType:"text",symbol:"==",fieldValue:"",fieldValueType:1},x={logic:"and",groups:[T]},S=i({currTable:{},parentTable:{},dataForm:{}}),{dataForm:I}=F(S),[j,{closeDrawer:J}]=je((function(e){S.currTable=e,S.parentTable=a.getTableConfigTree().getSelectedNode(e.parentTable),S.dataForm=V(e.relationConfig)})),{createMessage:K}=U(),D=o((()=>[{id:S.parentTable.table,fullName:S.parentTable.tableName,options:S.parentTable.fieldList.map((e=>({id:e.field,fullName:e.fieldName,dataType:e.dataType})))}])),R=o((()=>[{id:S.currTable.table,fullName:S.currTable.tableName,options:S.currTable.fieldList.map((e=>({id:e.field,fullName:e.fieldName,dataType:e.dataType})))}])),O=o((()=>[{id:S.parentTable.table,fullName:S.parentTable.tableName,options:S.parentTable.fieldList.map((e=>({id:S.parentTable.table+"-"+e.field,fullName:e.fieldName,dataType:e.dataType})))},{id:S.currTable.table,fullName:S.currTable.tableName,options:S.currTable.fieldList.map((e=>({id:S.currTable.table+"-"+e.field,fullName:e.fieldName,dataType:e.dataType})))}]));function z(e){S.dataForm.ruleList.splice(e,1)}function P(){if(!S.dataForm.relationList.length)return K.warning("请至少配置一组字段关联");(function(){const e=S.dataForm.relationList;let l=!0;for(let a=0;a<e.length;a++){if(!e[a].pField){K.warning("关联字段中父表字段不能为空"),l=!1;break}e[a].field||(K.warning("关联字段中当前表字段不能为空"),l=!1)}return l})()&&function(){const e=S.dataForm.ruleList;let l=!0;e:for(let a=0;a<e.length;a++){const t=e[a];for(let e=0;e<t.groups.length;e++){const a=t.groups[e];if(!a.field){K.warning("字段不能为空"),l=!1;break e}if(2===a.fieldValueType&&!a.fieldValue){K.warning("系统参数不能为空"),l=!1;break e}if(1===a.fieldValueType&&!["null","notNull"].includes(a.symbol)&&(!a.fieldValue&&0!==a.fieldValue||Q(a.fieldValue)))return K.warning("数据值不能为空"),void(l=!1)}}return l}()&&(t("confirm",S.dataForm),J())}return(l,a)=>{const t=u("a-radio-button"),i=u("a-radio-group"),o=u("jnpf-select"),U=u("a-col"),F=u("a-row"),J=u("jnpf-radio"),K=u("jnpf-number-range"),M=u("jnpf-input-number"),A=u("jnpf-date-range"),Y=u("jnpf-date-picker"),E=u("a-input");return r(),_(g(Je),f(l.$attrs,{width:"500px",onRegister:g(j),title:"数据连接",class:"dataSet-table-config-drawer",showFooter:"",maskClosable:!1,onOk:P,destroyOnClose:""}),{default:m((()=>[y("div",Ql,[a[10]||(a[10]=y("div",{class:"common-cap"},[y("span",{class:"title"},"关联关系")],-1)),p(i,{value:g(I).type,"onUpdate:value":a[0]||(a[0]=e=>g(I).type=e),"button-style":"solid"},{default:m((()=>[(r(),c(b,null,L(N,(e=>p(t,{value:e.id,key:e.id},{default:m((()=>[y("i",{class:H(["mr-10px",e.icon])},null,2),k(h(e.fullName),1)])),_:2},1032,["value"]))),64))])),_:1},8,["value"]),a[11]||(a[11]=y("div",{class:"common-cap"},[y("span",{class:"title"},"关联字段")],-1)),y("div",Wl,[(r(!0),c(b,null,L(g(I).relationList,((e,l)=>(r(),_(F,{gutter:8,key:l,class:"mb-10px"},{default:m((()=>[p(U,{span:10},{default:m((()=>[p(o,{value:e.pField,"onUpdate:value":l=>e.pField=l,options:D.value,showSearch:"",allowClear:""},null,8,["value","onUpdate:value","options"])])),_:2},1024),p(U,{span:2,class:"leading-32px symbol-text"},{default:m((()=>a[4]||(a[4]=[k("等于")]))),_:1,__:[4]}),p(U,{span:10},{default:m((()=>[p(o,{value:e.field,"onUpdate:value":l=>e.field=l,options:R.value,showSearch:"",allowClear:""},null,8,["value","onUpdate:value","options"])])),_:2},1024),p(U,{span:2,class:"text-center"},{default:m((()=>[y("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e){S.dataForm.relationList.splice(e,1)}(l)},null,8,Gl)])),_:2},1024)])),_:2},1024)))),128)),y("span",{class:"link-text inline-block",onClick:a[1]||(a[1]=e=>{S.dataForm.relationList.push({pField:"",field:""})})},a[5]||(a[5]=[y("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),k("新增关联字段")]))]),a[12]||(a[12]=y("div",{class:"common-cap"},[y("span",{class:"title"},"条件筛选")],-1)),y("div",Zl,[g(I).ruleList?.length?(r(),c("div",Xl,[p(J,{value:g(I).matchLogic,"onUpdate:value":a[2]||(a[2]=e=>g(I).matchLogic=e),options:n,optionType:"button","button-style":"solid"},null,8,["value"])])):w("",!0),(r(!0),c(b,null,L(g(I).ruleList,((l,t)=>(r(),c("div",{class:"condition-item",key:t},[y("div",ea,[a[6]||(a[6]=y("div",null,"条件组",-1)),y("i",{class:"icon-ym icon-ym-nav-close",onClick:e=>z(t)},null,8,la)]),y("div",aa,[y("div",ta,[a[7]||(a[7]=k(" 以下条件全部执行： ")),p(J,{value:l.logic,"onUpdate:value":e=>l.logic=e,options:n,optionType:"button","button-style":"solid",size:"small"},null,8,["value","onUpdate:value"])]),(r(!0),c(b,null,L(l.groups,((l,a)=>(r(),_(F,{gutter:8,key:t+a,wrap:"",class:"mb-10px"},{default:m((()=>[p(U,{span:18,class:"!flex items-center"},{default:m((()=>[p(o,{value:l.field,"onUpdate:value":e=>l.field=e,options:O.value,placeholder:"请选择字段",allowClear:"",showSearch:""},null,8,["value","onUpdate:value","options"])])),_:2},1024),p(U,{span:6},{default:m((()=>[p(o,{class:"w-full",value:l.dataType,"onUpdate:value":e=>l.dataType=e,options:d,onChange:e=>function(e){e.fieldValueType=1,"text"===e.dataType?(s.some((l=>l.id===e.symbol))||(e.symbol="=="),e.fieldValue=""):(v.some((l=>l.id===e.symbol))||(e.symbol="=="),e.fieldValue=void 0)}(l)},null,8,["value","onUpdate:value","onChange"])])),_:2},1024),p(U,{span:6,class:"mt-10px"},{default:m((()=>[p(o,{class:"w-full",value:l.symbol,"onUpdate:value":e=>l.symbol=e,options:"text"===l.dataType?s:v,onChange:e=>function(e){"text"===e.dataType?["null","notNull"].includes(e.symbol)&&(e.fieldValueType=1,e.fieldValue=""):["null","notNull"].includes(e.symbol)?e.fieldValue=void 0:"between"===e.symbol?!Array.isArray(e.fieldValue)&&(e.fieldValue=[]):Array.isArray(e.fieldValue)&&(e.fieldValue=void 0)}(l)},null,8,["value","onUpdate:value","options","onChange"])])),_:2},1024),["double","bigint","date","time"].includes(l.dataType)?(r(),_(U,{key:0,span:16,class:"mt-10px"},{default:m((()=>[["double","bigint"].includes(l.dataType)?(r(),c(b,{key:0},["between"==l.symbol?(r(),_(K,{key:0,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e},null,8,["value","onUpdate:value"])):(r(),_(M,{key:1,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,placeholder:"请输入",disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","disabled"]))],64)):["date","time"].includes(l.dataType)?(r(),c(b,{key:1},["between"==l.symbol?(r(),_(A,{key:0,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,format:"time"===l.dataType?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD",allowClear:""},null,8,["value","onUpdate:value","format"])):(r(),_(Y,{key:1,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,format:"time"===l.dataType?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD",allowClear:"",disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","format","disabled"]))],64)):w("",!0)])),_:2},1024)):(r(),c(b,{key:1},[p(U,{span:6,class:"mt-10px"},{default:m((()=>[p(o,{value:l.fieldValueType,"onUpdate:value":e=>l.fieldValueType=e,options:C,onChange:e=>function(e){e.fieldValue=""}(l),disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","onChange","disabled"])])),_:2},1024),p(U,{span:10,class:"mt-10px"},{default:m((()=>[1===l.fieldValueType?(r(),_(E,{key:0,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,placeholder:"请输入",allowClear:"",disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","disabled"])):(r(),_(o,{key:1,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,options:e.sysVariableList,allowClear:"",showSearch:"",placeholder:"请选择系统参数"},null,8,["value","onUpdate:value","options"]))])),_:2},1024)],64)),p(U,{span:2,class:"text-center mt-10px"},{default:m((()=>[y("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e,l){S.dataForm.ruleList[e].groups.splice(l,1),S.dataForm.ruleList[e].groups.length||z(e)}(t,a)},null,8,ia)])),_:2},1024)])),_:2},1024)))),128)),y("span",{class:"link-text inline-block",onClick:e=>function(e){S.dataForm.ruleList[e].groups.push(V(T))}(t)},a[8]||(a[8]=[y("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),k("添加条件")]),8,na)])])))),128)),y("span",{class:"link-text inline-block",onClick:a[3]||(a[3]=e=>{S.dataForm.ruleList.push(V(x))})},a[9]||(a[9]=[y("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),k("添加条件组")]))])])])),_:1},16,["onRegister"])}}}),da={class:"p-20px"},sa={class:"common-cap !mt-0"},ua={class:"flex-1"},ra={class:"common-cap"},ca={class:"title"},pa={class:"condition-main overflow-auto"},fa={key:0,class:"mb-10px"},ma={class:"condition-item-title"},va=["onClick"],ya={class:"condition-item-content"},ga={class:"condition-item-cap"},ba=["onClick"],ha=["onClick"],ka=e({__name:"TableConfigDrawer",props:{linkId:{type:String,default:"0"},sysVariableList:{type:Array,default:()=>[]},getTableConfigTree:{type:Function}},emits:["register","confirm","close"],setup(e,{emit:l}){const a=e,t=l,n=[{title:"字段名",dataIndex:"field",key:"field",width:200},{title:"字段描述",dataIndex:"fieldName",key:"fieldName"}],d=[{id:"and",fullName:"且"},{id:"or",fullName:"或"}],s=[{id:"text",fullName:"text"},{id:"double",fullName:"double"},{id:"bigint",fullName:"bigint"},{id:"date",fullName:"date"},{id:"time",fullName:"time"}],v=[{id:"==",fullName:"等于"},{id:"<>",fullName:"不等于"},{id:"like",fullName:"包含"},{id:"notLike",fullName:"不包含"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],C=[{id:">=",fullName:"大于等于"},{id:">",fullName:"大于"},{id:"==",fullName:"等于"},{id:"<=",fullName:"小于等于"},{id:"<",fullName:"小于"},{id:"<>",fullName:"不等于"},{id:"between",fullName:"介于"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],T=[{id:1,fullName:"固定值"},{id:2,fullName:"系统参数"}],x={field:"",dataType:"text",symbol:"==",fieldValue:"",fieldValueType:1},S={logic:"and",groups:[x]},I={parentTable:"",table:"",tableName:"",fieldList:[],ruleList:[],matchLogic:"and",relationConfig:{ruleList:[],matchLogic:"and",type:1,relationList:[]},children:[]},j=i({dataForm:{},isEdit:!1,allFieldList:[],selectedRowKeys:[],oldTable:""}),{dataForm:J,allFieldList:K,selectedRowKeys:D}=F(j),[R,{closeDrawer:O}]=je((function(e){j.selectedRowKeys=[],j.allFieldList=[],j.isEdit=!!e.data;const l=e.data?V(e.data):V(I);!j.isEdit&&e.parentTable&&(l.parentTable=e.parentTable);j.isEdit&&$(l.table,!0);j.oldTable=l.table,j.dataForm=l})),[z,{openDrawer:P}]=Ke(),{t:M}=N(),{createMessage:A,createConfirm:Y}=U(),E=o((()=>({...a})));function q(e,l){if(!e)return B();j.dataForm.table!==e&&B(),$(e,j.dataForm.table===e),j.dataForm.table=e,j.dataForm.tableName=e+(l.tableName?`(${l.tableName})`:"")}function B(){j.dataForm.table="",j.dataForm.tableName="",j.dataForm.fieldList=[],j.dataForm.ruleList=[]}function $(e,l=!1){Ie(a.linkId,e).then((e=>{if(j.allFieldList=e.data.list,l){const e=j.dataForm.fieldList.filter((e=>j.allFieldList.some((l=>e.field===l.field))));j.dataForm.fieldList=e,j.selectedRowKeys=j.dataForm.fieldList.map((e=>e.field))}else{j.selectedRowKeys=j.allFieldList.map((e=>e.field));const e=j.allFieldList.map((e=>({field:e.field,fieldName:e.field+(e.fieldName?`(${e.fieldName})`:""),dataType:e.dataType})));j.dataForm.fieldList=e}}))}function H(e,l){j.selectedRowKeys=e,j.dataForm.fieldList=l.map((e=>({field:e.field,fieldName:e.field+(e.fieldName?`(${e.fieldName})`:""),dataType:e.dataType})))}function W(e){j.dataForm.ruleList.splice(e,1)}function G(e){j.dataForm.relationConfig=e}function Z(){if(!j.dataForm.table)return A.warning("请选择数据库表");if(j.dataForm.parentTable){let e=a.getTableConfigTree().getAllKeys();if(j.isEdit&&(e=e.filter((e=>e!=j.oldTable))),e.includes(j.dataForm.table))return A.warning("数据库表不能重复,请重新选择")}return j.dataForm.fieldList.length?function(){const e=j.dataForm.ruleList;let l=!0;e:for(let a=0;a<e.length;a++){const t=e[a];for(let e=0;e<t.groups.length;e++){const a=t.groups[e];if(!a.field){A.warning("字段不能为空"),l=!1;break e}if(2===a.fieldValueType&&!a.fieldValue){A.warning("系统参数不能为空"),l=!1;break e}if(1===a.fieldValueType&&!["null","notNull"].includes(a.symbol)&&(!a.fieldValue&&0!==a.fieldValue||Q(a.fieldValue)))return A.warning("数据值不能为空"),void(l=!1)}}return l}()?j.dataForm.parentTable&&!j.dataForm?.relationConfig?.relationList?.length?A.warning("请至少配置一组字段关联"):void(j.oldTable&&j.dataForm.table!=j.oldTable?Y({iconType:"warning",title:M("common.tipTitle"),content:"切换数据库表将清空关联子表，确定要继续?",onOk:()=>{t("confirm",j.dataForm,j.isEdit,!0),O()}}):(t("confirm",j.dataForm,j.isEdit),O())):void 0:A.warning("请至少选择一个字段")}function X(){return t("close"),!0}return(l,a)=>{const t=u("a-table"),i=u("jnpf-radio"),o=u("jnpf-select"),N=u("a-col"),U=u("jnpf-number-range"),F=u("jnpf-input-number"),I=u("jnpf-date-range"),O=u("jnpf-date-picker"),M=u("a-input"),Y=u("a-row"),B=u("a-button");return r(),_(g(Je),f(l.$attrs,{width:"500px",title:"数据库表设置",onRegister:g(R),class:"dataSet-table-config-drawer",showFooter:"",maskClosable:!1,onOk:Z,closeFunc:X,destroyOnClose:""}),{default:m((()=>[y("div",da,[y("div",sa,[a[3]||(a[3]=y("span",{class:"title w-80px flex-shrink-0"},"数据库表",-1)),y("div",ua,[p(Hl,{value:g(J).table,title:g(J).tableName,linkId:e.linkId,onChange:q},null,8,["value","title","linkId"])])]),g(J).table?(r(),c(b,{key:0},[y("div",ra,[y("span",ca,"选择 "+h(g(J)?.fieldList?.length||0)+"/"+h(g(K).length),1)]),p(t,{"data-source":g(K),columns:n,size:"small",pagination:!1,scroll:{y:"300px"},rowKey:"field","row-selection":{columnWidth:50,selectedRowKeys:g(D),onChange:H}},null,8,["data-source","row-selection"]),a[10]||(a[10]=y("div",{class:"common-cap"},[y("span",{class:"title"},"条件筛选")],-1)),y("div",pa,[g(J).ruleList?.length?(r(),c("div",fa,[p(i,{value:g(J).matchLogic,"onUpdate:value":a[0]||(a[0]=e=>g(J).matchLogic=e),options:d,optionType:"button","button-style":"solid"},null,8,["value"])])):w("",!0),(r(!0),c(b,null,L(g(J).ruleList,((l,t)=>(r(),c("div",{class:"condition-item",key:t},[y("div",ma,[a[4]||(a[4]=y("div",null,"条件组",-1)),y("i",{class:"icon-ym icon-ym-nav-close",onClick:e=>W(t)},null,8,va)]),y("div",ya,[y("div",ga,[a[5]||(a[5]=k(" 以下条件全部执行： ")),p(i,{value:l.logic,"onUpdate:value":e=>l.logic=e,options:d,optionType:"button","button-style":"solid",size:"small"},null,8,["value","onUpdate:value"])]),(r(!0),c(b,null,L(l.groups,((l,a)=>(r(),_(Y,{gutter:8,key:t+a,wrap:"",class:"mb-10px"},{default:m((()=>[p(N,{span:18,class:"!flex items-center"},{default:m((()=>[p(o,{value:l.field,"onUpdate:value":e=>l.field=e,options:g(J).fieldList,placeholder:"请选择字段",allowClear:"",showSearch:"",fieldNames:{label:"fieldName",value:"field"}},null,8,["value","onUpdate:value","options"])])),_:2},1024),p(N,{span:6},{default:m((()=>[p(o,{class:"w-full",value:l.dataType,"onUpdate:value":e=>l.dataType=e,options:s,onChange:e=>function(e){e.fieldValueType=1,"text"===e.dataType?(v.some((l=>l.id===e.symbol))||(e.symbol="=="),e.fieldValue=""):(C.some((l=>l.id===e.symbol))||(e.symbol="=="),e.fieldValue=void 0)}(l)},null,8,["value","onUpdate:value","onChange"])])),_:2},1024),p(N,{span:6,class:"mt-10px"},{default:m((()=>[p(o,{class:"w-full",value:l.symbol,"onUpdate:value":e=>l.symbol=e,options:"text"===l.dataType?v:C,onChange:e=>function(e){"text"===e.dataType?["null","notNull"].includes(e.symbol)&&(e.fieldValueType=1,e.fieldValue=""):["null","notNull"].includes(e.symbol)?e.fieldValue=void 0:"between"===e.symbol?!Array.isArray(e.fieldValue)&&(e.fieldValue=[]):Array.isArray(e.fieldValue)&&(e.fieldValue=void 0)}(l)},null,8,["value","onUpdate:value","options","onChange"])])),_:2},1024),["double","bigint","date","time"].includes(l.dataType)?(r(),_(N,{key:0,span:16,class:"mt-10px"},{default:m((()=>[["double","bigint"].includes(l.dataType)?(r(),c(b,{key:0},["between"==l.symbol?(r(),_(U,{key:0,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e},null,8,["value","onUpdate:value"])):(r(),_(F,{key:1,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,placeholder:"请输入",disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","disabled"]))],64)):["date","time"].includes(l.dataType)?(r(),c(b,{key:1},["between"==l.symbol?(r(),_(I,{key:0,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,format:"time"===l.dataType?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD",allowClear:""},null,8,["value","onUpdate:value","format"])):(r(),_(O,{key:1,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,format:"time"===l.dataType?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD",allowClear:"",disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","format","disabled"]))],64)):w("",!0)])),_:2},1024)):(r(),c(b,{key:1},[p(N,{span:6,class:"mt-10px"},{default:m((()=>[p(o,{value:l.fieldValueType,"onUpdate:value":e=>l.fieldValueType=e,options:T,onChange:e=>function(e){e.fieldValue=""}(l),disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","onChange","disabled"])])),_:2},1024),p(N,{span:10,class:"mt-10px"},{default:m((()=>[1===l.fieldValueType?(r(),_(M,{key:0,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,placeholder:"请输入",allowClear:"",disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","disabled"])):(r(),_(o,{key:1,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,options:e.sysVariableList,allowClear:"",showSearch:"",placeholder:"请选择系统参数"},null,8,["value","onUpdate:value","options"]))])),_:2},1024)],64)),p(N,{span:2,class:"text-center mt-10px"},{default:m((()=>[y("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e,l){j.dataForm.ruleList[e].groups.splice(l,1),j.dataForm.ruleList[e].groups.length||W(e)}(t,a)},null,8,ba)])),_:2},1024)])),_:2},1024)))),128)),y("span",{class:"link-text inline-block",onClick:e=>function(e){j.dataForm.ruleList[e].groups.push(V(x))}(t)},a[6]||(a[6]=[y("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),k("添加条件")]),8,ha)])])))),128)),y("span",{class:"link-text inline-block",onClick:a[1]||(a[1]=e=>{j.dataForm.ruleList.push(V(S))})},a[7]||(a[7]=[y("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),k("添加条件组")]))]),g(J).parentTable?(r(),c(b,{key:0},[a[9]||(a[9]=y("div",{class:"common-cap"},[y("span",{class:"title"},"数据连接")],-1)),p(B,{block:"",onClick:a[2]||(a[2]=e=>function(){if(!j.dataForm.fieldList.length)return A.warning("请至少选择一个字段");P(!0,{...j.dataForm})}())},{default:m((()=>a[8]||(a[8]=[k("配置数据连接")]))),_:1,__:[8]})],64)):w("",!0)],64)):w("",!0)]),p(oa,f(E.value,{onRegister:g(z),onConfirm:G}),null,16,["onRegister"])])),_:1},16,["onRegister"])}}}),wa={class:"p-20px"},Ca={class:"condition-main overflow-auto"},Na={key:0,class:"mb-10px"},Ta={class:"condition-item-title"},xa=["onClick"],_a={class:"condition-item-content"},La={class:"condition-item-cap"},Va=["onClick"],Ua=["onClick"],Sa=e({__name:"FilterConfigDrawer",props:{sysVariableList:{type:Array,default:()=>[]}},emits:["register","confirm"],setup(e,{emit:l}){const a=l,t=[{id:"and",fullName:"且"},{id:"or",fullName:"或"}],n=[{id:"text",fullName:"text"},{id:"double",fullName:"double"},{id:"bigint",fullName:"bigint"},{id:"date",fullName:"date"},{id:"time",fullName:"time"}],o=[{id:"==",fullName:"等于"},{id:"<>",fullName:"不等于"},{id:"like",fullName:"包含"},{id:"notLike",fullName:"不包含"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],d=[{id:">=",fullName:"大于等于"},{id:">",fullName:"大于"},{id:"==",fullName:"等于"},{id:"<=",fullName:"小于等于"},{id:"<",fullName:"小于"},{id:"<>",fullName:"不等于"},{id:"between",fullName:"介于"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],s=[{id:1,fullName:"固定值"},{id:2,fullName:"系统参数"}],v={field:"",dataType:"text",symbol:"==",fieldValue:"",fieldValueType:1},h={logic:"and",groups:[v]},C=i({dataForm:{ruleList:[]},fieldList:[]}),{dataForm:N,fieldList:T}=F(C),[x,{closeDrawer:S}]=je((function(e){(function(e=[]){const l=ae(e,{id:"table"});C.fieldList=l.map((e=>({id:e.table,fullName:e.tableName,options:e.fieldList.map((l=>({id:e.table+"-"+l.field,fullName:l.fieldName,dataType:l.dataType})))})))})(e.visualConfigJson),C.dataForm=V(e.data)})),{createMessage:I}=U();function j(e){C.dataForm.ruleList.splice(e,1)}function J(){(function(){const e=C.dataForm.ruleList;let l=!0;e:for(let a=0;a<e.length;a++){const t=e[a];for(let e=0;e<t.groups.length;e++){const a=t.groups[e];if(!a.field){I.warning("字段不能为空"),l=!1;break e}if(2===a.fieldValueType&&!a.fieldValue){I.warning("系统参数不能为空"),l=!1;break e}if(1===a.fieldValueType&&!["null","notNull"].includes(a.symbol)&&(!a.fieldValue&&0!==a.fieldValue||Q(a.fieldValue)))return I.warning("数据值不能为空"),void(l=!1)}}return l})()&&(a("confirm",C.dataForm),S())}return(l,a)=>{const i=u("jnpf-radio"),U=u("jnpf-select"),S=u("a-col"),F=u("jnpf-number-range"),I=u("jnpf-input-number"),K=u("jnpf-date-range"),D=u("jnpf-date-picker"),R=u("a-input"),O=u("a-row");return r(),_(g(Je),f(l.$attrs,{width:"500px",onRegister:g(x),title:"筛选设置",class:"dataSet-table-config-drawer",showFooter:"",maskClosable:!1,onOk:J,destroyOnClose:""}),{default:m((()=>[y("div",wa,[y("div",Ca,[g(N).ruleList?.length?(r(),c("div",Na,[p(i,{value:g(N).matchLogic,"onUpdate:value":a[0]||(a[0]=e=>g(N).matchLogic=e),options:t,optionType:"button","button-style":"solid"},null,8,["value"])])):w("",!0),(r(!0),c(b,null,L(g(N).ruleList,((l,u)=>(r(),c("div",{class:"condition-item",key:u},[y("div",Ta,[a[2]||(a[2]=y("div",null,"条件组",-1)),y("i",{class:"icon-ym icon-ym-nav-close",onClick:e=>j(u)},null,8,xa)]),y("div",_a,[y("div",La,[a[3]||(a[3]=k(" 以下条件全部执行： ")),p(i,{value:l.logic,"onUpdate:value":e=>l.logic=e,options:t,optionType:"button","button-style":"solid",size:"small"},null,8,["value","onUpdate:value"])]),(r(!0),c(b,null,L(l.groups,((l,a)=>(r(),_(O,{gutter:8,key:u+a,wrap:"",class:"mb-10px"},{default:m((()=>[p(S,{span:18,class:"!flex items-center"},{default:m((()=>[p(U,{value:l.field,"onUpdate:value":e=>l.field=e,options:g(T),placeholder:"请选择字段",allowClear:"",showSearch:""},null,8,["value","onUpdate:value","options"])])),_:2},1024),p(S,{span:6},{default:m((()=>[p(U,{class:"w-full",value:l.dataType,"onUpdate:value":e=>l.dataType=e,options:n,onChange:e=>function(e){e.fieldValueType=1,"text"===e.dataType?(o.some((l=>l.id===e.symbol))||(e.symbol="=="),e.fieldValue=""):(d.some((l=>l.id===e.symbol))||(e.symbol="=="),e.fieldValue=void 0)}(l)},null,8,["value","onUpdate:value","onChange"])])),_:2},1024),p(S,{span:6,class:"mt-10px"},{default:m((()=>[p(U,{class:"w-full",value:l.symbol,"onUpdate:value":e=>l.symbol=e,options:"text"===l.dataType?o:d,onChange:e=>function(e){"text"===e.dataType?["null","notNull"].includes(e.symbol)&&(e.fieldValueType=1,e.fieldValue=""):["null","notNull"].includes(e.symbol)?e.fieldValue=void 0:"between"===e.symbol?!Array.isArray(e.fieldValue)&&(e.fieldValue=[]):Array.isArray(e.fieldValue)&&(e.fieldValue=void 0)}(l)},null,8,["value","onUpdate:value","options","onChange"])])),_:2},1024),["double","bigint","date","time"].includes(l.dataType)?(r(),_(S,{key:0,span:16,class:"mt-10px"},{default:m((()=>[["double","bigint"].includes(l.dataType)?(r(),c(b,{key:0},["between"==l.symbol?(r(),_(F,{key:0,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e},null,8,["value","onUpdate:value"])):(r(),_(I,{key:1,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,placeholder:"请输入",disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","disabled"]))],64)):["date","time"].includes(l.dataType)?(r(),c(b,{key:1},["between"==l.symbol?(r(),_(K,{key:0,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,format:"time"===l.dataType?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD",allowClear:""},null,8,["value","onUpdate:value","format"])):(r(),_(D,{key:1,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,format:"time"===l.dataType?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD",allowClear:"",disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","format","disabled"]))],64)):w("",!0)])),_:2},1024)):(r(),c(b,{key:1},[p(S,{span:6,class:"mt-10px"},{default:m((()=>[p(U,{value:l.fieldValueType,"onUpdate:value":e=>l.fieldValueType=e,options:s,onChange:e=>function(e){e.fieldValue=""}(l),disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","onChange","disabled"])])),_:2},1024),p(S,{span:10,class:"mt-10px"},{default:m((()=>[1===l.fieldValueType?(r(),_(R,{key:0,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,placeholder:"请输入",allowClear:"",disabled:["null","notNull"].includes(l.symbol)},null,8,["value","onUpdate:value","disabled"])):(r(),_(U,{key:1,value:l.fieldValue,"onUpdate:value":e=>l.fieldValue=e,options:e.sysVariableList,allowClear:"",showSearch:"",placeholder:"请选择系统参数"},null,8,["value","onUpdate:value","options"]))])),_:2},1024)],64)),p(S,{span:2,class:"text-center mt-10px"},{default:m((()=>[y("i",{class:"icon-ym icon-ym-btn-clearn",onClick:e=>function(e,l){C.dataForm.ruleList[e].groups.splice(l,1),C.dataForm.ruleList[e].groups.length||j(e)}(u,a)},null,8,Va)])),_:2},1024)])),_:2},1024)))),128)),y("span",{class:"link-text inline-block",onClick:e=>function(e){C.dataForm.ruleList[e].groups.push(V(v))}(u)},a[4]||(a[4]=[y("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),k("添加条件")]),8,Ua)])])))),128)),y("span",{class:"link-text inline-block",onClick:a[1]||(a[1]=e=>{C.dataForm.ruleList.push(V(h))})},a[5]||(a[5]=[y("i",{class:"icon-ym icon-ym-btn-add text-14px mr-4px"},null,-1),k("添加条件组")]))])])])),_:1},16,["onRegister"])}}}),Fa={class:"jnpf-full-modal-header"},Ia={class:"header-title"},ja={key:0,class:"dataSet-modal-container"},Ja={class:"dataSet-modal-main"},Ka={key:0,class:"left-pane"},Da={class:"left-pane-box"},Ra={class:"middle-pane"},Oa={style:{float:"right",color:"#8492a6","padding-left":"10px"}},za={key:1,class:"config-tree-box"},Pa={key:0,class:"add-btn-box"},Ma=["onClick"],Aa=["title"],Ya={class:"jnpf-tree__action"},Ea={key:2,class:"interface-content"},qa={class:"interface-box"},Ba={class:"required-sign"},$a={key:3,class:"preview-box"},Ha={class:"preview-content"},Qa={class:"preview-content"},Wa=e({__name:"index",props:{type:{type:String,default:""}},emits:["register","confirm"],setup(e,{emit:l}){const a=e,n=[{fullName:"自定义",id:2},{fullName:"系统参数",id:4},{fullName:"为空",id:3}],d=[{width:50,title:"序号",align:"center",customRender:({index:e})=>e+1},{title:"参数名称",dataIndex:"field",key:"field",width:135},{title:"参数来源",dataIndex:"sourceType",key:"sourceType",width:220},{title:"参数值",dataIndex:"relationField",key:"relationField",width:220}],s={key:"table"},v={jnpfId:"",id:"",fullName:"",dbLinkId:"0",dataConfigJson:"",visualConfigJson:"",filterConfigJson:"",parameterJson:"",fieldJson:"",objectType:"print"===a.type?"printVersion":"",type:1},C={ruleList:[],matchLogic:"and"},x=i({dataForm:{jnpfId:"",id:"",fullName:"",dbLinkId:"0",dataConfigJson:"",visualConfigJson:"",filterConfigJson:"",parameterJson:"",fieldJson:"",objectType:"",type:1,interfaceId:"",treePropsName:"",templateJson:[]},dataSetList:[],parameterJson:[],fieldJson:[],dbOptions:[],treeLoading:!0,btnLoading:!1,keyword:"",treeData:[],isEdit:!1,visualConfigJson:[],filterConfigJson:{},previewActiveKey:1,currentNode:"",previewSqlText:"",previewData:[],previewColumns:[],previewLoading:!1,allOptions:[],selectedKeys:[],pagination:{currentPage:1,pageSize:30},finish:!1}),{dataForm:S,parameterJson:I,dbOptions:D,keyword:R,treeData:O,btnLoading:z,visualConfigJson:P,previewActiveKey:M,previewLoading:A,selectedKeys:E}=F(x),{t:q}=N(),{createMessage:B,createConfirm:$}=U(),Q=l,W=t(null),le=t(null),ae=t(null),[re,{closeModal:ce,changeLoading:pe}]=he((function(e){x.btnLoading=!1,x.previewActiveKey=1,He(),x.keyword="",x.isEdit=!!e.data,x.dataSetList=V(e.list);const l=e.data?V(e.data):V(v);if(x.dataForm=l,!x.isEdit){const e="DataSet"+se();x.dataForm.jnpfId=e,x.dataForm.fullName=e}x.dataForm.parameterJson=l.parameterJson?JSON.parse(l.parameterJson):[],x.fieldJson=l.fieldJson?JSON.parse(l.fieldJson):[],x.visualConfigJson=l.visualConfigJson?JSON.parse(l.visualConfigJson):[],x.filterConfigJson=l.filterConfigJson?JSON.parse(l.filterConfigJson):V(C),pe(!0),Se().then((e=>{let l=e.data.list||[];l=l.filter((e=>e.children&&e.children.length)),l[0]?.children?.length&&(l[0]=l[0].children[0]),delete l[0].children,x.dbOptions=l,pe(!1),x.finish=!1,x.treeData=[],x.pagination.currentPage=1,Le(),T((()=>{Te()}))}))})),[fe,{openDrawer:me}]=Ke(),[ye,{openDrawer:ge}]=Ke(),be=t(null),ke=o((()=>{let e=[{id:"@userId",fullName:"当前用户"},{id:"@userAndSubordinates",fullName:"当前用户及下属"},{id:"@organizeId",fullName:"当前组织"},{id:"@organizationAndSuborganization",fullName:"当前组织及子组织"},{id:"@branchManageOrganize",fullName:"当前分管组织"}];if("print"==a.type&&e.unshift({id:"@formId",fullName:"当前表单ID"}),1===x.dataForm.type){const l=[{id:"@lotSnowID",fullName:"批量生成不同雪花ID"},{id:"@snowFlakeID",fullName:"系统生成雪花ID"}];e.unshift(...l)}return e})),Ce=o((()=>{const e=+new Date;return{defaultExpandAll:!1,treeData:x.treeData,loading:x.treeLoading,loadData:Ve,onSelect:je,key:e}})),Ne=o((()=>({linkId:x.dataForm.dbLinkId,sysVariableList:g(ke),getTableConfigTree:ze})));function Te(){const e=be.value,l=e?.getScrollWrap();l?.addEventListener("scroll",(()=>{l.scrollHeight-l.clientHeight-l.scrollTop<=200&&!x.treeLoading&&!x.finish&&(x.pagination.currentPage+=1,Le())}))}function xe(e,l){if(!e)return x.dataForm.interfaceId="",x.dataForm.treePropsName="",void(x.dataForm.parameterJson=[]);x.dataForm.interfaceId!==e&&(x.dataForm.interfaceId=e,x.dataForm.treePropsName=l.fullName,x.dataForm.parameterJson=l.parameterJson?JSON.parse(l.parameterJson).map((e=>({...e,relationField:"",sourceType:2}))):[])}function _e(){O.value=[],x.pagination.currentPage=1,x.finish=!1,Le(!0)}function Le(e=!1){x.treeLoading=!0;const l={linkId:x.dataForm.dbLinkId,keyword:x.keyword,pageSize:x.pagination.pageSize,currentPage:x.pagination.currentPage};Fe(l).then((l=>{x.treeLoading=!1,l.data.list.length<x.pagination.pageSize&&(x.finish=!0),x.treeData=[...x.treeData,...l.data.list],x.treeData=x.treeData.map((e=>({...e,fullName:e.tableName?e.table+"("+e.tableName+")":e.table,isLeaf:!1,id:e.table,icon:1==e.type?"icon-ym icon-ym-view":"icon-ym icon-ym-generator-tableGrid"}))),e&&(x.dataForm.dataConfigJson="",x.visualConfigJson=[],x.filterConfigJson=V(C),He())})).catch((()=>{x.treeLoading=!1,x.treeData=[]}))}function Ve(e){return new Promise((l=>{Ie(x.dataForm.dbLinkId,e.dataRef.table).then((a=>{const t=a.data.list.map((l=>({...l,isLeaf:!0,fullName:l.fieldName?l.field+"("+l.fieldName+")":l.field,id:e.dataRef.table+"-"+l.field})));Je().updateNodeByKey(e.eventKey,{children:t,isLeaf:!t.length}),l()}))}))}function Ue(){x.pagination.currentPage=1,Le(),O.value=[],He()}function je(e){const l=Je()?.getSelectedNode(e[0]),a=l.isLeaf?l.field:l.table;W.value?.insert(a)}function Je(){const e=g(le);if(!e)throw new Error("tree is null!");return e}function Oe(e){x.btnLoading=!0,pe(!0),function(e){return Y.post({url:"/api/system/DataSet/fields",data:e})}(e).then((l=>{e.children=l.data.map((l=>({...l,jnpfId:e.fullName+"."+l.id}))),pe(!1),x.btnLoading=!1,function(e){if(x.isEdit){for(let l=0;l<x.dataSetList.length;l++)if(x.dataSetList[l].jnpfId===e.jnpfId){x.dataSetList[l]=e;break}}else x.dataSetList.push(e);Q("confirm",x.dataSetList),ce()}(e)})).catch((()=>{pe(!1),x.btnLoading=!1}))}function ze(){const e=g(ae);if(!e)throw new Error("tree is null!");return e}function Pe(e){return e.parentTable?1===e.relationConfig.type?"icon-ym icon-ym-left-join":2===e.relationConfig.type?"icon-ym icon-ym-right-join":3===e.relationConfig.type?"icon-ym icon-ym-inner-join":4===e.relationConfig.type?"icon-ym icon-ym-full-join":"icon-ym icon-ym-generator-tableGrid":"icon-ym icon-ym-generator-tableGrid"}function Me(e){return e.parentTable?1===e.relationConfig.type?"左连接":2===e.relationConfig.type?"右连接":3===e.relationConfig.type?"内连接":4===e.relationConfig.type?"全连接":"":""}function Ae(e=""){if(x.currentNode=e,x.currentNode){const e=ze().getSelectedNode(x.currentNode);if(e?.children?.length>=2)return void B.warning("最多只能添加两个子表")}me(!0,{parentTable:e})}function Ye(){He()}function Ee(e,l,a){if(!l){if(!x.currentNode)return x.visualConfigJson.push(e);const l=ze().getSelectedNode(x.currentNode);return l?.children?.push(e),void He()}a&&(e.children=[]),ze().updateNodeByKey(x.currentNode,e),He()}function qe(){if(!x.visualConfigJson.length)return B.error("请先配置数据库表");ge(!0,{data:x.filterConfigJson,visualConfigJson:x.visualConfigJson})}function Be(e){x.filterConfigJson=e,He()}function $e(){if(!x.visualConfigJson.length&&1==x.dataForm.type)return B.error("请先配置数据库表");if(!x.dataForm.interfaceId&&3==x.dataForm.type)return B.error("请选择数据接口");x.previewLoading=!0;(function(e){return Y.post({url:"/api/system/DataSet/getPreviewData",data:e})})({...x.dataForm,parameterJson:x.dataForm.parameterJson.length?JSON.stringify(x.dataForm.parameterJson):"",fieldJson:x.fieldJson.length?JSON.stringify(x.fieldJson):"",visualConfigJson:x.visualConfigJson.length?JSON.stringify(x.visualConfigJson):"",filterConfigJson:x.filterConfigJson?JSON.stringify(x.filterConfigJson):""}).then((e=>{x.previewData=e.data.previewData;let l=e.data.previewColumns.map((e=>({title:e.title,dataIndex:e.title,key:e.title})));x.previewColumns=[...l],x.previewSqlText=e.data.previewSqlText,x.previewLoading=!1})).catch((()=>{He()}))}function He(){x.previewLoading=!1,x.previewData=[],x.previewColumns=[],x.previewSqlText="",x.dataForm.interfaceId="",x.dataForm.propsName="",x.dataForm.parameterJson=[],x.selectedKeys=[]}function Qe(){O.value=[],x.visualConfigJson=[],x.pagination.currentPage=1,x.finish=!1,He(),1==x.dataForm.type&&(Le(),T((()=>{Te()})))}function We(){if(!x.previewSqlText)return;const{isSuccessRef:e}=ue(x.previewSqlText);g(e)&&B.success("复制成功")}function Ge(){if(!x.dataForm.fullName)return void B.error("请输入数据集名称");if(!/(^_([A-Za-z0-9]_?)*$)|(^[A-Za-z](_?[A-Za-z0-9])*_?$)/.test(x.dataForm.fullName))return void B.error("数据集名称只能包含字母、数字、下划线，并且以字母开头");let e=!1;for(let l=0;l<x.dataSetList.length;l++)if(x.dataForm.jnpfId!==x.dataSetList[l].jnpfId&&x.dataForm.fullName===x.dataSetList[l].fullName){e=!0;break}if(e)return B.error("数据集名称已存在");if(1===x.dataForm.type&&!x.dataForm.dataConfigJson)return B.error("请输入SQL语句");if(2===x.dataForm.type&&!x.visualConfigJson.length)return B.error("请配置数据库表");if(!x.dataForm.interfaceId&&3==x.dataForm.type)return B.error("请选择数据接口");if(3==x.dataForm.type&&!function(){let e=!0;for(let l=0;l<x.dataForm.parameterJson?.length;l++){const a=x.dataForm.parameterJson[l];if(2==a.sourceType&&!a.relationField){B.error(`参数${a.field}的参数值不能为空`),e=!1;break}if(a.required&&2==a.sourceType&&!a.relationField){B.error(`参数${a.field}的参数值不能为空`),e=!1;break}}return e}())return;Oe({...x.dataForm,parameterJson:x.dataForm.parameterJson.length?JSON.stringify(x.dataForm.parameterJson):"",fieldJson:x.fieldJson.length?JSON.stringify(x.fieldJson):"",visualConfigJson:x.visualConfigJson.length?JSON.stringify(x.visualConfigJson):"",filterConfigJson:x.filterConfigJson?JSON.stringify(x.filterConfigJson):""})}return(e,l)=>{const a=u("a-input"),t=u("a-step"),i=u("a-steps"),o=u("a-button"),v=u("a-space"),C=u("jnpf-select"),N=u("a-menu-item"),T=u("a-menu-divider"),V=u("a-menu"),U=u("a-dropdown"),F=u("a-tabs"),I=u("a-form-item"),O=u("a-table"),Y=u("a-tab-pane"),B=u("a-textarea"),Q=u("a-tooltip"),se=te("loading");return r(),_(g(we),f(e.$attrs,{onRegister:g(re),defaultFullscreen:"",footer:null,closable:!1,keyboard:!1,destroyOnClose:"",class:"jnpf-full-modal full-modal designer-modal dataSet-modal"}),{title:m((()=>[y("div",Fa,[y("div",Ia,[l[11]||(l[11]=k("数据集名称：")),p(a,{value:g(S).fullName,"onUpdate:value":l[0]||(l[0]=e=>g(S).fullName=e),placeholder:"请输入",class:"!w-200px"},null,8,["value"])]),p(i,{current:g(S).type,"onUpdate:current":l[1]||(l[1]=e=>g(S).type=e),initial:1,type:"navigation",size:"small",onChange:Qe,class:"header-steps tab-steps"},{default:m((()=>[p(t,{title:"SQL语句"}),p(t,{title:"配置式"}),p(t,{title:"数据接口"})])),_:1},8,["current"]),p(v,{class:"options",size:10},{default:m((()=>[p(o,{type:"primary",onClick:l[2]||(l[2]=e=>Ge()),disabled:g(z)},{default:m((()=>[k(h(g(q)("common.okText")),1)])),_:1},8,["disabled"]),p(o,{onClick:g(ce),disabled:g(z)},{default:m((()=>[k(h(g(q)("common.cancelText")),1)])),_:1},8,["onClick","disabled"])])),_:1})])])),default:m((()=>[2==g(S).type?(r(),c("div",ja,[l[12]||(l[12]=y("span",{class:"label"},"数据连接",-1)),p(C,{class:"dataSet-modal-select",value:g(S).dbLinkId,"onUpdate:value":l[3]||(l[3]=e=>g(S).dbLinkId=e),showSearch:"",options:g(D),placeholder:"选择数据库",onChange:_e,fieldNames:{options:"children"}},null,8,["value","options"])])):w("",!0),y("div",Ja,[1==g(S).type?(r(),c("div",Ka,[p(C,{class:"!w-full",value:g(S).dbLinkId,"onUpdate:value":l[4]||(l[4]=e=>g(S).dbLinkId=e),showSearch:"",options:g(D),placeholder:"选择数据库",onChange:_e,fieldNames:{options:"children"}},null,8,["value","options"]),y("div",Da,[p(g(ie),{class:"search-box",placeholder:g(q)("common.enterKeyword"),allowClear:"",value:g(R),"onUpdate:value":l[5]||(l[5]=e=>j(R)?R.value=e:null),onSearch:Ue},null,8,["placeholder","value"]),p(g(ee),{ref_key:"infiniteBody",ref:be},{default:m((()=>[p(g(ne),f({class:"tree-box remove-active-tree",ref_key:"leftTreeRef",ref:le},Ce.value),null,16)])),_:1},512)])])):w("",!0),y("div",Ra,[p(F,{class:"jnpf-content-wrapper-tabs"},G({_:2},[1==g(S).type?{name:"rightExtra",fn:m((()=>[p(U,null,{overlay:m((()=>[p(V,null,{default:m((()=>[p(N,{disabled:""},{default:m((()=>l[14]||(l[14]=[k("当前系统变量仅支持内部接口引用")]))),_:1,__:[14]}),p(T),(r(!0),c(b,null,L(ke.value,((e,l)=>(r(),_(N,{key:l,onClick:l=>{return a=e.id,void W.value?.insert(a);var a}},{default:m((()=>[y("span",null,h(e.id),1),y("span",Oa,h(e.fullName),1)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:m((()=>[p(o,{type:"link"},{default:m((()=>[l[13]||(l[13]=k("系统变量")),p(g(Z))])),_:1,__:[13]})])),_:1})])),key:"0"}:void 0]),1024),1==g(S).type?(r(),_(g(De),{key:0,class:"h-full",ref_key:"sqlEditorRef",ref:W,language:"sql",modelValue:g(S).dataConfigJson,"onUpdate:modelValue":l[6]||(l[6]=e=>g(S).dataConfigJson=e)},null,8,["modelValue"])):2==g(S).type?(r(),c("div",za,[g(P).length?(r(),_(g(ne),{key:1,class:"tree-box remove-active-tree",ref_key:"tableConfigTreeRef",ref:ae,treeData:g(P),fieldNames:s,selectedKeys:g(E),"onUpdate:selectedKeys":l[8]||(l[8]=e=>j(E)?E.value=e:null),defaultExpandAll:""},{title:m((e=>{return[y("div",{class:"jnpf-tree__title",onClick:l=>function(e){x.currentNode=e;const l=ze().getSelectedNode(x.currentNode);me(!0,{parentTable:l.parentTable,data:l})}(e.table)},[y("i",{class:H(["mr-6px",Pe(e)]),title:Me(e)},null,10,Aa),k(" "+h(e.tableName)+" ",1),y("span",Ya,[(l=e.parentTable,!l||x.visualConfigJson.some((e=>e.table===l))?(r(),_(g(oe),{key:0,class:"ml-10px",title:"添加",onClick:X((l=>Ae(e.table)),["stop"])},null,8,["onClick"])):w("",!0)),p(g(de),{class:"ml-6px",title:"删除",onClick:X((l=>{return a=e.table,void $({iconType:"warning",title:q("common.tipTitle"),content:"确定删除数据库表?",onOk:()=>{ze().deleteNodeByKey(a),He()}});var a}),["stop"])},null,8,["onClick"])])],8,Ma)];var l})),_:1},8,["treeData","selectedKeys"])):(r(),c("div",Pa,[p(o,{size:"large",preIcon:"icon-ym icon-ym-btn-add",onClick:l[7]||(l[7]=e=>Ae())},{default:m((()=>l[15]||(l[15]=[k("新增数据库表")]))),_:1,__:[15]})]))])):3==g(S).type?(r(),c("div",Ea,[p(I,{label:"数据接口",colon:!1},{default:m((()=>[p(g(xt),{class:"interface-modal",value:g(S).interfaceId,title:g(S).treePropsName,popupTitle:"数据接口",sourceType:1,onChange:xe},null,8,["value","title"])])),_:1}),y("div",qa,[g(S).parameterJson?.length?(r(),_(O,{key:0,"data-source":g(S).parameterJson,columns:d,size:"small",pagination:!1},{bodyCell:m((({column:e,record:l})=>{return["field"===e.key?(r(),c(b,{key:0},[y("span",Ba,h(l.required?"*":""),1),k(" "+h(l.field)+h(l.fieldName?"("+l.fieldName+")":""),1)],64)):w("",!0),"sourceType"===e.key?(r(),_(C,{key:1,class:"!w-100%",value:l.sourceType,"onUpdate:value":e=>l.sourceType=e,options:(t=l.required,t?n.filter((e=>3!=e.id)):n),onChange:e=>function(e){e.relationField=4==e.sourceType?g(ke)[0]?.id:""}(l)},null,8,["value","onUpdate:value","options","onChange"])):w("",!0),"relationField"===e.key?(r(),c(b,{key:2},[2==l.sourceType?(r(),_(a,{key:0,value:l.relationField,"onUpdate:value":e=>l.relationField=e,placeholder:"请输入",class:"!w-100%"},null,8,["value","onUpdate:value"])):4==l.sourceType?(r(),_(C,{key:1,class:"!w-100%",value:l.relationField,"onUpdate:value":e=>l.relationField=e,options:ke.value},null,8,["value","onUpdate:value","options"])):w("",!0)],64)):w("",!0)];var t})),_:1},8,["data-source"])):w("",!0)])])):w("",!0),1!=g(S).type?(r(),c("div",$a,[p(F,{activeKey:g(M),"onUpdate:activeKey":l[9]||(l[9]=e=>j(M)?M.value=e:null),class:"jnpf-content-wrapper-tabs"},{rightExtra:m((()=>[2==g(S).type?(r(),_(o,{key:0,type:"link",preIcon:"icon-ym icon-ym-filter",onClick:qe},{default:m((()=>l[16]||(l[16]=[k("筛选设置")]))),_:1,__:[16]})):w("",!0),p(o,{type:"link",preIcon:"icon-ym icon-ym-Refresh",onClick:$e},{default:m((()=>l[17]||(l[17]=[k("刷新数据")]))),_:1,__:[17]})])),default:m((()=>[(r(),_(Y,{key:1,tab:"数据预览"})),2==g(S).type?(r(),_(Y,{key:2,tab:"SQL预览"})):w("",!0)])),_:1},8,["activeKey"]),J((r(),c("div",Ha,[l[18]||(l[18]=y("div",{class:"preview-tip"},"预览数据仅显示20条数据",-1)),x.previewColumns.length?(r(),_(g(ve),{key:0,"data-source":x.previewData,columns:x.previewColumns,size:"small",pagination:!1,showTableSetting:!1},null,8,["data-source","columns"])):w("",!0)])),[[se,g(A)],[K,1===g(M)]]),J((r(),c("div",Qa,[p(B,{value:x.previewSqlText,"onUpdate:value":l[10]||(l[10]=e=>x.previewSqlText=e),readonly:"",class:"preview-content-sql"},null,8,["value"]),p(Q,{placement:"bottom",title:g(q)("common.copyText")},{default:m((()=>[x.previewSqlText?(r(),_(g(Re),{key:0,class:"copy-btn",onClick:We})):w("",!0)])),_:1},8,["title"])])),[[se,g(A)],[K,2===g(M)]])])):w("",!0)])]),p(ka,f(Ne.value,{onRegister:g(fe),onConfirm:Ee,onClose:Ye}),null,16,["onRegister"]),p(Sa,{sysVariableList:ke.value,onRegister:g(ye),onConfirm:Be},null,8,["sysVariableList","onRegister"])])),_:1},16,["onRegister"])}}}),Ga={class:"tags"},Za={class:"transfer__body"},Xa={class:"transfer-pane left-pane"},et={class:"transfer-pane__tool"},lt={class:"transfer-pane__body transfer-pane__body-tab"},at=["onClick"],tt={class:"selected-item-main"},it={class:"selected-item-text"},nt={class:"name"},ot=["title"],dt={class:"transfer-pane right-pane"},st={class:"transfer-pane__tool"},ut={class:"transfer-pane__body"},rt={class:"selected-item-main"},ct={class:"selected-item-text"},pt={class:"name"},ft=["title"],mt=e({name:"CandidateUserSelect",inheritAttrs:!1,__name:"UserSelect",props:{value:{type:[String,Array]},multiple:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择"},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!0},size:String,buttonType:{type:String,default:"select"},modalTitle:{type:String,default:"选择用户"},api:{type:Function},query:{type:Object,default:()=>({})}},emits:["update:value","change","labelChange"],setup(e,{emit:a}){const n=e,x=a,U=le({excludeDefaultKeys:!1}),{t:F}=N(),I=S(),j=t(I.apiUrl),K=t(!1),D=t([]),R=i({keyword:"",currentPage:1,pageSize:20}),O=t(!1),z=t(null),P=t([]),M=t([]),A=t(!1),Y=t([]),E=l.useInjectFormItemContext(),q=o((()=>({...d(n,["placeholder","disabled","size","allowClear"]),fieldNames:{label:"fullName",value:"id"},open:!1,mode:n.multiple?"multiple":"",showSearch:!1,showArrow:!0,class:g(U).class?"w-full "+g(U).class:"w-full"})));function B(){if(!n.value||!n.value.length)return D.value=n.multiple?[]:void 0,M.value=[],Y.value=[],void x("labelChange","");const e=n.multiple?n.value:[n.value];re(g(e)).then((e=>{const l=e.data.list,a=l.map((e=>e.id));D.value=n.multiple?a:a[0],M.value=V(l),Y.value=V(l);const t=Y.value.map((e=>e.fullName)).join();x("labelChange",t)}))}function $(e,l){Y.value=l??[],X()}function Q(){n.disabled||(K.value=!0,R.keyword="",R.currentPage=1,P.value=[],O.value=!1,T((()=>{!function(){const e=z.value,l=e?.getScrollWrap();l?.addEventListener("scroll",(()=>{l.scrollHeight-l.clientHeight-l.scrollTop<=200&&!A.value&&!O.value&&(R.currentPage+=1,ae())}))}(),G(),B()})))}function W(){K.value=!1}function G(){P.value=[],R.currentPage=1,O.value=!1,ae()}function Z(){Y.value=[]}function X(){const e=g(Y).map((e=>e.id));M.value=g(Y),D.value=n.multiple?e:e[0],n.multiple?(x("update:value",e),x("change",e,g(M))):(x("update:value",e[0]),x("change",e[0],g(M)[0])),E.onFieldChange(),W()}function ae(){if(!n.api)return;A.value=!0;const e={...R,...n.query};n.api(e).then((e=>{e.data.list.length<R.pageSize&&(O.value=!0),P.value=[...P.value,...e.data.list],A.value=!1}))}return s((()=>n.value),(()=>{B()}),{immediate:!0}),(l,a)=>{const t=u("a-button"),i=u("a-tag"),o=u("a-select"),d=u("a-input-search"),s=u("a-avatar"),N=u("jnpf-empty"),T=te("loading");return r(),c(b,null,["button"===e.buttonType?(r(),c("div",{key:0,class:H([l.$attrs.class,"select-tag-list"])},[p(t,{preIcon:"icon-ym icon-ym-btn-add",onClick:Q},{default:m((()=>[k(h(e.modalTitle),1)])),_:1}),y("div",Ga,[(r(!0),c(b,null,L(M.value,((l,a)=>(r(),_(i,{class:"!mt-10px",closable:!e.disabled,key:l.id,onClose:e=>function(e){Y.value.splice(e,1),X()}(a)},{default:m((()=>[k(h(l.fullName),1)])),_:2},1032,["closable","onClose"])))),128))])],2)):(r(),_(o,f({key:1},q.value,{value:D.value,"onUpdate:value":a[0]||(a[0]=e=>D.value=e),options:M.value,onChange:$,onClick:Q}),null,16,["value","options"])),p(g(C),{open:K.value,"onUpdate:open":a[2]||(a[2]=e=>K.value=e),title:e.modalTitle,width:800,class:"transfer-modal",onOk:X,centered:"",destroyOnClose:"",maskClosable:!1,keyboard:!1},{closeIcon:m((()=>[p(v,{canFullscreen:!1,onCancel:W})])),default:m((()=>[y("div",Za,[y("div",Xa,[y("div",et,[p(d,{placeholder:g(F)("common.enterKeyword"),allowClear:"",value:R.keyword,"onUpdate:value":a[1]||(a[1]=e=>R.keyword=e),onSearch:G},null,8,["placeholder","value"])]),y("div",lt,[a[3]||(a[3]=y("div",{class:"custom-title"},"全部数据",-1)),J((r(),_(g(ee),{ref_key:"infiniteBody",ref:z},{default:m((()=>[(r(!0),c(b,null,L(P.value,(e=>(r(),c("div",{key:e.id,class:"selected-item selected-item-user",onClick:l=>{return a=e,void(Y.value.some((e=>e.id===a.id))||(n.multiple?Y.value.push(a):Y.value=[a]));var a}},[y("div",tt,[p(s,{size:36,src:j.value+e.headIcon,class:"selected-item-headIcon"},null,8,["src"]),y("div",it,[y("p",nt,h(e.fullName),1),y("p",{class:"organize",title:e.organize},h(e.organize),9,ot)])])],8,at)))),128)),P.value.length?w("",!0):(r(),_(N,{key:0}))])),_:1})),[[T,A.value&&1===R.currentPage]])])]),y("div",dt,[y("div",st,[y("span",null,h(g(F)("component.jnpf.common.selected")),1),y("span",{class:"remove-all-btn",onClick:Z},"清空列表")]),y("div",ut,[p(g(ee),null,{default:m((()=>[(r(!0),c(b,null,L(Y.value,((e,l)=>(r(),c("div",{key:l,class:"selected-item selected-item-user"},[y("div",rt,[p(s,{size:36,src:j.value+e.headIcon,class:"selected-item-headIcon"},null,8,["src"]),y("div",ct,[y("p",pt,h(e.fullName),1),y("p",{class:"organize",title:e.organize},h(e.organize),9,ft)]),p(g(de),{class:"delete-btn",onClick:e=>{return a=l,void Y.value.splice(a,1);var a}},null,8,["onClick"])])])))),128)),Y.value.length?w("",!0):(r(),_(N,{key:0}))])),_:1})])])])])),_:1},8,["open","title"])],64)}}}),vt={class:"w-355px"},yt={class:"error-title"},gt={class:"error-content"},bt={class:"error-item"},ht={class:"error-sub-item error-top"},kt=["title"],wt={class:"error-sub-item error-bottom"},Ct=["title"],Nt=["onClick"],Tt=e({__name:"ValidatePopover",props:{errorList:{type:Array,default:()=>[]}},emits:["select"],setup(e,{expose:l,emit:a}){const i=t(!1),n=a,d=e;l({setVisible:f});const s=o((()=>function(e){let l=[];return e.map((e=>{const a=l.findIndex((l=>l.id===e.id));-1!==a?l[a].children.push({errorInfo:e.errorInfo}):l.push({title:e.title,id:e.id,children:[{errorInfo:e.errorInfo}]})})),l}(d.errorList)));function f(e){i.value=!!e}return(e,l)=>{const a=u("a-button"),t=u("a-popover");return s.value.length?(r(),_(t,{key:0,open:i.value,"onUpdate:open":l[0]||(l[0]=e=>i.value=e),trigger:"click",placement:"bottom",overlayClassName:"error-contain jnpf-flow-common-popover",bordered:!1,"arrow-point-at-center":""},{content:m((()=>[y("div",vt,[y("div",yt,[p(g(ce),{class:"error-icon"}),l[1]||(l[1]=k("内容不完善，校验失败！"))]),y("div",gt,[(r(!0),c(b,null,L(s.value,(e=>(r(),c("div",bt,[y("div",ht,[y("div",{class:"title",title:e.title},h(e.title),9,kt),y("div",null,[y("span",null,h(e.children.length),1),l[2]||(l[2]=k(" 项 "))])]),(r(!0),c(b,null,L(e.children,(l=>(r(),c("div",wt,[y("div",{class:"title",title:l.errorInfo},h(l.errorInfo),9,Ct),e?.id?(r(),c("div",{key:0,class:"write",onClick:l=>{return a=e.id,f(!1),void n("select",a);var a}},"去填写",8,Nt)):w("",!0)])))),256))])))),256))])])])),default:m((()=>[p(a,{shape:"round",class:"error-tips-button"},{default:m((()=>[k(h(s.value.length||0)+"项不完善",1),l[3]||(l[3]=y("i",{class:"icon-ym icon-ym-unfold ml-5px font text-10px"},null,-1))])),_:1,__:[3]})])),_:1},8,["open"])):w("",!0)}}}),xt=pe(Ee),_t=pe(We);pe(be);const Lt=pe(Ze),Vt=pe(Xe),Ut=pe(wl),St=pe(zl);pe(Yl);const Ft=pe(Wa),It=pe(mt),jt=pe(Tt);export{_t as B,Ft as D,Vt as E,Ut as I,Lt as P,St as S,It as U,jt as V,jl as _,xt as a};
