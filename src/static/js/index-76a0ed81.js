import{d as e,ad as t,u as o,fg as n,M as r,k as i,gt as s,n as a,e as l,o as p,g as u,a4 as m,j as d,l as c,m as _,t as y,bN as f,F as g,af as j,q as k,p as w,V as b,gu as v,ah as x}from"./index-920db443.js";import{u as R,B as h}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{u as I,B as C}from"./useTable-dc8c9d84.js";import{T as Q}from"./TableAction-adbe36f2.js";import{u as T}from"./index-143f5813.js";import{u as M}from"./index-9c138ba5.js";import{_ as F}from"./Form.vue_vue_type_script_setup_true_lang-3e78e871.js";import{_ as D}from"./DepForm.vue_vue_type_script_setup_true_lang-e796ef3c.js";import{_ as A}from"./Member.vue_vue_type_script_setup_true_lang-a56cb130.js";import N from"./Permission-c66b6a38.js";import P from"./OrgTree-30863eee.js";import{_ as S}from"./ImportModal.vue_vue_type_script_setup_true_lang-772d2a6b.js";import{_ as B}from"./ExportModal.vue_vue_type_script_setup_true_lang-295b5f0e.js";import"./useTabs-ceeccdba.js";import"./upperFirst-2cd1a2f7.js";import"./log-2a5f2c26.js";import"./uniqBy-e868edd7.js";import"./visualDev-8f54ab4b.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./index-999abbee.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./config-06ca91cd.js";import"./useWindowSizeFn-05f906e2.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";import"./formValidate-c8ab8d29.js";import"./permissionGroup-129512c4.js";import"./import-e198d900.js";import"./tip-b30e67af.js";import"./config-900ef1e2.js";const O={class:"jnpf-content-wrapper"},E={class:"jnpf-content-wrapper-center"},L={class:"jnpf-content-wrapper-search-box"},Y={class:"jnpf-content-wrapper-content"},q=e({name:"permission-organize",__name:"index",setup(e){const q=t({loading:!1,key:0,list:[],listQuery:{parentId:"0",keyword:""}}),{createMessage:z}=x(),{t:G}=o(),H=n(),[V,{openModal:K}]=T(),[J,{openModal:W}]=T(),[U,{openPopup:X}]=M(),[Z,{openPopup:$}]=M(),[ee,{openPopup:te}]=M(),[oe,{openModal:ne}]=T(),[re,{openModal:ie}]=T(),se=r((()=>[{title:"名称",dataIndex:"fullName"},{title:"编码",dataIndex:"enCode"},{title:"类型",dataIndex:"type",width:100,align:"center",customRender:({record:e})=>"company"===e.type?"公司":"部门"},{title:"创建时间",dataIndex:"creatorTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"排序",dataIndex:"sortCode",width:70,align:"center"}])),ae=r((()=>{const e={searchInfo:q.listQuery,columns:i(se),isTreeTable:!q.listQuery.keyword,loading:q.loading,key:q.key,defaultExpandAllRows:!1,onChange:ve};return e.isTreeTable&&(e.pagination=!1),e})),[le,{getFieldsValue:pe,resetFields:ue}]=R({baseColProps:{span:8},showActionButtonGroup:!0,showAdvancedButton:!0,compact:!0,schemas:[{field:"keyword",label:G("common.keyword"),component:"Input",componentProps:{placeholder:G("common.enterKeyword"),submitOnPressEnter:!0}}]}),[me]=I({api:s,actionColumn:{width:150,title:"操作",dataIndex:"action"},tableSetting:{expand:!1,redo:!1},afterFetch:e=>e.map((e=>{const t=e;return t.hasChildren&&(t.children=[]),t})),onExpand:async(e,t)=>{if(e){if(t.children?.length)return;q.loading=!0,q.listQuery.parentId=t.id;const e=(await s(q.listQuery)).data.list.map((e=>{const t=e;return t.hasChildren&&(t.children=[]),t}));q.loading=!1,t.children=e}}});function de(e){q.listQuery.keyword=e?.keyword||"",q.listQuery.keyword||(q.listQuery.parentId="0"),q.key=+new Date,we()}function ce(){q.listQuery.parentId="0",q.listQuery.keyword="",we()}function _e(e){return[{label:G("common.editText"),onClick:je.bind(null,e.id,e.type,e.parentId)},{label:G("common.delText"),color:"error",modelConfirm:{onOk:ke.bind(null,e.id)}}]}function ye(e){return[{label:"查看成员",onClick:be.bind(null,e.id,e.fullName)},{label:"查看权限",onClick:fe.bind(null,e.id,e.fullName,e.type)}]}function fe(e,t,o){$(!0,{id:e,fullName:t,objectType:o})}function ge({key:e}){je("",e)}function je(e="",t,o=""){("company"===t?X:K)(!0,{id:e,parentId:o})}function ke(e){v(e).then((e=>{z.success(e.msg),H.resetState(),ue()}))}function we(){q.key=+new Date}function be(e,t){W(!0,{id:e,fullName:t})}function ve(){const e=pe(),t=q.listQuery.keyword;q.listQuery.keyword=e.keyword||"",q.listQuery.keyword||(q.listQuery.parentId="0"),t!==e.keyword&&a((()=>{we()}))}function xe(){ne(!0,{type:"company"})}function Re(){ie(!0,{listQuery:q.listQuery,type:"company"})}return(e,t)=>{const o=l("a-tooltip"),n=l("a-menu-item"),r=l("a-menu"),s=l("a-button"),a=l("a-dropdown");return p(),u("div",O,[m("div",E,[m("div",L,[d(i(h),{class:"search-form",onRegister:i(le),onSubmit:de,onReset:ce},null,8,["onRegister"])]),m("div",Y,[d(i(C),b({onRegister:i(me)},ae.value),{toolbar:c((()=>[d(o,{placement:"top",title:"结构图"},{default:c((()=>[m("i",{class:"icon-ym icon-ym-org-tree cursor-pointer text-18px",onClick:t[0]||(t[0]=e=>i(te)(!0,{}))})])),_:1})])),tableTitle:c((()=>[d(a,null,{overlay:c((()=>[d(r,{onClick:ge},{default:c((()=>[d(n,{key:"company"},{default:c((()=>t[1]||(t[1]=[_("新建公司")]))),_:1,__:[1]}),d(n,{key:"department"},{default:c((()=>t[2]||(t[2]=[_("新建部门")]))),_:1,__:[2]})])),_:1})])),default:c((()=>[d(s,{type:"primary",preIcon:"icon-ym icon-ym-btn-add"},{default:c((()=>[_(y(i(G)("common.addText")),1),d(i(f))])),_:1})])),_:1}),d(s,{type:"link",onClick:Re},{default:c((()=>[t[3]||(t[3]=m("i",{class:"icon-ym icon-ym-btn-download button-preIcon"},null,-1)),_(y(i(G)("common.exportText")),1)])),_:1,__:[3]}),d(s,{type:"link",onClick:xe},{default:c((()=>[t[4]||(t[4]=m("i",{class:"icon-ym icon-ym-btn-upload button-preIcon"},null,-1)),_(y(i(G)("common.importText")),1)])),_:1,__:[4]})])),bodyCell:c((({column:e,record:t})=>["fullName"===e.key?(p(),u(g,{key:0},[m("i",{class:j("mr-6px "+t.icon)},null,2),_(y(t.fullName),1)],64)):k("",!0),"action"===e.key?(p(),w(i(Q),{key:1,actions:_e(t),dropDownActions:ye(t)},null,8,["actions","dropDownActions"])):k("",!0)])),_:1},16,["onRegister"])])]),d(F,{onRegister:i(U),onReload:ce},null,8,["onRegister"]),d(D,{onRegister:i(V),onReload:i(ue)},null,8,["onRegister","onReload"]),d(A,{onRegister:i(J)},null,8,["onRegister"]),d(N,{onRegister:i(Z)},null,8,["onRegister"]),d(P,{onRegister:i(ee)},null,8,["onRegister"]),d(B,{onRegister:i(re)},null,8,["onRegister"]),d(S,{onRegister:i(oe),onReload:i(ue)},null,8,["onRegister","onReload"])])}}});export{q as default};
