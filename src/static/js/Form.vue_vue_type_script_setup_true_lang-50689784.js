import{b as e,B as a}from"./index-143f5813.js";import{u as o,B as t}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{a as l,u as r,c as n}from"./billRule-0363563b.js";import{d as s,r as m,ad as i,M as d,k as u,u as p,co as c,o as f,p as Y,l as g,j as h,V as b,ah as M}from"./index-920db443.js";const F=s({__name:"Form",emits:["register","reload"],setup(s,{emit:F}){const N=m(""),D=i({dataForm:{}}),x=[{field:"fullName",label:"名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"enCode",label:"编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"category",label:"分类",component:"Select",componentProps:{placeholder:"请选择"},rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"prefix",label:"前辍",component:"Input",componentProps:{placeholder:"请输入",onChange:function(e){D.dataForm.prefix=e,L()}}},{field:"type",label:"方式",component:"Select",defaultValue:1,componentProps:{placeholder:"请选择",allowClear:!1,options:[{fullName:"时间格式",id:1},{fullName:"随机数编号",id:2},{fullName:"UUID",id:3}]}},{ifShow:({values:e})=>1==e.type,field:"dateFormat",label:" ",component:"Select",defaultValue:"YYYY",componentProps:{placeholder:"请选择",allowClear:!1,options:[{fullName:"YYYY",id:"YYYY"},{fullName:"YYYYMM",id:"YYYYMM"},{fullName:"YYYYMMDD",id:"YYYYMMDD"},{fullName:"YYYYMMDDHH",id:"YYYYMMDDHH"},{fullName:"YYYYMMDDHHmm",id:"YYYYMMDDHHmm"},{fullName:"YYYYMMDDHHmmss",id:"YYYYMMDDHHmmss"},{fullName:"YYYYMMDDHHmmssSSS",id:"YYYYMMDDHHmmssSSS"},{fullName:"no",id:"no"}],onChange:function(e){D.dataForm.dateFormat=e,L()}}},{ifShow:({values:e})=>1==e.type,field:"digit",label:"位数",component:"InputNumber",componentProps:{placeholder:"请输入",min:1,max:9,precision:0,onChange:function(e){D.dataForm.digit=e,L()}},rules:[{required:!0,trigger:"blur",message:"必填",type:"number"}]},{ifShow:({values:e})=>2==e.type,field:"randomDigit",label:"位数",defaultValue:16,component:"Select",componentProps:{allowClear:!1,options:[{fullName:"16",id:16},{fullName:"32",id:32}]},rules:[{trigger:"blur",message:"必填",type:"number"}]},{ifShow:({values:e})=>1==e.type,field:"startNumber",label:"起始值",component:"Input",componentProps:{placeholder:"不允许输入0或特殊字符",onChange:function(e){D.dataForm.startNumber=e,L()}},rules:[{required:!0,trigger:"blur",message:"必填"},{pattern:/^[0-9]*$/,message:"只能输入数字",trigger:"blur"},{validator:(e,a)=>{if(a){if(!(a&&a.replace(/0/g,"")))return Promise.reject(`起始值不能为${a}`)}return Promise.resolve()}}]},{ifShow:({values:e})=>2==e.type,field:"randomType",label:"类型",component:"Select",defaultValue:1,componentProps:{allowClear:!1,options:[{fullName:"纯数字",id:1},{fullName:"字母+数字",id:2}]}},{field:"suffix",label:"后辍",component:"Input",componentProps:{placeholder:"请输入",onChange:function(e){D.dataForm.suffix=e,L()}}},{ifShow:({values:e})=>1==e.type,field:"example",label:"范例",component:"Input",componentProps:{disabled:!0}},{field:"sortCode",label:"排序",component:"InputNumber",defaultValue:0,componentProps:{min:"0",max:"999999",placeholder:"请输入"}},{field:"enabledMark",label:"状态",component:"Switch",defaultValue:1},{field:"description",label:"说明",component:"Textarea",componentProps:{rows:3,placeholder:"请输入"}}],S=d((()=>u(N)?H("common.editText"):H("common.addText"))),y=F,{createMessage:P}=M(),{t:H}=p(),[v,{setFieldsValue:w,validate:C,resetFields:I,updateSchema:j}]=o({labelWidth:80,schemas:x}),[V,{closeModal:k,changeLoading:q,changeOkLoading:R}]=e((function(e){I(),D.dataForm.dateFormat="YYYY",D.dataForm.prefix="",D.dataForm.suffix="",D.dataForm.digit="",N.value=e.id,e.categoryList&&j([{field:"category",componentProps:{options:e.categoryList}}]);N.value?(q(!0),l(N.value).then((e=>{const a=e.data;D.dataForm=a,w(a),q(!1)}))):L()}));function L(){const e=D.dataForm.prefix||"",a=D.dataForm.suffix||"",o=D.dataForm.dateFormat||"";let t="";o&&"no"!==o&&(t=c().format(o));let l=D.dataForm.digit||0;l&&(l=Array(l).join("0")+0);const r=D.dataForm.startNumber||"";let n="";""!=r&&(n=l+r,l=n.substring(n.length-l.length,n.length),D.dataForm.startNumber=l,w({startNumber:l}));w({example:e+t+l+a})}async function O(){const e=await C();if(!e)return;R(!0);const a={...e,id:N.value};(N.value?r:n)(a).then((e=>{P.success(e.msg),R(!1),k(),y("reload")})).catch((()=>{R(!1)}))}return(e,o)=>(f(),Y(u(a),b(e.$attrs,{onRegister:u(V),title:S.value,showOkBtn:"",onOk:O,destroyOnClose:""}),{default:g((()=>[h(u(t),{onRegister:u(v)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{F as _};
