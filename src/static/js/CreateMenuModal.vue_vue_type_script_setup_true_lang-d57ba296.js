import{d as e,u as a,r as t,ad as r,a0 as s,M as l,fm as o,fn as c,e as n,o as d,p as i,l as p,j as m,k as u,a4 as f,af as v,be as g,ae as y,q as M,t as h,V as I,fo as k,ah as R}from"./index-920db443.js";import{b as F,B as P}from"./index-143f5813.js";const _={class:"release-item report-item-left"},b={class:"icon-checked"},w={class:"released"},C=e({__name:"CreateMenuModal",emits:["register","reload"],setup(e,{emit:C}){const O=C,{createMessage:S,createConfirm:j}=R(),{t:x}=a(),[D,{changeOkLoading:J,closeModal:N}]=F((function(e){q.pcModuleParentId=[],o(e.id).then((e=>{q.record=e.data;const a=e.data.platformRelease?JSON.parse(e.data.platformRelease):{};q.dataForm={pc:0===a.pc?0:1,pcModuleParentId:[]},T.value?.clearValidate()})),a=e.id,c({category:"Web"},a).then((e=>{q.treeData=e.data.list}));var a})),T=t(),q=r({dataForm:{pc:1,pcModuleParentId:[]},record:{},treeData:[],pcModuleParentId:[]}),{dataForm:V,record:W,treeData:B,pcModuleParentId:E}=s(q),L=l((()=>{let e={pcModuleParentId:[]};return q.record.pcIsRelease||(e.pcModuleParentId=[{required:!0,message:"必填",trigger:"change",type:"array"}]),e}));function U(e){q.dataForm.pcModuleParentId=e.map((e=>e.value))}async function $(){try{if(!q.dataForm.pc)return S.error("请选择发布类型");if(!(await(T.value?.validate())))return;const e={pc:q.dataForm.pc},a={...q.dataForm,platformRelease:JSON.stringify(e)},t=()=>{J(!0),k(q.record.id,a).then((e=>{J(!1),S.success(e.msg),O("reload"),N()})).catch((()=>{J(!1)}))};if(!q.record.isRelease)return t();j({iconType:"warning",title:x("common.tipTitle"),content:"发布确定后会覆盖当前线上版本且进行菜单同步，是否继续?",onOk:t})}catch(e){}}return(e,a)=>{const t=n("a-alert"),r=n("a-form-item"),s=n("JnpfTreeSelect"),l=n("a-form");return d(),i(u(P),I(e.$attrs,{onRegister:u(D),title:"生成菜单",onOk:$,class:"jnpf-release-modal"}),{default:p((()=>[m(t,{message:"将该报表发布至应用菜单",type:"warning","show-icon":""}),m(l,{class:"release-main",colon:!1,model:u(V),rules:L.value,layout:"vertical",ref_key:"formElRef",ref:T},{default:p((()=>[f("div",_,[m(r,null,{default:p((()=>[f("div",{class:v(["top-item",{active:1===u(V).pc}]),onClick:a[0]||(a[0]=e=>{return a="pc",void(q.dataForm[a]=1===q.dataForm[a]?0:1);var a})},[a[2]||(a[2]=f("i",{class:"item-icon icon-ym icon-ym-pc"},null,-1)),a[3]||(a[3]=f("p",{class:"item-title"},"桌面端",-1)),f("div",b,[m(u(g))])],2)])),_:1}),u(V).pc?(d(),i(r,{key:0,label:"上级",name:"pcModuleParentId"},{default:p((()=>[m(s,{value:u(E),"onUpdate:value":a[1]||(a[1]=e=>y(E)?E.value=e:null),options:u(B),treeCheckStrictly:"",multiple:"",dropdownMatchSelectWidth:!1,onChange:U},null,8,["value","options"])])),_:1})):M("",!0),u(W).pcIsRelease?(d(),i(r,{key:1,label:"已发布菜单路径"},{default:p((()=>[f("div",w,h(u(W).pcReleaseName),1)])),_:1})):M("",!0)])])),_:1},8,["model","rules"])])),_:1},16,["onRegister"])}}});export{C as _};
