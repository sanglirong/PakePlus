import{d as e,a6 as o,r as n,ad as t,a0 as i,dl as r,M as f,n as a,o as _,g as s,j as d,l,a4 as c,k as u,p,q as g,am as m,V as h,F as y,ah as I,u as w,dn as k,ci as C,co as T,cp as O}from"./index-920db443.js";import{a as S,d as j,e as x}from"./visualDev-8f54ab4b.js";import{c as v}from"./createAsyncComponent-7e8f72ac.js";import{u as D,B as V}from"./index-9c138ba5.js";import{u as P,B as R}from"./index-143f5813.js";import{u as K,B as M}from"./index-999abbee.js";const L={class:"p-10px"},B=e({__name:"CustomForm",emits:["reload"],setup(e,{expose:B,emit:F}){const b=F,{createMessage:A}=I(),{t:z}=w(),J=o(),[E,{openPopup:H,setPopupProps:N}]=D(),[W,{openModal:$,setModalProps:q}]=P(),[G,{openDrawer:U,setDrawerProps:Q}]=K(),X=n(null),Y=t({formConf:{},formData:{},config:{},loading:!1,key:+new Date,dataForm:{id:"",data:""},formOperates:[]}),{config:Z,formConf:ee,key:oe,loading:ne}=i(Y),te=v((()=>r((()=>import("./Parser-2e1eddb1.js")),["static/js/Parser-2e1eddb1.js","static/js/Parser.vue_vue_type_script_lang-80b37b11.js","static/js/index-920db443.js","static/css/index-648461a4.css","static/js/config-06ca91cd.js","static/js/componentMap-c91676b4.js","static/js/visualDev-8f54ab4b.js","static/js/index.vue_vue_type_script_setup_true_lang-69353133.js","static/js/index-9c138ba5.js","static/js/ArrowLeftOutlined-3fbf15bc.js","static/js/log-2a5f2c26.js","static/css/index-01bda6b6.css","static/js/index-143f5813.js","static/js/useWindowSizeFn-05f906e2.js","static/css/index-e7d3e030.css","static/js/index-999abbee.js","static/css/index-cddfced7.css","static/js/Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js","static/js/Item.vue_vue_type_script_setup_true_lang-fef56f78.js","static/js/Form.vue_vue_type_script_setup_true_lang-63005a4d.js","static/js/createAsyncComponent-7e8f72ac.js","static/js/DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js","static/js/index-0be8277c.js","static/css/DataLogList-12ff8c0e.css","static/js/jquery-6353a699.js","static/js/useDefineSetting-7df030ff.js","static/css/index-c2afac83.css","static/js/upperFirst-2cd1a2f7.js","static/css/componentMap-489cc2b1.css"]))),ie=f((()=>(Y.formConf.confirmButtonTextI18nCode?z(Y.formConf.confirmButtonTextI18nCode,Y.formConf.confirmButtonText):Y.formConf.confirmButtonText)||z("common.okText")));function re(e){if(Y.config.formOptions.length)for(let[o,n]of Object.entries(e))for(let t=0;t<Y.config.formOptions.length;t++){const i=Y.config.formOptions[t];"@formId"==i.currentField&&(Y.formData[i.field]=e[Y.config.rowKey]),i.currentField==o&&(Y.formData[i.field]=n)}!function(e,o){const n=J.getUserInfo,t=new Date,i=(e,r)=>{for(let f=0;f<e.length;f++){let a=e[f];if(a.__vModel__){a.__config__.defaultCurrent&&("datePicker"===a.__config__.jnpfKey&&(a.__config__.defaultValue=T(t).startOf(O(a.format)).valueOf()),"timePicker"===a.__config__.jnpfKey&&(a.__config__.defaultValue=T(t).format(a.format||"HH:mm:ss")),"organizeSelect"===a.__config__.jnpfKey&&n.organizeIdList?.length&&(a.__config__.defaultValue=a.multiple?[n.organizeIdList]:n.organizeIdList),"depSelect"===a.__config__.jnpfKey&&n.departmentId&&(a.__config__.defaultValue=a.multiple?[n.departmentId]:n.departmentId),"userSelect"===a.__config__.jnpfKey&&n.userId&&(a.__config__.defaultValue=a.multiple?[n.userId]:n.userId),"usersSelect"===a.__config__.jnpfKey&&n.userId&&(a.__config__.defaultValue=a.multiple?[n.userId+"--user"]:n.userId+"--user"),"posSelect"===a.__config__.jnpfKey&&n.positionIds?.length&&(a.__config__.defaultValue=a.multiple?n.positionIds.map((e=>e.id)):n.positionIds[0].id),"roleSelect"===a.__config__.jnpfKey&&n.roleIds?.length&&(a.__config__.defaultValue=a.multiple?n.roleIds:n.roleIds[0]),"groupSelect"===a.__config__.jnpfKey&&n.groupIds?.length&&(a.__config__.defaultValue=a.multiple?n.groupIds:n.groupIds[0]),"sign"===a.__config__.jnpfKey&&n.signImg&&(a.__config__.defaultValue=n.signImg));let e=o.hasOwnProperty(a.__vModel__)?o[a.__vModel__]:a.__config__.defaultValue;if(a.__config__.defaultValue=e,!Y.config.isPreview&&Y.config.useFormPermission){let e=a.__config__.isSubTable?r.__vModel__+"-"+a.__vModel__:a.__vModel__,o=!0;Y.formOperates&&Y.formOperates.length&&(o=!Y.formOperates.some((o=>o.enCode===e))),o=a.__config__.noShow?a.__config__.noShow:o,a.__config__.noShow=o}}a.__config__&&a.__config__.children&&Array.isArray(a.__config__.children)&&i(a.__config__.children,a)}};i(e.fields),e.formData=o}(Y.formConf,Y.formData),a((()=>{Y.loading=!1,Y.key=+new Date,se(!1)}))}function fe(e,o){if(e)if(_e({confirmLoading:!0}),Y.config.customBtn){const n={paramList:k(Y.config.templateJson,{...e,id:Y.config.record.id})||[]};C(Y.config.interfaceId,n).then((e=>{A.success(e.msg),o&&"function"==typeof o&&o(),_e({confirmLoading:!1}),_e({open:!1}),Y.config?.isRefresh&&b("reload")})).catch((()=>{_e({confirmLoading:!1})}))}else{const n={...Y.formData,...e};Y.dataForm.data=JSON.stringify(n),x(Y.config.modelId,Y.dataForm).then((e=>{A.success(e.msg),o&&"function"==typeof o&&o(),_e({confirmLoading:!1}),_e({open:!1}),Y.config?.isRefresh&&b("reload")})).catch((()=>{_e({confirmLoading:!1})}))}}function ae(){if(Y.config.isPreview)return A.warning("功能预览不支持数据保存");(function(){const e=u(X);if(!e)throw new Error("parser is null!");return e})().handleSubmit()}function _e(e){return"fullScreen"===Y.config.popupType?N(e):"drawer"===Y.config.popupType?Q(e):void q(e)}function se(e){_e({loading:e})}return B({init:function(e){Y.config=e,Y.formData={},function(){if("fullScreen"===Y.config.popupType)return H();if("drawer"===Y.config.popupType)return U();$()}(),a((()=>{setTimeout((()=>{Y.config.modelId&&(se(!0),Y.loading=!0,S(Y.config.modelId).then((e=>{if(200!==e.code||!e.data)return A.error(e.msg||"请求出错，请重试");if(e.data.formData){if(Y.formConf=JSON.parse(e.data.formData),"4"==Y.config.webType||!Y.config.record.id)return re(Y.config.record);j(Y.config.recordModelId,Y.config.record.id).then((e=>{e.data&&e.data.data&&re({...JSON.parse(e.data.data),id:Y.config.record.id})}))}})))}),0)}))}}),(e,o)=>(_(),s(y,null,[d(u(V),h(e.$attrs,{onRegister:u(E),title:u(Z).popupTitle,showOkBtn:"",okText:ie.value,destroyOnClose:"",onOk:o[0]||(o[0]=e=>ae())}),{default:l((()=>[c("div",{class:"p-10px",style:m({margin:"0 auto",width:u(Z).popupWidth||"100%"})},[u(ne)?g("",!0):(_(),p(u(te),{ref_key:"parserRef",ref:X,formConf:u(ee),onSubmit:fe,key:u(oe)},null,8,["formConf"]))],4)])),_:1},16,["onRegister","title","okText"]),d(u(R),h(e.$attrs,{onRegister:u(W),title:u(Z).popupTitle,width:u(Z).popupWidth,minHeight:100,okText:ie.value,onOk:o[1]||(o[1]=e=>ae())}),{default:l((()=>[u(ne)?g("",!0):(_(),p(u(te),{ref_key:"parserRef",ref:X,formConf:u(ee),onSubmit:fe,key:u(oe)},null,8,["formConf"]))])),_:1},16,["onRegister","title","width","okText"]),d(u(M),h(e.$attrs,{onRegister:u(G),title:u(Z).popupTitle,width:u(Z).popupWidth,showFooter:"",okText:ie.value,onOk:o[2]||(o[2]=e=>ae())}),{default:l((()=>[c("div",L,[u(ne)?g("",!0):(_(),p(u(te),{ref_key:"parserRef",ref:X,formConf:u(ee),onSubmit:fe,key:u(oe)},null,8,["formConf"]))])])),_:1},16,["onRegister","title","width","okText"])],64))}});export{B as _};
