import{b as e,B as a}from"./index-143f5813.js";import{u as l,B as o}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{a as s,u as r,c as t,t as n}from"./dataSource-ed26da12.js";import{d,r as c,aD as p,ad as i,a0 as u,M as m,k as b,u as f,dM as g,e as S,o as h,p as y,l as v,j as w,dz as E,q as T,a4 as x,V as k,ah as L}from"./index-920db443.js";const N=d({__name:"Form",emits:["register","reload"],setup(d,{emit:N}){const P=c(""),I=p(),M=i({testLoading:!1,dbType:""}),{testLoading:C,dbType:D}=u(M),O=[{field:"dbType",label:"连接驱动",component:"Select",componentProps:{placeholder:"请选择",fieldNames:{label:"fullName",value:"enCode"},onChange:function(e){M.dbType=e;let a="",l="";switch(e){case"SQLServer":a="1433",l="dbo";break;case"MySQL":a="3306";break;case"Oracle":a="1521";break;case"DM":a="5236";break;case"KingbaseES":a="54321",l="public";break;case"PostgreSQL":a="5432",l="public";break;default:a=""}V({port:a,dbSchema:l}),j()}},rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"fullName",label:"连接名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"host",label:"主机地址",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"port",label:"端口",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"},{pattern:/^([0-9]|[1-9]\d{1,3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/,message:"请输入正确的端口号",trigger:"blur"}]},{field:"userName",label:"用户",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"password",label:"密码",component:"InputPassword",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{ifShow:({values:e})=>"MySQL"===e.dbType||"SQLServer"===e.dbType||"PostgreSQL"===e.dbType||"KingbaseES"===e.dbType,field:"serviceName",label:"库名",component:"Input",slot:"serviceName",rules:[{required:!0,trigger:"blur",message:"必填"}]},{ifShow:({values:e})=>e.dbType&&"MySQL"!==e.dbType,field:"dbSchema",label:"模式",component:"InputSearch",slot:"dbSchema"},{ifShow:({values:e})=>"Oracle"===e.dbType,field:"oracleExtend",label:"更多",component:"Switch",defaultValue:0},{ifShow:({values:e})=>"Oracle"===e.dbType&&!!e.oracleExtend,field:"oracleLinkType",label:"连接方式",component:"Select",componentProps:{placeholder:"请选择",options:[{fullName:"SERVICE",id:"SERVICE"},{fullName:"SID",id:"SID"},{fullName:"SCHEMA",id:"SCHEMA"},{fullName:"TNS",id:"TNS"}]}},{ifShow:({values:e})=>"Oracle"===e.dbType&&!!e.oracleExtend,field:"oracleRole",label:"角色",component:"Select",componentProps:{placeholder:"请选择",options:[{fullName:"Default",id:"Default"},{fullName:"SYSDBA",id:"SYSDBA"},{fullName:"SYSOPER",id:"SYSOPER"}]}},{ifShow:({values:e})=>"Oracle"===e.dbType&&!!e.oracleExtend,field:"oracleService",label:"服务名",component:"Input",componentProps:{placeholder:"请输入"}},{field:"sortCode",label:"排序",component:"InputNumber",defaultValue:0,componentProps:{min:"0",max:"999999",placeholder:"请输入"}}],A=m((()=>b(P)?B("common.editText"):B("common.addText"))),R=N,{createMessage:q}=L(),{t:B}=f(),[Q,{setFieldsValue:V,validate:_,clearValidate:j,resetFields:U,updateSchema:F}]=l({labelWidth:80,schemas:O}),[Y,{closeModal:H,changeLoading:K,changeOkLoading:$}]=e((function(e){M.testLoading=!1,U(),async function(){const e=await I.getDictionaryData("dbType");F({field:"dbType",componentProps:{options:e}})}(),P.value=e.id||0,F({field:"dbType",componentProps:{disabled:!!b(P)}}),P.value&&(K(!0),s(P.value).then((e=>{const a=e.data;a.oracleExtend=a.oracleExtend?1:0,a.password=z.decryptByAES(a.password),M.dbType=a.dbType,V(a),K(!1)})))})),z=new g({useHex:!0});async function W(){const e=await _();if(!e)return;$(!0),e.oracleExtend=!!e.oracleExtend;const a={...e,id:P.value,password:z.encryptByAES(e.password)};(P.value?r:t)(a).then((e=>{q.success(e.msg),$(!1),H(),R("reload")})).catch((()=>{$(!1)}))}async function G(){const e=await _();if(!e)return;M.testLoading=!0,e.oracleExtend=!!e.oracleExtend;const a={...e,id:P.value,password:z.encryptByAES(e.password)};n(a).then((e=>{q.success(e.msg),M.testLoading=!1})).catch((()=>{M.testLoading=!1}))}return(e,l)=>{const s=S("a-input");return h(),y(b(a),k(e.$attrs,{onRegister:b(Y),title:A.value,showOkBtn:"",onOk:W}),{default:v((()=>[w(b(o),{onRegister:b(Q)},{dbSchema:v((({model:e,field:a})=>[w(s,{value:e[a],"onUpdate:value":l=>e[a]=l,allowClear:"",placeholder:"Oracle"===b(D)||"DM"===b(D)?"与用户同名":"",disabled:"KingbaseES"!==b(D)},{addonAfter:v((()=>[b(C)?(h(),y(b(E),{key:0,class:"mr-5px"})):T("",!0),x("span",{class:"cursor-pointer",onClick:l[0]||(l[0]=e=>G())},"连接测试")])),_:2},1032,["value","onUpdate:value","placeholder","disabled"])])),serviceName:v((({model:e,field:a})=>["MySQL"===b(D)?(h(),y(s,{key:0,value:e[a],"onUpdate:value":l=>e[a]=l,allowClear:"",placeholder:"库名"},{addonAfter:v((()=>[b(C)?(h(),y(b(E),{key:0,class:"mr-5px"})):T("",!0),x("span",{class:"cursor-pointer",onClick:l[1]||(l[1]=e=>G())},"连接测试")])),_:2},1032,["value","onUpdate:value"])):(h(),y(s,{key:1,value:e[a],"onUpdate:value":l=>e[a]=l,allowClear:"",placeholder:"库名"},null,8,["value","onUpdate:value"]))])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"])}}});export{N as _};
