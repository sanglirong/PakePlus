import{d as e,s as o,dl as _,r as n,ad as t,a0 as i,cd as a,a6 as f,a7 as r,o as l,g as d,k as s,p as c,q as u,am as g,ah as p,n as m,co as I,cp as y}from"./index-920db443.js";import{c as w}from"./createAsyncComponent-7e8f72ac.js";const v=e({__name:"index",props:["config"],emits:["setPageLoad","eventReceiver"],setup(e,{expose:v,emit:h}){const S=e,b=h;v({dataFormSubmit:function(e,o){if(V.config.isPreview)return C.warning("功能预览不支持数据保存");V.eventType=e,V.flowUrgent=o,function(){const e=s(j);if(!e)throw new Error("parser is null!");return e}().handleSubmit()}});const{createMessage:C}=p(),D=o("getLeftTreeActiveInfo",null),T=w((()=>_((()=>import("./Parser-2e1eddb1.js")),["static/js/Parser-2e1eddb1.js","static/js/Parser.vue_vue_type_script_lang-80b37b11.js","static/js/index-920db443.js","static/css/index-648461a4.css","static/js/config-06ca91cd.js","static/js/componentMap-c91676b4.js","static/js/visualDev-8f54ab4b.js","static/js/index.vue_vue_type_script_setup_true_lang-69353133.js","static/js/index-9c138ba5.js","static/js/ArrowLeftOutlined-3fbf15bc.js","static/js/log-2a5f2c26.js","static/css/index-01bda6b6.css","static/js/index-143f5813.js","static/js/useWindowSizeFn-05f906e2.js","static/css/index-e7d3e030.css","static/js/index-999abbee.js","static/css/index-cddfced7.css","static/js/Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js","static/js/Item.vue_vue_type_script_setup_true_lang-fef56f78.js","static/js/Form.vue_vue_type_script_setup_true_lang-63005a4d.js","static/js/createAsyncComponent-7e8f72ac.js","static/js/DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js","static/js/index-0be8277c.js","static/css/DataLogList-12ff8c0e.css","static/js/jquery-6353a699.js","static/js/useDefineSetting-7df030ff.js","static/js/CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js","static/css/index-c2afac83.css","static/js/upperFirst-2cd1a2f7.js","static/css/componentMap-489cc2b1.css"]))),j=n(null),V=t({config:{},formConf:{},formData:{},key:+new Date,loading:!1,isCustomCopy:!1,dataForm:{id:"",formData:{},flowId:""},eventType:"",flowUrgent:1}),{formConf:K,key:k,loading:M}=i(V),O=a(),P=f();function A(e){V.config=e,V.formConf=e.formConf?JSON.parse(e.formConf):{},V.formData={},V.dataForm.id=e.id||"",V.dataForm.flowId=e.flowId,V.isCustomCopy=e.flowTemplateJson&&e.flowTemplateJson.properties&&e.flowTemplateJson.properties.isCustomCopy,V.loading=!0;let o={};if(e.id){o={modelId:e.flowId,id:e.id,type:e.type,flowId:e.flowId,processId:e.id,taskId:e.taskId,opType:e.opType};const _=e.draftData||e.formData;V.formData={id:e.id,..._,flowId:e.flowId}}else D&&(V.formData={...D()||{}});O.setDynamicModelExtra(o),function(e,o,_){const n=P.getUserInfo,t=new Date;e.disabled=V.config.disabled;const i=(e,a)=>{for(let f=0;f<e.length;f++){let r=e[f];if(r.__vModel__){const e=o.hasOwnProperty(r.__vModel__)?o[r.__vModel__]:r.__config__.defaultValue;r.__config__.isSubTable||(r.__config__.defaultValue=e),(_||r.__config__.isSubTable)&&r.__config__.defaultCurrent&&("datePicker"===r.__config__.jnpfKey&&(r.__config__.defaultValue=I(t).startOf(y(r.format)).valueOf()),"timePicker"===r.__config__.jnpfKey&&(r.__config__.defaultValue=I(t).format(r.format||"HH:mm:ss")),"organizeSelect"===r.__config__.jnpfKey&&n.organizeIdList?.length&&(r.__config__.defaultValue=r.multiple?[n.organizeIdList]:n.organizeIdList),"depSelect"===r.__config__.jnpfKey&&n.departmentId&&(r.__config__.defaultValue=r.multiple?[n.departmentId]:n.departmentId),"userSelect"===r.__config__.jnpfKey&&n.userId&&(r.__config__.defaultValue=r.multiple?[n.userId]:n.userId),"usersSelect"===r.__config__.jnpfKey&&n.userId&&(r.__config__.defaultValue=r.multiple?[n.userId+"--user"]:n.userId+"--user"),"posSelect"===r.__config__.jnpfKey&&n.positionIds?.length&&(r.__config__.defaultValue=r.multiple?n.positionIds.map((e=>e.id)):n.positionIds[0].id),"roleSelect"===r.__config__.jnpfKey&&n.roleIds?.length&&(r.__config__.defaultValue=r.multiple?n.roleIds:n.roleIds[0]),"groupSelect"===r.__config__.jnpfKey&&n.groupIds?.length&&(r.__config__.defaultValue=r.multiple?n.groupIds:n.groupIds[0]),"sign"===r.__config__.jnpfKey&&n.signImg&&(r.__config__.defaultValue=n.signImg)),_&&!r.__config__.isSubTable&&o.hasOwnProperty(r.__vModel__)&&(r.__config__.defaultValue=o[r.__vModel__]);let i=r.__config__.noShow||!1,f=r.disabled||!1,l=r.__config__.required||!1;if(V.config.formOperates&&V.config.formOperates.length){let e=r.__config__.isSubTable?a.__vModel__+"-"+r.__vModel__:r.__vModel__,o=V.config.formOperates.filter((o=>o.id===e))||[];if(o.length){let e=o[0];i=!e.read,f=!e.write,l=e.required?e.required:r.__config__.required}}(V.config.readonly||V.config.disabled)&&(f=!0),r.disabled=f,r.__config__.noShow=i,r.__config__.required=l||!1}["relationFormAttr","popupAttr"].includes(r.__config__.jnpfKey)&&!r.isStorage&&V.config.disabled&&(r.disabled=!0),r.__config__&&r.__config__.children&&Array.isArray(r.__config__.children)&&i(r.__config__.children,r)}};i(e.fields),e.formData=o}(V.formConf,V.formData,!e.id),m((()=>{V.loading=!1,V.key=+new Date,setTimeout((()=>{b("setPageLoad")}),200)}))}function F(e,o){if(!e)return;const _={...V.formData,...e};V.dataForm.formData=_,o&&"function"==typeof o&&o(),b("eventReceiver",V.dataForm,V.eventType)}return r((()=>{A(S.config)})),(e,o)=>(l(),d("div",{class:"flow-form",style:g({margin:"0 auto",width:s(K).fullScreenWidth||"100%"})},[s(M)?u("",!0):(l(),c(s(T),{ref_key:"parserRef",ref:j,formConf:s(K),onSubmit:F,key:s(k)},null,8,["formConf"]))],4))}});export{v as default};
