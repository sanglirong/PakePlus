import{d as e,bs as t,a6 as a,aw as s,r as i,ad as r,a0 as o,aA as n,M as u,dD as l,w as p,eA as c,eB as d,eC as _,a7 as m,e as v,o as f,g,j,l as y,a4 as b,k as h,p as z,q as k,t as L,F as I,h as w,af as x,be as T,e1 as A,ae as D,eD as F,eE as K,eF as C,ah as P}from"./index-920db443.js";import O from"./UserInfo-9c1c3220.js";import{_ as S}from"./TenantInfo.vue_vue_type_script_setup_true_lang-75627f3e.js";import{_ as U}from"./Password.vue_vue_type_script_setup_true_lang-e9f5f408.js";import{_ as q}from"./JustAuth.vue_vue_type_script_setup_true_lang-f993772d.js";import M from"./Authorize-df4fdd80.js";import{_ as N}from"./SysLog.vue_vue_type_script_setup_true_lang-d95f854b.js";import{_ as B}from"./index.vue_vue_type_script_setup_true_lang-99fecc87.js";import"./commonWords-8e03a6e1.js";import"./useTable-dc8c9d84.js";import"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import"./visualDev-8f54ab4b.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./index-9c138ba5.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./log-2a5f2c26.js";import"./index-143f5813.js";import"./useWindowSizeFn-05f906e2.js";import"./index-999abbee.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./config-06ca91cd.js";import"./upperFirst-2cd1a2f7.js";import"./useTabs-ceeccdba.js";import"./uniqBy-e868edd7.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";import"./TableAction-adbe36f2.js";import"./Form.vue_vue_type_script_setup_true_lang-e9305f07.js";import"./socialsUser-930d0346.js";import"./log-ce7b44c2.js";import"./flowDelegate-3964bb34.js";import"./Form.vue_vue_type_script_setup_true_lang-95c2157d.js";import"./FlowSelect.vue_vue_type_script_setup_true_lang-a9be46b7.js";import"./template-c6142676.js";import"./BasicLeftTree-cd55d444.js";import"./index-c37d2476.js";import"./billRule-0363563b.js";import"./import-e198d900.js";import"./tip-b30e67af.js";import"./dataSource-ed26da12.js";import"./dataModel-ea807f46.js";import"./index-3b5bee70.js";import"./CopyOutlined-8d46c8b2.js";const E={class:"jnpf-content-wrapper profile-wrapper bg-white"},R={class:"organize-list"},J=["onClick"],W={class:"organize-name"},G={class:"icon-checked"},H={class:"organize-list"},Q=["onClick"],V={class:"organize-name"},X={class:"icon-checked"},Y={class:"subordinate-list"},Z={class:"text"},$={class:"user-text"},ee={class:"head"},te={class:"avatar-box"},ae={class:"username"},se=e({__name:"index",setup(e){const{createMessage:se}=P(),ie=t(),re=a(),oe=s(),ne=i(oe.apiUrl),ue=i(oe.uploadUrl),le=i(null),pe=r({activeKey:"",user:{},tenantInfo:{},isTenant:!1,userLoading:!1,loading:!1,nodeId:"0",subordinateList:[],organizeList:[],positionList:[],activeOrganize:"",activePosition:""}),{activeKey:ce,user:de,tenantInfo:_e,isTenant:me}=o(pe),ve=n(),fe=u((()=>({Authorization:l()}))),ge=u((()=>!!ie.get("useSocials")));function je(e){let t=new RegExp("image/*").test(e.type);return t||se.error("请上传图片"),t}function ye({file:e}){if("error"!==e.status){if("done"===e.status)if(200===e.response.code){if(!e.response.data||!e.response.data.name)return;F(e.response.data.name).then((t=>{pe.user.avatar=e.response.data.url,re.setUserInfo({headIcon:e.response.data.url}),se.success(t.msg)}))}else se.error(e.response.msg)}else se.error("上传失败")}function be(){pe.userLoading=!0,K().then((e=>{pe.user=e.data,pe.tenantInfo=e.data.currentTenantInfo,pe.isTenant=e.data.isTenant||!1,ve.query.config||(pe.activeKey="user"),pe.userLoading=!1}))}function he(e){return pe.nodeId=e.id,new Promise((t=>{c(pe.nodeId).then((a=>{const s=a.data;(function(){const e=h(le);if(!e)throw new Error("tree is null!");return e})().updateNodeByKey(e.eventKey,{children:s,isLeaf:!s.length}),t()}))}))}function ze(e,t){if(pe["active"+t]===e)return;C({majorId:e,majorType:t}).then((a=>{pe["active"+t]=e,se.success(a.msg).then((()=>{location.reload()}))}))}return p((()=>pe.activeKey),(e=>{if("subordinate"===e)return pe.nodeId="0",pe.loading=!0,void c(pe.nodeId).then((e=>{pe.subordinateList=e.data,pe.loading=!1}));"organize"!==e?"position"!==e||_().then((e=>{pe.positionList=e.data||[];const t=pe.positionList.filter((e=>e.isDefault));if(!t.length)return pe.activePosition="";const a=t[0];pe.activePosition=a.id})):d().then((e=>{pe.organizeList=e.data||[];const t=pe.organizeList.filter((e=>e.isDefault));if(!t.length)return pe.activeOrganize="";const a=t[0];pe.activeOrganize=a.id}))})),m((()=>{ve.query.config&&(pe.activeKey="entrust"),be()})),(e,t)=>{const a=v("a-tab-pane"),s=v("jnpf-group-title"),i=v("a-col"),r=v("a-row"),o=v("jnpf-empty"),n=v("a-avatar"),u=v("a-card"),l=v("a-upload"),p=v("a-tabs");return f(),g("div",E,[j(p,{activeKey:h(ce),"onUpdate:activeKey":t[0]||(t[0]=e=>D(ce)?ce.value=e:null),"tab-position":"left",class:"common-left-tabs profile-left-tabs",destroyInactiveTabPane:""},{leftExtra:y((()=>[b("div",ee,[j(l,{showUploadList:!1,action:ue.value+"/userAvatar",class:"avatar-uploader",headers:fe.value,accept:"image/*","before-upload":je,onChange:ye},{default:y((()=>[b("div",te,[h(de).avatar?(f(),z(n,{key:0,size:50,src:ne.value+h(de).avatar,class:"avatar"},null,8,["src"])):k("",!0),t[5]||(t[5]=b("div",{class:"avatar-hover"},"更换头像",-1))])])),_:1},8,["action","headers"]),b("span",ae,L(h(de).realName),1)])])),default:y((()=>[j(a,{key:"user",tab:"个人资料"},{default:y((()=>[j(O,{user:h(de),onUpdateInfo:be},null,8,["user"])])),_:1}),h(me)?(f(),z(a,{key:"tenantInfo",tab:"租户信息"},{default:y((()=>[j(S,{tenantInfo:h(_e)},null,8,["tenantInfo"])])),_:1})):k("",!0),j(a,{key:"password",tab:"修改密码"},{default:y((()=>[j(U)])),_:1}),j(a,{key:"line",disabled:""}),j(a,{key:"organize",tab:"我的组织"},{default:y((()=>[j(s,{content:"我的组织",helpMessage:"用户可以自行切换组织信息，我的组织默认只能进行单选"}),b("div",R,[pe.organizeList.length?(f(),z(r,{key:0,gutter:80},{default:y((()=>[(f(!0),g(I,null,w(pe.organizeList,((e,a)=>(f(),z(i,{span:12,class:"organize-item",key:a},{default:y((()=>[b("div",{class:x(["organize-item-main",{active:pe.activeOrganize===e.id}]),onClick:t=>ze(e.id,"Organize")},[t[1]||(t[1]=b("i",{class:"icon-ym icon-ym-organization"},null,-1)),b("p",W,L(e.fullName),1),t[2]||(t[2]=b("p",{class:"btn"},"默认",-1)),b("div",G,[j(h(T))])],10,J)])),_:2},1024)))),128))])),_:1})):(f(),z(o,{key:1}))])])),_:1}),j(a,{key:"position",tab:"我的岗位"},{default:y((()=>[j(s,{content:"我的岗位",helpMessage:"用户可以自行切换我的组织内的岗位信息，我的岗位默认只能进行单选"}),b("div",H,[pe.positionList.length?(f(),z(r,{key:0,gutter:80},{default:y((()=>[(f(!0),g(I,null,w(pe.positionList,((e,a)=>(f(),z(i,{span:12,class:"organize-item",key:a},{default:y((()=>[b("div",{class:x(["organize-item-main",{active:pe.activePosition===e.id}]),onClick:t=>ze(e.id,"Position")},[t[3]||(t[3]=b("i",{class:"icon-ym icon-ym-wf-outgoingApply"},null,-1)),b("p",V,L(e.fullName),1),t[4]||(t[4]=b("p",{class:"btn"},"主岗",-1)),b("div",X,[j(h(T))])],10,Q)])),_:2},1024)))),128))])),_:1})):(f(),z(o,{key:1}))])])),_:1}),j(a,{key:"subordinate",tab:"我的下属"},{default:y((()=>[j(s,{content:"我的下属"}),b("div",Y,[j(h(A),{ref_key:"subTreeRef",ref:le,treeData:pe.subordinateList,"load-data":he},{title:y((e=>[j(u,{class:"subordinate-tree-node",shadow:"never","slot-scope":"{ data }"},{default:y((()=>[j(n,{size:50,src:ne.value+e.avatar},null,8,["src"]),b("div",Z,[b("p",null,L(e.userName),1),b("p",$,L(e.department)+L(e.position?"/"+e.position:""),1)])])),_:2},1024)])),_:1},8,["treeData"])])])),_:1}),j(a,{key:"entrust",tab:"委托代理"},{default:y((()=>[j(B)])),_:1}),ge.value?(f(),z(a,{key:"justAuth",tab:"绑定设置"},{default:y((()=>[j(q)])),_:1})):k("",!0),j(a,{key:"authorize",tab:"系统权限"},{default:y((()=>[j(M)])),_:1}),j(a,{key:"sysLog",tab:"登录日志"},{default:y((()=>[j(N)])),_:1})])),_:1},8,["activeKey"])])}}});export{se as default};
