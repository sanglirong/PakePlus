import{e as o}from"./shortLink-5c58d9bb.js";import{u as e,B as n}from"./index-9c138ba5.js";import{u as t,B as r}from"./index-143f5813.js";import{u as a,B as i}from"./index-999abbee.js";import{_}from"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import{d as f,u as l,r as s,ad as d,a0 as p,c,n as m,e as u,o as g,g as y,j as h,l as D,a4 as w,am as C,k as v,p as k,q as F,V as j,F as M}from"./index-920db443.js";const S={class:"p-10px"},R=f({name:"Detail",__name:"index",emits:["close"],setup(f,{expose:R,emit:x}){const T=x,{t:A}=l(),[O,{openPopup:P,closePopup:b,setPopupProps:V}]=e(),[B,{openModal:K,closeModal:W,setModalProps:$}]=t(),[E,{openDrawer:q,closeDrawer:H,setDrawerProps:I}]=a(),J=s(null),L=s(null),N=d({formConf:{},formData:{},config:{},loading:!1,key:+new Date,dataForm:{id:"",data:""},formOperates:[],title:A("common.detailText"),relationData:{},detailVisible:!1}),{title:z,formConf:G,formData:Q,relationData:U,key:X,loading:Y,detailVisible:Z}=p(N);function oo(){var e;no(!0),N.loading=!0,N.config.id?(e=N.config.id,o(N.config.modelId,e,N.config.encryption).then((o=>{N.dataForm=o.data||{},N.dataForm.data&&(N.formData=JSON.parse(N.dataForm.data),function(o,e){const n=(o,t)=>{for(let r=0;r<o.length;r++){let a=o[r];if(a.__vModel__){if("relationForm"===a.__config__.jnpfKey||"popupSelect"===a.__config__.jnpfKey)a.__config__.defaultValue=e[a.__vModel__+"_id"],a.name=e[a.__vModel__]||"";else{const o=e.hasOwnProperty(a.__vModel__)?e[a.__vModel__]:a.__config__.defaultValue;a.__config__.defaultValue=o}if(N.config.useFormPermission){let o=a.__config__.isSubTable?t.__vModel__+"-"+a.__vModel__:a.__vModel__,e=!0;N.formOperates&&N.formOperates.length&&(e=!N.formOperates.some((e=>e.enCode===o))),e=a.__config__.noShow?a.__config__.noShow:e,a.__config__.noShow=e}}["relationFormAttr","popupAttr"].includes(a.__config__.jnpfKey),a.__config__&&a.__config__.children&&Array.isArray(a.__config__.children)&&n(a.__config__.children,a)}};n(o.fields)}(N.formConf,N.formData),eo(N.formConf.fields),m((()=>{N.loading=!1,N.key=+new Date,no(!1)})))}))):function(){if("fullScreen"===N.formConf.popupType)return b();if("drawer"===N.formConf.popupType)return H();W()}()}function eo(o){o.forEach((e=>{const n=e.__config__;if("relationFormAttr"==n.jnpfKey||"popupAttr"==n.jnpfKey){const n=e.relationField.split("_jnpfTable_")[0];o.forEach((o=>{const t=Array.isArray(o.__config__.visibility)&&!o.__config__.visibility.includes("pc");n!=o.__vModel__||!t&&!o.__config__.noShow||e.__vModel__||(e.__config__.noShow=!0)}))}e.__config__.children&&e.__config__.children.length&&eo(e.__config__.children)}))}function no(o){var e;e={loading:o},"fullScreen"===N.formConf.popupType?V(e):"drawer"===N.formConf.popupType?I(e):$(e)}async function to(){return T("close"),!0}return R({init:function(o){N.config=o,N.formConf=c(o.formConf),N.dataForm.id=o.id,function(){if("fullScreen"===N.formConf.popupType)return P();if("drawer"===N.formConf.popupType)return q();K()}(),m((()=>{setTimeout(oo,0)}))}}),(o,e)=>{const t=u("Detail");return g(),y(M,null,[h(v(n),j(o.$attrs,{onRegister:v(O),title:v(z),destroyOnClose:"",closeFunc:to}),{default:D((()=>[w("div",{class:"p-10px",style:C({margin:"0 auto",width:v(G).fullScreenWidth||"100%"})},[v(Y)?F("",!0):(g(),k(_,{ref_key:"parserRef",ref:J,formConf:v(G),formData:v(Q),relationData:v(U),key:v(X)},null,8,["formConf","formData","relationData"]))],4)])),_:1},16,["onRegister","title"]),h(v(r),j(o.$attrs,{onRegister:v(B),title:v(z),width:v(G).generalWidth,minHeight:100,showOkBtn:!1,closeFunc:to}),{default:D((()=>[v(Y)?F("",!0):(g(),k(_,{ref_key:"parserRef",ref:J,formConf:v(G),formData:v(Q),relationData:v(U),key:v(X)},null,8,["formConf","formData","relationData"]))])),_:1},16,["onRegister","title","width"]),h(v(i),j(o.$attrs,{onRegister:v(E),title:v(z),width:v(G).drawerWidth,showFooter:"",showOkBtn:!1,closeFunc:to}),{default:D((()=>[w("div",S,[v(Y)?F("",!0):(g(),k(_,{ref_key:"parserRef",ref:J,formConf:v(G),formData:v(Q),relationData:v(U),key:v(X)},null,8,["formConf","formData","relationData"]))])])),_:1},16,["onRegister","title","width"]),v(Z)?(g(),k(t,{key:0,ref_key:"detailRef",ref:L,onClose:e[0]||(e[0]=o=>N.detailVisible=!1)},null,512)):F("",!0)],64)}}});export{R as _};
