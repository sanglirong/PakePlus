import{f as e}from"./visualDev-8f54ab4b.js";import{d as a,ad as l,a0 as n,aw as s,r as t,e as o,o as i,p,l as r,j as c,g as d,af as m,t as u,q as f,F as y,k as g,V as k,dv as v,a7 as _,n as j,a9 as h,i as C,h as D,ab as x,a4 as b,am as L,m as w}from"./index-920db443.js";import{b as K,B as I,u as M}from"./index-143f5813.js";import{T as S,a as F}from"./index-0be8277c.js";const R={key:0,class:"min-h-20px"},z=["onClick"],N={key:1,class:"min-h-20px"},Q=["onClick"],T={key:0,class:"min-h-20px"},U=["onClick"],B={key:0,class:"value-cell-modify"},H=["onClick"],O={key:1,class:"h-6px"},P=["onClick"],q=["onClick"],A={key:1,class:"h-6px"},E=["onClick"],J={key:0,class:"value-cell-old value-cell"},V={key:1,class:"h-6px"},W={key:2,class:"value-cell-new value-cell"},$=a({__name:"ChildLogModal",emits:["register","confirm"],setup(e,{emit:a}){const _=l({list:[],columnList:[]}),{list:j,columnList:h}=n(_),C=s(),D=t(C.apiUrl),[x]=K((function(e){_.list=e.chidData||[],_.columnList=e.chidField.map((e=>({...e,title:e.label,align:"center",dataIndex:e.prop,width:150})))}));function b(e){return 2===e.jnpf_type?{style:{background:"#fca0a0"}}:0===e.jnpf_type?{style:{background:"#aeeec2"}}:void 0}function L(e,a){return"sign"===e.jnpfKey?2===a.jnpf_type?"旧签名":1===a.jnpf_type?"签名":"新签名":"signature"===e.jnpfKey?2===a.jnpf_type?"旧签章":1===a.jnpf_type?"签章":"新签章":e.nameModified?a[e.prop]==a["jnpf_old_"+e.prop]?"未修改":"已修改":2===a.jnpf_type?a["jnpf_old_"+e.prop]:a[e.prop]}function w(e,a){return{"line-through":2===a.jnpf_type,"value-cell-more":e.jnpfKey&&["sign","signature"].includes(e.jnpfKey),"value-cell-modify":!!e.nameModified}}function M(e,a){if(!e.jnpfKey||!["sign","signature"].includes(e.jnpfKey))return;const l="sign"===e.jnpfKey?"":D.value,n=2===a.jnpf_type?a["jnpf_old_"+e.prop]:a[e.prop];if(!n)return;S(l+n)}function S(e){v({imageList:[e]})}return(e,a)=>{const l=o("a-table");return i(),p(g(I),k(e.$attrs,{width:"1000px",class:"child-log-Modal",onRegister:g(x),title:"修改详情",footer:null,destroyOnClose:""}),{default:r((()=>[c(l,{size:"small","data-source":g(j),columns:g(h),bordered:"",pagination:!1,customRow:b,scroll:{y:"calc(60vh - 40px)"}},{bodyCell:r((({column:e,record:a})=>[0===a.jnpf_type?(i(),d("div",R,[a[e.prop]?(i(),d("span",{key:0,class:m(w(e,a)),onClick:l=>M(e,a)},u(L(e,a)),11,z)):f("",!0)])):2===a.jnpf_type?(i(),d("div",N,[a["jnpf_old_"+e.prop]?(i(),d("span",{key:0,class:m(w(e,a)),onClick:l=>M(e,a)},u(L(e,a)),11,Q)):f("",!0)])):(i(),d(y,{key:2},[a[e.prop]==a["jnpf_old_"+e.prop]?(i(),d("div",T,[a[e.prop]?(i(),d("span",{key:0,class:m(w(e,a)),onClick:l=>M(e,a)},u(L(e,a)),11,U)):f("",!0)])):(i(),d(y,{key:1},[e.nameModified?(i(),d("span",B,"已修改")):"sign"===e.jnpfKey?(i(),d(y,{key:1},[a["jnpf_old_"+e.prop]?(i(),d("span",{key:0,class:"value-cell-more line-through",onClick:l=>S(a["jnpf_old_"+e.prop])}," 旧签名 ",8,H)):f("",!0),a["jnpf_old_"+e.prop]&&a[e.prop]?(i(),d("div",O)):f("",!0),a[e.prop]?(i(),d("span",{key:2,class:"value-cell-more",onClick:l=>S(a[e.prop])},"新签名",8,P)):f("",!0)],64)):"signature"===e.jnpfKey?(i(),d(y,{key:2},[a["jnpf_old_"+e.prop]?(i(),d("span",{key:0,class:"value-cell-more line-through",onClick:l=>S(D.value+a["jnpf_old_"+e.prop])}," 旧签章 ",8,q)):f("",!0),a["jnpf_old_"+e.prop]&&a[e.prop]?(i(),d("div",A)):f("",!0),a[e.prop]?(i(),d("span",{key:2,class:"value-cell-more",onClick:l=>S(D.value+a[e.prop])},"新签章",8,E)):f("",!0)],64)):(i(),d(y,{key:3},[a["jnpf_old_"+e.prop]?(i(),d("span",J,u(a["jnpf_old_"+e.prop]),1)):f("",!0),a["jnpf_old_"+e.prop]&&a[e.prop]?(i(),d("div",V)):f("",!0),a[e.prop]?(i(),d("span",W,u(a[e.prop]),1)):f("",!0)],64))],64))],64))])),_:1},8,["data-source","columns"])])),_:1},16,["onRegister"])}}}),G={class:"form-extra-log"},X={class:"time-item-container"},Y={class:"time-item-head"},Z={class:"head-name"},ee={key:0,class:"time-item-log"},ae={class:"time-item-log-total"},le={class:"time-item-log-item"},ne={class:"time-item-log-item-label"},se={class:"time-item-log-item-value"},te={key:0,class:"time-item-log-item-value-modify"},oe=["onClick"],ie=["onClick"],pe=["onClick"],re=["onClick"],ce=["onClick"],de={key:0,class:"time-item-log-item-value-old"},me={class:"time-item-log-item-value-new"},ue=a({__name:"DataLogList",props:{modelId:{type:String,default:""},formDataId:{type:[String,Number],default:""}},setup(a){const m=a,k=s(),K=t(k.apiUrl),I=t(null),R=l({list:[],loading:!1,finish:!1,listQuery:{currentPage:1,pageSize:20,sort:"desc",sidx:""}}),{list:z,loading:N}=n(R),[Q,{openModal:T}]=M();function U(e){return 1==e?"编辑":"新建"}function B(e){v({imageList:[e]})}function H(){if(!m.modelId||!m.formDataId)return;R.loading=!0;const a={...R.listQuery,modelId:m.modelId,dataId:m.formDataId};e(a).then((e=>{e.data.list.length<R.listQuery.pageSize&&(R.finish=!0);const a=e.data.list.map((e=>({...e,dataLog:e.dataLog?JSON.parse(e.dataLog):[]})));R.list=[...R.list,...a],R.loading=!1})).catch((()=>{R.loading=!1}))}return _((()=>{R.list=[],R.finish=!1,H(),j((()=>{!function(){const e=I.value,a=e?.getScrollWrap();a?.addEventListener("scroll",(()=>{a.scrollHeight-a.clientHeight-a.scrollTop<=200&&!R.loading&&!R.finish&&(R.listQuery.currentPage+=1,H())}))}()}))})),(e,a)=>{const l=o("a-avatar"),n=o("a-tag"),s=o("jnpf-empty"),t=h("loading");return i(),d("div",G,[C((i(),p(g(x),{ref_key:"infiniteBody",ref:I,class:"form-extra-comment-main"},{default:r((()=>[g(z).length?(i(),p(g(S),{key:0,class:"form-extra-log-list"},{default:r((()=>[(i(!0),d(y,null,D(g(z),(e=>(i(),p(g(F),null,{dot:r((()=>{return[b("span",{class:"tag",style:L({background:(a=e.type,1==a?"#0177FF":"#08AF28")})},null,4)];var a})),default:r((()=>{return[b("span",null,u(e.creatorTime),1),b("div",X,[b("div",Y,[c(l,{size:24,src:K.value+e.headIcon,class:"head-avatar"},null,8,["src"]),b("span",Z,u(e.creatorUserName),1),c(n,{color:(s=e.type,1==s?"blue":"success"),bordered:!1,class:"head-status"},{default:r((()=>[w(u(U(e.type)),1)])),_:2},1032,["color"])]),e.type?(i(),d("div",ee,[b("div",ae,[a[0]||(a[0]=w(" 有 ")),b("span",null,u(e.dataLog.length),1),a[1]||(a[1]=w(" 处更改 "))]),(i(!0),d(y,null,D(e.dataLog,(e=>(i(),d("div",le,[b("div",ne,u(e.fieldName)+"：",1),b("div",se,[e.nameModified?(i(),d("span",te,"已修改")):(i(),d(y,{key:1},["table"===e.jnpfKey?(i(),d("span",{key:0,class:"time-item-log-item-value-more",onClick:a=>{T(!0,e)}},"修改详情",8,oe)):"sign"===e.jnpfKey?(i(),d(y,{key:1},[e.oldData?(i(),d("span",{key:0,class:"time-item-log-item-value-more line-through",onClick:a=>B(e.oldData)},"旧签名",8,ie)):f("",!0),e.newData?(i(),d(y,{key:1},[a[2]||(a[2]=w(" 修改为 ")),b("span",{class:"time-item-log-item-value-more",onClick:a=>B(e.newData)},"新签名",8,pe)],64)):f("",!0)],64)):"signature"===e.jnpfKey?(i(),d(y,{key:2},[e.oldData?(i(),d("span",{key:0,class:"time-item-log-item-value-more line-through",onClick:a=>B(K.value+e.oldData)},"旧签章",8,re)):f("",!0),e.newData?(i(),d(y,{key:1},[a[3]||(a[3]=w(" 修改为 ")),b("span",{class:"time-item-log-item-value-more",onClick:a=>B(K.value+e.newData)},"新签章",8,ce)],64)):f("",!0)],64)):(i(),d(y,{key:3},[e.oldData?(i(),d("span",de,u(e.oldData),1)):f("",!0),e.newData?(i(),d(y,{key:1},[a[4]||(a[4]=w(" 修改为 ")),b("span",me,u(e.newData),1)],64)):f("",!0)],64))],64))])])))),256))])):f("",!0)])];var s})),_:2},1024)))),256))])),_:1})):f("",!0),g(z).length?f("",!0):(i(),p(s,{key:1}))])),_:1})),[[t,g(N)]]),c($,{onRegister:g(Q)},null,8,["onRegister"])])}}});export{ue as _};
