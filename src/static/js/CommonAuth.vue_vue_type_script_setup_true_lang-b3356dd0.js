import{d as e,u as t,r as a,ad as s,a0 as d,a7 as n,e as l,a9 as i,o,g as c,a4 as r,t as p,k as u,j as f,l as y,m as b,p as g,q as h,i as m,e1 as _,v as k,n as x,ah as I}from"./index-920db443.js";import{b as v,c as C}from"./authorize-72eaa3a6.js";const j={class:"auth-main-container"},w={class:"tool-container"},D={class:"tool-container-title"},L={class:"main"},K={class:"no-data"},P=e({__name:"CommonAuth",props:{id:{type:String,default:""},type:{type:String,default:"Portal"}},setup(e){const P=e,{t:A}=t(),{createMessage:E}=I(),S=a(null),z=s({title:"",loading:!1,objectId:"",selectedIds:[],treeData:[],btnLoading:!1}),{treeData:R,loading:T,btnLoading:q,title:F}=d(z);function M(){z.objectId=P.id,z.btnLoading=!1,function(){let e="";"Portal"===P.type&&(e="门户权限");"Flow"===P.type&&(e="流程权限");"Print"===P.type&&(e="打印模板权限");z.title=e}(),function(){if(z.loading=!0,z.treeData=[],z.selectedIds=[],H().setCheckedKeys([]),!P.type||!z.objectId)return;v(P.type,z.objectId).then((e=>{z.treeData=e.data.list||[];const t=H().getParentKeys(z.treeData,!0),a=[...new Set([...z.selectedIds,...e.data.ids])];z.selectedIds=a;const s=a.filter((e=>!t.includes(e)));x((()=>{H().setCheckedKeys(s),z.loading=!1}))})).catch((()=>{z.loading=!1}))}()}function N(e,t){let a=[...e,...t.halfCheckedKeys];z.selectedIds=a}function B(e){H().checkAll(e),x((()=>{let e=H().getCheckedKeys();z.selectedIds=e}))}function G(e){H().expandAll(e)}function H(){const e=u(S);if(!e)throw new Error("tree is null!");return e}return n((()=>{M()})),(t,a)=>{const s=l("a-button"),d=l("a-divider"),n=l("a-space"),x=l("a-alert"),I=l("jnpf-empty"),v=i("loading");return o(),c("div",j,[r("div",w,[r("div",D,p(u(F)),1),f(n,{size:10},{default:y((()=>[f(s,{type:"text",disabled:u(T),onClick:a[0]||(a[0]=e=>G(!0))},{default:y((()=>a[5]||(a[5]=[b("展开全部")]))),_:1,__:[5]},8,["disabled"]),f(s,{type:"text",disabled:u(T),onClick:a[1]||(a[1]=e=>G(!1))},{default:y((()=>a[6]||(a[6]=[b("折叠全部")]))),_:1,__:[6]},8,["disabled"]),f(s,{type:"text",disabled:u(T),onClick:a[2]||(a[2]=e=>B(!0))},{default:y((()=>a[7]||(a[7]=[b("全部勾选")]))),_:1,__:[7]},8,["disabled"]),f(s,{type:"text",disabled:u(T),onClick:a[3]||(a[3]=e=>B(!1))},{default:y((()=>a[8]||(a[8]=[b("取消全选")]))),_:1,__:[8]},8,["disabled"]),f(d,{type:"vertical",class:"!h-7"}),f(s,{type:"primary",onClick:a[4]||(a[4]=e=>(z.btnLoading=!0,void C(P.type,z.objectId,{ids:z.selectedIds}).then((e=>{E.success(e.msg),z.btnLoading=!1})).catch((()=>{z.btnLoading=!1})))),disabled:u(T),loading:u(q)},{default:y((()=>[b(p(u(A)("common.saveText")),1)])),_:1},8,["disabled","loading"])])),_:1})]),"Portal"===e.type?(o(),g(x,{key:0,message:"请先授权应用权限，且该应用需添加门户（【系统管理】-【应用菜单】）",type:"warning",showIcon:"",class:"!mx-20px !mt-20px"})):h("",!0),m((o(),c("div",L,[m(f(u(_),{treeData:u(R),ref_key:"treeRef",ref:S,checkable:"",blockNode:"",clickRowToExpand:"",defaultExpandAll:"",onCheck:N,class:"overflow-auto"},null,8,["treeData"]),[[k,u(R).length]]),m(r("div",K,[f(I)],512),[[k,!u(R).length&&!u(T)]])])),[[v,u(T)]])])}}});export{P as _};
