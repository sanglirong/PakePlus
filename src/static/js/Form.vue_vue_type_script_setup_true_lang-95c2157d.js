import{g as e,u as a,c as t}from"./flowDelegate-3964bb34.js";import{b as o,B as r}from"./index-143f5813.js";import{u as s,B as d}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{d as l,ad as m,u as n,ac as i,M as p,o as u,p as c,l as f,j as g,k as F,cR as y,e3 as I,V as v,co as w,ah as U}from"./index-920db443.js";import{_ as h}from"./FlowSelect.vue_vue_type_script_setup_true_lang-a9be46b7.js";import{U as N}from"./index-c37d2476.js";const j=l({__name:"Form",emits:["register","reload"],setup(l,{emit:j}){const T=j,_=e=>e&&e<w().endOf("day").subtract(1,"day"),b=async(e,a)=>k().endTime?k().endTime<a?Promise.reject("开始时间应该小于结束时间"):(Y(["endTime"]),Promise.resolve()):Promise.resolve(),x=async(e,a)=>k().startTime&&k().startTime>a?Promise.reject("结束时间应该大于开始时间"):Promise.resolve(),[P,{setFieldsValue:D,resetFields:M,getFieldsValue:k,validate:Y}]=s({labelWidth:90}),[S,{closeModal:q,changeLoading:C,changeOkLoading:R}]=o((function(a){C(!0),M(),$.flowId=[],$.dataForm={id:"",toUserName:"",toUserId:[],userName:"",type:0,flowId:"",flowName:"全部流程"},$.dataForm.type=a.type||0,$.dataForm.id=a.id,$.dataForm.id?e($.dataForm.id).then((e=>{D(e.data),$.dataForm=e.data,$.flowId=$.dataForm.flowId?$.dataForm.flowId.split(","):[],C(!1)})):C(!1)})),$=m({dataForm:{id:"",toUserName:"",toUserId:[],userName:"",type:0,flowId:"",flowName:"全部流程"},flowId:[]}),{createMessage:H}=U(),{t:O}=n(),V=i(),B=p((()=>V.getSysConfigInfo)),L=p((()=>$.dataForm.id?O("common.editText"):O("common.addText"))),W=p((()=>{const e=0===$.dataForm.type?"委托":"代理";return[{field:"toUserId",label:0===$.dataForm.type?"受委托人":"代理人",component:"UserSelect",slot:"toUserId",rules:[{required:!0,trigger:"blur",message:"必填",type:"array"}]},{field:"flowId",label:`${e}流程`,helpMessage:`未选择${e}流程默认全部流程进行${e}`,component:"Input",slot:"flowId"},{field:"startTime",label:"开始时间",component:"DatePicker",componentProps:{format:"YYYY-MM-DD HH:mm:ss",disabledDate:_},rules:[{required:!0,message:"必填",trigger:"change"},{validator:b,trigger:"change"}]},{field:"endTime",label:"结束时间",component:"DatePicker",componentProps:{format:"YYYY-MM-DD HH:mm:ss",disabledDate:_},rules:[{required:!0,message:"必填",trigger:"change"},{validator:x,trigger:"change"}]},{field:"description",label:`${e}说明`,component:"Textarea",componentProps:{placeholder:"请输入"}}]}));function z(e,a){if(!e)return $.dataForm.toUserId=[],void($.dataForm.toUserName="");$.dataForm.toUserId=e,$.dataForm.toUserName=a.map((e=>e.fullName)).join()}function A(e,a){if(!a||!a.length)return $.dataForm.flowName="全部流程";$.dataForm.flowName=a.map((e=>e.fullName+"/"+e.enCode)).join()}async function E(){const e=await Y();if(!e)return;R(!0);const o={...e,type:$.dataForm.type,flowId:$.flowId.join(),flowName:$.dataForm.flowName,userName:$.dataForm.userName,toUserName:$.dataForm.toUserName};($.dataForm.id?a:t)(o).then((e=>{H.success(e.msg),R(!1),q(),T("reload")})).catch((()=>{R(!1)}))}return(e,a)=>(u(),c(F(r),v(e.$attrs,{onRegister:F(S),title:L.value,onOk:E}),{default:f((()=>[g(F(d),{onRegister:F(P),schemas:W.value},{toUserId:f((({model:e,field:a})=>[1===B.value[0===$.dataForm.type?"delegateScope":"proxyScope"]?(u(),c(F(y),{key:0,value:e[a],"onUpdate:value":t=>e[a]=t,multiple:"",onChange:z},null,8,["value","onUpdate:value"])):(u(),c(F(N),{key:1,value:e[a],"onUpdate:value":t=>e[a]=t,multiple:"",onChange:z,query:{type:B.value[0===$.dataForm.type?"delegateScope":"proxyScope"]},api:F(I)},null,8,["value","onUpdate:value","query","api"]))])),flowId:f((()=>[g(h,{value:$.flowId,"onUpdate:value":a[0]||(a[0]=e=>$.flowId=e),popupTitle:"委托流程",entrustType:$.dataForm.type,toUserId:$.dataForm.toUserId,placeholder:"全部流程",onChange:A},null,8,["value","entrustType","toUserId"])])),_:1},8,["onRegister","schemas"])])),_:1},16,["onRegister","title"]))}});export{j as _};
