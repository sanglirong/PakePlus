import{d as e,U as a,u as l,aw as t,r as s,c3 as n,M as u,bk as o,k as i,w as c,ei as d,c as r,e as v,a9 as p,o as m,g as f,af as h,j as y,l as g,m as b,t as k,a4 as C,F as _,h as w,p as S,V as z,aN as N,e1 as x,i as I,ab as U,q as j,dF as T,aH as D,n as F,gc as B}from"./index-920db443.js";const K={class:"tags"},A={class:"transfer__body"},E={class:"transfer-pane left-pane"},G={class:"transfer-pane__tool"},O={class:"transfer-pane__body transfer-pane__body-tab"},R=["onClick"],q={class:"selected-item-main"},H={class:"selected-item-text"},L={class:"name"},M=["title"],P={class:"transfer-pane right-pane"},V={class:"transfer-pane__tool"},$={class:"transfer-pane__body"},J={class:"selected-item-main"},Q={class:"selected-item-text"},W={class:"name"},X=["title"],Y=e({name:"GradeUserSelect",inheritAttrs:!1,__name:"GradeUserSelect",props:{value:{type:[String,Array]},multiple:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择"},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!0},size:String,buttonType:{type:String,default:"select"},modalTitle:{type:String,default:"选择用户"}},emits:["update:value","change","labelChange"],setup(e,{emit:Y}){const Z=e,ee=Y,ae=a({excludeDefaultKeys:!1}),{t:le}=l(),te=t(),se=s(te.apiUrl),ne=s(!1),ue=s(null),oe=s([]),ie=s(""),ce=s([]),de=s([]),re=s(!1),ve=s(!1),pe=s([]),me=s("0"),fe=s(+new Date),he=n.useInjectFormItemContext(),ye=u((()=>({...o(Z,["placeholder","disabled","size","allowClear"]),fieldNames:{label:"fullName",value:"id"},open:!1,mode:Z.multiple?"multiple":"",showSearch:!1,showArrow:!0,class:i(ae).class?"w-full "+i(ae).class:"w-full"})));function ge(){if(!Z.value||!Z.value.length)return oe.value=Z.multiple?[]:void 0,de.value=[],pe.value=[],void ee("labelChange","");const e=Z.multiple?Z.value:[Z.value];d(i(e)).then((e=>{const a=e.data.list,l=a.map((e=>e.id));oe.value=Z.multiple?l:l[0],de.value=r(a),pe.value=r(a);const t=pe.value.map((e=>e.fullName)).join();ee("labelChange",t)}))}function be(e,a){pe.value=a??[],xe()}function ke(){Z.disabled||(ne.value=!0,ie.value="",F((()=>{_e(),ge()})))}function Ce(){ne.value=!1}function _e(){fe.value=+new Date,me.value="0",ce.value=[],ve.value=!!ie.value,function(){re.value=!0,ie.value&&(me.value="0");B(me.value,ie.value).then((e=>{ce.value=e.data.list,re.value=!1}))}()}function we(e){if(!e.length)return;const a=Ne().getSelectedNode(e[0]);a?.disabled||"user"!==a?.type||Se(a)}function Se(e){pe.value.some((a=>a.id===e.id))||(Z.multiple?pe.value.push(e):pe.value=[e])}function ze(){pe.value=[]}function Ne(){const e=i(ue);if(!e)throw new Error("tree is null!");return e}function xe(){const e=i(pe).map((e=>e.id));de.value=i(pe),oe.value=Z.multiple?e:e[0],Z.multiple?(ee("update:value",e),ee("change",e,i(de))):(ee("update:value",e[0]),ee("change",e[0],i(de)[0])),he.onFieldChange(),Ce()}function Ie(e){return me.value=e.id,new Promise((a=>{B(me.value,ie.value).then((l=>{const t=l.data.list;Ne().updateNodeByKey(e.eventKey,{children:t,isLeaf:!t.length}),a()}))}))}return c((()=>Z.value),(()=>{ge()}),{immediate:!0}),(a,l)=>{const t=v("a-button"),s=v("a-tag"),n=v("a-select"),u=v("a-input-search"),o=v("a-avatar"),c=v("jnpf-empty"),d=p("loading");return m(),f(_,null,["button"===e.buttonType?(m(),f("div",{key:0,class:h([a.$attrs.class,"select-tag-list"])},[y(t,{preIcon:"icon-ym icon-ym-btn-add",onClick:ke},{default:g((()=>[b(k(e.modalTitle),1)])),_:1}),C("div",K,[(m(!0),f(_,null,w(de.value,((a,l)=>(m(),S(s,{class:"!mt-10px",closable:!e.disabled,key:a.id,onClose:e=>function(e){pe.value.splice(e,1),xe()}(l)},{default:g((()=>[b(k(a.fullName),1)])),_:2},1032,["closable","onClose"])))),128))])],2)):(m(),S(n,z({key:1},ye.value,{value:oe.value,"onUpdate:value":l[0]||(l[0]=e=>oe.value=e),options:de.value,onChange:be,onClick:ke}),null,16,["value","options"])),y(i(D),{open:ne.value,"onUpdate:open":l[2]||(l[2]=e=>ne.value=e),title:e.modalTitle,width:800,class:"transfer-modal",onOk:xe,centered:"",destroyOnClose:"",maskClosable:!1,keyboard:!1},{closeIcon:g((()=>[y(N,{canFullscreen:!1,onCancel:Ce})])),default:g((()=>[C("div",A,[C("div",E,[C("div",G,[y(u,{placeholder:i(le)("common.enterKeyword"),allowClear:"",value:ie.value,"onUpdate:value":l[1]||(l[1]=e=>ie.value=e),onSearch:_e},null,8,["placeholder","value"])]),C("div",O,[ve.value?I((m(),S(i(U),{key:1},{default:g((()=>[(m(!0),f(_,null,w(ce.value,(e=>(m(),f("div",{key:e.id,class:"selected-item selected-item-user",onClick:a=>Se(e)},[C("div",q,[y(o,{size:36,src:se.value+e.headIcon,class:"selected-item-headIcon"},null,8,["src"]),C("div",H,[C("p",L,k(e.fullName),1),C("p",{class:"organize",title:e.organize},k(e.organize),9,M)])])],8,R)))),128)),ce.value.length?j("",!0):(m(),S(c,{key:0}))])),_:1})),[[d,re.value]]):(m(),S(i(x),{class:"tree-main",treeData:ce.value,"load-data":Ie,clickRowToExpand:"",onSelect:we,ref_key:"treeRef",ref:ue,loading:re.value,key:fe.value},null,8,["treeData","loading"]))])]),C("div",P,[C("div",V,[C("span",null,k(i(le)("component.jnpf.common.selected")),1),C("span",{class:"remove-all-btn",onClick:ze},"清空列表")]),C("div",$,[y(i(U),null,{default:g((()=>[(m(!0),f(_,null,w(pe.value,((e,a)=>(m(),f("div",{key:a,class:"selected-item selected-item-user"},[C("div",J,[y(o,{size:36,src:se.value+e.headIcon,class:"selected-item-headIcon"},null,8,["src"]),C("div",Q,[C("p",W,k(e.fullName),1),C("p",{class:"organize",title:e.organize},k(e.organize),9,X)]),y(i(T),{class:"delete-btn",onClick:e=>{return l=a,void pe.value.splice(l,1);var l}},null,8,["onClick"])])])))),128)),pe.value.length?j("",!0):(m(),S(c,{key:0}))])),_:1})])])])])),_:1},8,["open","title"])],64)}}});export{Y as _};
