import{g as e}from"./order-aaf42b07.js";import{u as a}from"./useFlowForm-3cb03b53.js";import{d as t,r as l,ad as d,a0 as o,M as i,k as n,w as s,a7 as r,e as u,o as c,g as p,j as m,l as v,p as y,m as b,t as f,q as g,ae as _,aR as k,F as L,h,fi as x,a5 as j}from"./index-920db443.js";import{u as U}from"./index-143f5813.js";import{_ as M}from"./GoodsModal.vue_vue_type_script_setup_true_lang-2750eecd.js";import"./billRule-0363563b.js";import"./useWindowSizeFn-05f906e2.js";import"./log-2a5f2c26.js";import"./useTable-dc8c9d84.js";import"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import"./visualDev-8f54ab4b.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./index-9c138ba5.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./index-999abbee.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./config-06ca91cd.js";import"./upperFirst-2cd1a2f7.js";import"./useTabs-ceeccdba.js";import"./uniqBy-e868edd7.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";const I={class:"flow-form"},F={key:0,class:"required-sign"},C={key:0,class:"required-sign"},P=j(t({name:"SalesOrder",__name:"index",props:["config"],emits:["setPageLoad","eventReceiver"],setup(t,{expose:j,emit:P}){const N=t,w=P,[D,{openModal:R}]=U(),q=[{id:"现金",fullName:"现金"},{id:"转帐",fullName:"转帐"},{id:"汇票",fullName:"汇票"}],A=[{id:"快递",fullName:"快递"},{id:"物流",fullName:"物流"},{id:"配送",fullName:"配送"},{id:"自提",fullName:"自提"}],S=[{title:"商品名称",dataIndex:"goodsName",key:"goodsName"},{title:"规格型号",dataIndex:"specifications",key:"specifications",width:80},{title:"单位",dataIndex:"unit",key:"unit",width:80},{title:"数量",dataIndex:"qty",key:"qty",width:80},{title:"单价",dataIndex:"price",key:"price",width:80},{title:"金额",dataIndex:"amount",key:"amount",width:80},{title:"折扣%",dataIndex:"discount",key:"discount",width:90},{title:"税率%",dataIndex:"cess",key:"cess",width:90},{title:"实际单价",dataIndex:"actualPrice",key:"actualPrice",width:80},{title:"实际金额",dataIndex:"actualAmount",key:"actualAmount",width:80},{title:"备注",dataIndex:"description",key:"description",width:80}],E=[{title:"收款日期",dataIndex:"receivableDate",key:"receivableDate",width:200},{title:"收款比率%",dataIndex:"receivableRate",key:"receivableRate"},{title:"收款金额",dataIndex:"receivableMoney",key:"receivableMoney"},{title:"收款方式",dataIndex:"receivableMode",key:"receivableMode"},{title:"收款摘要",dataIndex:"abstract",key:"abstract"}],z=l([]),K=l(),O=d({dataForm:{id:"",customerName:"",salesmanId:"",orderDate:void 0,orderCode:"",paymentMode:"",receivableMoney:0,earnestRate:0,prepayEarnest:0,transportMode:"",deliveryDate:void 0,deliveryAddress:"",description:"",customerId:"",salesmanName:"",goodsList:[],collectionPlanList:[],fileJson:""},dataRule:{customerName:[{required:!0,message:"客户名称不能为空",trigger:"click"}],salesmanId:[{required:!0,message:"业务人员不能为空",trigger:"change"}],orderDate:[{required:!0,message:"订单日期不能为空",trigger:"change"}],paymentMode:[{required:!0,message:"付款方式不能为空",trigger:"change"}]},billEnCode:"OrderNumber",fileList:[],activeKey:"1"}),{dataForm:J,dataRule:$,fileList:Y,activeKey:H}=o(O),{init:B,judgeShow:G,judgeWrite:T,judgeRequired:W,dataFormSubmit:Q}=a({config:N.config,selfState:O,emit:w,formRef:K});j({dataFormSubmit:Q});const V={width:50,title:"序号",dataIndex:"index",key:"index",align:"center",customRender:({index:e})=>e+1},X=i((()=>{const e=N.config.disabled||T("goodsList")?null:{title:"操作",dataIndex:"action",key:"action",width:50},a=S.filter((e=>G(`goodsList-${e.key}`))),t=[V,...a];return e&&t.push(e),t})),Z=i((()=>{const e=[];return n(X).forEach(((a,t)=>{if(0===t)return e[t]="合计";if(1===t||2===t||11===t)return e[t]="";let l=O.dataForm.goodsList.reduce(((e,t)=>e+parseFloat(t[a.key])),0);l=Number.isNaN(l)?"":l,e[t]=l&&!Number.isInteger(l)?l.toFixed(2):l})),e})),ee=i((()=>{const e=N.config.disabled||T("collectionPlanList")?null:{title:"操作",dataIndex:"action",key:"action",width:50},a=E.filter((e=>G(`collectionPlanList-${e.key}`))),t=[V,...a];return e&&t.push(e),t})),ae=i((()=>{const e=[];return n(ee).forEach(((a,t)=>{if(0===t)return e[t]="合计";if(1===t||4===t||5===t)return e[t]="";let l=O.dataForm.collectionPlanList.reduce(((e,t)=>e+parseFloat(t[a.key])),0);l=Number.isNaN(l)?"":l,e[t]=l&&!Number.isInteger(l)?l.toFixed(2):l})),e}));function te(a){e(a).then((e=>{z.value=e.data.list.map((e=>({value:e.text,label:e.text,...e})))}))}function le(e,a){O.dataForm.customerId=a.id}function de(e,a){if(!e)return O.dataForm.salesmanName="";O.dataForm.salesmanName=a.fullName}function oe(e){for(let a=0;a<e.length;a++){const t=e[a];let l={goodsId:t.id,goodsCode:t.code,goodsName:t.text,specifications:t.specifications,unit:t.unit,qty:1,price:t.price,amount:t.price,discount:100,cess:0,actualPrice:t.price,actualAmount:t.price,description:""};O.dataForm.goodsList.push(l)}}function ie(){O.dataForm.collectionPlanList.push({receivableDate:void 0,receivableRate:0,receivableMoney:0,receivableMode:"",abstract:""})}function ne(e){e.amount=x(parseFloat(e.price)*parseFloat(e.qty));const a=e.price*(e.discount?e.discount/100:1);e.actualPrice=x(a*(1+(e.cess?e.cess/100:0))),e.actualAmount=x(parseFloat(e.actualPrice)*parseFloat(e.qty))}return s((()=>O.dataForm.goodsList),(e=>{let a=0;for(let t=0;t<e.length;t++){const l=e[t];a+=parseFloat(l.actualAmount)}O.dataForm.receivableMoney=a.toFixed(2)}),{deep:!0}),r((()=>{B(),te("")})),(e,a)=>{const l=u("a-auto-complete"),d=u("a-form-item"),o=u("a-col"),i=u("jnpf-user-select"),s=u("jnpf-date-picker"),r=u("a-input"),x=u("jnpf-select"),j=u("a-input-number"),U=u("jnpf-upload-file"),P=u("jnpf-textarea"),N=u("a-row"),w=u("a-form"),S=u("a-button"),E=u("a-table-summary-cell"),B=u("a-table-summary-row"),Q=u("a-table-summary"),V=u("a-table"),se=u("a-tab-pane"),re=u("a-tabs");return c(),p("div",I,[m(w,{colon:!1,labelCol:{style:{width:"90px"}},model:n(J),rules:n($),ref_key:"formRef",ref:K,disabled:t.config.disabled},{default:v((()=>[m(N,null,{default:v((()=>[n(G)("customerName")?(c(),y(o,{key:0,span:6},{default:v((()=>[m(d,{label:"客户名称",name:"customerName"},{default:v((()=>[m(l,{value:n(J).customerName,"onUpdate:value":a[0]||(a[0]=e=>n(J).customerName=e),options:z.value,placeholder:"请输入",onSelect:le,onSearch:te,disabled:n(T)("customerName")},{option:v((({text:e})=>[b(f(e),1)])),_:1},8,["value","options","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("salesmanId")?(c(),y(o,{key:1,span:6},{default:v((()=>[m(d,{label:"业务人员",name:"salesmanId"},{default:v((()=>[m(i,{value:n(J).salesmanId,"onUpdate:value":a[1]||(a[1]=e=>n(J).salesmanId=e),placeholder:"选择人员",onChange:de,disabled:n(T)("salesmanId")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("orderDate")?(c(),y(o,{key:2,span:6},{default:v((()=>[m(d,{label:"订单日期",name:"orderDate"},{default:v((()=>[m(s,{value:n(J).orderDate,"onUpdate:value":a[2]||(a[2]=e=>n(J).orderDate=e),format:"YYYY-MM-DD HH:mm:ss",placeholder:"选择日期",disabled:n(T)("orderDate")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("orderCode")?(c(),y(o,{key:3,span:6},{default:v((()=>[m(d,{label:"订单编码",name:"orderCode"},{default:v((()=>[m(r,{value:n(J).orderCode,"onUpdate:value":a[3]||(a[3]=e=>n(J).orderCode=e),placeholder:"订单编码",readonly:"",disabled:n(T)("orderCode")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("paymentMode")?(c(),y(o,{key:4,span:6},{default:v((()=>[m(d,{label:"付款方式",name:"paymentMode"},{default:v((()=>[m(x,{value:n(J).paymentMode,"onUpdate:value":a[4]||(a[4]=e=>n(J).paymentMode=e),options:q,placeholder:"选择付款方式",disabled:n(T)("paymentMode")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("receivableMoney")?(c(),y(o,{key:5,span:6},{default:v((()=>[m(d,{label:"付款金额",name:"receivableMoney"},{default:v((()=>[m(j,{value:n(J).receivableMoney,"onUpdate:value":a[5]||(a[5]=e=>n(J).receivableMoney=e),min:0,placeholder:"付款金额",disabled:n(T)("receivableMoney")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("earnestRate")?(c(),y(o,{key:6,span:6},{default:v((()=>[m(d,{label:"定金比率",name:"earnestRate"},{default:v((()=>[m(j,{value:n(J).earnestRate,"onUpdate:value":a[6]||(a[6]=e=>n(J).earnestRate=e),min:0,placeholder:"定金比率",disabled:n(T)("earnestRate")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("prepayEarnest")?(c(),y(o,{key:7,span:6},{default:v((()=>[m(d,{label:"预付定金",name:"prepayEarnest"},{default:v((()=>[m(j,{value:n(J).prepayEarnest,"onUpdate:value":a[7]||(a[7]=e=>n(J).prepayEarnest=e),min:0,placeholder:"预付定金",disabled:n(T)("prepayEarnest")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("transportMode")?(c(),y(o,{key:8,span:6},{default:v((()=>[m(d,{label:"运输方式",name:"transportMode"},{default:v((()=>[m(x,{value:n(J).transportMode,"onUpdate:value":a[8]||(a[8]=e=>n(J).transportMode=e),options:A,placeholder:"选择运输方式",disabled:n(T)("transportMode")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("deliveryDate")?(c(),y(o,{key:9,span:6},{default:v((()=>[m(d,{label:"发货日期",name:"deliveryDate"},{default:v((()=>[m(s,{value:n(J).deliveryDate,"onUpdate:value":a[9]||(a[9]=e=>n(J).deliveryDate=e),placeholder:"选择日期",disabled:n(T)("deliveryDate")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("deliveryAddress")?(c(),y(o,{key:10,span:12},{default:v((()=>[m(d,{label:"发货地址",name:"deliveryAddress"},{default:v((()=>[m(r,{value:n(J).deliveryAddress,"onUpdate:value":a[10]||(a[10]=e=>n(J).deliveryAddress=e),placeholder:"发货地址",disabled:n(T)("deliveryAddress")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("fileJson")?(c(),y(o,{key:11,span:24},{default:v((()=>[m(d,{label:"相关附件",name:"fileJson"},{default:v((()=>[m(U,{value:n(Y),"onUpdate:value":a[11]||(a[11]=e=>_(Y)?Y.value=e:null),type:"workFlow",disabled:n(T)("fileJson")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0),n(G)("description")?(c(),y(o,{key:12,span:24},{default:v((()=>[m(d,{label:"订单备注",name:"description"},{default:v((()=>[m(P,{value:n(J).description,"onUpdate:value":a[12]||(a[12]=e=>n(J).description=e),placeholder:"订单备注",disabled:n(T)("description")},null,8,["value","disabled"])])),_:1})])),_:1})):g("",!0)])),_:1})])),_:1},8,["model","rules","disabled"]),t.config.formOperates?(c(),y(re,{key:0,activeKey:n(H),"onUpdate:activeKey":a[14]||(a[14]=e=>_(H)?H.value=e:null),size:"small"},{default:v((()=>[m(se,{key:"1",tab:"订单商品"},{default:v((()=>[n(G)("goodsList")?(c(),y(V,{key:0,"data-source":n(J).goodsList,columns:X.value,size:"small",pagination:!1},k({headerCell:v((({column:e})=>[n(W)(`goodsList-${e.key}`)?(c(),p("span",F,"*")):g("",!0),b(f(e.title),1)])),bodyCell:v((({column:e,record:t,index:l})=>["unit"===e.key?(c(),y(r,{key:0,value:t.unit,"onUpdate:value":e=>t.unit=e,disabled:n(T)("goodsList")||n(T)("goodsList-unit")},null,8,["value","onUpdate:value","disabled"])):g("",!0),"qty"===e.key?(c(),y(j,{key:1,value:t.qty,"onUpdate:value":e=>t.qty=e,min:0,onChange:e=>ne(t),disabled:n(T)("goodsList")||n(T)("goodsList-qty")},null,8,["value","onUpdate:value","onChange","disabled"])):g("",!0),"price"===e.key?(c(),y(j,{key:2,value:t.price,"onUpdate:value":e=>t.price=e,onChange:e=>ne(t),disabled:n(T)("goodsList")||n(T)("goodsList-price")},null,8,["value","onUpdate:value","onChange","disabled"])):g("",!0),"amount"===e.key?(c(),y(j,{key:3,value:t.amount,"onUpdate:value":e=>t.amount=e,readonly:"",disabled:n(T)("goodsList")||n(T)("goodsList-amount")},null,8,["value","onUpdate:value","disabled"])):g("",!0),"discount"===e.key?(c(),y(j,{key:4,value:t.discount,"onUpdate:value":e=>t.discount=e,precision:2,step:.1,min:0,max:100,onChange:e=>ne(t),disabled:n(T)("goodsList")||n(T)("goodsList-discount")},null,8,["value","onUpdate:value","onChange","disabled"])):g("",!0),"cess"===e.key?(c(),y(j,{key:5,value:t.cess,"onUpdate:value":e=>t.cess=e,precision:2,step:.1,min:0,max:100,onChange:e=>ne(t),disabled:n(T)("goodsList")||n(T)("goodsList-cess")},null,8,["value","onUpdate:value","onChange","disabled"])):g("",!0),"actualPrice"===e.key?(c(),y(j,{key:6,value:t.actualPrice,"onUpdate:value":e=>t.actualPrice=e,readonly:"",disabled:n(T)("goodsList")||n(T)("goodsList-actualPrice")},null,8,["value","onUpdate:value","disabled"])):g("",!0),"actualAmount"===e.key?(c(),y(j,{key:7,value:t.actualAmount,"onUpdate:value":e=>t.actualAmount=e,readonly:"",disabled:n(T)("goodsList")||n(T)("goodsList-actualAmount")},null,8,["value","onUpdate:value","disabled"])):g("",!0),"description"===e.key?(c(),y(r,{key:8,value:t.description,"onUpdate:value":e=>t.description=e,disabled:n(T)("goodsList")||n(T)("goodsList-description")},null,8,["value","onUpdate:value","disabled"])):g("",!0),"action"===e.key?(c(),y(S,{key:9,class:"action-btn",type:"link",color:"error",onClick:e=>function(e){O.dataForm.goodsList.splice(e,1)}(l),size:"small"},{default:v((()=>a[15]||(a[15]=[b("删除")]))),_:2,__:[15]},1032,["onClick"])):g("",!0)])),_:2},[n(J).goodsList.length?{name:"summary",fn:v((()=>[m(Q,{fixed:""},{default:v((()=>[m(B,null,{default:v((()=>[(c(!0),p(L,null,h(Z.value,((e,a)=>(c(),y(E,{key:a,index:a},{default:v((()=>[b(f(e),1)])),_:2},1032,["index"])))),128))])),_:1})])),_:1})])),key:"0"}:void 0]),1032,["data-source","columns"])):g("",!0),t.config.disabled||n(T)("goodsList")?g("",!0):(c(),p("div",{key:1,class:"table-add-action",onClick:a[13]||(a[13]=e=>n(R)(!0,{}))},[m(S,{type:"link",preIcon:"icon-ym icon-ym-btn-add"},{default:v((()=>a[16]||(a[16]=[b("新增商品")]))),_:1,__:[16]})]))])),_:1}),m(se,{key:"2",tab:"收款计划"},{default:v((()=>[n(G)("collectionPlanList")?(c(),y(V,{key:0,"data-source":n(J).collectionPlanList,columns:ee.value,size:"small",pagination:!1},k({headerCell:v((({column:e})=>[n(W)(`collectionPlanList-${e.key}`)?(c(),p("span",C,"*")):g("",!0),b(f(e.title),1)])),bodyCell:v((({column:e,record:t,index:l})=>["receivableDate"===e.key?(c(),y(s,{key:0,value:t.receivableDate,"onUpdate:value":e=>t.receivableDate=e,disabled:n(T)("collectionPlanList")||n(T)("collectionPlanList-receivableDate")},null,8,["value","onUpdate:value","disabled"])):g("",!0),"receivableRate"===e.key?(c(),y(j,{key:1,value:t.receivableRate,"onUpdate:value":e=>t.receivableRate=e,precision:2,step:.1,min:0,max:100,onChange:e=>ne(t),disabled:n(T)("collectionPlanList")||n(T)("collectionPlanList-receivableRate")},null,8,["value","onUpdate:value","onChange","disabled"])):g("",!0),"receivableMoney"===e.key?(c(),y(j,{key:2,value:t.receivableMoney,"onUpdate:value":e=>t.receivableMoney=e,disabled:n(T)("collectionPlanList")||n(T)("collectionPlanList-receivableMoney")},null,8,["value","onUpdate:value","disabled"])):g("",!0),"receivableMode"===e.key?(c(),y(r,{key:3,value:t.receivableMode,"onUpdate:value":e=>t.receivableMode=e,disabled:n(T)("collectionPlanList")||n(T)("collectionPlanList-receivableMode")},null,8,["value","onUpdate:value","disabled"])):g("",!0),"abstract"===e.key?(c(),y(r,{key:4,value:t.abstract,"onUpdate:value":e=>t.abstract=e,disabled:n(T)("collectionPlanList")||n(T)("collectionPlanList-abstract")},null,8,["value","onUpdate:value","disabled"])):g("",!0),"action"===e.key?(c(),y(S,{key:5,class:"action-btn",type:"link",color:"error",onClick:e=>function(e){O.dataForm.collectionPlanList.splice(e,1)}(l),size:"small"},{default:v((()=>a[17]||(a[17]=[b("删除")]))),_:2,__:[17]},1032,["onClick"])):g("",!0)])),_:2},[n(J).collectionPlanList.length?{name:"summary",fn:v((()=>[m(Q,{fixed:""},{default:v((()=>[m(B,null,{default:v((()=>[(c(!0),p(L,null,h(ae.value,((e,a)=>(c(),y(E,{key:a,index:a},{default:v((()=>[b(f(e),1)])),_:2},1032,["index"])))),128))])),_:1})])),_:1})])),key:"0"}:void 0]),1032,["data-source","columns"])):g("",!0),t.config.disabled||n(T)("collectionPlanList")?g("",!0):(c(),p("div",{key:1,class:"table-add-action",onClick:ie},[m(S,{type:"link",preIcon:"icon-ym icon-ym-btn-add"},{default:v((()=>a[18]||(a[18]=[b("新增计划")]))),_:1,__:[18]})]))])),_:1})])),_:1},8,["activeKey"])):g("",!0),m(M,{onRegister:n(D),onSelect:oe},null,8,["onRegister"])])}}}),[["__scopeId","data-v-279d1362"]]);export{P as default};
