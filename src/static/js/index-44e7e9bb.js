import{g as e,d as t,r as s}from"./message-22b8b6a8.js";import{u as a,B as o}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{d as r,aB as n,u as i,ad as p,a0 as c,aD as l,M as d,w as m,a7 as u,e as y,o as _,g as f,a4 as g,j,k as w,l as v,F as b,h,p as k,ae as x,m as T,t as R,q as I,n as D,aE as C,ah as K}from"./index-920db443.js";import{u as S,B as F}from"./useTable-dc8c9d84.js";import{u as M}from"./index-143f5813.js";import B from"./Detail-4e2b49fe.js";import{_ as O}from"./Detail.vue_vue_type_script_setup_true_lang-645a467a.js";import{g as N}from"./schedule-74da51ff.js";import"./useTabs-ceeccdba.js";import"./upperFirst-2cd1a2f7.js";import"./log-2a5f2c26.js";import"./uniqBy-e868edd7.js";import"./visualDev-8f54ab4b.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./index-9c138ba5.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./index-999abbee.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./config-06ca91cd.js";import"./useWindowSizeFn-05f906e2.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";const P={class:"jnpf-content-wrapper message-record-wrapper"},A={class:"jnpf-content-wrapper-center"},J={class:"jnpf-content-wrapper-search-box"},L={class:"jnpf-content-wrapper-content bg-white"},Y=["title","onClick"],q=r({name:"messageRecord",__name:"index",setup(r){const q=n(),{createMessage:E,createConfirm:H}=K(),{t:U}=i(),z=p({activeKey:"0",keyword:"",messageType:[]}),{activeKey:G,messageType:Q}=c(z),W=l(),V=d((()=>({keyword:z.keyword,type:"0"==z.activeKey?"":z.activeKey}))),[X,{resetFields:Z}]=a({baseColProps:{span:6},showActionButtonGroup:!0,showAdvancedButton:!0,compact:!0,schemas:[{field:"keyword",label:U("common.keyword"),component:"Input",componentProps:{placeholder:U("common.enterKeyword"),submitOnPressEnter:!0}}]}),$=[{title:"消息标题",dataIndex:"title"},{title:"消息类型",dataIndex:"type",width:120},{title:"发送人员",dataIndex:"releaseUser",width:120},{title:"发送时间",dataIndex:"releaseTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"状态",dataIndex:"isRead",width:70}],[ee,{reload:te,getSelectRows:se,clearSelectedRowKeys:ae}]=S({api:e,rowSelection:{type:"checkbox"},clickToRowSelect:!1,immediate:!1}),[oe,{openModal:re}]=M(),[ne,{openModal:ie}]=M();function pe(e){z.keyword=e?.keyword||"",le()}function ce(){z.keyword="",le()}function le(){D((()=>{te({page:1})}))}function de(){const e=se();if(!e.length)return E.error(U("common.selectDataTip"));const s={ids:e.map((e=>e.id)).join(",")};H({iconType:"warning",title:U("common.tipTitle"),content:U("common.batchDelTip"),onOk:()=>{t(s).then((e=>{E.success(e.msg),ae(),te()}))}})}function me(e){const t=z.messageType.filter((t=>t.enCode==e))||[];return t.length?t[0].fullName:"公告"}return m((()=>z.activeKey),(()=>{Z()})),u((()=>{!async function(){const e=await W.getDictionaryData("msgSourceType")||[];z.messageType=[{id:"",fullName:"全部",enCode:""},...e]}(),z.activeKey=""})),(e,t)=>{const a=y("a-tab-pane"),r=y("a-tabs"),n=y("a-button"),i=y("a-tag");return _(),f("div",P,[g("div",A,[g("div",J,[j(w(o),{class:"search-form",onRegister:w(X),onSubmit:pe,onReset:ce},null,8,["onRegister"])]),g("div",L,[j(r,{activeKey:w(G),"onUpdate:activeKey":t[0]||(t[0]=e=>x(G)?G.value=e:null),class:"jnpf-content-wrapper-tabs",destroyInactiveTabPane:""},{default:v((()=>[(_(!0),f(b,null,h(w(Q),(e=>(_(),k(a,{key:e.enCode,tab:e.fullName},null,8,["tab"])))),128))])),_:1},8,["activeKey"]),j(w(F),{onRegister:w(ee),columns:$,searchInfo:V.value},{tableTitle:v((()=>[j(n,{type:"error",preIcon:"icon-ym icon-ym-btn-clearn",onClick:de},{default:v((()=>[T(R(w(U)("common.delText")),1)])),_:1})])),bodyCell:v((({column:e,record:t})=>["title"===e.key?(_(),f("a",{key:0,title:t.name,onClick:e=>{var a;s((a=t).id).then((e=>{if("0"==a.isRead&&(a.isRead="1"),4==a.type){let t=e.data.bodyText?JSON.parse(e.data.bodyText):{};if(3==t.type)return;N(t.groupId,t.id).then((()=>{ie(!0,{id:t.id,groupId:t.groupId})}))}else if(2==a.type&&2==a.flowType){const t=JSON.parse(e.data.bodyText);if(0==t.type)return;q.push("/profile?config="+t.type)}else if(1==a.type||3==a.type)re(!0,{id:a.id,type:1});else{if(!e.data.bodyText)return;q.push("/workFlowDetail?config="+encodeURIComponent(C(e.data.bodyText)))}}))}},R(t.title),9,Y)):I("",!0),"type"===e.key?(_(),f(b,{key:1},[T(R(me(t.type)),1)],64)):I("",!0),"isRead"===e.key?(_(),k(i,{key:2,color:1==t.isRead?"success":""},{default:v((()=>[T(R(1==t.isRead?"已读":"未读"),1)])),_:2},1032,["color"])):I("",!0)])),_:1},8,["onRegister","searchInfo"])])]),j(B,{onRegister:w(oe)},null,8,["onRegister"]),j(O,{onRegister:w(ne)},null,8,["onRegister"])])}}});export{q as default};
