import{b as e,B as a}from"./index-143f5813.js";import{u as t,B as r}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{di as o,d as l,ad as d,a0 as n,M as i,aD as s,u as p,h5 as u,h6 as c,fe as m,n as f,h7 as h,e as g,o as y,p as D,l as v,j as b,k as A,a4 as I,aR as F,m as N,V as k,h8 as _,h9 as R,ah as w}from"./index-920db443.js";import{v as T}from"./visualDev-8f54ab4b.js";import{b as x}from"./dataReport-8cd046d3.js";import{g as J}from"./portal-935b0b1b.js";import{j as C}from"./template-c6142676.js";const S={style:{flex:"1","margin-right":"10px"}},z=l({__name:"Form",emits:["register","reload"],setup(l,{emit:z}){const j=["#008cff","#35b8e0","#00cc88","#ff9d00","#ff4d4d","#5b69bc","#ff8acc","#3b3e47","#282828"],B=d({id:"",category:"",systemId:"",dataForm:{type:"",linkTarget:"",propertyJson:{moduleId:"",iconBackgroundColor:"",isTree:0}},featureWebData:[],dictionaryData:[],dataReportData:[],reportData:[],screenData:[],portalData:[],flowData:[],tempData:[],moduleIdKey:0}),{dataForm:P,tempData:W,moduleIdKey:U}=n(B),$=[{id:1,fullName:"目录"},{id:2,fullName:"页面"},{id:3,fullName:"表单"},{id:9,fullName:"流程"},{id:5,fullName:"报表(原)"},{id:8,fullName:"门户"},{id:7,fullName:"外链"}],q=[{id:1,fullName:"目录"},{id:2,fullName:"页面"},{id:3,fullName:"表单"},{id:9,fullName:"流程"},{id:4,fullName:"字典"},{id:10,fullName:"报表"},{id:5,fullName:"报表(原)"},{id:6,fullName:"大屏"},{id:8,fullName:"门户"},{id:7,fullName:"外链"}],M=[{field:"parentId",label:"上级",component:"TreeSelect",componentProps:{placeholder:"请选择",onChange:function(e){if("App"!==B.category)return;const a=ee();let t=[];"-1"===e?(t=$.filter((e=>1==e.id)),a.type&&1!=a.type&&H({type:""})):t=$;Z({field:"type",componentProps:{options:t}})}},rules:[{required:!0,message:"必填",trigger:"change"}]},{field:"fullName",label:"名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,message:"必填",trigger:"blur"}]},{field:"enCode",label:"编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,message:"必填",trigger:"blur"}]},{field:"icon",label:"图标",component:"Input",slot:"icon",componentProps:{placeholder:"请选择"},rules:[{required:!0,message:"必填",trigger:"change"}]},{field:"type",label:"类型",component:"Select",componentProps:{placeholder:"请选择",onChange:function(e){H({moduleId:""}),X(),B.moduleIdKey=+new Date;B.id&&(B.dataForm.urlAddress="",H({urlAddress:""}));[2,3,4,9].includes(e)?(B.dataForm.isButtonAuthorize=1,B.dataForm.isColumnAuthorize=1,B.dataForm.isFormAuthorize=1,B.dataForm.isDataAuthorize=1):(B.dataForm.isButtonAuthorize=0,B.dataForm.isColumnAuthorize=0,B.dataForm.isFormAuthorize=0,B.dataForm.isDataAuthorize=0);B.dataForm.linkTarget=6==e?"_blank":"_self";de(e),se(e)}},rules:[{required:!0,trigger:"change",message:"必填",type:"number"}]},{ifShow:({values:e})=>2==e.type||7==e.type,field:"urlAddress",label:"地址",component:"Input",slot:"urlAddress",componentProps:{placeholder:"请输入"},rules:[{required:!0,message:"必填",trigger:"blur"}]},{ifShow:({values:e})=>[3,4,5,6,8,9,10].indexOf(e.type)>-1,field:"moduleId",label:"关联",component:"TreeSelect",slot:"moduleId",rules:[{required:!0,message:"必填",trigger:"change"}]},{field:"sortCode",label:"排序",component:"InputNumber",defaultValue:0,componentProps:{min:"0",max:"999999",placeholder:"请输入"}},{field:"enabledMark",label:"状态",component:"Switch",defaultValue:1},{field:"description",label:"说明",component:"Textarea",componentProps:{rows:4,placeholder:"请输入"}}],O=i((()=>B.id?E("common.editText"):E("common.addText"))),V=z,{createMessage:K}=w(),L=s(),{t:E}=p(),[G,{setFieldsValue:H,validate:Q,clearValidate:X,resetFields:Y,updateSchema:Z,getFieldsValue:ee}]=t({labelWidth:80,schemas:M}),[ae,{closeModal:te,changeLoading:re,changeOkLoading:oe}]=e((function(e){Y(),B.id=e.id,B.category=e.category,B.systemId=e.systemId,B.featureWebData=[],B.dictionaryData=[],B.dataReportData=[],B.reportData=[],B.screenData=[],B.portalData=[],B.flowData=[],H({urlAddress:""}),Z({field:"type",componentProps:{options:"App"===B.category?$:q}}),function(e,a="0",t){c({category:e},a,t).then((e=>{let a={fullName:"顶级节点",hasChildren:!0,id:"-1",children:e.data.list};Z({field:"parentId",componentProps:{options:[a]}})}))}(B.category,B.id,B.systemId),e.parentId&&H({parentId:e.parentId});B.id&&(re(!0),u(B.id).then((e=>{const a=e.data,t=a.propertyJson?JSON.parse(a.propertyJson):null;a.propertyJson=t||{moduleId:"",iconBackgroundColor:""},a.moduleId=a.propertyJson.moduleId;const r=a.type;[2,3,4,9].includes(r)&&(a.isButtonAuthorize=1,a.isColumnAuthorize=1,a.isFormAuthorize=1,a.isDataAuthorize=1),a.oldUrlAddress=e.data.urlAddress,de(a.type),se(r),B.dataForm=a,H(a),re(!1)})))}));async function le(){const e=await Q();if(!e)return;oe(!0);const a=e.enCode.replace(".",""),t=e.moduleId;B.dataForm.propertyJson.moduleId=t,"Web"===B.category?(3!=e.type&&9!=e.type||(e.urlAddress=`model/${a}`),4==e.type&&(e.urlAddress=`dictionary/${a}`),5==e.type&&(e.urlAddress=`dataReport/${a}`),10==e.type&&(e.urlAddress=`report/${a}`),6==e.type&&(e.urlAddress=`dataScreen/${a}`),8==e.type&&(e.urlAddress=`portal/${a}`)):(3!=e.type&&9!=e.type||(e.urlAddress=`/pages/apply/dynamicModel/index?id=${t}`),5!=e.type&&10!=e.type&&8!=e.type||(e.urlAddress=a));const r={...B.dataForm,...e,systemId:B.systemId,category:B.category,propertyJson:JSON.stringify(B.dataForm.propertyJson),linkTarget:B.dataForm.linkTarget,id:B.id};(B.id?_:R)(r).then((e=>{K.success(e.msg),oe(!1),V("reload"),setTimeout((()=>{te()}),200)})).catch((()=>{oe(!1)}))}function de(e){Z([{field:"urlAddress",helpMessage:7===e?"地址以http://或https://为开头":""}])}function ne(e){if(4==ee().type){const a=ie(B.dictionaryData).filter((a=>a?.id===e));B.dataForm.propertyJson.isTree=a[0]?.isTree}}function ie(e,a=[]){return e.forEach((e=>{const{children:t}=e;if(t?.length)return a.push(e),ie(t,a);a.push(e)})),a}function se(e){3==e&&function(){if(!B.featureWebData.length)return void T({type:1,isRelease:1}).then((e=>{B.featureWebData=e.data.list,B.tempData=B.featureWebData}));B.tempData=B.featureWebData}(),4==e&&function(){if(!B.dictionaryData.length)return void m().then((e=>{B.dictionaryData=e.data.list,B.tempData=B.dictionaryData}));B.tempData=B.dictionaryData}(),5==e&&async function(){if(!B.dataReportData.length){const e=await L.getDictionaryData("businessType"),a=JSON.parse(JSON.stringify(e));return void x().then((e=>{let t=e.data.list;B.dataReportData=a,f((()=>{for(let e=0;e<B.dataReportData.length;e++){let a=t.filter((a=>B.dataReportData[e].id===a.categoryId));B.dataReportData[e].children=a,B.dataReportData[e].hasChildren=!!a?.length}B.dataReportData=B.dataReportData.filter((e=>e.children.length)),B.tempData=B.dataReportData}))}))}B.tempData=B.reportData}(),10==e&&async function(){if(!B.reportData.length)return void h().then((e=>{B.reportData=e.data.list,B.tempData=B.reportData}));B.tempData=B.reportData}(),6==e&&function(){if(!B.screenData.length)return void o.get({url:"/api/blade-visual/visual/Selector"}).then((e=>{B.screenData=e.data.list,B.tempData=B.screenData}));B.tempData=B.screenData}(),8==e&&function(){if(!B.portalData.length)return void J().then((e=>{B.portalData=e.data.list.filter((e=>e.children&&e.children.length)),B.tempData=B.portalData}));B.tempData=B.portalData}(),9==e&&function(){if(!B.flowData.length)return void C("2").then((e=>{B.flowData=e.data.list.filter((e=>e.children&&e.children.length)),B.tempData=B.flowData}));B.tempData=B.flowData}()}return(e,t)=>{const o=g("jnpf-icon-picker"),l=g("jnpf-color-picker"),d=g("a-form-item-rest"),n=g("a-row"),i=g("a-select-option"),s=g("a-select"),p=g("a-input"),u=g("JnpfTreeSelect");return y(),D(A(a),k(e.$attrs,{onRegister:A(ae),title:O.value,onOk:le,"destroy-on-close":""}),{default:v((()=>[b(A(r),{onRegister:A(G)},{icon:v((({model:e,field:a})=>[b(n,{type:"flex"},{default:v((()=>[I("div",S,[b(o,{value:e[a],"onUpdate:value":t=>e[a]=t,placeholder:"请选择"},null,8,["value","onUpdate:value"])]),b(d,null,{default:v((()=>[b(l,{value:A(P).propertyJson.iconBackgroundColor,"onUpdate:value":t[0]||(t[0]=e=>A(P).propertyJson.iconBackgroundColor=e),size:"small",predefine:j,name:"iconBackground"},null,8,["value"])])),_:1})])),_:2},1024)])),urlAddress:v((({model:e,field:a})=>[b(p,{value:e[a],"onUpdate:value":t=>e[a]=t,placeholder:"请输入"},F({_:2},["Web"===B.category&&2==e.type?{name:"addonBefore",fn:v((()=>[t[2]||(t[2]=N("@/views/"))])),key:"0"}:void 0,"Web"===B.category&&7==e.type?{name:"addonAfter",fn:v((()=>[b(s,{value:A(P).linkTarget,"onUpdate:value":t[1]||(t[1]=e=>A(P).linkTarget=e),style:{width:"80px"}},{default:v((()=>[b(i,{value:"_self"},{default:v((()=>t[3]||(t[3]=[N("_self")]))),_:1,__:[3]}),b(i,{value:"_blank"},{default:v((()=>t[4]||(t[4]=[N("_blank")]))),_:1,__:[4]})])),_:1},8,["value"])])),key:"1"}:void 0]),1032,["value","onUpdate:value"])])),moduleId:v((({model:e,field:a})=>[(y(),D(u,{value:e[a],"onUpdate:value":t=>e[a]=t,lastLevel:"",options:A(W),placeholder:"请选择关联",onChange:ne,key:A(U)},null,8,["value","onUpdate:value","options"]))])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"])}}});export{z as _};
