import{b as a,B as e}from"./index-143f5813.js";import{u as t,B as d}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{u as o}from"./authorize-05422727.js";import{d as s,ad as i,o as l,p as n,l as r,j as m,k as c,V as p,ah as u}from"./index-920db443.js";import{_ as b}from"./TableModal.vue_vue_type_script_setup_true_lang-b7bc8bbc.js";const g=s({__name:"Form",emits:["register","reload"],setup(s,{emit:g}){const k=i({moduleId:"",id:"",dataType:"",dataForm:{id:"",dbLinkId:"0",dataSelect:[]},dbOptions:[]}),h=[{field:"dbLinkId",label:"数据连接",component:"Select",defaultValue:"0",componentProps:{placeholder:"请选择",allowClear:!1,showSearch:!0,fieldNames:{options:"children"},onChange:function(a){k.dataForm.dbLinkId=a,S({dataSelect:[]}),y()}},rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"dataSelect",label:"数据选择",component:"Select",slot:"dataSelect",rules:[{required:!0,trigger:"change",message:"必填",type:"array"}]}],I=g,{createMessage:f}=u(),[L,{setFieldsValue:S,validate:F,resetFields:_,clearValidate:y,updateSchema:T}]=t({labelWidth:80,schemas:h}),[j,{closeModal:O,changeOkLoading:v}]=a((function(a){_(),k.id=a.id,k.moduleId=a.moduleId,k.dbOptions=a.dbOptions,T([{field:"dbLinkId",componentProps:{options:k.dbOptions}}]),k.dataType=a.dataType,a.dataList&&(k.dataForm.id=a.dataList.id||"",k.dataForm.dbLinkId=a.dataList.linkId||"0",k.dataForm.dataSelect=a.dataList.linkTables?a.dataList.linkTables.split(","):[],S({dbLinkId:k.dataForm.dbLinkId,dataSelect:k.dataForm.dataSelect}),y())}));async function w(){const a=await F();if(!a)return;v(!0);const e={moduleId:k.moduleId,linkId:a.dbLinkId,linkTables:k.dataForm.dataSelect.toString(),dataType:k.dataType,id:k.dataForm.id};o(e).then((a=>{f.success(a.msg),v(!1),O(),I("reload")})).catch((()=>{v(!1)}))}function x(a){k.dataForm.dataSelect=a,S({dataSelect:a}),a?.length&&y()}return(a,t)=>(l(),n(c(e),p(a.$attrs,{onRegister:c(j),title:"数据连接",showOkBtn:"",onOk:w}),{default:r((()=>[m(c(d),{onRegister:c(L)},{dataSelect:r((({model:a,field:e})=>[m(b,{dbLinkId:k.dataForm.dbLinkId,value:a[e],onChange:x},null,8,["dbLinkId","value"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister"]))}});export{g as _};
