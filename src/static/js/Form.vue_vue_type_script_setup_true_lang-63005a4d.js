import{d as e,ad as o,a0 as t,M as n,a7 as a,e as i,o as l,g as r,p as d,l as s,a4 as f,k as c,dp as u,bC as _,j as m,q as p,ae as g,af as v,aS as x,V as y,u as C,s as I,a6 as b,cd as h,r as k,dl as T,c as w,n as L,t as B,am as D,F as S,ah as F,co as j,cp as K}from"./index-920db443.js";import{d as A,u as M,e as O}from"./visualDev-8f54ab4b.js";import{c as P}from"./createAsyncComponent-7e8f72ac.js";import{u as R,B as z}from"./index-9c138ba5.js";import{u as V,B as E}from"./index-143f5813.js";import{u as U,B as H}from"./index-999abbee.js";import{_ as J}from"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";const N={class:"form-extra-panel-main"},W=e({__name:"index",props:{showLog:{type:Boolean,default:!1},modelId:{type:String,default:""},formDataId:{type:[String,Number],default:""}},setup(e){const I=e,b=o({isAdvanced:!0,activeKey:1,tooltipKey:+new Date}),{isAdvanced:h,activeKey:k,tooltipKey:T}=t(b),{t:w}=C(),L=n((()=>({...I})));function B(){b.isAdvanced=!b.isAdvanced,b.tooltipKey=+new Date}return a((()=>{b.activeKey=1})),(o,t)=>{const n=i("a-tooltip"),a=i("a-tab-pane"),C=i("a-tabs");return l(),r("div",{class:v(["form-extra-panel",{"form-extra-panel-unfold":!c(h)}])},[(l(),d(n,{placement:"left",title:c(h)?c(w)("component.form.fold"):c(w)("component.form.unfold"),key:c(T)},{default:s((()=>[f("div",{class:"trigger-btn",onClick:B},[c(h)?(l(),d(c(u),{key:0})):(l(),d(c(_),{key:1}))])])),_:1},8,["title"])),m(C,{activeKey:c(k),"onUpdate:activeKey":t[0]||(t[0]=e=>g(k)?k.value=e:null),tabBarGutter:10,size:"small",class:v(["average-tabs",{"average-tabs-single":e.showLog}])},{default:s((()=>[e.showLog?(l(),d(a,{key:1,tab:"修改记录"})):p("",!0)])),_:1},8,["activeKey","class"]),f("div",N,[1==c(k)?(l(),d(J,x(y({key:0},L.value)),null,16)):p("",!0)])],2)}}}),$={class:"text-16px font-medium"},G={class:"jnpf-common-form-wrapper"},q={class:"text-16px font-medium"},Q={key:0,class:"float-left mt-5px"},X={class:"flex justify-between items-center"},Y={class:"text-16px font-medium"},Z={key:0,class:"float-left mt-5px"},ee={class:"p-10px"},oe=e({__name:"Form",emits:["reload"],setup(e,{expose:a,emit:u}){const _=u,v=I("getLeftTreeActiveInfo",null),x=b(),J=h(),{createMessage:N}=F(),{t:oe}=C(),[te,{openPopup:ne,setPopupProps:ae}]=R(),[ie,{openModal:le,setModalProps:re}]=V(),[de,{openDrawer:se,setDrawerProps:fe}]=U(),ce=k(null),ue=o({formConf:{},defaultFormConf:{},formData:{},config:{},loading:!0,prevBtnLoading:!1,nextBtnLoading:!1,key:+new Date,dataForm:{id:"",data:""},formOperates:[],title:"",continueText:"",allList:[],currIndex:0,isContinue:!1,submitType:0,showContinueBtn:!0}),{title:_e,formConf:me,key:pe,loading:ge,continueText:ve,showContinueBtn:xe,submitType:ye}=t(ue),Ce=P((()=>T((()=>import("./Parser-2e1eddb1.js")),["static/js/Parser-2e1eddb1.js","static/js/Parser.vue_vue_type_script_lang-80b37b11.js","static/js/index-920db443.js","static/css/index-648461a4.css","static/js/config-06ca91cd.js","static/js/componentMap-c91676b4.js","static/js/visualDev-8f54ab4b.js","static/js/index.vue_vue_type_script_setup_true_lang-69353133.js","static/js/index-9c138ba5.js","static/js/ArrowLeftOutlined-3fbf15bc.js","static/js/log-2a5f2c26.js","static/css/index-01bda6b6.css","static/js/index-143f5813.js","static/js/useWindowSizeFn-05f906e2.js","static/css/index-e7d3e030.css","static/js/index-999abbee.js","static/css/index-cddfced7.css","static/js/Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js","static/js/Item.vue_vue_type_script_setup_true_lang-fef56f78.js","static/js/jquery-6353a699.js","static/js/useDefineSetting-7df030ff.js","static/js/CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js","static/js/createAsyncComponent-7e8f72ac.js","static/css/index-c2afac83.css","static/js/upperFirst-2cd1a2f7.js","static/css/componentMap-489cc2b1.css","static/js/DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js","static/js/index-0be8277c.js","static/css/DataLogList-12ff8c0e.css"]))),Ie=n((()=>0===ue.currIndex)),be=n((()=>ue.currIndex===ue.allList.length-1)),he=n((()=>ue.config.id&&ue.config.showMoreBtn&&ue.formConf.hasConfirmAndAddBtn)),ke=n((()=>(ue.formConf.confirmButtonTextI18nCode?oe(ue.formConf.confirmButtonTextI18nCode,ue.formConf.confirmButtonText):ue.formConf.confirmButtonText)||oe("common.okText"))),Te=n((()=>(ue.formConf.cancelButtonTextI18nCode?oe(ue.formConf.cancelButtonTextI18nCode,ue.formConf.cancelButtonText):ue.formConf.cancelButtonText)||oe("common.cancelText"))),we=n((()=>({showLog:ue.formConf.dataLog,modelId:ue.config.modelId,formDataId:ue.config.id})));function Le(){if(Pe(!0),ue.loading=!0,ue.config.id){const e={modelId:ue.config.modelId,id:ue.config.id,type:2};J.setDynamicModelExtra(e),Be(ue.config.id)}else J.setDynamicModelExtra({}),ue.formData={},De(!0)}function Be(e){A(ue.config.modelId,e,ue.config.menuId).then((e=>{ue.dataForm=e.data||{},ue.dataForm.data&&(ue.formData={...JSON.parse(ue.dataForm.data),id:ue.dataForm.id},De())}))}function De(e=!1){e&&v&&(ue.formData={...v()||{}}),ue.formConf=w(ue.defaultFormConf),function(e,o,t){const n=x.getUserInfo,a=new Date,i=(e,l)=>{for(let r=0;r<e.length;r++){let d=e[r];if(d.__vModel__){let e=o.hasOwnProperty(d.__vModel__)?o[d.__vModel__]:d.__config__.defaultValue;if(d.__config__.isSubTable||(d.__config__.defaultValue=e),(t||d.__config__.isSubTable)&&d.__config__.defaultCurrent&&("datePicker"===d.__config__.jnpfKey&&(d.__config__.defaultValue=j(a).startOf(K(d.format)).valueOf()),"timePicker"===d.__config__.jnpfKey&&(d.__config__.defaultValue=j(a).format(d.format||"HH:mm:ss")),"organizeSelect"===d.__config__.jnpfKey&&n.organizeIdList?.length&&(d.__config__.defaultValue=d.multiple?[n.organizeIdList]:n.organizeIdList),"depSelect"===d.__config__.jnpfKey&&n.departmentId&&(d.__config__.defaultValue=d.multiple?[n.departmentId]:n.departmentId),"userSelect"===d.__config__.jnpfKey&&n.userId&&(d.__config__.defaultValue=d.multiple?[n.userId]:n.userId),"usersSelect"===d.__config__.jnpfKey&&n.userId&&(d.__config__.defaultValue=d.multiple?[n.userId+"--user"]:n.userId+"--user"),"posSelect"===d.__config__.jnpfKey&&n.positionIds?.length&&(d.__config__.defaultValue=d.multiple?n.positionIds.map((e=>e.id)):n.positionIds[0].id),"roleSelect"===d.__config__.jnpfKey&&n.roleIds?.length&&(d.__config__.defaultValue=d.multiple?n.roleIds:n.roleIds[0]),"groupSelect"===d.__config__.jnpfKey&&n.groupIds?.length&&(d.__config__.defaultValue=d.multiple?n.groupIds:n.groupIds[0]),"sign"===d.__config__.jnpfKey&&n.signImg&&(d.__config__.defaultValue=n.signImg)),t&&!d.__config__.isSubTable&&o.hasOwnProperty(d.__vModel__)&&(d.__config__.defaultValue=o[d.__vModel__]),!ue.config.isPreview&&!ue.config.isDataManage&&ue.config.useFormPermission){let e=d.__config__.isSubTable?l.__vModel__+"-"+d.__vModel__:d.__vModel__,o=!0;ue.formOperates&&ue.formOperates.length&&(o=!ue.formOperates.some((o=>o.enCode===e))),o=d.__config__.noShow?d.__config__.noShow:o,d.__config__.noShow=o}}d.__config__&&d.__config__.children&&Array.isArray(d.__config__.children)&&i(d.__config__.children,d)}};i(e.fields),e.formData=o}(ue.formConf,ue.formData,e),L((()=>{ue.key=+new Date,ue.loading=!1,ue.prevBtnLoading=!1,ue.nextBtnLoading=!1,Pe(!1)}))}function Se(e,o){if(!e)return;Oe({confirmLoading:!0});const t={...ue.formData,...e};ue.dataForm.data=JSON.stringify(t);(ue.dataForm.id?M:O)(ue.config.modelId,{...ue.dataForm,menuId:ue.config.menuId}).then((e=>{N.success(e.msg),o&&"function"==typeof o&&o(),Oe({confirmLoading:!1}),1==ue.submitType?(Le(),ue.isContinue=!0):(Oe({open:!1}),_("reload"))})).catch((()=>{Oe({confirmLoading:!1})}))}function Fe(){if(ue.config.isPreview)return N.warning("功能预览不支持数据保存");Me().handleSubmit()}function je(){ue.currIndex--,Ae()}function Ke(){ue.currIndex++,Ae()}function Ae(){Pe(!0),ue.loading=!0,Me().handleReset(),ue.config.id=ue.allList[ue.currIndex].id,Be(ue.config.id)}function Me(){const e=c(ce);if(!e)throw new Error("parser is null!");return e}function Oe(e){return"fullScreen"===ue.formConf.popupType?ae(e):"drawer"===ue.formConf.popupType?fe(e):void re(e)}function Pe(e){Oe({loading:e})}async function Re(){return ue.isContinue&&_("reload"),!0}return a({init:function(e){ue.loading=!0,ue.submitType=0,ue.isContinue=!1,ue.prevBtnLoading=!1,ue.nextBtnLoading=!1,ue.title=e.id&&"jnpfAdd"!==e.id?oe("common.editText"):oe("common.add2Text"),ue.continueText=e.id?oe("common.continueText"):oe("common.continueAndAddText"),ue.config=e,ue.defaultFormConf=w(e.formConf),ue.formConf=w(ue.defaultFormConf),ue.showContinueBtn=!e.formData&&ue.formConf.hasConfirmAndAddBtn,ue.dataForm.id=e.id&&"jnpfAdd"!==e.id?e.id:"",function(){if(ue.config.isPreview||ue.config.isDataManage||!ue.config.useFormPermission)return;const e=x.getPermissionList,o=ue.config.menuId,t=e.filter((e=>e.modelId===o));ue.formOperates=t[0]&&t[0].form?t[0].form:[]}(),function(){if("fullScreen"===ue.formConf.popupType)return ne();if("drawer"===ue.formConf.popupType)return se();le()}(),ue.allList=e.allList,ue.currIndex=ue.allList.length&&e.id?ue.allList.findIndex((o=>o.id===e.id)):0,L((()=>{if(!e.formData)return setTimeout(Le,0);setTimeout((()=>{ue.formData={...e.formData,id:ue.dataForm.id},De()}),0)}))}}),(e,o)=>{const t=i("a-button"),n=i("a-tooltip"),a=i("a-space-compact"),u=i("a-space"),_=i("JnpfCheckboxSingle");return l(),r(S,null,[m(c(z),y(e.$attrs,{onRegister:c(te),showOkBtn:"",okText:ke.value,cancelText:Te.value,destroyOnClose:"",onOk:Fe,closeFunc:Re,class:"full-popup"}),{title:s((()=>[m(u,{size:10},{default:s((()=>[f("div",$,B(c(_e)),1),he.value?(l(),d(a,{key:0,size:"small",block:""},{default:s((()=>[m(n,{title:c(oe)("common.prevRecord")},{default:s((()=>[m(t,{size:"small",loading:ue.prevBtnLoading,disabled:Ie.value,onClick:je},{default:s((()=>o[3]||(o[3]=[f("i",{class:"icon-ym icon-ym-caret-left text-10px"},null,-1)]))),_:1,__:[3]},8,["loading","disabled"])])),_:1},8,["title"]),m(n,{title:c(oe)("common.nextRecord")},{default:s((()=>[m(t,{size:"small",loading:ue.nextBtnLoading,disabled:be.value,onClick:Ke},{default:s((()=>o[4]||(o[4]=[f("i",{class:"icon-ym icon-ym-caret-right text-10px"},null,-1)]))),_:1,__:[4]},8,["loading","disabled"])])),_:1},8,["title"])])),_:1})):p("",!0)])),_:1})])),insertToolbar:s((()=>[c(xe)?(l(),d(_,{key:0,value:c(ye),"onUpdate:value":o[0]||(o[0]=e=>g(ye)?ye.value=e:null),label:c(ve)},null,8,["value","label"])):p("",!0)])),default:s((()=>[f("div",G,[f("div",{class:"jnpf-common-form-wrapper__main p-10px",style:D({margin:"0 auto",width:c(me).fullScreenWidth||"100%"})},[c(ge)?p("",!0):(l(),d(c(Ce),{ref_key:"parserRef",ref:ce,formConf:c(me),onSubmit:Se,key:c(pe)},null,8,["formConf"]))],4),ue.dataForm.id&&c(me).dataLog&&!c(ge)?(l(),d(W,y({key:0},we.value,{key:c(pe)}),null,16)):p("",!0)])])),_:1},16,["onRegister","okText","cancelText"]),m(c(E),y(e.$attrs,{onRegister:c(ie),width:c(me).generalWidth,minHeight:100,okText:ke.value,cancelText:Te.value,onOk:Fe,closeFunc:Re}),{title:s((()=>[m(u,{size:10},{default:s((()=>[f("div",q,B(c(_e)),1),he.value?(l(),d(a,{key:0,size:"small",block:""},{default:s((()=>[m(n,{title:c(oe)("common.prevRecord")},{default:s((()=>[m(t,{size:"small",loading:ue.prevBtnLoading,disabled:Ie.value,onClick:je},{default:s((()=>o[5]||(o[5]=[f("i",{class:"icon-ym icon-ym-caret-left text-10px"},null,-1)]))),_:1,__:[5]},8,["loading","disabled"])])),_:1},8,["title"]),m(n,{title:c(oe)("common.nextRecord")},{default:s((()=>[m(t,{size:"small",loading:ue.nextBtnLoading,disabled:be.value,onClick:Ke},{default:s((()=>o[6]||(o[6]=[f("i",{class:"icon-ym icon-ym-caret-right text-10px"},null,-1)]))),_:1,__:[6]},8,["loading","disabled"])])),_:1},8,["title"])])),_:1})):p("",!0)])),_:1})])),insertFooter:s((()=>[c(xe)?(l(),r("div",Q,[m(_,{value:c(ye),"onUpdate:value":o[1]||(o[1]=e=>g(ye)?ye.value=e:null),label:c(ve)},null,8,["value","label"])])):p("",!0)])),default:s((()=>[c(ge)?p("",!0):(l(),d(c(Ce),{ref_key:"parserRef",ref:ce,formConf:c(me),onSubmit:Se,key:c(pe)},null,8,["formConf"]))])),_:1},16,["onRegister","width","okText","cancelText"]),m(c(H),y(e.$attrs,{onRegister:c(de),width:c(me).drawerWidth,showFooter:"",okText:ke.value,cancelText:Te.value,onOk:Fe,closeFunc:Re}),{title:s((()=>[f("div",X,[f("div",Y,B(c(_e)),1),he.value?(l(),d(a,{key:0,size:"small"},{default:s((()=>[m(n,{title:c(oe)("common.prevRecord")},{default:s((()=>[m(t,{size:"small",loading:ue.prevBtnLoading,disabled:Ie.value,onClick:je},{default:s((()=>o[7]||(o[7]=[f("i",{class:"icon-ym icon-ym-caret-left text-10px"},null,-1)]))),_:1,__:[7]},8,["loading","disabled"])])),_:1},8,["title"]),m(n,{title:c(oe)("common.nextRecord")},{default:s((()=>[m(t,{size:"small",loading:ue.nextBtnLoading,disabled:be.value,onClick:Ke},{default:s((()=>o[8]||(o[8]=[f("i",{class:"icon-ym icon-ym-caret-right text-10px"},null,-1)]))),_:1,__:[8]},8,["loading","disabled"])])),_:1},8,["title"])])),_:1})):p("",!0)])])),insertFooter:s((()=>[c(xe)?(l(),r("div",Z,[m(_,{value:c(ye),"onUpdate:value":o[2]||(o[2]=e=>g(ye)?ye.value=e:null),label:c(ve)},null,8,["value","label"])])):p("",!0)])),default:s((()=>[f("div",ee,[c(ge)?p("",!0):(l(),d(c(Ce),{ref_key:"parserRef",ref:ce,formConf:c(me),onSubmit:Se,key:c(pe)},null,8,["formConf"]))])])),_:1},16,["onRegister","width","okText","cancelText"])],64)}}});export{W as _,oe as a};
