import{b as e,B as a}from"./index-143f5813.js";import{u as l,B as t}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{g as o,u as n,c as s}from"./columnAuthorize-1d4eafbb.js";import{d,ad as i,a0 as r,M as u,u as p,e as m,o as c,p as f,l as b,j as h,k as g,m as T,t as y,q as v,V as _,ah as I}from"./index-920db443.js";import{g as k}from"./authorize-05422727.js";import{_ as x}from"./FieldModal.vue_vue_type_script_setup_true_lang-f57eee1d.js";const R=d({__name:"Form",emits:["register","reload"],setup(d,{emit:R}){const j=i({moduleId:"",id:"",menuType:0,dataType:0,treeData:[],fieldRuleOptions:[{value:0,label:"主表规则"},{value:1,label:"副表规则"},{value:2,label:"子表规则"}]}),{fieldRuleOptions:w,treeData:C,menuType:M,dataType:P}=r(j),D=u((()=>j.id?q("common.editText"):q("common.addText"))),F=R,{createMessage:V}=I(),{t:q}=p(),[B,{setFieldsValue:O,validate:N,resetFields:S,clearValidate:L}]=l({labelWidth:100,schemas:[{field:"enCode",label:"字段名称",component:"Input",slot:"enCode",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"change",message:"必填"}]},{ifShow:({values:e})=>e.bindTable,field:"bindTable",label:"数据库表",component:"Input",componentProps:{placeholder:"请输入",disabled:!0}},{field:"fieldRule",label:"字段规则",component:"Select",slot:"fieldRule",defaultValue:0,componentProps:{placeholder:"请选择"},rules:[{required:!0,trigger:"blur",message:"必填",type:"number"}]},{ifShow:({values:e})=>2===e.fieldRule,field:"childTableKey",label:"子表控件名",component:"Input",componentProps:{placeholder:"请输入"},helpMessage:"输入表单设计内设计子表的控件字段名，例：tableField107",rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"fullName",label:"字段说明",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"sortCode",label:"排序",component:"InputNumber",defaultValue:0,componentProps:{min:"0",max:"999999",placeholder:"请输入"}},{field:"enabledMark",label:"状态",component:"Switch",defaultValue:1},{field:"description",label:"备注",component:"Textarea",componentProps:{rows:3,placeholder:"请输入"}}]}),[z,{closeModal:K,changeLoading:U,changeOkLoading:$}]=e((function(e){S(),j.id=e.id,j.moduleId=e.moduleId,j.menuType=e.type,j.dataType=e.dataType,U(!0),k(j.moduleId,1).then((e=>{let a=[];for(const l in e?.data?.linkTables){const t={tableName:e.data.linkTables[l],dbLink:e.data.linkId};a.push(t)}j.treeData=a,U(!1)})).then((()=>{U(!1)})),j.id&&(U(!0),o(j.id).then((e=>{const a=e.data;O(a),U(!1)})).then((()=>{U(!1)})))}));async function A(){const e=await N();if(!e)return;$(!0);const a={...e,moduleId:j.moduleId,id:j.id};(j.id?n:s)(a).then((e=>{V.success(e.msg),$(!1),K(),F("reload")})).catch((()=>{$(!1)}))}function E(e,a,l){O({enCode:e||""}),a&&O({bindTable:a}),l&&O({fullName:l}),e&&L()}function H(){O({childTableKey:""})}return(e,l)=>{const o=m("BasicHelp"),n=m("a-select");return c(),f(g(a),_(e.$attrs,{onRegister:g(z),title:D.value,showOkBtn:"",onOk:A}),{default:b((()=>[h(g(t),{onRegister:g(B)},{enCode:b((({model:e,field:a})=>[h(x,{value:e[a],onChange:E,treeData:g(C),menuType:g(M),dataType:g(P)},null,8,["value","treeData","menuType","dataType"])])),fieldRule:b((({model:e,field:a})=>[h(n,{value:e[a],"onUpdate:value":l=>e[a]=l,options:g(w),placeholder:"请选择字段规则",onChange:H},{option:b((({value:e,label:a})=>[T(y(a),1),0!=e?(c(),f(o,{key:0,text:`与主表是一对${1==e?"一":"多"}的主从关系`},null,8,["text"])):v("",!0)])),_:2},1032,["value","onUpdate:value","options"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"])}}});export{R as _};
