import{d as e,u as l,e as a,o as t,g as o,j as n,l as i,p as r,q as s,F as u,m as d,k as c,a4 as _,t as m,ah as p,aP as f,ad as h,a0 as F,c as y,V as g,eg as w,n as v}from"./index-920db443.js";import{b}from"./define-8efdf20f.js";import{s as k,d as C}from"./config-06ca91cd.js";import{f as x}from"./template-c6142676.js";import{_ as N}from"./FlowModal.vue_vue_type_script_setup_true_lang-b2e7f9ad.js";import{a as U}from"./InitiatorUserSelect.vue_vue_type_script_setup_true_lang-dfa9afb0.js";import{b as I,B as L}from"./index-143f5813.js";const T={key:0,class:"mt-6px"},j=e({__name:"LaunchFlowCfg",props:{dataForm:{type:Object,default:()=>{}},allFormFieldsOptions:{type:Array,default:()=>[]}},setup(e){const h=e,{t:F}=l(),{createMessage:y}=p(),g=[{width:50,title:"序号",align:"center",customRender:({index:e})=>e+1},{title:"目标表单值",dataIndex:"targetField",key:"targetField",width:200},{title:"的值设为",dataIndex:"tips",key:"tips",align:"center",width:80},{title:"类型",dataIndex:"sourceType",key:"sourceType",width:100},{title:"值",dataIndex:"sourceValue",key:"sourceValue",width:200},{title:"操作",dataIndex:"action",key:"action",width:50}];function w(e,l){if(!e)return h.dataForm.launchFlow.flowName="",h.dataForm.launchFlow.flowId="",h.dataForm.launchFlow.formFieldList=[],h.dataForm.launchFlow.transferList=[],h.dataForm.launchFlow.initiator=[],void(h.dataForm.launchFlow.launchPermission=1);h.dataForm.launchFlow.flowName=l.fullName,h.dataForm.launchFlow.flowId=e,h.dataForm.launchFlow.transferList=[],h.dataForm.launchFlow.initiator=[],h.dataForm.launchFlow.launchPermission=l.visibleType||1,function(e){if(!e)return;x(e).then((e=>{let{type:l=1,formData:a}=e.data,t={},o=[];a&&(t=JSON.parse(a)),o=2==l?function(e){const l=e.map((e=>({__config__:{label:e.filedName,jnpfKey:e.jnpfKey||"",required:e.required||!1},__vModel__:e.filedId,multiple:e.multiple||!1})));return l}(t):t.fields;let n=function(e){let l=[];const a=(e,t)=>{if(e){if(e.__vModel__){const a=t&&t.__config__&&"table"===t.__config__.jnpfKey,o={id:a?t.__vModel__+"-"+e.__vModel__:e.__vModel__,fullName:a?t.__config__.label+"-"+e.__config__.label:e.__config__.label,...f(e,["__config__","on","style","templateJson","addTableConf","tableConf","disabled"]),__vModel__:a?t.__vModel__+"-"+e.__vModel__:e.__vModel__,__config__:{label:a?t.__config__.label+"-"+e.__config__.label:e.__config__.label,...e.__config__}},n=o.__config__;C.includes(n.jnpfKey)&&"static"!==n.dataType&&delete o.options,l.push(o)}Array.isArray(e)&&e.forEach((e=>a(e,t))),e.__config__&&e.__config__.children&&Array.isArray(e.__config__.children)&&a(e.__config__.children,e)}};return a(e),l}(o);h.dataForm.launchFlow.formFieldList=n.map((e=>({...e,label:e.fullName?e.id+"("+e.fullName+")":e.id}))),function(){const e=h.dataForm.launchFlow.formFieldList;let l=[];for(let a=0;a<e.length;a++)e[a].__config__?.required&&l.push({targetField:e[a].id,targetFieldLabel:e[a].fullName,sourceType:1,sourceValue:"",required:!0});h.dataForm.launchFlow.transferList=l}()}))}(e)}function v(e){let l=[];for(let a=0;a<h.dataForm.launchFlow.transferList.length;a++){const t=h.dataForm.launchFlow.transferList[a];t.targetField&&e!==a&&l.push(t.targetField)}return h.dataForm.launchFlow.formFieldList.filter((e=>!l.includes(e.id)&&!["table",...k].includes(e?.__config__?.jnpfKey)))}return(l,p)=>{const f=a("a-form-item"),k=a("jnpf-select"),C=a("a-input"),x=a("a-button"),I=a("a-table"),L=a("BasicHelp"),j=a("JnpfCheckboxSingle"),M=a("jnpf-users-select");return t(),o(u,null,[n(f,{label:"选择流程",name:["launchFlow","flowId"],rules:[{required:!0,message:"必填",trigger:"change"}]},{default:i((()=>[n(N,{value:e.dataForm.launchFlow.flowId,title:e.dataForm.launchFlow.flowName,onChange:w,allowClear:!1},null,8,["value","title"])])),_:1}),n(f,{label:"字段设置",style:{"margin-bottom":"0"}}),n(I,{"data-source":e.dataForm.launchFlow?.transferList,columns:g,size:"small",pagination:!1},{bodyCell:i((({column:e,record:l,index:a})=>{return["targetField"===e.key?(t(),r(k,{key:0,class:"!w-190px",value:l.targetField,"onUpdate:value":e=>l.targetField=e,options:v(a),showSearch:"",allowClear:"",disabled:l.required,fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options","disabled"])):s("",!0),"tips"===e.key?(t(),o(u,{key:1},[d("的值设为")],64)):s("",!0),"sourceType"===e.key?(t(),r(k,{key:2,value:l.sourceType,"onUpdate:value":e=>l.sourceType=e,options:c(b),onChange:e=>l.sourceValue=""},null,8,["value","onUpdate:value","options","onChange"])):s("",!0),"sourceValue"===e.key?(t(),o(u,{key:3},[1===l.sourceType?(t(),r(k,{key:0,class:"!w-190px",value:l.sourceValue,"onUpdate:value":e=>l.sourceValue=e,options:(n=l,n.targetField?n.targetField.includes("-")?h.allFormFieldsOptions:h.allFormFieldsOptions.filter((e=>!e?.__config__?.isSubTable)):[]),placeholder:"数据源字段",showSearch:"",allowClear:"",fieldNames:{options:"options1"}},null,8,["value","onUpdate:value","options"])):s("",!0),2===l.sourceType?(t(),r(C,{key:1,value:l.sourceValue,"onUpdate:value":e=>l.sourceValue=e,placeholder:"请输入",allowClear:""},null,8,["value","onUpdate:value"])):s("",!0)],64)):s("",!0),"action"===e.key?(t(),r(x,{key:4,class:"action-btn",type:"link",color:"error",onClick:e=>function(e){h.dataForm.launchFlow.transferList.splice(e,1)}(a),size:"small",disabled:l.required},{default:i((()=>p[6]||(p[6]=[d("删除")]))),_:2,__:[6]},1032,["onClick","disabled"])):s("",!0)];var n})),emptyText:i((()=>p[7]||(p[7]=[_("p",{class:"leading-60px"},"暂无数据",-1)]))),_:1},8,["data-source"]),_("div",{class:"table-add-action mb-20px",onClick:p[0]||(p[0]=e=>{h.dataForm.launchFlow.transferList.push({targetField:"",targetFieldLabel:"",sourceType:1,sourceValue:"",required:!1})})},[n(x,{type:"link",preIcon:"icon-ym icon-ym-btn-add"},{default:i((()=>[d(m(c(F)("common.add2Text")),1)])),_:1})]),n(f,null,{label:i((()=>[p[8]||(p[8]=d("发起人")),n(L,{text:"多个审批人时产生多条流程实例"})])),default:i((()=>[n(j,{class:"leading-32px",label:"当前用户",value:e.dataForm.launchFlow.currentUser,"onUpdate:value":p[1]||(p[1]=l=>e.dataForm.launchFlow.currentUser=l)},null,8,["value"]),p[10]||(p[10]=_("br",null,null,-1)),n(j,{class:"leading-32px",label:"自定义",value:e.dataForm.launchFlow.customUser,"onUpdate:value":p[2]||(p[2]=l=>e.dataForm.launchFlow.customUser=l)},null,8,["value"]),e.dataForm.launchFlow.customUser?(t(),o("div",T,[e.dataForm.launchFlow.flowId?(t(),o(u,{key:1},[2==e.dataForm.launchFlow.launchPermission?(t(),r(U,{key:0,value:e.dataForm.launchFlow.initiator,"onUpdate:value":p[4]||(p[4]=l=>e.dataForm.launchFlow.initiator=l),flowId:e.dataForm.launchFlow.flowId,buttonType:"button",multiple:""},null,8,["value","flowId"])):(t(),r(M,{key:1,value:e.dataForm.launchFlow.initiator,"onUpdate:value":p[5]||(p[5]=l=>e.dataForm.launchFlow.initiator=l),buttonType:"button",modalTitle:"添加发起人",multiple:""},null,8,["value"]))],64)):(t(),r(x,{key:0,preIcon:"icon-ym icon-ym-btn-add",onClick:p[3]||(p[3]=e=>c(y).error("请选择流程"))},{default:i((()=>p[9]||(p[9]=[d("添加发起人")]))),_:1,__:[9]}))])):s("",!0)])),_:1,__:[10]})],64)}}}),M=e({__name:"ComplexHeaderModal",emits:["register","confirm"],setup(e,{emit:l}){const o=h({list:[],childColumnsList:[]}),{list:u}=F(o),m=[{fullName:"左对齐",id:"left"},{fullName:"居中对齐",id:"center"},{fullName:"右对齐",id:"right"}],p=l,[f,{closeModal:b}]=I((function(e){o.list=y(e.list),o.childColumnsList=y(e.columnOptions).map((e=>({...e,disabled:!1})))})),k=[{title:"表头列名",dataIndex:"fullName",key:"fullName",width:200},{title:"子列",dataIndex:"childColumns",key:"childColumns",width:330},{title:"对齐方式",dataIndex:"align",key:"align",width:150},{title:"操作",dataIndex:"action",key:"action",width:50}];function C(e){let l=[];for(let t=0;t<o.list.length;t++){const a=o.list[t];a.childColumns?.length&&e!==t&&l.push(...a.childColumns)}let a=o.childColumnsList.filter((e=>!l.includes(e.id)));return a.length&&(a=a.map((e=>({...e,align:"left"})))),a}function x(){p("confirm",o.list),v((()=>b()))}return(e,l)=>{const p=a("jnpf-i18n-input"),h=a("JnpfSelect"),F=a("a-button"),y=a("a-table");return t(),r(c(L),g(e.$attrs,{width:"1000px",class:"JNPF-complex-header-Modal",onRegister:c(f),title:"复杂表头配置",onOk:x,destroyOnClose:""}),{default:i((()=>[n(y,{size:"small",rowKey:"id",class:"complex-header-table","data-source":c(u),columns:k,pagination:!1},{bodyCell:i((({column:e,record:a,index:n})=>["fullName"===e.key?(t(),r(p,{key:0,value:a.fullName,"onUpdate:value":e=>a.fullName=e,i18n:a.fullNameI18nCode,"onUpdate:i18n":e=>a.fullNameI18nCode=e,placeholder:"请输入",allowClear:"",maxlength:50},null,8,["value","onUpdate:value","i18n","onUpdate:i18n"])):s("",!0),"childColumns"===e.key?(t(),r(h,{key:1,value:a.childColumns,"onUpdate:value":e=>a.childColumns=e,fieldNames:{options:"options1"},placeholder:"请选择",multiple:"",showSearch:"",allowClear:"",options:C(n)},null,8,["value","onUpdate:value","options"])):s("",!0),"align"===e.key?(t(),r(h,{key:2,value:a.align,"onUpdate:value":e=>a.align=e,placeholder:"请选择",options:m},null,8,["value","onUpdate:value"])):s("",!0),"action"===e.key?(t(),r(F,{key:3,class:"action-btn",type:"link",color:"error",onClick:e=>function(e){o.list.splice(e,1)}(n),size:"small"},{default:i((()=>l[1]||(l[1]=[d("删除")]))),_:2,__:[1]},1032,["onClick"])):s("",!0)])),_:1},8,["data-source"]),_("div",{class:"table-add-action",onClick:l[0]||(l[0]=e=>function(){const e="complex"+w(),l={fullName:"表头列名"+e,fullNameI18nCode:"",childColumns:[],align:"center",id:e};o.list.push(l)}())},[n(F,{type:"link",preIcon:"icon-ym icon-ym-btn-add"},{default:i((()=>l[2]||(l[2]=[d("添加")]))),_:1,__:[2]})])])),_:1},16,["onRegister"])}}});export{j as _,M as a};
