import{a as e,B as a}from"./index-9c138ba5.js";import{u as t,B as l}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{g as s,u as o,c as i,a as n}from"./interfaceOauth-318e3e16.js";import{d,ad as r,a0 as p,M as u,u as c,aw as m,e as f,o as h,p as g,l as b,j as w,k as x,aR as v,dz as y,q as I,a4 as L,m as R,V as T,ah as k}from"./index-920db443.js";import{u as S}from"./index-143f5813.js";import{u as _,B as D}from"./useTable-dc8c9d84.js";import C from"./Info-974ef17a.js";const j=d({__name:"Form",emits:["register","reload"],setup(d,{emit:j}){const P=r({showLoading:!1,id:"",isDetail:!1,dataForm:{},tableList:[],userTableList:[],activeKey:"1"}),{showLoading:K,id:M}=p(P),O=[{field:"appId",label:"appId",component:"Input",componentProps:{placeholder:"请输入",maxlength:100},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"appSecret",label:"获取秘钥",component:"Input",slot:"appSecret",rules:[{required:!0,trigger:"change",message:"必填"}]},{ifShow:()=>!P.isDetail,field:"appName",label:"应用名称",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"verifySignature",label:"验证签名",component:"Switch",defaultValue:0,slot:"verifySignature",helpMessage:"开启后需要验证消息签名的真实性"},{field:"usefulLife",label:"使用期限",component:"DatePicker",helpMessage:"未选择日期默认永久有效",componentProps:{placeholder:"请选择"}},{field:"whiteList",label:"白名单",component:"Textarea",helpMessage:"多个IP设置，用英文符号隔开，如192.168.0.1,192.168.0.2",componentProps:{rows:5,placeholder:"请输入"}},{field:"sortCode",label:"排序",component:"InputNumber",defaultValue:0,componentProps:{min:"0",max:"999999",placeholder:"请输入"}},{field:"enabledMark",label:"状态",defaultValue:1,component:"Switch"},{field:"description",label:"说明",component:"Textarea",componentProps:{rows:5,placeholder:"请输入"}},{ifShow:()=>!!P.isDetail,field:"list",label:"",slot:"table",component:"Input"}],B=u((()=>P.isDetail?P.dataForm.appName:P.id?U("common.editText"):U("common.addText"))),F=j,{createMessage:N}=k(),{t:U}=c(),V=m(),[A,{openModal:E}]=S(),[q,{setFieldsValue:z,validate:J,resetFields:$}]=t({labelWidth:90,schemas:O}),[W,{closePopup:G,changeLoading:H,changeOkLoading:Q}]=e((function(e){P.showLoading=!1,$(),P.id=e.id,P.isDetail=!!e.isDetail||!1,P.tableList=[],P.userTableList=[],P.id&&(H(!0),s(P.id).then((e=>{const a=e.data;P.dataForm=a,z(a);let t=a.tenantId?a.tenantId:"";a.list&&(a.list.map((e=>{e.url=`${V.apiUrl}/api/system/DataInterface/${e.id}/Actions/Response`+(t?"?tenantId="+t:""),e.parameterJson&&(e.paramList=[...JSON.parse(e.parameterJson)]),e.paramList?.length&&e.paramList.forEach((e=>{[{label:"字符串",value:"varchar"},{label:"整型",value:"int"},{label:"日期时间",value:"datetime"},{label:"浮点",value:"decimal"},{label:"长整型",value:"bigint"},{label:"文本",value:"text"}].map((a=>{a.value==e.dataType&&(e.dataType=a.label)}))}))})),P.tableList=a.list||[]),P.userTableList=a.userList||[],H(!1)})))})),[X]=_({columns:[{title:"接口名称",dataIndex:"fullName",width:120},{title:"接口编码",dataIndex:"enCode",width:80},{title:"接口地址",dataIndex:"url"},{title:"接口类型",dataIndex:"dataType",width:80}],expandRowByClick:!0,showTableSetting:!1,showIndexColumn:!1,defaultExpandAllRows:!1,pagination:!1,canResize:!1}),[Y]=_({columns:[{title:"用户名",dataIndex:"userName",width:200},{title:"userKey",dataIndex:"userKey",width:200}],expandRowByClick:!0,showTableSetting:!1,showIndexColumn:!1,defaultExpandAllRows:!1,pagination:!1,canResize:!1}),[Z]=_({columns:[{title:"参数名称",dataIndex:"field"},{title:"参数类型",dataIndex:"dataType",width:100},{title:"默认值",dataIndex:"defaultValue",width:80}],showTableSetting:!1,showIndexColumn:!1,pagination:!1,canResize:!1});async function ee(){const e=await J();if(!e)return;Q(!0),e.oracleExtend=!!e.oracleExtend;const a={...e,id:M.value};(M.value?o:i)(a).then((e=>{N.success(e.msg),Q(!1),G(),F("reload")})).catch((()=>{Q(!1)}))}function ae(){P.showLoading=!0,n().then((e=>{P.showLoading=!1,z({appSecret:e.data})})).then((()=>{P.showLoading=!1}))}function te(){E(!0)}return(e,t)=>{const s=f("a-input-password"),o=f("jnpf-switch"),i=f("a-tag"),n=f("a-tab-pane"),d=f("a-tabs"),r=f("a-col"),p=f("a-row");return h(),g(x(a),T(e.$attrs,{onRegister:x(W),title:B.value,showOkBtn:!P.isDetail,onOk:ee,destroyOnClose:""}),{default:b((()=>[w(p,{class:"mt-20px overflow-auto h-full"},{default:b((()=>[w(r,{span:14,offset:5},{default:b((()=>[w(x(l),{onRegister:x(q),disabled:P.isDetail},{appSecret:b((({model:e,field:a})=>[w(s,{value:e[a],"onUpdate:value":t=>e[a]=t,placeholder:"请输入",readonly:"","show-password":"",disabled:P.isDetail},v({_:2},[P.isDetail?void 0:{name:"addonAfter",fn:b((()=>[x(K)?(h(),g(x(y),{key:0,class:"mr-5px"})):I("",!0),L("span",{class:"cursor-pointer",onClick:ae},"获取秘钥")])),key:"0"}]),1032,["value","onUpdate:value","disabled"])])),verifySignature:b((({model:e,field:a})=>[w(o,{value:e[a],"onUpdate:value":t=>e[a]=t,disabled:P.isDetail},null,8,["value","onUpdate:value","disabled"]),L("a",{class:"float-right",onClick:te},"验证签名使用说明")])),table:b((()=>[w(d,{activeKey:P.activeKey,"onUpdate:activeKey":t[0]||(t[0]=e=>P.activeKey=e)},{default:b((()=>[w(n,{key:"1",tab:"接口集合"},{default:b((()=>[w(x(D),{onRegister:x(X),"data-source":P.tableList},{expandedRowRender:b((({record:e})=>[w(x(D),{onRegister:x(Z),"data-source":e.paramList},null,8,["onRegister","data-source"])])),bodyCell:b((({column:e})=>["dataType"===e.key?(h(),g(i,{key:0,color:"blue"},{default:b((()=>t[1]||(t[1]=[R("POST")]))),_:1,__:[1]})):I("",!0)])),_:1},8,["onRegister","data-source"])])),_:1}),w(n,{key:"2",tab:"用户集合"},{default:b((()=>[w(x(D),{onRegister:x(Y),"data-source":P.userTableList},null,8,["onRegister","data-source"])])),_:1})])),_:1},8,["activeKey"])])),_:1},8,["onRegister","disabled"])])),_:1})])),_:1}),w(C,{onRegister:x(A)},null,8,["onRegister"])])),_:1},16,["onRegister","title","showOkBtn"])}}});export{j as _};
