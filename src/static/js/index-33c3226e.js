import{_ as e}from"./index-b34d9508.js";import{L as t}from"./index-fea1d737.js";import{ad as a,a0 as o,s as i,e5 as r,w as l,dn as n,ci as s,aE as p,n as u,d as c,r as f,a7 as y,e as d,o as x,p as h,aR as m,l as S,j as g,k as b,a4 as C}from"./index-920db443.js";import{G as A}from"./dataMap-47db3937.js";import{u as L}from"./useECharts-1e384526.js";import"./upperFirst-2cd1a2f7.js";function T(c,f){const y=a({currOption:{},chartData:[]}),{chartData:d,currOption:x}=o(y),{setOptions:h,resize:m}=L(f,void 0,(function(e){if(!c.option?.urlAddress)return;let t=JSON.parse(JSON.stringify(c.option.urlAddress));t=t.replace(/\${[^{}]+}/g,(t=>{const a=t.slice(2,-1);let o="";return"type"===a&&(o=e.seriesName),"name"===a&&(o=e.name),"value"===a&&(o=e.value),o||t})),"_self"==c.option.target?g(`/externalLink?href=${encodeURIComponent(p(t))}`):window.open(t,c.option.target)})),S=i("emitter"),g=r();function b(){const e=c.jnpfKey,t=c.option.styleType,a=c.option,o=function(){let e=JSON.parse(JSON.stringify(y.chartData))||[];return c.mappingConfig&&"static"!==c.dataType?["barChart","pieChart","lineChart"].includes(c.jnpfKey)?e.map((e=>({type:e[c.mappingConfig[0].value?c.mappingConfig[0].value:"type"],name:e[c.mappingConfig[1].value?c.mappingConfig[1].value:"name"],value:e[c.mappingConfig[2].value?c.mappingConfig[2].value:"value"]}))):"radarChart"==c.jnpfKey?e.map((e=>({type:e[c.mappingConfig[0].value?c.mappingConfig[0].value:"type"],name:e[c.mappingConfig[1].value?c.mappingConfig[1].value:"name"],value:e[c.mappingConfig[2].value?c.mappingConfig[2].value:"value"],max:e[c.mappingConfig[3].value?c.mappingConfig[3].value:"max"]}))):void 0:e}();let i=Array.from(new Set(o.map((e=>e.type)))),r=Array.from(new Set(o.map((e=>e.name)))),l=[];i.forEach(((i,r)=>{const n=function(e){const t=c.jnpfKey,a=c.option;if("barChart"==t){if(7==a.styleType){const t=a.barType.find((t=>e==t.title));if(t&&t.type)return t.type}return"bar"}if("lineChart"==t)return"line";if("pieChart"==t)return"pie";if("radarChart"==t)return"radar"}(i);let s={name:i,type:n,stack:5==t||6==t||7==t||4!=t&&"lineChart"==e?i:"total"},p=o.filter((e=>i===e.type));if("pieChart"==e)s.data=p.map((e=>({value:e.value,name:e.name}))),a.sortable&&function(e){for(let t=0;t<e.length-1;t++)for(let a=0;a<e.length-1;a++)if(e[a].value>e[a+1].value){let t=e[a];e[a]=e[a+1],e[a+1]=t}}(s.data),a.showZero&&(s.data=s.data.filter((e=>0!=e.value)));else if("radarChart"==e){const e=p.map((e=>e.type)),t={value:p.map((e=>e.value)),name:e&&e.length?e[0]:"",areaStyle:{color:C(r),opacity:a.seriesAreaStyleOpacity}};s.data=[t],s.colorBy="series"}else s.data=p.map((e=>e.value));l.push(s)}));let n={type:"category"==a.category?"category":"value",show:a.xAxisShow,inverse:a.xAxisInverse,data:r,name:a.xAxisName,nameTextStyle:{color:a.xAxisNameTextStyleColor,fontSize:a.xAxisNameTextStyleFontSize,fontWeight:a.xAxisNameTextStyleFontWeight?"bolder":""},splitLine:{show:a.xAxisSplitLineShow,lineStyle:{color:a.xAxisSplitLineLineStyleColor}},axisLabel:{rotate:a.xAxisAxisLabelRotate,color:a.AxisTextStyleColor?a.AxisTextStyleColor:a.xAxisAxisLabelTextStyleColor,fontSize:a.xAxisAxisLabelTextStyleFontSize,fontWeight:a.xAxisAxisLabelTextFontWeight?"bolder":""},axisLine:{show:a.xAxisShow,lineStyle:{color:a.AxisLineStyleColor?a.AxisLineStyleColor:a.xAxisAxisLineLineStyleColor}}},s=[{type:"category"==a.category?"value":"category",show:a.yAxisShow,inverse:a.yAxisInverse,data:r,name:a.yAxisName,nameTextStyle:{color:a.yAxisNameTextStyleColor,fontSize:a.yAxisNameTextStyleFontSize,fontWeight:a.yAxisNameTextStyleFontWeight?"bolder":""},splitLine:{show:a.yAxisSplitLineShow,lineStyle:{color:a.yAxisSplitLineLineStyleColor}},axisLabel:{interval:a.yAxisAxisLabelInterval,rotate:a.yAxisAxisLabelRotate,color:a.AxisTextStyleColor?a.AxisTextStyleColor:a.yAxisAxisLabelTextStyleColor,fontSize:a.yAxisAxisLabelTextStyleFontSize,fontWeight:a.yAxisAxisLabelTextFontWeight?"bolder":""},axisLine:{show:a.yAxisShow,lineStyle:{color:a.AxisLineStyleColor?a.AxisLineStyleColor:a.yAxisAxisLineLineStyleColor}}}],p={title:{show:a.titleText||a.titleSubtext,text:a.titleText,textStyle:{color:a.titleTextStyleColor,fontSize:a.titleTextStyleFontSize,fontWeight:a.titleTextStyleFontWeight?"bolder":""},subtext:a.titleSubtext,subtextStyle:{color:a.titleSubtextStyleColor,fontSize:a.titleSubtextStyleFontSize,fontWeight:a.titleSubtextStyleFontWeight?"bolder":""},left:a.titleLeft,backgroundColor:(a.titleText||a.titleSubtext)&&a.titleBgColor||"#fff"},tooltip:{show:a.tooltipShow,backgroundColor:a.tooltipBgColor,textStyle:{color:a.tooltipTextStyleColor,fontSize:a.tooltipTextStyleFontSize,fontWeight:a.tooltipTextStyleFontWeight?"bolder":""}},grid:{left:a.gridLeft,top:a.gridTop,right:a.gridRight,bottom:a.gridBottom,containLabel:!0},legend:{show:a.legendShow,orient:a.legendOrient,textStyle:{fontSize:a.legendTextStyleFontSize||12},top:a.legendTop+"%",right:a.legendLeft+"%"},series:(l||[]).map(((o,i)=>{let r={show:a.seriesLabelShow,position:"pieChart"==e?a.seriesLabelPosition:"top",fontSize:a.seriesLabelFontSize,fontWeight:a.seriesLabelFontWeight?"bolder":"normal",color:a.seriesLabelColor,backgroundColor:a.seriesLabelBgColor},l={borderRadius:a.seriesItemStyleBarBorderRadius};if("barChart"!=e&&"lineChart"!=e&&"radarChart"!=e||(l.color=C(i)),"lineChart"==e&&(o.smooth=2==t,o.step=3==t,o.lineStyle={width:a.seriesLineStyleWidth},o.symbolSize=a.seriesSymbolRotate,a.areaStyle&&(o.areaStyle={})),"pieChart"==e){if(1==t&&(o.radius="60%"),2==t&&(o.radius=["30%","60%"]),a.roseType&&(o.roseType="area"),a.seriesLabelShowInfo&&a.seriesLabelShowInfo.length&&(a.seriesLabelShowInfo.includes("count")&&a.seriesLabelShowInfo.includes("percent")?r.formatter="{b}: {c} ({d}%)":a.seriesLabelShowInfo.includes("count")?r.formatter="{b}: {c} ":a.seriesLabelShowInfo.includes("percent")&&(r.formatter="{b}: ({d}%) ")),a.colorList&&a.colorList.length){const e=[];a.colorList.map(((t,a)=>{const o=C(a)||"#71B6F5";e.push(o)})),o.color=e}o.center=[a.seriesCenterLeft+"%",a.seriesCenterTop+"%"]}return Object.assign(o,{name:o.name,type:o.type,data:o.data,stack:o.stack,showBackground:4==t,barWidth:a.seriesBarWidth,itemStyle:l,label:r})}))};"barChart"==e||"lineChart"==e?("lineChart"==e&&a.areaStyle&&(n.boundaryGap=!1),p.xAxis=n,p.yAxis=s):"radarChart"==e?(p.radar=[],i.map((e=>{const t={indicator:r.map((t=>{const a=o.find((a=>a.type==e&&a.name==t));return{name:t,max:a?a.max:""}})),shape:1==a.styleType?"polygon":"circle",axisName:{fontSize:a.radarAxisNameFontSize,fontWeight:a.radarAxisNameFontWeight?"bolder":"normal",color:a.radarAxisNameColor},center:[a.radarCenterLeft+"%",a.radarCenterTop+"%"]};p.radar.push(t)}))):"pieChart"==e&&(a.seriesLabelShowInfo.includes("count")&&a.seriesLabelShowInfo.includes("percent")?p.tooltip.formatter="{b}: {c} ({d}%)":a.seriesLabelShowInfo.includes("count")?p.tooltip.formatter="{b}: {c}":a.seriesLabelShowInfo.includes("percent")?p.tooltip.formatter="{b}: {d}%":p.tooltip.formatter="{b}"),y.currOption=p,h(p,!0)}function C(e){const a=c.option.colorList||[];if(a[e]){const o=a[e].color1,i=a[e].color2;return i&&o?new t(0,0,0,1,[{offset:0,color:o},{offset:1,color:i}]):o}}function T(e){const t=c.jnpfKey;c.option.defaultValue=[],"barChart"==t?(1!=e&&4!=e||(c.option.defaultValue=A.baseBarData),2!=e&&5!=e||(c.option.defaultValue=A.mulBarData),6==e&&(c.option.defaultValue=A.plusMinusBarData),7==e&&(c.option.defaultValue=A.brokenColumnBarData,v())):"lineChart"==t?(1!=e&&2!=e&&3!=e||(c.option.defaultValue=A.baseBarData),4==e&&(c.option.defaultValue=A.mulBarData)):"pieChart"==t?c.option.defaultValue=A.baseBarData:"radarChart"==t&&(c.option.defaultValue=A.radarData)}function v(){const e=c.option;if(7!==e.styleType)return;const t=y.chartData||[];if(!Array.isArray(t))return;e.barType=[],Array.from(new Set(t.map((e=>e.type)))).map(((t,a)=>{t&&e.barType.push({title:t,type:1==a?"line":"bar"})}))}return l((()=>c.option),(()=>{b()}),{deep:!0}),l((()=>c.dataType),(e=>{c.option.defaultValue=[],y.chartData=[],"static"==e&&T(c.option.styleType),v()}),{deep:!0}),l((()=>c.option.styleType),(e=>{"static"==c.dataType&&T(e),v()})),l((()=>c.option.defaultValue),(e=>{"static"===c.dataType&&setTimeout((()=>{y.chartData=e,b(),v()}),0)})),l((()=>c.propsApi),(e=>{if("static"===c.dataType||!e)return;const t={paramList:n(c.templateJson)};s(e,t).then((e=>{y.chartData=e.data,b(),v()}))})),l((()=>c.mappingConfig),(()=>{b()}),{deep:!0}),{CardHeader:e,chartData:d,currOption:x,init:function(){if("dynamic"===c.dataType){if(!c.propsApi)return y.chartData=[];const e={paramList:n(c.templateJson)};s(c.propsApi,e).then((e=>{y.chartData=e.data,b()}))}else setTimeout((()=>{y.chartData=c.option.defaultValue,b()}),0);S.on("eChart"+c.i,(()=>{u((()=>m()))}))}}}const v={class:"portal-card-body h-full"},w=c({__name:"index",props:["activeData"],setup(e){const t=f(null),a=e,{CardHeader:o,init:i}=T(a.activeData,t);return y((()=>i())),(a,i)=>{const r=d("a-card");return x(),h(r,{class:"portal-card-box"},m({default:S((()=>[C("div",v,[C("div",{ref_key:"chartRef",ref:t,class:"h-full w-full box-inherit p-10px"},null,512)])])),_:2},[e.activeData.title?{name:"title",fn:S((()=>[g(b(o),{title:e.activeData.title,card:e.activeData.card},null,8,["title","card"])])),key:"0"}:void 0]),1024)}}});export{w as default};
