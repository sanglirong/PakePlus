import{b as e,B as o}from"./index-143f5813.js";import{d as a,ad as t,u as n,e as r,o as d,p as l,l as i,j as s,m as c,k as m,a4 as p,V as u,ah as f}from"./index-920db443.js";import{f as g}from"./formValidate-c8ab8d29.js";import{u as b,B as h}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{l as y,u as F,q as k}from"./template-c6142676.js";const x={class:"flex"},v={class:"flex-1 mr-10px"},B=a({__name:"Form",emits:["register","reload","design"],setup(a,{emit:B}){const j=t({iconBackground:"#008cff",dataForm:{},btnLoading:!1,showType:0,type:0}),_=B,{t:L}=n(),{createMessage:P}=f(),w=["#008cff","#35b8e0","#00cc88","#ff9d00","#ff4d4d","#5b69bc","#ff8acc","#3b3e47","#282828"],[N,{closeModal:T,changeLoading:q,changeOkLoading:C}]=e((function(e){j.type=e.type,j.iconBackground="#008cff",I([{field:"category",componentProps:{options:e.categoryList||[]}}]),j.dataForm.id=e.id,j.dataForm.id?y(j.dataForm.id).then((e=>{j.dataForm=e.data,j.iconBackground=j.dataForm.iconBackground||"#008cff",S(j.dataForm),q(!1)})):(j.dataForm.type=e.type||0,q(!1))})),[R,{setFieldsValue:S,validate:V,updateSchema:I}]=b({schemas:[{field:"fullName",label:"流程名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"enCode",label:"流程编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:g("enCode"),trigger:"blur"}]},{field:"category",label:"流程分类",component:"Select",componentProps:{placeholder:"请选择",showSearch:!0},rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"icon",label:"流程图标",slot:"icon",component:"IconPicker",rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"showType",label:"显示位置",defaultValue:0,ifShow:()=>2!=j.type,component:"Radio",componentProps:{optionType:"button",buttonStyle:"solid",options:[{fullName:"都显示",id:0},{fullName:"仅发起流程显示",id:1},{fullName:"仅菜单显示",id:2}]}},{field:"sortCode",label:"流程排序",defaultValue:0,component:"InputNumber",componentProps:{min:0,max:999999}},{field:"description",label:"流程说明",component:"Textarea",componentProps:{placeholder:"请输入"}}]});async function M(e){const o=await V();if(!o)return;C(!0),j.btnLoading=!0;const a={...o,iconBackground:j.iconBackground,id:j.dataForm.id,type:j.dataForm.type};(j.dataForm.id?F:k)(a).then((o=>{P.success(o.msg),C(!1),j.btnLoading=!1,T(),_("reload"),1===e&&_("design",{id:j.dataForm.id||o.data,fullName:j.dataForm.fullName})})).catch((()=>{C(!1),j.btnLoading=!1}))}return(e,a)=>{const t=r("jnpf-icon-picker"),n=r("jnpf-color-picker"),f=r("a-form-item-rest"),g=r("a-button");return d(),l(m(o),u(e.$attrs,{onRegister:m(N),title:j.dataForm.id?m(L)("common.editText"):m(L)("common.addText"),width:600,onOk:M,destroyOnClose:""}),{appendFooter:i((()=>[s(g,{type:"primary",onClick:a[1]||(a[1]=e=>M(1)),loading:j.btnLoading},{default:i((()=>a[2]||(a[2]=[c("确定并设计")]))),_:1,__:[2]},8,["loading"])])),default:i((()=>[s(m(h),{onRegister:m(R)},{icon:i((({model:e,field:o})=>[p("div",x,[p("div",v,[s(t,{value:e[o],"onUpdate:value":a=>e[o]=a,placeholder:"请选择"},null,8,["value","onUpdate:value"])]),s(f,null,{default:i((()=>[s(n,{value:j.iconBackground,"onUpdate:value":a[0]||(a[0]=e=>j.iconBackground=e),optionType:"button","button-style":"solid",size:"small",predefine:w,name:"iconBackground"},null,8,["value"])])),_:1})])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"])}}});export{B as _};
