import{b as e,B as a}from"./index-143f5813.js";import{u as o,B as t}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{f as r}from"./formValidate-c8ab8d29.js";import{b as n,u as l,c as s}from"./portal-935b0b1b.js";import{d as i,u as d,ad as m,a0 as p,e as c,o as u,p as g,l as f,k as h,m as b,q as y,j as F,V as P,dC as k,ah as x}from"./index-920db443.js";const w=i({__name:"Form",emits:["register","reload","design"],setup(i,{emit:w}){const{t:C}=d(),L=m({dataForm:{type:0},btnLoading:!1}),{dataForm:S,btnLoading:T}=p(L),{createMessage:V}=x(),j=w,[v,{closeModal:q,changeLoading:_,changeOkLoading:M}]=e((function(e){U(),L.dataForm.id=e.id||"",A([{field:"category",componentProps:{options:e.categoryList||[]}}]),L.dataForm.type=0,L.dataForm.id&&(_(!0),n(L.dataForm.id).then((e=>{L.dataForm=e.data,W(L.dataForm.linkType),R(L.dataForm),_(!1)})).catch((()=>{_(!1)})))})),[N,{setFieldsValue:R,getFieldsValue:I,resetFields:U,validate:B,clearValidate:O,updateSchema:A}]=o({labelWidth:100,schemas:[{field:"fullName",label:"名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:100},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"enCode",label:"编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:r("enCode"),trigger:"blur"}]},{field:"category",label:"分类",component:"Select",componentProps:{placeholder:"请选择",showSearch:!0},rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"type",label:"类型",defaultValue:0,component:"Radio",componentProps:{options:[{id:0,fullName:"门户设计"},{id:1,fullName:"配置路径"}],optionType:"button",buttonStyle:"solid",onChange:function(e){L.dataForm.type=e,W(I()?.linkType)}},rules:[{required:!0,trigger:"change",message:"必填",type:"number"}]},{ifShow:({values:e})=>1===e.type,field:"linkType",label:"链接类型",defaultValue:0,component:"Radio",componentProps:{options:[{id:0,fullName:"页面"},{id:1,fullName:"外链"}],optionType:"button",buttonStyle:"solid",onChange:W},rules:[{required:!0,trigger:"change",message:"必填",type:"number"}]},{ifShow:({values:e})=>1===e.type,field:"customUrl",label:"链接地址",component:"Input",componentProps:{placeholder:"请输入"},helpMessage:"链接类型选择页面，只支持PC显示，不支持APP显示。",rules:[{required:!0,trigger:"blur",message:"必填"},{validator:(e,a)=>a&&1==I()?.linkType&&!k(a)?Promise.reject("请输入正确的链接地址"):Promise.resolve(),trigger:"blur"}]},{ifShow:({values:e})=>0===e.type,field:"enabledLock",label:"锁定",component:"Switch",defaultValue:1,helpMessage:"启用：不允许拖拽移动控件；禁用：允许用户在PC门户上拖拽大小及移动控件。"},{field:"sortCode",label:"排序",defaultValue:0,component:"InputNumber",componentProps:{min:0,max:999999}},{field:"description",label:"说明 ",component:"Textarea",componentProps:{placeholder:"请输入"}}]});function W(e){A([{field:"customUrl",componentProps:{addonBefore:0===e?"@/views/":""},helpMessage:1===e?"地址以http://或https://为开头":""}]),R({customUrl:""}),O("customUrl")}async function $(e){const a=await B();if(!a)return;1===e?L.btnLoading=!0:M(!0);const o={...a,id:L.dataForm.id};(L.dataForm.id?l:s)(o).then((o=>{V.success(o.msg),M(!1),L.btnLoading=!1,q(),j("reload"),L.dataForm.id||(L.dataForm.id=o.data),1==e&&j("design",{...a,id:L.dataForm.id})})).catch((()=>{M(!1),L.btnLoading=!1}))}return(e,o)=>{const r=c("a-alert"),n=c("a-button");return u(),g(h(a),P(e.$attrs,{onRegister:h(v),title:L.dataForm.id?h(C)("common.editText"):h(C)("common.addText"),onOk:$}),{appendFooter:f((()=>[0===h(S).type?(u(),g(n,{key:0,type:"primary",loading:h(T),onClick:o[0]||(o[0]=e=>$(1))},{default:f((()=>o[1]||(o[1]=[b("确定并设计")]))),_:1,__:[1]},8,["loading"])):y("",!0)])),default:f((()=>[h(S).id?y("",!0):(u(),g(r,{key:0,message:"新建成功后，前往【系统管理】>【应用菜单】中添加应用门户并授权。",type:"warning","show-icon":"",class:"!mb-20px"})),F(h(t),{onRegister:h(N)},null,8,["onRegister"])])),_:1},16,["onRegister","title"])}}});export{w as _};
