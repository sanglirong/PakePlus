import{r as e,t,v as o,x as n,y as i,z as a}from"./template-c6142676.js";import{u as s,B as r}from"./useTable-dc8c9d84.js";import{T as l}from"./TableAction-adbe36f2.js";import{d as u,aD as p,u as d,r as m,a7 as c,e as _,o as f,g as j,a4 as g,j as y,l as v,p as b,m as w,t as k,k as h,bN as x,q as M,ea as C,hC as T,hD as S,hE as R,c3 as D,ah as I}from"./index-920db443.js";import{u as F}from"./index-143f5813.js";import{_ as O}from"./Form.vue_vue_type_script_setup_true_lang-4d282a5d.js";import N from"./DesignForm-7e2524bc.js";import{_ as A}from"./AuthModal.vue_vue_type_script_setup_true_lang-2687d805.js";import"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import"./visualDev-8f54ab4b.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./index-9c138ba5.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./log-2a5f2c26.js";import"./index-999abbee.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./config-06ca91cd.js";import"./upperFirst-2cd1a2f7.js";import"./useTabs-ceeccdba.js";import"./uniqBy-e868edd7.js";import"./useWindowSizeFn-05f906e2.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";import"./formValidate-c8ab8d29.js";import"./componentMap-7e15a185.js";import"./Main.vue_vue_type_style_index_0_lang-0afb53a3.js";import"./define-8efdf20f.js";import"./MsgModal.vue_vue_type_script_setup_true_lang-65704aaa.js";import"./sendConfig-5e58278e.js";import"./MsgTemplateDetail-001aea8e.js";import"./msgTemplate-ce5c0fa7.js";import"./index-3b5bee70.js";import"./index-7e2f1b8c.js";import"./index-c37d2476.js";import"./BasicLeftTree-cd55d444.js";import"./billRule-0363563b.js";import"./import-e198d900.js";import"./tip-b30e67af.js";import"./dataSource-ed26da12.js";import"./dataModel-ea807f46.js";import"./CopyOutlined-8d46c8b2.js";import"./ReloadOutlined-5b95234b.js";import"./vuedraggable.umd-11acc51f.js";import"./InitiatorUserSelect.vue_vue_type_script_setup_true_lang-dfa9afb0.js";import"./FlowModal.vue_vue_type_script_setup_true_lang-b2e7f9ad.js";import"./task-ee77df5a.js";import"./TemplateModal.vue_vue_type_script_setup_true_lang-60c125c7.js";import"./accountConfig-5422c027.js";import"./WebhookRequestModal.vue_vue_type_style_index_0_lang-1411d0ba.js";import"./integrate-cef8009f.js";import"./authorize-72eaa3a6.js";import"./permissionGroup-129512c4.js";const P={class:"jnpf-content-wrapper"},H={class:"jnpf-content-wrapper-center"},q={class:"jnpf-content-wrapper-content"},L=u({name:"workFlow-flowEngine",__name:"index",setup(u){const{createMessage:L}=I(),z=p(),{t:B}=d(),[U,{openModal:E}]=F(),[Y,{openModal:G}]=F(),[K,{openModal:W}]=F(),{createConfirm:J}=I(),Q=[{title:"流程名称",dataIndex:"fullName"},{title:"流程编码",dataIndex:"enCode",width:200},{title:"流程分类",dataIndex:"category",width:150},{title:"流程类型",dataIndex:"type",width:100,align:"center",customRender:({record:e})=>{return 0===(t=e.type)?"标准流程":1===t?"简单流程":2===t?"任务流程":"";var t}},{title:"创建人",dataIndex:"creatorUser",width:120},{title:"创建时间",dataIndex:"creatorTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"排序",dataIndex:"sortCode",width:70,align:"center"},{title:"发布状态",dataIndex:"enabledMark",width:100,align:"center"},{title:"上架状态",dataIndex:"status",width:100,align:"center"}],V=m([]),[X,{reload:Z,getForm:$}]=s({api:e,columns:Q,useSearchForm:!0,formConfig:{schemas:[{field:"keyword",label:B("common.keyword"),component:"Input",componentProps:{placeholder:B("common.enterKeyword"),submitOnPressEnter:!0}},{field:"category",label:"流程分类",component:"Select",componentProps:{placeholder:"请选择",showSearch:!0}},{field:"type",label:"流程类型",component:"Select",componentProps:{placeholder:"请选择",options:[{id:0,fullName:"标准流程"},{id:1,fullName:"简单流程"},{id:2,fullName:"任务流程"}]}}]},actionColumn:{width:180,title:"操作",dataIndex:"action"}});function ee(e){return[{label:B("common.editText"),onClick:oe.bind(null,e.id,e.type)},{label:1!=e.status?"上架":"下架",color:"error",disabled:0===e.enabledMark,onClick:pe.bind(null,e)},{label:"设计",onClick:ne.bind(null,e)}]}function te(e){return[{label:"复制",ifShow:!!e.enabledMark,modelConfirm:{content:"您确定要复制该流程, 是否继续?",onOk:ae.bind(null,e.id)}},{label:"导出",ifShow:!!e.enabledMark,modelConfirm:{content:"您确定要导出该流程, 是否继续?",onOk:se.bind(null,e.id)}},{label:"切换",ifShow:1===e.type,modelConfirm:{content:"您确定要切换为标准流程, 是否继续?",onOk:re.bind(null,e.id)}},{label:"权限",ifShow:2==e.visibleType,onClick:le.bind(null,e.id)},{label:B("common.delText"),modelConfirm:{content:B("common.delTip"),onOk:ie.bind(null,e.id)}}]}function oe(e="",t){E(!0,{id:e,type:t,categoryList:V})}function ne(e){G(!0,{id:e.id,fullName:e.fullName})}function ie(e){t(e).then((e=>{L.success(e.msg),Z()}))}function ae(e){o(e).then((e=>{L.success(e.msg),Z()}))}function se(e){n(e).then((e=>{C({url:e.data.url})}))}function re(e){i(e).then((e=>{L.success(e.msg),Z()}))}function le(e){W(!0,{id:e})}function ue(e){oe("",e.key)}function pe(e){1!=e.status?function(e){function t(){a({id:e.id,isUp:0}).then((e=>{L.success(e.msg),Z()}))}J({iconType:"warning",title:B("common.tipTitle"),content:"此操作将上架该流程，是否继续？",onOk:t})}(e):function(e){const t=m({isHidden:0}),o=m(null);function n(){return o.value?.validate().then((()=>{a({id:e.id,isUp:1,...t.value}).then((e=>{L.success(e.msg),Z()}))})).catch((()=>Promise.reject()))}J({iconType:"warning",title:B("common.tipTitle"),content:()=>y(D,{model:t.value,ref:e=>o.value=e,layout:"vertical",class:"downFlow-confirm"},{default:()=>[y(T,{label:"此操作将下架该流程，下架后未审批完成的流程",name:"isHidden",class:"downFlow-label"},{default:()=>y(S,{value:t.value.isHidden,"onUpdate:value":e=>t.value.isHidden=e},{default:()=>[y(R,{value:0},{default:()=>"继续审批"}),y(R,{value:1},{default:()=>"隐藏审批数据"})]})})]}),onOk:n})}(e)}return c((()=>{!async function(){const e=await z.getDictionaryData("businessType");V.value=e,$().updateSchema({field:"category",componentProps:{options:e}})}()})),(e,t)=>{const o=_("a-menu-item"),n=_("a-menu"),i=_("a-button"),a=_("a-dropdown"),s=_("jnpf-upload-btn"),u=_("a-tag");return f(),j("div",P,[g("div",H,[g("div",q,[y(h(r),{onRegister:h(X)},{tableTitle:v((()=>[y(a,null,{overlay:v((()=>[y(n,{onClick:ue},{default:v((()=>[(f(),b(o,{key:0},{default:v((()=>t[0]||(t[0]=[w("标准流程")]))),_:1,__:[0]})),(f(),b(o,{key:1},{default:v((()=>t[1]||(t[1]=[w("简单流程")]))),_:1,__:[1]})),(f(),b(o,{key:2},{default:v((()=>t[2]||(t[2]=[w("任务流程")]))),_:1,__:[2]}))])),_:1})])),default:v((()=>[y(i,{type:"primary",preIcon:"icon-ym icon-ym-btn-add"},{default:v((()=>[w(k(h(B)("common.addText")),1),y(h(x))])),_:1})])),_:1}),y(s,{url:"/api/workflow/template/Actions/Import",accept:".ffe",onOnSuccess:h(Z)},null,8,["onOnSuccess"])])),bodyCell:v((({column:e,record:t})=>["status"===e.key?(f(),b(u,{key:0,color:0===t.status?"":1==t.status?"success":"error"},{default:v((()=>[w(k(0===t.status?"未上架":1===t.status?"已上架":"已下架"),1)])),_:2},1032,["color"])):M("",!0),"enabledMark"===e.key?(f(),b(u,{key:1,color:1==t.enabledMark?"success":""},{default:v((()=>[w(k(1==t.enabledMark?"已发布":"未发布"),1)])),_:2},1032,["color"])):M("",!0),"action"===e.key?(f(),b(h(l),{key:2,actions:ee(t),dropDownActions:te(t)},null,8,["actions","dropDownActions"])):M("",!0)])),_:1},8,["onRegister"])])]),y(O,{onRegister:h(U),onReload:h(Z),onDesign:ne},null,8,["onRegister","onReload"]),y(N,{onRegister:h(Y),onReload:h(Z)},null,8,["onRegister","onReload"]),y(A,{onRegister:h(K)},null,8,["onRegister"])])}}});export{L as default};
