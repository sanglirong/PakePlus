import{d as e,u as a,aw as t,r as s,ad as n,a0 as i,ei as l,gi as o,gj as d,n as r,fT as c,k as u,e as g,a9 as p,o as y,p as m,l as f,a4 as h,j as v,g as k,F as b,e1 as I,i as D,ab as _,h as w,t as K,q as z,dF as j,V as F,ah as C}from"./index-920db443.js";import{g as L,c as x}from"./userRelation-654fbd05.js";import{b as N,B as R}from"./index-143f5813.js";const A={class:"transfer__body"},P={class:"transfer-pane left-pane"},S={class:"transfer-pane__tool"},T={class:"transfer-pane__body transfer-pane__body-tab"},B=["onClick"],E={class:"selected-item-main"},G={class:"selected-item-text"},M={class:"name"},O=["title"],U=["onClick"],H={class:"selected-item-main"},q={class:"selected-item-text"},V={class:"name"},W=["title"],$={class:"transfer-pane right-pane"},J={class:"transfer-pane__tool"},Q={class:"transfer-pane__body"},X={class:"selected-item-main"},Y={class:"selected-item-text"},Z={class:"name"},ee=["title"],ae=e({__name:"GlobalMember",emits:["register"],setup(e){const{t:ae}=a(),te=t(),{createMessage:se}=C(),ne=s(te.apiUrl),ie=s(null),le=s(null),[oe,{changeLoading:de,changeOkLoading:re,closeModal:ce}]=N((function(e){de(!0),ue.isAsync=!1,ue.finish=!1,"Role"===e.type?ue.title="角色成员 - "+e.fullName||"":"Group"===e.type&&(ue.title="组内成员 - "+e.fullName||"");ue.dataForm.objectId=e.id,ue.dataForm.objectType=e.type,ue.dataForm.userIds=[],ue.treeData=[],ue.ableList=[],ue.selectedData=[],ue.pagination.keyword="",ue.pagination.currentPage=1,ue.nodeId="0",ue.activeKey="1",L(ue.dataForm.objectId).then((e=>{if(ue.dataForm.userIds=e.data.ids,!ue.dataForm.userIds.length)return de(!1);l(ue.dataForm.userIds).then((e=>{ue.selectedData=e.data.list,de(!1)}))})),be()})),ue=n({treeData:[],ableList:[],dataForm:{objectId:"",objectType:"Role",userIds:[]},title:"",selectedData:[],nodeId:"0",loading:!1,isAsync:!1,activeKey:"",pagination:{keyword:"",currentPage:1,pageSize:20},finish:!1,treeKey:+new Date}),{treeData:ge,ableList:pe,title:ye,selectedData:me,pagination:fe,loading:he,isAsync:ve,treeKey:ke}=i(ue);function be(){if("1"===ue.activeKey)return Ie();"2"===ue.activeKey&&(ue.loading=!0,o({keyword:ue.pagination.keyword,organizeId:"0"}).then((e=>{ue.ableList=e.data,ue.loading=!1}))),"3"===ue.activeKey&&(ue.loading=!0,d(ue.pagination.keyword).then((e=>{ue.ableList=e.data,ue.loading=!1}))),r((()=>{De()}))}function Ie(){ue.loading=!0,ue.pagination.keyword&&(ue.nodeId="0"),c(ue.nodeId,ue.pagination).then((e=>{ue.pagination.keyword?(e.data.list.length<ue.pagination.pageSize&&(ue.finish=!0),ue.treeData=[...ue.treeData,...e.data.list]):(ue.treeData=e.data.list,ue.treeData.length&&"0"==ue.nodeId&&Fe().setExpandedKeys([ue.treeData[0].id])),ue.loading=!1}))}function De(){const e=le.value,a=e?.getScrollWrap();a?.addEventListener("scroll",(()=>{a.scrollHeight-a.clientHeight-a.scrollTop<=200&&!ue.loading&&!ue.finish&&(ue.pagination.currentPage+=1,Ie())}))}function _e(){ue.pagination.keyword="",ue.nodeId="0",ue.isAsync=!1,be()}function we(e){return ue.nodeId=e.id,new Promise((a=>{c(ue.nodeId).then((t=>{const s=t.data.list;Fe().updateNodeByKey(e.eventKey,{children:s,isLeaf:!s.length}),a()}))}))}function Ke(e){if(!e.length)return;const a=Fe().getSelectedNode(e[0]);"user"===a?.type&&ze(a)}function ze(e){ue.selectedData.some((a=>a.id===e.id))||ue.selectedData.push(e)}function je(){ue.treeKey=+new Date,ue.nodeId="0",ue.treeData=[],ue.ableList=[],ue.pagination.currentPage=1,ue.isAsync=!!ue.pagination.keyword,ue.finish=!1,ue.isAsync&&"1"===ue.activeKey&&r((()=>{De()})),be()}function Fe(){const e=u(ie);if(!e)throw new Error("tree is null!");return e}function Ce(){ue.selectedData=[]}function Le(){re(!0),ue.dataForm.userIds=ue.selectedData.map((e=>e.id)),x(ue.dataForm).then((e=>{se.success(e.msg),re(!1),ce()})).catch((()=>{re(!1)}))}return(e,a)=>{const t=g("a-input-search"),s=g("a-tab-pane"),n=g("a-tabs"),i=g("a-avatar"),l=g("jnpf-empty"),o=p("loading");return y(),m(u(R),F(e.$attrs,{onRegister:u(oe),title:u(ye),width:800,onOk:Le,destroyOnClose:"",class:"transfer-modal"}),{default:f((()=>[h("div",A,[h("div",P,[h("div",S,[v(t,{placeholder:u(ae)("common.enterKeyword"),allowClear:"",value:u(fe).keyword,"onUpdate:value":a[0]||(a[0]=e=>u(fe).keyword=e),onSearch:je},null,8,["placeholder","value"])]),h("div",T,[v(n,{activeKey:ue.activeKey,"onUpdate:activeKey":a[1]||(a[1]=e=>ue.activeKey=e),tabBarGutter:10,size:"small",class:"pane-tabs",onChange:_e},{default:f((()=>[v(s,{key:"1",tab:"全部数据"}),v(s,{key:"2",tab:"当前组织"}),v(s,{key:"3",tab:"我的下属"})])),_:1},8,["activeKey"]),"1"===ue.activeKey?(y(),k(b,{key:0},[u(ve)?D((y(),m(u(_),{key:1,ref_key:"infiniteBody",ref:le},{default:f((()=>[(y(!0),k(b,null,w(u(ge),(e=>(y(),k("div",{key:e.id,class:"selected-item selected-item-user",onClick:a=>ze(e)},[h("div",E,[v(i,{size:36,src:ne.value+e.headIcon,class:"selected-item-headIcon"},null,8,["src"]),h("div",G,[h("p",M,K(e.fullName),1),h("p",{class:"organize",title:e.organize},K(e.organize),9,O)])])],8,B)))),128)),u(ge).length?z("",!0):(y(),m(l,{key:0}))])),_:1})),[[o,u(he)&&1===u(fe).currentPage]]):(y(),m(u(I),{class:"tree-main",treeData:u(ge),"load-data":we,clickRowToExpand:"",onSelect:Ke,ref_key:"treeRef",ref:ie,loading:u(he),key:u(ke)},null,8,["treeData","loading"]))],64)):D((y(),m(u(_),{key:1},{default:f((()=>[(y(!0),k(b,null,w(u(pe),(e=>(y(),k("div",{key:e.id,class:"selected-item selected-item-user",onClick:a=>ze(e)},[h("div",H,[v(i,{size:36,src:ne.value+e.headIcon,class:"selected-item-headIcon"},null,8,["src"]),h("div",q,[h("p",V,K(e.fullName),1),h("p",{class:"organize",title:e.organize},K(e.organize),9,W)])])],8,U)))),128)),u(pe).length?z("",!0):(y(),m(l,{key:0}))])),_:1})),[[o,u(he)]])])]),h("div",$,[h("div",J,[h("span",null,K(u(ae)("component.jnpf.common.selected")),1),h("span",{class:"remove-all-btn",onClick:Ce},"清空列表")]),h("div",Q,[v(u(_),null,{default:f((()=>[(y(!0),k(b,null,w(u(me),((e,a)=>(y(),k("div",{key:a,class:"selected-item selected-item-user"},[h("div",X,[v(i,{size:36,src:ne.value+e.headIcon,class:"selected-item-headIcon"},null,8,["src"]),h("div",Y,[h("p",Z,K(e.fullName),1),h("p",{class:"organize",title:e.organize},K(e.organize),9,ee)]),v(u(j),{class:"delete-btn",onClick:e=>{return t=a,void ue.selectedData.splice(t,1);var t}},null,8,["onClick"])])])))),128)),u(me).length?z("",!0):(y(),m(l,{key:0}))])),_:1})])])])])),_:1},16,["onRegister","title"])}}});export{ae as _};
