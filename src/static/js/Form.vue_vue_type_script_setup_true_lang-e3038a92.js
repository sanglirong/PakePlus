import{a as e,u as a,B as t}from"./index-9c138ba5.js";import{f as l}from"./formValidate-c8ab8d29.js";import{g as o,u as n,c as s}from"./sendConfig-5e58278e.js";import{d,ad as i,a0 as r,r as u,u as m,aD as c,e as p,o as g,g as f,j as b,l as h,k as C,a4 as k,p as _,q as y,m as T,t as v,V as x,F as w,ah as F}from"./index-920db443.js";import{u as L,B as S}from"./useTable-dc8c9d84.js";import{T as R}from"./TableAction-adbe36f2.js";import{u as M}from"./index-143f5813.js";import{_ as j}from"./TemplateForm.vue_vue_type_script_setup_true_lang-2446753d.js";import{_ as N}from"./Detail.vue_vue_type_script_setup_true_lang-e8c6d5aa.js";const I={class:"msg-pane"},D={class:"list"},U=d({__name:"Form",emits:["register","reload"],setup(d,{emit:U}){const V=U,q=i({title:"",dataForm:{id:"",fullName:"",enCode:"",description:"",enabledMark:1,sortCode:0,messageSource:"",templateType:0,sendConfigTemplateList:[]},dataRule:{fullName:[{required:!0,message:"必填",trigger:"blur"}],enCode:[{required:!0,message:"必填",trigger:"blur"},{validator:l("enCode"),trigger:"blur"}],messageSource:[{required:!0,message:"必填",trigger:"change"}],messageType:[{required:!0,message:"必填",trigger:"change"}]},messageTypeList:[],messageSourceList:[]}),{dataForm:A,dataRule:O,title:B,messageSourceList:z}=r(q),P=u(),{t:E}=m(),$=c(),{createMessage:G,createConfirm:H}=F(),[J,{changeLoading:K,changeOkLoading:Q,closePopup:W}]=e((function(e){P.value?.resetFields(),void(q.dataForm={id:"",fullName:"",enCode:"",description:"",enabledMark:1,sortCode:0,messageSource:"",templateType:0,sendConfigTemplateList:[]}),q.dataForm.id=e.id||"",q.title=q.dataForm.id?E("common.editText"):E("common.addText"),async function(){q.messageTypeList=await $.getDictionaryData("msgSendType"),q.messageTypeList.map((e=>e.id=e.enCode)),q.messageSourceList=await $.getDictionaryData("msgSourceType"),q.messageSourceList.map((e=>e.id=e.enCode))}(),q.dataForm.id&&(K(!0),o(q.dataForm.id).then((e=>{K(!1),e.data.enabledMark=Number(e.data.enabledMark),q.dataForm=e.data})).catch((()=>{K(!1)})))})),[X,{openModal:Y}]=M(),[Z,{openPopup:ee}]=a(),ae=[{title:"消息类型",dataIndex:"messageType",key:"messageType",width:150,customRender:({record:e})=>q.messageTypeList.find((a=>e.messageType==a.enCode)).fullName},{title:"模板编码",dataIndex:"templateCode",width:150},{title:"模板名称",dataIndex:"templateName",width:150},{title:"账号编码",dataIndex:"accountCode",width:150},{title:"账号名称",dataIndex:"accountName",width:150},{title:"状态",dataIndex:"enabledMark",width:70,align:"center"}],[te]=L({columns:ae,useSearchForm:!1,pagination:!1,canResize:!1,showTableSetting:!1,actionColumn:{width:150,title:"操作",dataIndex:"action"}});function le(e,a){return[{label:E("common.editText"),onClick:ne.bind(null,e,a)},{label:E("common.delText"),color:"error",onClick:de.bind(null,a)}]}function oe(e){return[{label:E("common.detailText"),onClick:ie.bind(null,e.templateId)}]}function ne(e,a){if(!q.dataForm.messageSource)return G.warning("请选择消息来源");Y(!0,{row:e,index:a,messageSource:q.dataForm.messageSource})}function se(e,a){a||0==a?q.dataForm.sendConfigTemplateList[a]=e:q.dataForm.sendConfigTemplateList.push(e)}function de(e){H({iconType:"warning",title:E("common.tipTitle"),content:"删除记录，不可恢复?",onOk:()=>{q.dataForm.sendConfigTemplateList.splice(e,1)}})}function ie(e){ee(!0,{id:e,msgTypeList:q.messageTypeList})}async function re(){try{if(!(await(P.value?.validate())))return;Q(!0);(q.dataForm.id?n:s)(q.dataForm).then((e=>{G.success(e.msg),W(),Q(!1),V("reload")})).catch((()=>{Q(!1)}))}catch(e){}}function ue(){q.dataForm.sendConfigTemplateList=[]}return(e,a)=>{const l=p("a-input"),o=p("a-form-item"),n=p("a-col"),s=p("jnpf-select"),d=p("a-input-number"),i=p("a-switch"),r=p("a-textarea"),u=p("a-button"),m=p("a-row"),c=p("a-form");return g(),f(w,null,[b(C(t),x(e.$attrs,{onRegister:C(J),showOkBtn:"",title:C(B),onOk:re,"destroy-on-close":""}),{default:h((()=>[b(c,{class:"!mx-20px",colon:!1,model:C(A),rules:C(O),ref_key:"formElRef",ref:P,labelCol:{style:{width:"100px"}}},{default:h((()=>[b(m,{gutter:20},{default:h((()=>[b(n,{span:12},{default:h((()=>[b(o,{label:"名称",name:"fullName"},{default:h((()=>[b(l,{value:C(A).fullName,"onUpdate:value":a[0]||(a[0]=e=>C(A).fullName=e),placeholder:"请输入",allowClear:""},null,8,["value"])])),_:1})])),_:1}),b(n,{span:12},{default:h((()=>[b(o,{label:"编码",name:"enCode"},{default:h((()=>[b(l,{value:C(A).enCode,"onUpdate:value":a[1]||(a[1]=e=>C(A).enCode=e),placeholder:"请输入",allowClear:""},null,8,["value"])])),_:1})])),_:1}),b(n,{span:12},{default:h((()=>[b(o,{label:"模板类型"},{default:h((()=>[b(l,{value:"自定义模板",disabled:"",allowClear:""})])),_:1})])),_:1}),b(n,{span:12},{default:h((()=>[b(o,{label:"消息来源",name:"messageSource"},{default:h((()=>[b(s,{value:C(A).messageSource,"onUpdate:value":a[2]||(a[2]=e=>C(A).messageSource=e),placeholder:"请选择",disabled:!!C(A).id,options:C(z),onChange:ue},null,8,["value","disabled","options"])])),_:1})])),_:1}),b(n,{span:12},{default:h((()=>[b(o,{label:"排序",name:"sortCode"},{default:h((()=>[b(d,{min:0,max:999999,value:C(A).sortCode,"onUpdate:value":a[3]||(a[3]=e=>C(A).sortCode=e),placeholder:"请输入"},null,8,["value"])])),_:1})])),_:1}),b(n,{span:12},{default:h((()=>[b(o,{label:"状态",name:"enabledMark"},{default:h((()=>[b(i,{checked:C(A).enabledMark,"onUpdate:checked":a[4]||(a[4]=e=>C(A).enabledMark=e),checkedValue:1,unCheckedValue:0},null,8,["checked"])])),_:1})])),_:1}),b(n,{span:24},{default:h((()=>[b(o,{label:"说明",name:"description"},{default:h((()=>[b(r,{value:C(A).description,"onUpdate:value":a[5]||(a[5]=e=>C(A).description=e),placeholder:"请输入",type:"textarea",rows:3},null,8,["value"])])),_:1})])),_:1}),b(n,{span:24},{default:h((()=>[k("div",I,[k("div",D,[b(C(S),{onRegister:C(te),"data-source":C(A).sendConfigTemplateList,size:"small"},{bodyCell:h((({column:e,record:a,index:t})=>["enabledMark"===e.key?(g(),_(i,{key:0,checked:a.enabledMark,"onUpdate:checked":e=>a.enabledMark=e,checkedValue:1,unCheckedValue:0},null,8,["checked","onUpdate:checked"])):y("",!0),"action"===e.key?(g(),_(C(R),{key:1,actions:le(a,t),dropDownActions:oe(a)},null,8,["actions","dropDownActions"])):y("",!0)])),_:1},8,["onRegister","data-source"])]),k("div",{class:"table-add-action",onClick:ne},[b(u,{type:"link",preIcon:"icon-ym icon-ym-btn-add"},{default:h((()=>[T(v(C(E)("common.addText")),1)])),_:1})])])])),_:1})])),_:1})])),_:1},8,["model","rules"]),b(j,{onRegister:C(X),onReload:se},null,8,["onRegister"])])),_:1},16,["onRegister","title"]),b(N,{onRegister:C(Z)},null,8,["onRegister"])],64)}}});export{U as _};
