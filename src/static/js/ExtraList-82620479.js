import{h as e,j as n,a}from"./visualDev-8f54ab4b.js";import{d as t,a6 as l,aD as o,r as i,ad as s,a0 as r,c as d,M as u,k as p,ch as c,a7 as m,e as f,o as h,g,a4 as v,j as y,q as _,aR as x,l as b,F as w,h as I,m as j,t as k,p as C,V as D,u as L,cm as S,n as U,ci as F,ah as P,cn as K}from"./index-920db443.js";import{a as O,u as T,B as N}from"./useForm-1d28ee0b.js";import{g as R}from"./componentMap-c91676b4.js";import{u as B,B as A}from"./useTable-dc8c9d84.js";import{T as M}from"./TableAction-adbe36f2.js";import{a as J}from"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import{_ as H}from"./index.vue_vue_type_script_setup_true_lang-69353133.js";import{_ as E}from"./ChildTableColumn.vue_vue_type_script_setup_true_lang-1a28ca33.js";import{d as z}from"./config-06ca91cd.js";import"./useTabs-ceeccdba.js";import"./upperFirst-2cd1a2f7.js";import"./log-2a5f2c26.js";import"./uniqBy-e868edd7.js";import"./index-143f5813.js";import"./useWindowSizeFn-05f906e2.js";import"./index-999abbee.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";import"./createAsyncComponent-7e8f72ac.js";import"./index-9c138ba5.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";const V={class:"jnpf-content-wrapper"},q={class:"jnpf-content-wrapper-center"},Q={key:0,class:"jnpf-content-wrapper-search-box"},$={class:"jnpf-content-wrapper-content bg-white"},G=["onClick"],W={key:0},X=["onClick"],Y=t({__name:"ExtraList",props:["config","detailFormData","isPreview","isDataManage"],emits:["openDetail","openForm"],setup(t,{expose:Y,emit:Z}){const ee=t,ne=Z,{hasBtnP:ae}=O(),{createMessage:te,createConfirm:le}=P(),{t:oe}=L(),ie=l(),se=o(),re=i(null),de=i(null),ue=i(null),pe=s({modelId:"",menuId:"",queryJson:"",superQueryJson:"",extraQueryJson:""}),ce=s({config:{},columnData:{},formConf:{},headerBtnsList:[],columnBtnsList:[],columnOptions:[],columns:[],childColumnList:[],cacheList:[],columnSettingList:[],searchSchemas:[],customRow:null,tabActiveKey:"",tabList:[]}),{columnData:me,childColumnList:fe}=r(ce),[he,{updateSchema:ge,submit:ve}]=T({baseColProps:{span:6},showActionButtonGroup:!0,showAdvancedButton:!0,compact:!0}),[ye,{reload:_e,setLoading:xe,clearSelectedRowKeys:be,redoHeight:we}]=B({api:e,immediate:!1,clickToRowSelect:!1,tableSetting:{setting:!1,redo:!ee.isPreview},afterFetch:e=>(ce.cacheList=d(e),e)}),[Ie]=B({pagination:!1,canResize:!1,showTableSetting:!1});Y({reload:_e});const je=u((()=>!([3,5].includes(ce.columnData.type)||!ce.columnData.hasPage)&&{pageSize:ce.columnData.pageSize})),ke=u((()=>3==ce.columnData.type||5==ce.columnData.type?1:ce.columnData.childTableStyle)),Ce=u((()=>ce.columns)),De=u((()=>d(ce.searchSchemas).map((e=>({...e,show:!0}))))),Le=u((()=>4==ce.config.webType&&ce.columnData.viewKey?ce.columnData.viewKey:"id")),Se=u((()=>{let e=p(Ce);const n=(ce.columnData.defaultSortConfig||[]).map((e=>("desc"===e.sort?"-":"")+e.field)),a={pagination:p(je),searchInfo:p(pe),defSort:{sidx:n.join(",")},sortFn:e=>{if(Array.isArray(e)){return{sidx:e.map((e=>("descend"===e.order?"-":"")+e.field)).join(",")}}{const{field:n,order:a}=e;return n&&a?{sidx:("descend"===a?"-":"")+n}:{}}},columns:e,clearSelectOnPageChange:!0,bordered:2!=p(ke)&&!!ce.childColumnList?.length||!!ce.columnData.complexHeaderList?.length,rowKey:p(Le)};if(ce.columnBtnsList.length){let e=ce.columnBtnsList.length;a.actionColumn={width:50*e,title:oe("component.table.action"),dataIndex:"action",fixed:"right"}}return ce.customRow&&(a.customRow=ce.customRow),a})),Ue=u((()=>{let e=p(Ce);if(ce.columnSettingList?.length){for(let n=0;n<e.length;n++)e:for(let a=0;a<ce.columnSettingList.length;a++)if(e[n].dataIndex===ce.columnSettingList[a].dataIndex){e[n].fixed=ce.columnSettingList[a].fixed,e[n].visible=ce.columnSettingList[a].visible;break e}e=e.filter((e=>e.visible))}let n=[];for(let l=0;l<e.length;l++){const a=e[l];if("table"===a.jnpfKey||"complexHeader"===a.jnpfKey?a.children?.length&&n.push(...a.children):n.push(a),a.fixed&&a.children?.length)for(let e=0;e<a.children.length;e++)a.children[e].fixed=a.fixed}const a=n.filter((e=>"left"===e.fixed)),t=n.filter((e=>"right"===e.fixed));return[...a,...n.filter((e=>"left"!==e.fixed&&"right"!==e.fixed)),...t]})),Fe=u((()=>{const e=[];return p(Ue).forEach(((n,a)=>{let t=ce.cacheList.reduce(((e,a)=>e+function(e,n){const a=e=>ce.columnData.summaryField.includes(e);if(!ce.columnData.summaryField.length||!a(n))return 0;const t=e[n];if(!t)return 0;return isNaN(t)?0:Number(t)}(a,n.prop)),0);var l;l=n.prop,ce.columnData.summaryField.includes(l)||(t=""),t=Number.isNaN(t)?"":t;const o=t&&!Number.isInteger(t)?Number(t).toFixed(2):t;e[a]=(e=>p(Ue).some((n=>n.__vModel__===e&&n.thousands)))(n.prop)?c(o):o})),[1,2].includes(ce.columnData.type)&&2===p(ke)&&ce.childColumnList.length&&e.unshift(""),e}));function Pe(e){if(p(Ue).length)return p(Ue)[e]?.align||"left"}function Ke(e,n){return ce.columnBtnsList.map((a=>{const t={label:a.labelI18nCode?oe(a.labelI18nCode,a.label):a.label,onClick:Te.bind(null,a.value,e)};if("remove"===a.value&&(t.color="error"),ce.config.enableFlow)"edit"===a.value&&(t.disabled=![0,8,9].includes(e.flowState)),"remove"===a.value&&(t.disabled=![0,9].includes(e.flowState)),"detail"===a.value&&(t.disabled=!e.flowState);else if(a?.event?.enableFunc){const l={row:e,rowIndex:n,onlineUtils:K},o=S(a.event.enableFunc);t.disabled=o&&!o(l)||!1}return t}))}function Oe(e){if("add"===e)return function(){const e={id:"",formConf:Je(ce.formConf),modelId:pe.modelId,isPreview:ee.isPreview,useFormPermission:ce.columnData.useFormPermission,showMoreBtn:![3,5].includes(ce.columnData.type),menuId:pe.menuId,allList:ce.cacheList};ne("openForm",e)}()}function Te(e,a){return"edit"===e?function(e){const n={id:e.id,formConf:ce.formConf,modelId:pe.modelId,isPreview:ee.isPreview,useFormPermission:ce.columnData.useFormPermission,showMoreBtn:![3,5].includes(ce.columnData.type),menuId:pe.menuId,allList:ce.cacheList};ne("openForm",n)}(a):"detail"===e?function(e){const n={id:e.id,formConf:ce.formConf,modelId:pe.modelId,menuId:pe.menuId,useFormPermission:ce.columnData.useFormPermission,title:ce.config.fullName,hideExtra:!0};ne("openDetail",n)}(a):void("remove"==e&&(t=a.id,le({iconType:"warning",title:oe("common.tipTitle"),content:oe("common.delTip"),onOk:()=>{const e={ids:[t],flowId:ce.config.flowId||""};n(pe.modelId,e).then((e=>{te.success(e.msg),_e()}))}})));var t}function Ne(){ce.config={modelId:pe.modelId,isPreview:ee.isPreview,...ee.config.extraConfig},pe.modelId=ce.config.id,pe.menuId=ee.config.targetFormId;const e={};if(e[ee.config.targetField]=ee.detailFormData[ee.config.currentField+"_jnpfId"],pe.extraQueryJson="{}"===JSON.stringify(e)?"":JSON.stringify(e),!ce.config.columnData||"4"!=ce.config.webType&&!ce.config.formData)return;ce.columnData=JSON.parse(ce.config.columnData),ce.formConf=ce.config.formData?JSON.parse(ce.config.formData):{};const n=ce.columnData.columnBtnsList||[];if(function(e){if(e=e.filter((e=>e.show||!Reflect.has(e,"show"))),ee.isPreview||ee.isDataManage||!ce.columnData.useBtnPermission)return ce.headerBtnsList=e;let n=[];for(let a=0;a<e.length;a++)ae("btn_"+e[a].value,!0,pe.menuId)&&n.push(e[a]);ce.headerBtnsList=n}(ce.columnData.btnsList.filter((e=>"add"===e.value))||[]),function(e){e=e.filter((e=>e.show||!Reflect.has(e,"show")));let n=[];if(ee.isPreview||ee.isDataManage||!ce.columnData.useBtnPermission)n=e;else{const a=ie.getPermissionList.filter((e=>e.modelId===pe.menuId)),t=a[0]&&a[0].button?a[0].button:[];for(let l=0;l<e.length;l++)e:for(let a=0;a<t.length;a++)if("btn_"+e[l].value===t[a].enCode){n.push(e[l]);break e}}ce.columnBtnsList=n}(n),ce.columnOptions=ce.columnData.columnOptions||[],p(je)||(pe.pageSize=1e6),xe(!0),function(){const e=R(ce.columnData.searchList);e.forEach((e=>{const n=e.__config__;if(z.includes(n.jnpfKey)&&("dictionary"===n.dataType&&n.dictionaryType&&se.getDicDataSelector(n.dictionaryType).then((n=>{ge([{field:e.field,componentProps:{options:n}}])})),"dynamic"===n.dataType&&n.propsUrl)){const a={paramList:n.templateJson||[]};F(n.propsUrl,a).then((n=>{const a=Array.isArray(n.data)?n.data:[];ge([{field:e.field,componentProps:{options:a}}])}))}(Array.isArray(e.value)&&e.value.length||e.value||0===e.value||!1===e.value)&&(e.defaultValue=e.value)})),ce.searchSchemas=e}(),function(){let e=[];if(ee.isPreview||ee.isDataManage||!ce.columnData.useColumnPermission)e=ce.columnData.columnList;else{const n=ie.getPermissionList.filter((e=>e.modelId===pe.menuId)),a=n[0]&&n[0].column?n[0].column:[];for(let t=0;t<ce.columnData.columnList.length;t++)e:for(let n=0;n<a.length;n++)if(ce.columnData.columnList[t].prop===a[n].enCode){e.push(ce.columnData.columnList[t]);break e}}let n=e.map((e=>({...e,placeholder:4==ce.columnData.type&&e.placeholderI18nCode?oe(e.placeholderI18nCode,e.placeholder):e.placeholder,title:e.labelI18nCode?oe(e.labelI18nCode,e.label):e.label,dataIndex:e.prop,align:e.align,fixed:"none"!=e.fixed&&e.fixed,sorter:e.sortable?{multiple:1}:e.sortable,width:e.width||100})));3!==ce.columnData.type&&5!==ce.columnData.type&&(n=function(e){let n=ce.columnData.complexHeaderList||[];if(!n.length)return e;let a=[],t=[];for(let o=0;o<n.length;o++){const l=n[o];if(l.label=l.fullName,l.labelI18nCode=l.fullNameI18nCode,l.title=l.fullNameI18nCode?oe(l.fullNameI18nCode,l.fullName):l.fullName,l.align=l.align,l.dataIndex=l.id,l.prop=l.id,l.children=[],l.jnpfKey="complexHeader",l.childColumns?.length){a.push(...l.childColumns);for(let n=0;n<l.childColumns.length;n++){const a=l.childColumns[n];for(let n=0;n<e.length;n++){const t=e[n];t.prop==a&&"left"!==t.fixed&&"right"!==t.fixed&&l.children.push({...t})}}}l.children.length&&t.push(l.children[0].prop)}n=n.filter((e=>e.children.length));let l=[];for(let o=0;o<e.length;o++){const i=e[o];if(a.includes(i.prop)&&"left"!==i.fixed&&"right"!==i.fixed){if(t.includes(i.prop)){const e=n.find((e=>e.childColumns.includes(i.prop)));l.push(e)}}else l.push(i)}return l}(n));ce.columns=n.filter((e=>e.prop.indexOf("-")<0))}(),ee.isPreview)return xe(!1);U((()=>{p(De)?.length?ve():_e({page:1})}))}function Re(e,n,t){n&&a(e).then((a=>{if(!a.data||!a.data.formData)return;const l=JSON.parse(a.data.formData);l.popupType="general",l.customBtns=[],l.hasPrintBtn=!1;const o={id:n,formConf:l,modelId:e,propsValue:t};ue.value?.init(o)}))}function Be(e){ce.columnSettingList=e}function Ae(e){if(ee.isPreview)return;be();let n={};for(let[a,t]of Object.entries(e))(t||0===t||!1===t)&&(Array.isArray(t)?t.length&&(n[a]=t):n[a]=t);pe.queryJson="{}"===JSON.stringify(n)?"":JSON.stringify(n),_e({page:1})}function Me(){ve()}function Je(e){if(!ee.config?.formOptions?.length)return e;const n=e=>{for(let a=0;a<e.length;a++){let t=e[a];if(t?.__config__?.children&&Array.isArray(t.__config__.children)&&n(t.__config__.children),t.__vModel__)for(let e=0;e<ee.config?.formOptions.length;e++){const n=ee.config?.formOptions[e];n.targetField==t.__vModel__&&(t.__config__.defaultValue=ee.detailFormData[n.currentField+"_jnpfId"],t.__config__.defaultCurrent=!1)}}};return n(e.fields),e}return m((()=>Ne())),(e,n)=>{const a=f("a-button"),t=f("jnpf-input-number"),l=f("jnpf-calculate"),o=f("jnpf-sign"),i=f("jnpf-signature"),s=f("jnpf-rate"),r=f("jnpf-slider"),d=f("jnpf-upload-img"),u=f("jnpf-upload-file"),c=f("jnpf-input"),m=f("a-tab-pane"),L=f("a-tabs"),S=f("a-table-summary-cell"),U=f("a-table-summary-row"),F=f("a-table-summary");return h(),g("div",V,[v("div",q,[De.value?.length?(h(),g("div",Q,[y(p(N),{onRegister:p(he),schemas:De.value,onAdvancedChange:p(we),onSubmit:Ae,onReset:Me,class:"search-form"},null,8,["onRegister","schemas","onAdvancedChange"])])):_("",!0),v("div",$,[y(p(A),D({onRegister:p(ye)},Se.value,{ref_key:"tableRef",ref:de,onColumnsChange:Be}),x({tableTitle:b((()=>[(h(!0),g(w,null,I(ce.headerBtnsList,(e=>(h(),C(a,{key:e.value,type:"add"===e.value?"primary":"link",preIcon:e.icon,onClick:n=>Oe(e.value)},{default:b((()=>[j(k(e.labelI18nCode?p(oe)(e.labelI18nCode,e.label):e.label),1)])),_:2},1032,["type","preIcon","onClick"])))),128))])),bodyCell:b((({column:e={},record:n,index:a})=>["INDEX"===e.flag?(h(),g("span",W,k(a+1),1)):_("",!0),2!==ke.value&&p(fe).length?(h(!0),g(w,{key:1},I(p(fe),((a,t)=>(h(),g(w,null,[e.id?.includes("-")&&a.children&&a.children[0]&&e.id===a.children[0]?.id?(h(),C(E,{data:n[a.prop],head:a.children,onToggleExpand:e=>{return t=n,l=`${a.prop}Expand`,void(t[l]=!t[l]);var t,l},onToDetail:Re,expand:n[`${a.prop}Expand`],showOverflow:p(me).showOverflow,key:t},null,8,["data","head","onToggleExpand","expand","showOverflow"])):_("",!0)],64)))),256)):_("",!0),n.top||e.id?.includes("-")?_("",!0):(h(),g(w,{key:2},["relationForm"===e.jnpfKey?(h(),g("p",{key:0,class:"link-text",onClick:a=>Re(e.modelId,n[`${e.prop}_id`],e.propsValue)},k(n[e.prop]),9,X)):_("",!0),"inputNumber"===e.jnpfKey?(h(),C(t,{key:1,value:n[e.prop],"onUpdate:value":a=>n[e.prop]=a,precision:e.precision,thousands:e.thousands,disabled:"",detailed:""},null,8,["value","onUpdate:value","precision","thousands"])):_("",!0),"calculate"===e.jnpfKey?(h(),C(l,{key:2,value:n[e.prop],"onUpdate:value":a=>n[e.prop]=a,isStorage:e.isStorage,precision:e.precision,thousands:e.thousands,roundType:e.roundType,detailed:""},null,8,["value","onUpdate:value","isStorage","precision","thousands","roundType"])):_("",!0),"sign"===e.jnpfKey?(h(),C(o,{key:3,value:n[e.prop],"onUpdate:value":a=>n[e.prop]=a,detailed:""},null,8,["value","onUpdate:value"])):_("",!0),"signature"===e.jnpfKey?(h(),C(i,{key:4,value:n[e.prop],"onUpdate:value":a=>n[e.prop]=a,detailed:""},null,8,["value","onUpdate:value"])):_("",!0),"rate"===e.jnpfKey?(h(),C(s,{key:5,value:n[e.prop],"onUpdate:value":a=>n[e.prop]=a,count:e.count,allowHalf:e.allowHalf,disabled:""},null,8,["value","onUpdate:value","count","allowHalf"])):_("",!0),"slider"===e.jnpfKey?(h(),C(r,{key:6,value:n[e.prop],"onUpdate:value":a=>n[e.prop]=a,min:e.min,max:e.max,step:e.step,disabled:""},null,8,["value","onUpdate:value","min","max","step"])):_("",!0),"uploadImg"===e.jnpfKey?(h(),g(w,{key:7},[n[e.prop]?.length?(h(),C(d,{key:0,value:n[e.prop],"onUpdate:value":a=>n[e.prop]=a,disabled:"",detailed:"",simple:""},null,8,["value","onUpdate:value"])):_("",!0)],64)):_("",!0),"uploadFile"===e.jnpfKey?(h(),g(w,{key:8},[n[e.prop]?.length?(h(),C(u,{key:0,value:n[e.prop],"onUpdate:value":a=>n[e.prop]=a,disabled:"",detailed:"",simple:""},null,8,["value","onUpdate:value"])):_("",!0)],64)):_("",!0),"input"===e.jnpfKey?(h(),C(c,{key:9,value:n[e.prop],"onUpdate:value":a=>n[e.prop]=a,useMask:e.useMask,maskConfig:e.maskConfig,showOverflow:p(me).showOverflow,detailed:""},null,8,["value","onUpdate:value","useMask","maskConfig","showOverflow"])):_("",!0)],64)),"action"!==e.key||n.top&&5!=p(me).type?_("",!0):(h(),C(p(M),{key:3,actions:Ke(n,a)},null,8,["actions"]))])),_:2},[[1,2].includes(p(me).type)&&2===ke.value&&p(fe).length?{name:"expandedRowRender",fn:b((({record:e})=>[y(L,{size:"small"},{default:b((()=>[(h(!0),g(w,null,I(p(fe),((n,a)=>(h(),C(m,{key:a,tab:n.label,label:n.label},{default:b((()=>[y(p(A),{onRegister:p(Ie),ellipsis:!!p(me).showOverflow,"data-source":e[n.prop],columns:n.children},{bodyCell:b((({column:e={},record:n})=>["relationForm"===e.jnpfKey?(h(),g("p",{key:0,class:"link-text",onClick:a=>Re(e.modelId,n[`${e.dataIndex}_id`],n[e.propsValue])},k(n[e.dataIndex]),9,G)):_("",!0),"inputNumber"===e.jnpfKey?(h(),C(t,{key:1,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,precision:e.precision,thousands:e.thousands,disabled:"",detailed:""},null,8,["value","onUpdate:value","precision","thousands"])):_("",!0),"calculate"===e.jnpfKey?(h(),C(l,{key:2,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,isStorage:e.isStorage,precision:e.precision,thousands:e.thousands,roundType:e.roundType,detailed:""},null,8,["value","onUpdate:value","isStorage","precision","thousands","roundType"])):_("",!0),"sign"===e.jnpfKey?(h(),C(o,{key:3,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,detailed:""},null,8,["value","onUpdate:value"])):_("",!0),"signature"===e.jnpfKey?(h(),C(i,{key:4,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,detailed:""},null,8,["value","onUpdate:value"])):_("",!0),"rate"===e.jnpfKey?(h(),C(s,{key:5,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,count:e.count,allowHalf:e.allowHalf,disabled:""},null,8,["value","onUpdate:value","count","allowHalf"])):_("",!0),"slider"===e.jnpfKey?(h(),C(r,{key:6,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,min:e.min,max:e.max,step:e.step,disabled:""},null,8,["value","onUpdate:value","min","max","step"])):_("",!0),"uploadImg"===e.jnpfKey?(h(),g(w,{key:7},[n[e.dataIndex]?.length?(h(),C(d,{key:0,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,disabled:"",detailed:"",simple:""},null,8,["value","onUpdate:value"])):_("",!0)],64)):_("",!0),"uploadFile"===e.jnpfKey?(h(),g(w,{key:8},[n[e.dataIndex]?.length?(h(),C(u,{key:0,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,disabled:"",detailed:"",simple:""},null,8,["value","onUpdate:value"])):_("",!0)],64)):_("",!0),"input"===e.jnpfKey?(h(),C(c,{key:9,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,useMask:e.useMask,maskConfig:e.maskConfig,showOverflow:p(me).showOverflow,detailed:""},null,8,["value","onUpdate:value","useMask","maskConfig","showOverflow"])):_("",!0)])),_:2},1032,["onRegister","ellipsis","data-source","columns"])])),_:2},1032,["tab","label"])))),128))])),_:2},1024)])),key:"0"}:void 0,p(me).showSummary&&[1,2,4].includes(p(me).type)?{name:"summary",fn:b((()=>[y(F,{fixed:""},{default:b((()=>[y(U,null,{default:b((()=>[y(S,{index:0},{default:b((()=>[j(k(p(oe)("component.table.summary")),1)])),_:1}),(h(!0),g(w,null,I(Fe.value,((e,n)=>(h(),C(S,{key:n,index:n+1,align:Pe(n)},{default:b((()=>[j(k(e),1)])),_:2},1032,["index","align"])))),128)),y(S,{index:Fe.value.length+1},null,8,["index"])])),_:1})])),_:1})])),key:"1"}:void 0]),1040,["onRegister"])])]),y(J,{ref_key:"formRef",ref:re,onReload:p(_e)},null,8,["onReload"]),y(H,{ref_key:"detailRef",ref:ue},null,512)])}}});export{Y as default};
