import{u as useI18n,d as defineComponent,U as useAttrs,c3 as Form,cd as useGeneratorStore,s as inject,T as useDesign,r as ref,ad as reactive,a0 as toRefs,M as computed,k as unref,bk as pick,w as watch,a7 as onMounted,e as resolveComponent,o as openBlock,g as createElementBlock,j as createVNode,V as mergeProps,p as createBlock,l as withCtx,aN as ModalClose,a4 as createBaseVNode,m as createTextVNode,t as toDisplayString,af as normalizeClass,bB as RedoOutlined,F as Fragment,q as createCommentVNode,aH as Modal,am as normalizeStyle,ce as Drawer,cf as ExtraRelationInfo,n as nextTick,a3 as withInstall,c as cloneDeep,a6 as useUserStore,cg as getDataInterfaceDataSelect,aD as useBaseStore,ch as thousandsFormat,ci as getDataInterfaceRes,cj as CaretRightOutlined,h as renderList,aR as createSlots,ck as isUnDef,aa as resolveDynamicComponent,cl as withModifiers,i as withDirectives,v as vShow,cm as getScriptFunc,bn as buildUUID,cn as onlineUtils,co as dayjs,cp as getDateTimeUnit,ah as useMessage,a5 as _export_sfc,av as Input,b9 as DatePicker,cq as Tinymce,cr as BasicCaption,bh as propTypes,aj as watchEffect,aL as renderSlot,aS as normalizeProps,aT as guardReactiveProps,at as tryOnUnmounted,cs as Button,Z as isFunction,a1 as getCurrentInstance,ct as readonly,aV as isEqual,aU as toRaw,cu as JnpfAlert,cv as JnpfAreaSelect,cw as JnpfAutoComplete,cx as JnpfButton,cy as JnpfCron,cz as JnpfCascader,cA as JnpfColorPicker,cB as JnpfCheckbox,cC as JnpfCheckboxSingle,cD as JnpfDatePicker,cE as JnpfDateRange,cF as JnpfTimePicker,cG as JnpfTimeRange,c2 as JnpfDivider,cH as JnpfInput,cI as JnpfTextarea,cJ as JnpfInputNumber,cK as JnpfIconPicker,cL as JnpfLink,cM as JnpfOrganizeSelect,cN as JnpfDepSelect,cO as JnpfPosSelect,cP as JnpfGroupSelect,cQ as JnpfRoleSelect,cR as JnpfUserSelect,cS as JnpfUsersSelect,cT as JnpfQrcode,cU as JnpfBarcode,cV as JnpfRadio,cW as JnpfRate,cX as JnpfSelect,cY as JnpfSlider,cZ as JnpfSign,c_ as JnpfSignature,c$ as JnpfSwitch,d0 as JnpfText,d1 as JnpfTreeSelect,d2 as JnpfUploadFile,d3 as JnpfUploadImg,d4 as JnpfUploadImgSingle,d5 as JnpfOpenData,d6 as JnpfRelationFormAttr,d7 as JnpfPopupSelect,d8 as JnpfPopupTableSelect,d9 as JnpfPopupAttr,da as JnpfNumberRange,db as JnpfCalculate,dc as JnpfLocation,dd as JnpfIframe}from"./index-920db443.js";import{g as getDataChange,a as getConfigData,b as getFieldDataSelect}from"./visualDev-8f54ab4b.js";import{_ as _sfc_main$6}from"./index.vue_vue_type_script_setup_true_lang-69353133.js";import{u as useInputList,a as useDateList,b as useSelectList,s as systemComponentsList,d as dyOptionsList}from"./config-06ca91cd.js";import{c as createCaseFirst,u as upperFirst}from"./upperFirst-2cd1a2f7.js";import{D as DrawerFooter}from"./index-999abbee.js";var lowerFirst=createCaseFirst("toLowerCase");const lowerFirst$1=lowerFirst,{t:t$1}=useI18n(),relationFormProps={value:[String,Number,Array],modelId:{type:String,default:""},relationField:{type:String,default:""},field:{type:String,default:""},placeholder:{type:String,default:t$1("common.chooseText")},extraOptions:{type:Array,default:()=>[]},columnOptions:{type:Array,default:()=>[]},hasPage:{type:Boolean,default:!1},pageSize:{type:Number,default:20},allowClear:{type:Boolean,default:!0},size:{type:String},disabled:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},popupType:{type:String,default:"dialog"},popupTitle:{type:String,default:t$1("component.jnpf.popupSelect.modalTitle")},popupWidth:{type:String,default:"800px"},queryType:{type:Number,default:1},propsValue:{type:String,default:""}},_hoisted_1$3={class:"common-container"},_hoisted_2$2={class:"jnpf-common-search-box jnpf-common-search-box-modal"},_hoisted_3$2={class:"jnpf-common-search-box-right"},_hoisted_4$2={class:"common-container-drawer-body"},_hoisted_5$2={class:"jnpf-common-search-box jnpf-common-search-box-modal"},_hoisted_6$1={class:"jnpf-common-search-box-right"},_sfc_main$5=defineComponent({name:"JnpfRelationForm",inheritAttrs:!1,__name:"RelationForm",props:relationFormProps,emits:["update:value","change"],setup(e,{emit:t}){const n=e,o=t,a=useAttrs({excludeDefaultKeys:!1}),r=Form.useInjectFormItemContext(),s=useGeneratorStore(),l=inject("emitter"),{t:i}=useI18n(),{prefixCls:c}=useDesign("basic-drawer"),{prefixCls:p}=useDesign("basic-form"),{prefixCls:u}=useDesign("basic-table"),{prefixCls:d}=useDesign("basic-drawer-footer"),f=ref(null),m=ref(void 0),g=ref(null),h=ref(!1),_=ref([]),y=ref(),b=ref(null),C={width:50,title:i("component.table.index"),dataIndex:"index",key:"index",align:"center",customRender:({index:e})=>e+1},v=reactive({list:[],listQuery:{keyword:"",currentPage:1,pageSize:20},loading:!1,total:0,selectedRowKeys:[],selectedRows:[],extraData:{}}),{listQuery:x,list:w,extraData:k}=toRefs(v),S=computed((()=>[p,`${p}--compact`,"search-form"])),M=computed((()=>{const e="60px";return{height:e,lineHeight:`calc(${e} - 1px)`}})),I=computed((()=>{const e=n.columnOptions.map((e=>({title:e.label,dataIndex:e.value,ellipsis:!0})));return[C,...e]})),T=computed((()=>({modelId:n.modelId,relationField:n.relationField,columnOptions:n.columnOptions.map((e=>e.value)).join(",")}))),D=computed((()=>!!n.hasPage&&{current:v.listQuery.currentPage,pageSize:v.listQuery.pageSize,size:"small",defaultPageSize:v.listQuery.pageSize,showTotal:e=>i("component.table.total",{total:e}),showSizeChanger:!0,pageSizeOptions:["20","50","80","100"],showQuickJumper:!0,total:v.total})),R=computed((()=>({type:"radio",selectedRowKeys:v.selectedRowKeys,onChange:U}))),N=computed((()=>{let e="drawer"===n.popupType?window.innerHeight-120-52-38:.7*window.innerHeight-52-38;return n.hasPage&&(e-=44),e})),P=computed((()=>({columns:unref(I),pagination:unref(D),rowSelection:unref(R),size:"small",loading:v.loading,rowKey:unref(n).propsValue,scroll:{y:unref(N)},class:unref(u)}))),V=computed((()=>{let e=unref(a).class?"w-full "+unref(a).class:"w-full";return n.disabled&&(e+=" disabled-select"),{...pick(n,["size"]),fieldNames:{label:unref(n).relationField,value:unref(n).propsValue},placeholder:unref(n).placeholder,mode:n.multiple?"multiple":"",open:!1,showSearch:!1,showArrow:!0,allowClear:!n.disabled&&n.allowClear,class:e,style:Reflect.has(unref(a),"style")?unref(a).style:{}}}));function F(){const e=s.getRelationData;m.value=n.multiple?[]:void 0,v.extraData={},_.value=[],g.value=null,n.field&&(e[n.field]={},s.setRelationData(e),l.emit("setRelationData",{jnpfRelationField:n.field}))}function B(){_.value=[],o("update:value",""),o("change","",{}),r.onFieldChange()}async function E(){if(n.disabled){if(!n.value)return;getConfigData(n.modelId).then((e=>{if(!e.data||!e.data.formData)return;const t=JSON.parse(e.data.formData);t.popupType="general",t.customBtns=[],t.hasPrintBtn=!1;const o={id:n.value,formConf:t,modelId:n.modelId,propsValue:n.propsValue};f.value?.init(o)}))}else h.value=!0,nextTick((()=>{J(),v.selectedRowKeys=m.value?[m.value]:[];const e=b.value?.$el;e.querySelector(".ant-table-body").style.height=`${unref(N)}px`}))}function A(){h.value=!1}function L(){if(v.selectedRowKeys.length||v.selectedRows.length){if(!v.selectedRows.length)return o("update:value",m.value),o("change",m.value,_.value[0]),r.onFieldChange(),void A();g.value=v.selectedRows[0],_.value=v.selectedRows,m.value=unref(g)[n.propsValue],o("update:value",unref(g)[n.propsValue]),o("change",unref(g).id,unref(g)),r.onFieldChange(),A()}}function O(){v.listQuery.currentPage=1,v.listQuery.pageSize=n.hasPage?n.pageSize:1e4,j()}function J(){(function(){const e=unref(y);if(!e)throw new Error("form is null!");return e})().resetFields(),v.listQuery.keyword="",O()}function j(){if(!n.modelId||!n.relationField)return;v.loading=!0;const e={...v.listQuery,...unref(T),queryType:n.queryType,propsValue:n.propsValue};getFieldDataSelect(e).then((e=>{v.list=e.data.list,v.total=e.data.pagination.total,v.loading=!1})).catch((()=>{v.loading=!1}))}function z(e){v.listQuery.currentPage=e.current,v.listQuery.pageSize=e.pageSize,j()}function U(e,t){v.selectedRowKeys=e,v.selectedRows=t}return watch((()=>n.value),(e=>{!function(e){const t=s.getRelationData;if(n.multiple&&!n.value.length||!n.multiple&&!n.value&&0!==n.value)return void F();if(!n.modelId)return;if(!n.multiple){let o={id:e};n.propsValue&&(o={...o,propsValue:n.propsValue}),getDataChange(n.modelId,o).then((o=>{if(n.multiple&&!n.value.length||!n.multiple&&!n.value&&0!==n.value)return void F();if(!o.data||!o.data.data)return;const a=JSON.parse(o.data.data);v.extraData=a,m.value=e,_.value=[{...a,id:o.data.id}],n.field&&(t[n.field]={...a,id:o.data.id},s.setRelationData(t),l.emit("setRelationData",{jnpfRelationField:n.field,...a,id:o.data.id}))}))}}(e)}),{immediate:!0}),onMounted((()=>{v.listQuery.pageSize=n.hasPage?n.pageSize:1e4})),(e,t)=>{const n=resolveComponent("a-select"),o=resolveComponent("a-input"),a=resolveComponent("a-form-item"),r=resolveComponent("a-col"),s=resolveComponent("a-button"),l=resolveComponent("a-row"),p=resolveComponent("a-form"),u=resolveComponent("a-tooltip"),g=resolveComponent("a-table");return openBlock(),createElementBlock("div",_hoisted_1$3,[createVNode(n,mergeProps({value:m.value,"onUpdate:value":t[0]||(t[0]=e=>m.value=e)},V.value,{options:_.value,onChange:B,onClick:E}),null,16,["value","options"]),"dialog"===e.popupType?(openBlock(),createBlock(unref(Modal),{key:0,open:h.value,"onUpdate:open":t[2]||(t[2]=e=>h.value=e),title:e.popupTitle,width:e.popupWidth,class:"common-container-modal",onOk:L,onCancel:A,maskClosable:!1},{closeIcon:withCtx((()=>[createVNode(ModalClose,{canFullscreen:!1,onCancel:A})])),default:withCtx((()=>[createBaseVNode("div",_hoisted_2$2,[createVNode(p,{colon:!1,labelAlign:"right",model:unref(x),ref_key:"formElRef",ref:y,class:normalizeClass(S.value)},{default:withCtx((()=>[createVNode(l,{gutter:10},{default:withCtx((()=>[createVNode(r,{span:8},{default:withCtx((()=>[createVNode(a,{label:unref(i)("common.keyword"),name:"keyword"},{default:withCtx((()=>[createVNode(o,{value:unref(x).keyword,"onUpdate:value":t[1]||(t[1]=e=>unref(x).keyword=e),placeholder:unref(i)("common.enterKeyword"),allowClear:"",onPressEnter:O},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),createVNode(r,{span:8},{default:withCtx((()=>[createVNode(a,{label:" "},{default:withCtx((()=>[createVNode(s,{type:"primary",class:"mr-2",onClick:O},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(i)("common.queryText")),1)])),_:1}),createVNode(s,{onClick:J},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(i)("common.resetText")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model","class"]),createBaseVNode("div",_hoisted_3$2,[createVNode(u,{placement:"top"},{title:withCtx((()=>[createBaseVNode("span",null,toDisplayString(unref(i)("common.redo")),1)])),default:withCtx((()=>[createVNode(unref(RedoOutlined),{class:"jnpf-common-search-box-right-icon",onClick:j})])),_:1})])]),createVNode(g,mergeProps({"data-source":unref(w)},P.value,{onChange:z,ref_key:"tableElRef",ref:b}),{bodyCell:withCtx((({column:e,record:t})=>["index"!==e.dataIndex?(openBlock(),createElementBlock(Fragment,{key:0},[createTextVNode(toDisplayString(t[e.dataIndex]),1)],64)):createCommentVNode("",!0)])),_:1},16,["data-source"])])),_:1},8,["open","title","width"])):createCommentVNode("",!0),"drawer"===e.popupType?(openBlock(),createBlock(unref(Drawer),{key:1,title:e.popupTitle,width:e.popupWidth,open:h.value,"onUpdate:open":t[4]||(t[4]=e=>h.value=e),class:normalizeClass(unref(c)+" common-container-drawer")},{default:withCtx((()=>[createBaseVNode("div",_hoisted_4$2,[createBaseVNode("div",_hoisted_5$2,[createVNode(p,{colon:!1,labelAlign:"right",model:unref(x),ref_key:"formElRef",ref:y,class:normalizeClass(S.value)},{default:withCtx((()=>[createVNode(l,{gutter:10},{default:withCtx((()=>[createVNode(r,{span:8},{default:withCtx((()=>[createVNode(a,{label:unref(i)("common.keyword"),name:"keyword"},{default:withCtx((()=>[createVNode(o,{value:unref(x).keyword,"onUpdate:value":t[3]||(t[3]=e=>unref(x).keyword=e),placeholder:unref(i)("common.enterKeyword"),allowClear:"",onPressEnter:O},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),createVNode(r,{span:8},{default:withCtx((()=>[createVNode(a,{label:" "},{default:withCtx((()=>[createVNode(s,{type:"primary",class:"mr-2",onClick:O},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(i)("common.queryText")),1)])),_:1}),createVNode(s,{onClick:J},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(i)("common.resetText")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model","class"]),createBaseVNode("div",_hoisted_6$1,[createVNode(u,{placement:"top"},{title:withCtx((()=>[createBaseVNode("span",null,toDisplayString(unref(i)("common.redo")),1)])),default:withCtx((()=>[createVNode(unref(RedoOutlined),{class:"jnpf-common-search-box-right-icon",onClick:j})])),_:1})])]),createVNode(g,mergeProps({"data-source":unref(w)},P.value,{onChange:z,ref_key:"tableElRef",ref:b}),{bodyCell:withCtx((({column:e,record:t})=>["index"!==e.dataIndex?(openBlock(),createElementBlock(Fragment,{key:0},[createTextVNode(toDisplayString(t[e.dataIndex]),1)],64)):createCommentVNode("",!0)])),_:1},16,["data-source"])]),createBaseVNode("div",{class:normalizeClass(unref(d)),style:normalizeStyle(M.value)},[createVNode(s,{onClick:A,class:"mr-10px"},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(i)("common.cancelText")),1)])),_:1}),createVNode(s,{type:"primary",onClick:L,class:"mr-10px"},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(i)("common.okText")),1)])),_:1})],6)])),_:1},8,["title","width","open","class"])):createCommentVNode("",!0),createVNode(_sfc_main$6,{ref_key:"detailRef",ref:f},null,512),e.extraOptions.length&&"{}"!==JSON.stringify(unref(k))?(openBlock(),createBlock(ExtraRelationInfo,{key:2,extraOptions:e.extraOptions,data:unref(k)},null,8,["extraOptions","data"])):createCommentVNode("",!0)])}}}),JnpfRelationForm=withInstall(_sfc_main$5),{t:t}=useI18n(),getRealProps=(e,t)=>(Reflect.has(e,"clearable")&&(e.allowClear=e.clearable,delete e.clearable),Reflect.has(e,"filterable")&&(e.showSearch=e.filterable,delete e.filterable),Reflect.has(e,"props")&&(e.fieldNames=e.props,delete e.props),"switch"===t&&(e.checkedValue=e.activeValue,e.unCheckedValue=e.inactiveValue,delete e.activeValue,delete e.inactiveValue),"card"===t&&(e.title=e.header,delete e.title,e.hoverable="hover"===e.shadow,delete e.shadow),e),getFormSchemaItem=data=>{const item=getRealProps(data,data.__config__.jnpfKey),componentProps=cloneDeep(item);delete componentProps.on,delete componentProps.__vModel__;let rules=[];const regList=item.__config__.regList;if(regList)for(let i=0;i<regList.length;i++)rules.push({pattern:eval(regList[i].pattern),message:regList[i].messageI18nCode?t(regList[i].messageI18nCode,regList[i].message):regList[i].message,trigger:item.__config__.trigger});const schema={field:item.prop,label:item.labelI18nCode?t(item.labelI18nCode,item.label):item.label,defaultValue:item.__config__.defaultValue,component:upperFirst(item.__config__.jnpfKey),componentProps:componentProps,labelWidth:item.__config__.labelWidth||null,required:item.__config__.required||!1,colProps:{span:item.__config__.span||24},className:item.__config__.className,value:item.value,rules:rules,show:!item.noShow,__config__:item.__config__};return schema},getFormSchemas=e=>{const t=[],n=[];return(e=>{for(let o=0;o<e.length;o++)if(!e[o]?.noShow){const a=getFormSchemaItem(e[o]);n.push({...e[o],schema:a}),t.push(a)}})(e),t},getSearchFormSchemas=e=>{const n=getFormSchemas(e);for(let o=0;o<n.length;o++){const e=n[o];let a=["className","colProps","labelWidth","required","rules","defaultValue"];for(let t=0;t<a.length;t++)delete e[a[t]];if(useInputList.includes(lowerFirst$1(e.component))&&(e.component="Input",e.componentProps={placeholder:t("common.inputTextPrefix")+e.label,allowClear:!0}),useDateList.includes(lowerFirst$1(e.component))&&(e.component="DateRange",e.componentProps={format:"YYYY-MM-DD HH:mm:ss"}),"Switch"===e.component&&(e.componentProps={checkedValue:e.componentProps.checkedValue,unCheckedValue:e.componentProps.unCheckedValue}),useSelectList.includes(lowerFirst$1(e.component))&&(e.component="Select",e.componentProps={options:e.componentProps.options,showSearch:!0,multiple:e.componentProps.searchMultiple||!1,fieldNames:e.componentProps.fieldNames,placeholder:t("common.chooseTextPrefix")+e.label}),["InputNumber","Calculate","Rate","Slider"].includes(e.component)){let t=e.componentProps.precision;(!e.componentProps.precision&&"Calculate"===e.component||"Slider"===e.component)&&(t=0),"Rate"===e.component&&(t=e.componentProps.allowHalf?1:0),e.__config__.isFromParam||(e.component="NumberRange"),e.componentProps={precision:t}}"Cascader"===e.component&&(e.componentProps={options:e.componentProps.options,showSearch:!0,multiple:e.componentProps.searchMultiple||!1,fieldNames:e.componentProps.fieldNames,showAllLevels:e.componentProps.showAllLevels,placeholder:t("common.chooseTextPrefix")+e.label}),"TimePicker"===e.component&&(e.component="TimeRange",e.componentProps={format:e.componentProps.format}),"DatePicker"===e.component&&(e.__config__.isFromParam||(e.component="DateRange"),e.componentProps={format:e.componentProps.format||"yyyy-MM-dd HH:mm:ss"}),"AreaSelect"===e.component&&(e.componentProps={placeholder:t("common.chooseTextPrefix")+e.label,level:e.componentProps.level}),"TreeSelect"===e.component&&(e.componentProps={options:e.componentProps.options,showSearch:!0,multiple:e.componentProps.searchMultiple||!1,fieldNames:e.componentProps.fieldNames,placeholder:t("common.chooseTextPrefix")+e.label}),["CreateUser","ModifyUser"].includes(e.component)&&(e.component="UserSelect",e.componentProps={placeholder:t("common.chooseTextPrefix")+e.label}),"CurrOrganize"===e.component&&(e.component="OrganizeSelect",e.componentProps={multiple:e.componentProps.searchMultiple||!1,placeholder:t("common.chooseTextPrefix")+e.label}),"CurrPosition"===e.component&&(e.component="PosSelect",e.componentProps={multiple:e.componentProps.searchMultiple||!1,placeholder:t("common.chooseTextPrefix")+e.label}),["OrganizeSelect","DepSelect","PosSelect","RoleSelect","GroupSelect","UsersSelect"].includes(e.component)&&(e.componentProps={selectType:e.componentProps.selectType,ableIds:e.componentProps.ableIds,multiple:e.componentProps.searchMultiple||!1,placeholder:t("common.chooseTextPrefix")+e.label}),"UserSelect"===e.component&&(e.componentProps={selectType:"all"!=e.componentProps.selectType&&"custom"!=e.componentProps.selectType?"all":e.componentProps.selectType,ableIds:e.componentProps.ableIds,multiple:e.componentProps.searchMultiple||!1,placeholder:t("common.chooseTextPrefix")+e.label}),"AutoComplete"===e.component&&(e.componentProps={total:e.componentProps.total,interfaceId:e.componentProps.interfaceId,relationField:e.componentProps.relationField,templateJson:e.componentProps.templateJson,placeholder:t("common.inputTextPrefix")+e.label})}if(e.some((e=>e.isKeyword))){const e={field:"jnpfKeyword",label:t("common.keyword"),component:"Input",componentProps:{placeholder:t("common.leftTreeSearchText"),allowClear:!0},value:void 0,show:!0,__config__:{jnpfKey:"input"}};n.unshift(e)}return n},_hoisted_1$2={class:"common-container"},_hoisted_2$1={class:"jnpf-common-search-box jnpf-common-search-box-modal"},_hoisted_3$1={class:"jnpf-common-search-box-right"},_hoisted_4$1={class:"common-container-drawer-body"},_hoisted_5$1={class:"jnpf-common-search-box jnpf-common-search-box-modal"},_hoisted_6={class:"jnpf-common-search-box-right"},_sfc_main$4=defineComponent({name:"SelectModal",inheritAttrs:!1,__name:"SelectModal",props:{config:{type:Object,default:()=>{}},formData:Object},emits:["select"],setup(e,{expose:t,emit:n}){const o=e,a=n,{t:r}=useI18n(),{prefixCls:s}=useDesign("basic-drawer"),{prefixCls:l}=useDesign("basic-form"),{prefixCls:i}=useDesign("basic-table"),c=ref(null),p=ref(!1),u=useUserStore(),d=ref(),f=ref(null),m={width:50,title:"序号",dataIndex:"index",key:"index",align:"center",customRender:({index:e})=>e+1},g=reactive({list:[],listQuery:{keyword:"",currentPage:1,pageSize:20},loading:!1,total:0,selectedRowKeys:[],selectedRows:[]}),{listQuery:h,list:_}=toRefs(g),y=computed((()=>u.getUserInfo||{})),b=computed((()=>"dynamic"==o.config.dataSource)),C=computed((()=>[l,`${l}--compact`,"search-form"])),v=computed((()=>{const e=o.config.columnOptions.filter((e=>e.ifShow||void 0===e.ifShow)).map((e=>({title:e.label,dataIndex:e.value,ellipsis:!0,width:e.width||100})));return[m,...e]})),x=computed((()=>{const e=function(){let e=o.config.templateJson;if(!o.formData)return e;for(let t=0;t<e.length;t++){const n=e[t],a=o.formData;1==n.sourceType&&(n.defaultValue=a[n.relationField]||0==a[n.relationField]||0==a[n.relationField]?a[n.relationField]:""),"createUser"===n.jnpfKey&&(n.defaultValue=unref(y).userId),"createTime"===n.jnpfKey&&(n.defaultValue=(new Date).getTime()),"currOrganize"===n.jnpfKey&&(n.defaultValue=unref(y).organizeId),"currPosition"===n.jnpfKey&&unref(y).positionIds?.length&&(n.defaultValue=unref(y).positionIds[0].id)}return e}(),t=o.config.columnOptions.map((e=>e.value)).join(","),n={interfaceId:o.config.interfaceId,columnOptions:t,paramList:e},a={modelId:o.config.modelId,relationField:o.config.relationField,columnOptions:t};return unref(b)?n:a})),w=computed((()=>({current:g.listQuery.currentPage,pageSize:g.listQuery.pageSize,size:"small",defaultPageSize:20,showTotal:e=>r("component.table.total",{total:e}),showSizeChanger:!0,pageSizeOptions:["20","50","80","100"],showQuickJumper:!0,total:g.total}))),k=computed((()=>({type:"checkbox",onChange:V}))),S=computed((()=>{let e="drawer"===o.config.popupType?window.innerHeight-120-52-38:.7*window.innerHeight-52-38;return e-=44,e})),M=computed((()=>({columns:unref(v),pagination:unref(w),rowSelection:unref(k),size:"small",loading:g.loading,rowKey:e=>e,scroll:{y:unref(S)},class:unref(i)})));function I(){p.value=!1}function T(){if(!g.selectedRowKeys.length&&!g.selectedRows.length)return;c.value=g.selectedRows;let e=[];for(let t=0;t<unref(c).length;t++){const n=unref(c)[t];let a={};for(let e=0;e<o.config.relationOptions.length;e++){const t=o.config.relationOptions[e];a[t.field]=1===t.type?n[unref(b)?t.value:t.value+"_jnpfId"]:t.value}e.push(a)}a("select",e),I()}function D(){g.listQuery.currentPage=1,g.listQuery.pageSize=20,N()}function R(){(function(){const e=unref(d);if(!e)throw new Error("form is null!");return e})().resetFields(),g.listQuery.keyword="",D()}function N(){if(unref(b)&&!o.config.interfaceId)return;if(!unref(b)&&!o.config.modelId)return;g.loading=!0;const e={...g.listQuery,...unref(x)};(unref(b)?getDataInterfaceDataSelect:getFieldDataSelect)(e).then((e=>{g.list=e.data.list,g.total=e.data.pagination.total,g.loading=!1})).catch((()=>{g.loading=!1}))}function P(e){g.listQuery.currentPage=e.current,g.listQuery.pageSize=e.pageSize,N()}function V(e,t){g.selectedRows=t}return t({openSelectModal:function(){p.value=!0,setTimeout((()=>{nextTick((()=>{R(),g.selectedRowKeys=[],g.selectedRows=[],g.list=[],g.total=0;const e=f.value?.$el;e.querySelector(".ant-table-body").style.height=`${unref(S)}px`}))}),50)}}),(t,n)=>{const o=resolveComponent("a-input"),a=resolveComponent("a-form-item"),l=resolveComponent("a-col"),i=resolveComponent("a-button"),c=resolveComponent("a-row"),u=resolveComponent("a-form"),m=resolveComponent("a-tooltip"),g=resolveComponent("a-table");return openBlock(),createElementBlock("div",_hoisted_1$2,["dialog"===e.config.popupType?(openBlock(),createBlock(unref(Modal),{key:0,open:p.value,"onUpdate:open":n[1]||(n[1]=e=>p.value=e),title:e.config.popupTitle,width:e.config.popupWidth,class:"common-container-modal",onOk:T,onCancel:I,maskClosable:!1},{closeIcon:withCtx((()=>[createVNode(ModalClose,{canFullscreen:!1,onCancel:I})])),default:withCtx((()=>[createBaseVNode("div",_hoisted_2$1,[createVNode(u,{colon:!1,labelAlign:"right",model:unref(h),ref_key:"formElRef",ref:d,class:normalizeClass(C.value)},{default:withCtx((()=>[createVNode(c,{gutter:10},{default:withCtx((()=>[createVNode(l,{span:8},{default:withCtx((()=>[createVNode(a,{label:unref(r)("common.keyword"),name:"keyword"},{default:withCtx((()=>[createVNode(o,{value:unref(h).keyword,"onUpdate:value":n[0]||(n[0]=e=>unref(h).keyword=e),placeholder:unref(r)("common.enterKeyword"),allowClear:"",onPressEnter:D},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),createVNode(l,{span:8},{default:withCtx((()=>[createVNode(a,{label:" "},{default:withCtx((()=>[createVNode(i,{type:"primary",class:"mr-2",onClick:D},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(r)("common.queryText")),1)])),_:1}),createVNode(i,{onClick:R},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(r)("common.resetText")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model","class"]),createBaseVNode("div",_hoisted_3$1,[createVNode(m,{placement:"top"},{title:withCtx((()=>[createBaseVNode("span",null,toDisplayString(unref(r)("common.redo")),1)])),default:withCtx((()=>[createVNode(unref(RedoOutlined),{class:"jnpf-common-search-box-right-icon",onClick:N})])),_:1})])]),createVNode(g,mergeProps({"data-source":unref(_)},M.value,{onChange:P,ref_key:"tableElRef",ref:f}),{bodyCell:withCtx((({column:e,record:t})=>["index"!==e.dataIndex?(openBlock(),createElementBlock(Fragment,{key:0},[createTextVNode(toDisplayString(t[e.dataIndex]),1)],64)):createCommentVNode("",!0)])),_:1},16,["data-source"])])),_:1},8,["open","title","width"])):createCommentVNode("",!0),"drawer"===e.config.popupType?(openBlock(),createBlock(unref(Drawer),{key:1,title:e.config.popupTitle,width:e.config.popupWidth,open:p.value,"onUpdate:open":n[3]||(n[3]=e=>p.value=e),class:normalizeClass(unref(s)+" common-container-drawer")},{default:withCtx((()=>[createBaseVNode("div",_hoisted_4$1,[createBaseVNode("div",_hoisted_5$1,[createVNode(u,{colon:!1,labelAlign:"right",model:unref(h),ref_key:"formElRef",ref:d,class:normalizeClass(C.value)},{default:withCtx((()=>[createVNode(c,{gutter:10},{default:withCtx((()=>[createVNode(l,{span:8},{default:withCtx((()=>[createVNode(a,{label:unref(r)("common.keyword"),name:"keyword"},{default:withCtx((()=>[createVNode(o,{value:unref(h).keyword,"onUpdate:value":n[2]||(n[2]=e=>unref(h).keyword=e),placeholder:unref(r)("common.enterKeyword"),allowClear:"",onPressEnter:D},null,8,["value","placeholder"])])),_:1},8,["label"])])),_:1}),createVNode(l,{span:8},{default:withCtx((()=>[createVNode(a,{label:" "},{default:withCtx((()=>[createVNode(i,{type:"primary",class:"mr-2",onClick:D},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(r)("common.queryText")),1)])),_:1}),createVNode(i,{onClick:R},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(r)("common.resetText")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model","class"]),createBaseVNode("div",_hoisted_6,[createVNode(m,{placement:"top"},{title:withCtx((()=>[createBaseVNode("span",null,toDisplayString(unref(r)("common.redo")),1)])),default:withCtx((()=>[createVNode(unref(RedoOutlined),{class:"jnpf-common-search-box-right-icon",onClick:N})])),_:1})])]),createVNode(g,mergeProps({"data-source":unref(_)},M.value,{onChange:P,ref_key:"tableElRef",ref:f}),{bodyCell:withCtx((({column:e,record:t})=>["index"!==e.dataIndex?(openBlock(),createElementBlock(Fragment,{key:0},[createTextVNode(toDisplayString(t[e.dataIndex]),1)],64)):createCommentVNode("",!0)])),_:1},16,["data-source"])]),createVNode(DrawerFooter,{showFooter:"",onClose:I,onOk:T})])),_:1},8,["title","width","open","class"])):createCommentVNode("",!0)])}}}),_hoisted_1$1={key:1,class:"jnpf-child-list"},_hoisted_2={class:"min-h-22px inline-block"},_hoisted_3={class:"min-h-22px inline-block"},_hoisted_4={class:"min-h-22px inline-block"},_hoisted_5={key:0,class:"required-sign"},_sfc_main$3=defineComponent({name:"JnpfInputTable",inheritAttrs:!1,__name:"InputTable",props:{config:{type:Object,default:()=>{}},value:{type:Array,default:()=>[]},formData:Object,relations:Object,vModel:String,disabled:{type:Boolean,default:!1}},emits:["update:value","change"],setup(__props,{expose:__expose,emit:__emit}){const props=__props,emit=__emit,{createMessage:createMessage,createConfirm:createConfirm}=useMessage(),{t:t}=useI18n(),baseStore=useBaseStore(),formItemContext=Form.useInjectFormItemContext(),parameter=inject("parameter"),formConf=inject("formConf"),formStyle=inject("formStyle"),isShortLink=inject("isShortLink"),{prefixCls:prefixCls}=useDesign("input-table"),state=reactive({tableFormData:[],dataSource:[],rowConfig:[],activeRowIndex:0,isAddRow:!0,dataInterfaceInfo:[],selectedRowKeys:[],selectedRows:[],actionConfig:{},defaultRowData:{},outerActiveKey:[0],innerActiveKey:[]}),{tableFormData:tableFormData,dataSource:dataSource,actionConfig:actionConfig,rowConfig:rowConfig}=toRefs(state),selectModal=ref(null);__expose({handleRelationForParent:handleRelationForParent,submit:submit,setTableFormData:setTableFormData,setTableShowOrHide:setTableShowOrHide,setTableDisabled:setTableDisabled,resetTable:resetTable});const getTitle=computed((()=>{const e=props.config.__config__;return e.labelI18nCode?t(e.labelI18nCode,e.label):e.label})),getHelpMessage=computed((()=>{const e=props.config.__config__;return e.tipLabelI18nCode?t(e.tipLabelI18nCode,e.tipLabel):e.tipLabel})),childRelations=computed((()=>{let e={};for(let t in props.relations)if(t.includes("-")){if(t.split("-")[0]===props.vModel){e[t.split("-")[1]]=props.relations[t]}}return e})),getColumnBtnsList=computed((()=>props.config?.columnBtnsList?.length?props.config.columnBtnsList.filter((e=>e.show)):[])),getFooterBtnsList=computed((()=>{if(!props.config?.footerBtnsList?.length)return[];let e=props.config.footerBtnsList.filter((e=>e.show));return unref(isShortLink)&&(e=e.filter((e=>["add","batchRemove"].includes(e.value)))),"list"===props.config.layoutType&&(e=e.filter((e=>"add"==e.value||"batchRemove"!=e.value&&2!==e.actionType))),e})),getHasBatchBtn=computed((()=>unref(getFooterBtnsList).some((e=>"batchRemove"==e.value||2===e.actionType)))),getActionWidth=computed((()=>50*unref(getColumnBtnsList).length)),getColumns=computed((()=>{const e={width:50,title:t("component.table.index"),dataIndex:"index",key:"index",align:"center",customRender:({index:e})=>e+1,fixed:"left"},n={title:t("component.table.action"),dataIndex:"action",key:"action",width:unref(getActionWidth),fixed:"right"};let o=state.rowConfig.map((e=>({...e,dataIndex:e.__vModel__,key:e.__vModel__,width:e.__config__.columnWidth,title:e.__config__.labelI18nCode?t(e.__config__.labelI18nCode,e.__config__.label):e.__config__.label,tipLabel:e.__config__.tipLabelI18nCode?t(e.__config__.tipLabelI18nCode,e.__config__.tipLabel):e.__config__.tipLabel,align:e.__config__.tableAlign||"left",fixed:("left"==e.__config__.tableFixed||"right"==e.__config__.tableFixed)&&e.__config__.tableFixed,customCell:()=>({class:"align-top"})}))).filter((e=>!e.__config__.noShow&&(!e.__config__.visibility||Array.isArray(e.__config__.visibility)&&e.__config__.visibility.includes("pc")))),a=o;if("list"===props.config.layoutType)return a;let r=props.config.__config__.complexHeaderList||[];if(r.length){let e=[],n=[];for(let a=0;a<r.length;a++){const s=r[a];if(s.title=s.fullNameI18nCode?t(s.fullNameI18nCode,s.fullName):s.fullName,s.align=s.align,s.children=[],s.jnpfKey="complexHeader",s.childColumns?.length){e.push(...s.childColumns);for(let e=0;e<s.childColumns.length;e++){const t=s.childColumns[e];for(let e=0;e<o.length;e++){const n=o[e];n.__vModel__==t&&"left"!==n.__config__.tableFixed&&"right"!==n.__config__.tableFixed&&s.children.push({...n})}}}s.children.length&&n.push(s.children[0].__vModel__)}r=r.filter((e=>e.children.length));let s=[];for(let t=0;t<o.length;t++){const a=o[t];if(e.includes(a.__vModel__)&&"left"!==a.__config__?.tableFixed&&"right"!==a.__config__?.tableFixed){if(n.includes(a.__vModel__)){const e=r.find((e=>e.childColumns.includes(a.__vModel__)));s.push(e)}}else s.push(a)}a=s}let s=props.disabled||!unref(getActionWidth)?[e,...a]:[e,...a,n];const l=s.filter((e=>"left"===e.fixed)),i=s.filter((e=>"right"===e.fixed));return[...l,...s.filter((e=>"left"!==e.fixed&&"right"!==e.fixed)),...i]})),getSummaryColumn=computed((()=>{let e=unref(getColumns),t=[];for(let n=0;n<e.length;n++){const o=e[n];if("table"===o.jnpfKey||"complexHeader"===o.jnpfKey?o.children?.length&&t.push(...o.children):t.push(o),o.fixed&&o.children?.length)for(let e=0;e<o.children.length;e++)o.children[e].fixed=o.fixed}return t.filter((e=>"index"!=e?.key&&"action"!=e?.key))})),getColumnSum=computed((()=>{const e=unref(getSummaryColumn),t=[];return e.filter((e=>!e.__config__.noShow&&(!e.__config__.visibility||e.__config__.visibility.includes("pc")))).forEach(((n,o)=>{let a=state.dataSource.reduce(((e,t)=>e+getCmpValOfRow(t,n.__vModel__)),0);var r;r=n.__vModel__,props.config.summaryField.includes(r)||(a=""),a=Number.isNaN(a)?"":a;const s=a&&!Number.isInteger(a)?Number(a).toFixed(2):a;t[o]=(t=>e.some((e=>e.__vModel__===t&&e.thousands)))(n.__vModel__)?thousandsFormat(s):s.toString()})),unref(getHasBatchBtn)&&t.unshift(""),t})),getRowSelection=computed((()=>{if(!unref(getHasBatchBtn))return;return{selectedRowKeys:state.selectedRowKeys,onChange:(e,t)=>{state.selectedRowKeys=e||[],state.selectedRows=t||[]},columnWidth:50}})),getTableBindValues=computed((()=>({columns:unref(getColumns),rowSelection:unref(getRowSelection),pagination:!1,size:"small",rowKey:"jnpfId",scroll:{x:"max-content"},bordered:"word-form"===formStyle||!!props.config.__config__?.complexHeaderList?.length}))),getSystemField=computed((()=>{let e=[];return state.rowConfig.map((t=>systemComponentsList.includes(t.__config__.jnpfKey)&&e.push(t.__vModel__))),e}));function buildOptions(){state.rowConfig.forEach(((e,t)=>{const n=e.__config__;if(dyOptionsList.indexOf(n.jnpfKey)>-1&&("dictionary"===n.dataType&&n.dictionaryType&&baseStore.getDicDataSelector(n.dictionaryType).then((t=>{e.options=t})),"dynamic"===n.dataType&&n.propsUrl)){const o={paramList:n.templateJson?getDefaultParamList(n.templateJson,props.formData):[]},a={matchInfo:JSON.stringify({id:n.propsUrl,query:o}),rowIndex:-1,colIndex:t};state.dataInterfaceInfo.push(a),getDataInterfaceRes(n.propsUrl,o).then((t=>{e.options=Array.isArray(t.data)?t.data:[]}))}}))}function handleRelationForParent(e,t,n){if(state.tableFormData.length){for(let o=0;o<state.tableFormData.length;o++){let a=state.tableFormData[o];for(let r=0;r<a.length;r++){let s=a[r];if(e.__vModel__===s.__vModel__){if(n||(state.dataSource[o][s.__vModel__]=t),"setOptions"===e.opType){s.config.options=[];const t={paramList:getParamList(e.__config__.templateJson,props.formData,o)};getDataInterfaceRes(e.__config__.propsUrl,t).then((e=>{const t=e.data;s.config.options=Array.isArray(t)?t:[]}))}if("setUserOptions"===e.opType){const t=props.formData[e.relationField]||[];s.config.ableRelationIds=Array.isArray(t)?t:[t]}if("setStartTime"===e.opType){const t=props.formData[e.__config__.startRelationField]||null;s.config.startTime=t}if("setEndTime"===e.opType){const t=props.formData[e.__config__.endRelationField]||null;s.config.endTime=t}}}}updateParentData()}}function handleRelation(e,t){const n=unref(childRelations);for(let o in n)if(o===e.__vModel__)for(let e=0;e<n[o].length;e++){const a=n[o][e],r=a.__config__.jnpfKey;let s=null;(["checkbox","cascader","organizeSelect"].includes(r)||["select","treeSelect","popupSelect","popupTableSelect","userSelect"].includes(r)&&a.multiple)&&(s=[]);let l=state.tableFormData[t];for(let e=0;e<l.length;e++){let n=l[e];if(a.__vModel__===n.__vModel__){if("setOptions"===a.opType){n.config.options=[];const e={paramList:getParamList(a.__config__.templateJson,props.formData,t)};getDataInterfaceRes(a.__config__.propsUrl,e).then((e=>{n.config.options=Array.isArray(e.data)?e.data:[]}))}if("setUserOptions"===a.opType){const e=getFieldVal(a.relationField,t)||[];n.config.ableRelationIds=Array.isArray(e)?e:[e]}if("setStartTime"===a.opType){const e=getFieldVal(a.__config__.startRelationField,t)||null;n.config.startTime=e}if("setEndTime"===a.opType){const e=getFieldVal(a.__config__.endRelationField,t)||null;n.config.endTime=e}state.dataSource[t][n.__vModel__]!==s&&(state.dataSource[t][n.__vModel__]=s,nextTick((()=>handleRelation(n,t))))}}}updateParentData()}function buildRowAttr(e){let t=state.tableFormData[e];for(let n=0;n<t.length;n++){const o=t[n].config,a=o.__config__;if(dyOptionsList.indexOf(a.jnpfKey)>-1&&("dictionary"===a.dataType&&a.dictionaryType&&baseStore.getDicDataSelector(a.dictionaryType).then((e=>{o.options=e})),"dynamic"===a.dataType&&a.propsUrl)){if(o.options?.length&&(!a.templateJson||!a.templateJson.length||!hasTemplateJsonRelation(a.templateJson)))continue;const t={paramList:a.templateJson?getParamList(a.templateJson,props.formData,e):[]},r=JSON.stringify({id:a.propsUrl,query:t}),s={matchInfo:r,rowIndex:e,colIndex:n},l=state.dataInterfaceInfo.findIndex((e=>e.matchInfo===r));let i=!1;if(-1===l)state.dataInterfaceInfo.push(s);else{const e=getCacheOptions(l);e.length&&(o.options=e,i=!0)}i||getDataInterfaceRes(a.propsUrl,t).then((e=>{o.options=Array.isArray(e.data)?e.data:[]})).catch((()=>{o.options=[]}))}if("userSelect"===a.jnpfKey&&o.relationField&&"all"!==o.selectType&&"custom"!==o.selectType){let t=getFieldVal(o.relationField,e)||[];o.ableRelationIds=Array.isArray(t)?t:[t]}"datePicker"!==a.jnpfKey&&"timePicker"!==a.jnpfKey||(a.startTimeRule&&2==a.startTimeType&&a.startRelationField&&(o.startTime=getFieldVal(a.startRelationField,e)||null),a.endTimeRule&&2==a.endTimeType&&a.endRelationField&&(o.endTime=getFieldVal(a.endRelationField,e)||null))}}function getCacheOptions(e){const t=state.dataInterfaceInfo[e];return-1===t.rowIndex?state.rowConfig[t.colIndex].options||[]:state.tableFormData[t.rowIndex][t.colIndex].config.options||[]}function hasTemplateJsonRelation(e){return e.some((e=>e.relationField))}function getParamList(e,t,n){for(let o=0;o<e.length;o++)if(e[o].relationField&&1==e[o].sourceType)if(e[o].relationField.includes("-")){const t=e[o].relationField.split("-")[1];e[o].defaultValue=state.dataSource[n][t]||""}else e[o].defaultValue=t[e[o].relationField]||"";return e}function getDefaultParamList(e,t){for(let n=0;n<e.length;n++)if(e[n].relationField&&1==e[n].sourceType)if(e[n].relationField.includes("-")){let t=e[n].relationField.split("-")[1],o=state.rowConfig.filter((e=>e.__vModel__===t));e[n].defaultValue="",o.length&&(e[n].defaultValue=o[0].__config__.defaultValue||"")}else e[n].defaultValue=t[e[n].relationField]||"";return e}function getFieldVal(e,t){let n="";if(e.includes("-")){const o=e.split("-")[1];n=state.dataSource[t][o]||""}else n=props.formData[e]||"";return n}function clearAddRowFlag(){nextTick((()=>{state.isAddRow=!1}))}function setTableFormData(e,t){state.dataSource[state.activeRowIndex||0][e]=t}function setTableDisabled(e,t){let n=state.tableFormData[state.activeRowIndex||0];for(let o=0;o<n.length;o++)if(n[o].__vModel__===e){n[o].config.disabled=t;break}}function setTableShowOrHide(e,t){for(let n=0;n<state.rowConfig.length;n++)if(state.rowConfig[n].__vModel__===e){state.rowConfig[n].__config__.noShow=t;break}}function onFormBlur(e,t,n){const o=state.tableFormData[e][t];if(o&&o.on&&o.on.blur){const t=getScriptFunc(o.on.blur);if(!t)return;t({data:n,rowIndex:e,...unref(parameter)})}}function onFormDataChange(e,t,n,o){if(state.isAddRow)return;const a=state.tableFormData[e][t]||{};if(a.value=n,state.activeRowIndex=e,"list"!==props.config.layoutType&&(a.required&&(a.valid=checkData(a)),a.regList&&a.regList.length&&(a.regValid=checkRegData(a))),updateParentData(),handleRelation(a,e),a&&a.on&&a.on.change){const t=getScriptFunc(a.on.change);if(!t)return;t({data:o||n,rowIndex:e,...unref(parameter)})}["popupSelect","relationForm"].includes(a.jnpfKey)&&setTransferFormData(o,a.config.__config__)}function setTransferFormData(e,t){if(t?.transferList?.length)for(let n=0;n<t.transferList.length;n++){const o=t.transferList[n];o.sourceValue.includes("-")&&(o.sourceValue=o.sourceValue.split("-")[1]),state.dataSource[state.activeRowIndex][o.sourceValue]=e?e[o.targetField]:void 0,updateParentData()}}function checkData({value:e}){return![null,void 0,""].includes(e)&&(!Array.isArray(e)||e.length>0)}function checkRegData(col){let res=!0;for(let i=0;i<col.regList.length;i++){const item=col.regList[i];if(item.pattern){let pattern=eval(item.pattern);if(col.value&&!pattern.test(col.value)){res=!1,col.regErrorText=item.messageI18nCode?t(item.messageI18nCode,item.message):item.message;break}}}return res}function submit(){if("list"===props.config.layoutType)return getDataSource();let e=!0;const t=(t,n)=>{n.value=state.dataSource[t][n.__vModel__];const o=n.config.__config__.noShow;!o&&n.required&&!checkData(n)&&(e=n.valid=!1),!o&&n.regList&&n.regList.length&&!checkRegData(n)&&(e=n.regValid=!1)};return state.tableFormData.forEach(((e,n)=>e.forEach(t.bind(null,n)))),!!e&&getDataSource()}function getConfById(e,n){let o=state.tableFormData[n].find((t=>t.formId===e)).config,a=o.__config__,r={};o=getRealProps(o,a.jnpfKey);for(const s in o)["__config__","__vModel__","on"].includes(s)||(r[s]=o[s]),"disabled"===s&&(r[s]=props.disabled||o[s]),"placeholder"===s&&o.placeholderI18nCode&&(r[s]=t(o.placeholderI18nCode,o.placeholder));if(["relationForm","popupSelect"].includes(a.jnpfKey)&&(r.field=props.config.__vModel__+o.__vModel__+"_jnpfRelation_"+state.dataSource[n].jnpfId,delete r.extraOptions),["relationFormAttr","popupAttr"].includes(a.jnpfKey)){let e=r.relationField.split("_jnpfTable_")[0];r.relationField=props.config.__vModel__+e+"_jnpfRelation_"+state.dataSource[n].jnpfId}return r}function getLabelCol(e){const t=unref(formConf).labelWidth;let n={};if("top"!==unref(formConf).labelPosition&&e.showLabel){let o=(e.labelWidth||t)+"px";e.showLabel||(o="0px"),n={style:{width:o}}}return n}function getFormItemRules(config){let rules=[];if(Array.isArray(config.regList)||(config.regList=[]),config.required){const e={required:config.required,message:`${config.label}不能为空`,trigger:config.trigger||"blur"};Array.isArray(config.defaultValue)&&(e.type="array",e.message=`请至少选择一个${config.label}`),config.regList.push(e)}return rules=config.regList.map((item=>(item.pattern&&isRegExp(item.pattern)&&(item.pattern=eval(item.pattern)),item.trigger=config.trigger||"blur",item))),rules}function isRegExp(val){try{return"[object RegExp]"===Object.prototype.toString.call(eval(val))}catch{return!1}}function getEmptyRow(e){return state.rowConfig.map((t=>({tag:t.__config__.tag,formId:t.__config__.formId,value:e?Reflect.has(e,t.__vModel__)?e[t.__vModel__]:getDefaultEmptyValue(t):t.__config__.defaultValue,options:dyOptionsList.indexOf(t.__config__.jnpfKey)>-1?t.options:[],valid:!0,regValid:!0,regErrorText:"",on:t.on||{},jnpfKey:t.__config__.jnpfKey,__vModel__:t.__vModel__,regList:t.__config__.regList||[],required:t.__config__.required,rowData:e||{},config:t})))}function getDefaultEmptyValue(e){if(!e.__config__||!e.__config__.jnpfKey)return;const t=e.__config__.jnpfKey;return["checkbox","uploadFile","uploadImg","cascader","organizeSelect","areaSelect"].includes(t)||e.multiple?[]:void 0}function getDataSource(){return state.dataSource}function updateParentData(){const e=getDataSource();emit("update:value",e),emit("change",e),formItemContext.onFieldChange()}function columnBtnsHandle(e,t){return"remove"==e.value?removeRow(t,e.showConfirm):"copy"==e.value?copyRow(t):void 0}function removeRow(e,n=!1){const o=()=>{state.tableFormData.splice(e,1),state.dataSource.splice(e,1),nextTick((()=>updateParentData()))};if(!n)return o();createConfirm({iconType:"warning",title:t("common.tipTitle"),content:t("common.delTip"),onOk:o})}function openSelectDialog(){unref(selectModal)?.openSelectModal()}function addForSelect(e){e.forEach((e=>copyData(cloneDeep({...state.defaultRowData,...e}))))}function addRow(e,t=!0){state.isAddRow=!0,e||updateRowConfig();const n=cloneDeep(e||state.defaultRowData),o=buildUUID();n.jnpfId=o,state.dataSource.push(n),Array.isArray(state.tableFormData)||(state.tableFormData=[]);const a=state.tableFormData.length,r=cloneDeep(getEmptyRow(e));r.jnpfId=o,state.tableFormData.push(r),buildRowAttr(a),nextTick((()=>{t&&("list"===props.config.layoutType&&props.config.defaultExpandAll&&state.innerActiveKey.push(o),updateParentData()),clearAddRowFlag()}))}function copyRow(e){copyData(cloneDeep(state.dataSource[e]))}function copyData(e){const t={};for(let[n]of Object.entries(state.defaultRowData))t[n]=isUnDef(e[n])||unref(getSystemField).includes(n)?null:e[n];addRow(t)}function footerBtnsHandle(e){return"add"==e.value?addRow():"batchRemove"==e.value?batchRemoveRow(e):(state.actionConfig=e.actionConfig,2===e.actionType?state.selectedRowKeys.length?(2==state.actionConfig.executeType&&handleScriptFunc(),void(3==state.actionConfig.executeType&&handleBatchInterface())):createMessage.error(t("common.selectDataTip")):void openSelectDialog())}function handleScriptFunc(){const e={data:state.selectedRows,onlineUtils:onlineUtils},t=getScriptFunc(state.actionConfig.executeFunc);t&&t(e)}function handleBatchInterface(){const e=(e,t)=>{if(!e?.length)return[];for(let n=0;n<e.length;n++){const o=e[n];1==o.sourceType&&t?.length&&(o.defaultValue=t.map((e=>e[o.relationField])))}return e},n=t=>{const n={paramList:e(state.actionConfig.executeTemplateJson,t)||[]};getDataInterfaceRes(state.actionConfig.executeInterfaceId,n).then((e=>{createMessage.success(e.msg)}))};if(!state.actionConfig.executeUseConfirm)return n(state.selectedRows);createConfirm({iconType:"warning",title:t("common.tipTitle"),content:state.actionConfig.executeConfirmTitle||"确认执行此操作?",onOk:()=>{n(state.selectedRows)}})}function batchRemoveRow(e){if(!state.selectedRowKeys.length)return createMessage.error(t("common.selectDataTip"));const n=()=>{state.tableFormData=state.tableFormData.filter((e=>!state.selectedRowKeys.includes(e.jnpfId))),state.dataSource=state.dataSource.filter((e=>!state.selectedRowKeys.includes(e.jnpfId))),nextTick((()=>{state.selectedRowKeys=[],updateParentData()}))};if(!e.showConfirm)return n();createConfirm({iconType:"warning",title:t("common.tipTitle"),content:t("common.delTip"),onOk:n})}function getCmpValOfRow(e,t){if(!props.config.summaryField.length||(n=t,!props.config.summaryField.includes(n)))return 0;var n;const o=e[t];if(!o)return 0;return isNaN(o)?0:Number(o)}function resetTable(){state.dataSource=[],state.tableFormData=[]}function getSummaryCellAlign(e){if(unref(getSummaryColumn).length)return unref(getHasBatchBtn)&&e--,unref(getSummaryColumn)[e]?.align||"left"}function updateRowConfig(){const e={},n=new Date;state.rowConfig=state.rowConfig.map((o=>(o.__config__.defaultCurrent&&("datePicker"===o.__config__.jnpfKey&&(o.__config__.defaultValue=dayjs(n).startOf(getDateTimeUnit(o.format)).valueOf()),"timePicker"===o.__config__.jnpfKey&&(o.__config__.defaultValue=dayjs(n).format(o.format||"HH:mm:ss"))),e[o.__vModel__]=o.__config__.defaultValue,o.__config__&&dyOptionsList.includes(o.__config__.jnpfKey)&&"static"!==o.__config__.dataType&&(o.options=[]),"list"===props.config.layoutType&&(o.formItemRules=getFormItemRules(cloneDeep(o.__config__)),o.labelCol=getLabelCol(o.__config__),o.title=o.__config__.labelI18nCode?t(o.__config__.labelI18nCode,o.__config__.label):o.__config__.label,o.tipLabel=o.__config__.tipLabelI18nCode?t(o.__config__.tipLabelI18nCode,o.__config__.tipLabel):o.__config__.tipLabel),o))),"list"===props.config.layoutType&&(state.rowConfig=state.rowConfig.filter((e=>!e.__config__.noShow&&(!e.__config__.visibility||Array.isArray(e.__config__.visibility)&&e.__config__.visibility.includes("pc"))))),state.defaultRowData=e}function setActiveKey(){if("list"===props.config.layoutType&&(state.outerActiveKey=[0],state.innerActiveKey=[],props.config.defaultExpandAll&&(state.innerActiveKey=["summary"],state.dataSource.length)))for(let e=0;e<state.dataSource.length;e++)state.innerActiveKey.push(state.dataSource[e].jnpfId)}function init(){resetTable(),state.rowConfig=props.config.__config__.children||[],updateRowConfig(),buildOptions(),state.dataSource=[],state.tableFormData=[],props.value&&Array.isArray(props.value)&&props.value.length&&props.value.forEach((e=>addRow(e,!1))),nextTick((()=>setActiveKey()))}return onMounted((()=>{init()})),(e,n)=>{const o=resolveComponent("JnpfGroupTitle"),a=resolveComponent("BasicHelp"),r=resolveComponent("a-button"),s=resolveComponent("a-space"),l=resolveComponent("a-form-item"),i=resolveComponent("a-col"),c=resolveComponent("a-row"),p=resolveComponent("a-collapse-panel"),u=resolveComponent("JnpfInput"),d=resolveComponent("a-collapse"),f=resolveComponent("a-table-summary-cell"),m=resolveComponent("a-table-summary-row"),g=resolveComponent("a-table-summary"),h=resolveComponent("a-table");return openBlock(),createElementBlock("div",{class:normalizeClass(unref(prefixCls))},["list"!==__props.config.layoutType&&__props.config.__config__.showTitle&&getTitle.value?(openBlock(),createBlock(o,{key:0,content:getTitle.value,helpMessage:getHelpMessage.value,bordered:!1},null,8,["content","helpMessage"])):createCommentVNode("",!0),"list"===__props.config.layoutType?(openBlock(),createElementBlock("div",_hoisted_1$1,[createVNode(d,{expandIconPosition:"end",bordered:!1,class:"outer-collapse",activeKey:state.outerActiveKey,"onUpdate:activeKey":n[1]||(n[1]=e=>state.outerActiveKey=e)},{default:withCtx((()=>[createVNode(p,{forceRender:""},{header:withCtx((()=>[createBaseVNode("span",_hoisted_2,toDisplayString(__props.config.__config__.showTitle?getTitle.value:""),1),__props.config.__config__.showTitle&&getTitle.value&&getHelpMessage.value?(openBlock(),createBlock(a,{key:0,text:getHelpMessage.value},null,8,["text"])):createCommentVNode("",!0)])),default:withCtx((()=>[createVNode(d,{bordered:!1,activeKey:state.innerActiveKey,"onUpdate:activeKey":n[0]||(n[0]=e=>state.innerActiveKey=e)},{expandIcon:withCtx((({isActive:e})=>[createVNode(unref(CaretRightOutlined),{rotate:e?90:0},null,8,["rotate"])])),default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(dataSource),((e,n)=>(openBlock(),createBlock(p,{key:e.jnpfId,forceRender:""},createSlots({header:withCtx((()=>[createBaseVNode("span",_hoisted_3,toDisplayString(__props.config.__config__.showTitle?getTitle.value:"")+"("+toDisplayString(n+1)+")",1)])),default:withCtx((()=>[createVNode(c,{gutter:unref(formConf).formStyle?0:unref(formConf).gutter},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(rowConfig),((t,o)=>(openBlock(),createBlock(i,{span:t.__config__.span,key:t.__config__.formId},{default:withCtx((()=>[createVNode(l,{name:[__props.vModel,n,t.__vModel__],required:t.__config__.required,labelCol:t.labelCol,rules:t.formItemRules},createSlots({default:withCtx((()=>["JnpfRelationForm"===t.__config__.tag?(openBlock(),createBlock(unref(JnpfRelationForm),mergeProps({key:0,rowIndex:n,tableVModel:__props.config.__vModel__,componentVModel:t.__vModel__},{ref_for:!0},getConfById(t.__config__.formId,n),{value:e[t.__vModel__],"onUpdate:value":n=>e[t.__vModel__]=n,formData:__props.formData,onBlur:e=>onFormBlur(n,o,e),onChange:(e,t)=>onFormDataChange(n,o,e,t)}),null,16,["rowIndex","tableVModel","componentVModel","value","onUpdate:value","formData","onBlur","onChange"])):createCommentVNode("",!0),(openBlock(),createBlock(resolveDynamicComponent(t.__config__.tag),mergeProps({rowIndex:n,tableVModel:__props.config.__vModel__,componentVModel:t.__vModel__},{ref_for:!0},getConfById(t.__config__.formId,n),{value:e[t.__vModel__],"onUpdate:value":n=>e[t.__vModel__]=n,formData:__props.formData,onBlur:e=>onFormBlur(n,o,e),onChange:(e,t)=>onFormDataChange(n,o,e,t)}),null,16,["rowIndex","tableVModel","componentVModel","value","onUpdate:value","formData","onBlur","onChange"]))])),_:2},[t.__config__.showLabel?{name:"label",fn:withCtx((()=>[createTextVNode(toDisplayString(t.title?t.title+(t.__config__.labelSuffix||""):"")+" ",1),t.title&&t.tipLabel?(openBlock(),createBlock(a,{key:0,text:t.tipLabel},null,8,["text"])):createCommentVNode("",!0)])),key:"0"}:void 0]),1032,["name","required","labelCol","rules"])])),_:2},1032,["span"])))),128))])),_:2},1032,["gutter"])])),_:2},[__props.disabled?void 0:{name:"extra",fn:withCtx((()=>[getColumnBtnsList.value.length?(openBlock(),createBlock(s,{key:0},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(getColumnBtnsList.value,(e=>(openBlock(),createBlock(r,{class:"!px-0",type:"link",color:"remove"==e.value?"error":"",onClick:withModifiers((t=>columnBtnsHandle(e,n)),["stop"]),size:"small",key:e.value},{default:withCtx((()=>[createTextVNode(toDisplayString(e.labelI18nCode?unref(t)(e.labelI18nCode,e.label):e.label),1)])),_:2},1032,["color","onClick"])))),128))])),_:2},1024)):createCommentVNode("",!0)])),key:"0"}]),1024)))),128)),unref(tableFormData).length&&__props.config.showSummary?(openBlock(),createBlock(p,{key:"summary"},{header:withCtx((()=>[createBaseVNode("span",_hoisted_4,toDisplayString(unref(t)("component.table.summary")),1)])),default:withCtx((()=>[createVNode(c,{gutter:unref(formConf).formStyle?0:unref(formConf).gutter},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(rowConfig),((e,t)=>(openBlock(),createElementBlock(Fragment,{key:e.__config__.formId},[e.__vModel__&&__props.config.summaryField.includes(e.__vModel__)?(openBlock(),createBlock(i,{key:0,span:e.__config__.span},{default:withCtx((()=>[createVNode(l,{labelCol:e.labelCol},createSlots({default:withCtx((()=>[createVNode(u,{value:getColumnSum.value[t],disabled:"",style:normalizeStyle(e.style)},null,8,["value","style"])])),_:2},[e.__config__.showLabel?{name:"label",fn:withCtx((()=>[createTextVNode(toDisplayString(e.title?e.title+(e.__config__.labelSuffix||""):"")+" ",1),e.title&&e.tipLabel?(openBlock(),createBlock(a,{key:0,text:e.tipLabel},null,8,["text"])):createCommentVNode("",!0)])),key:"0"}:void 0]),1032,["labelCol"])])),_:2},1032,["span"])):createCommentVNode("",!0)],64)))),128))])),_:1},8,["gutter"])])),_:1})):createCommentVNode("",!0)])),_:1},8,["activeKey"]),!__props.disabled&&getFooterBtnsList.value.length?(openBlock(),createBlock(s,{key:0,class:"input-table-footer-btn"},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(getFooterBtnsList.value,(e=>(openBlock(),createBlock(r,{type:"text"==e.btnType?"link":e.btnType,preIcon:e.btnIcon,onClick:t=>footerBtnsHandle(e),key:e.value},{default:withCtx((()=>[createTextVNode(toDisplayString(e.labelI18nCode?unref(t)(e.labelI18nCode,e.label):e.label),1)])),_:2},1032,["type","preIcon","onClick"])))),128))])),_:1})):createCommentVNode("",!0)])),_:1})])),_:1},8,["activeKey"])])):(openBlock(),createBlock(h,mergeProps({key:2,"data-source":unref(dataSource)},getTableBindValues.value),createSlots({headerCell:withCtx((({column:e})=>[e.__config__&&e.__config__.required?(openBlock(),createElementBlock("span",_hoisted_5,"*")):createCommentVNode("",!0),createTextVNode(toDisplayString(e.title)+" ",1),e.title&&e.tipLabel?(openBlock(),createBlock(a,{key:1,text:e.tipLabel},null,8,["text"])):createCommentVNode("",!0)])),bodyCell:withCtx((({column:e,record:n,index:o})=>["index"===e.key?(openBlock(),createElementBlock(Fragment,{key:0},[createTextVNode(toDisplayString(o+1),1)],64)):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(rowConfig),((a,r)=>(openBlock(),createElementBlock(Fragment,null,[e.key===a.__vModel__&&e.__config__.formId===a.__config__.formId?(openBlock(),createElementBlock("div",{key:a.__config__.formId},["JnpfRelationForm"===a.__config__.tag?(openBlock(),createBlock(unref(JnpfRelationForm),mergeProps({key:0,rowIndex:o,tableVModel:__props.config.__vModel__,componentVModel:a.__vModel__},{ref_for:!0},getConfById(a.__config__.formId,o),{value:n[e.__vModel__],"onUpdate:value":t=>n[e.__vModel__]=t,formData:__props.formData,onBlur:e=>onFormBlur(o,r,e),onChange:(e,t)=>onFormDataChange(o,r,e,t)}),null,16,["rowIndex","tableVModel","componentVModel","value","onUpdate:value","formData","onBlur","onChange"])):createCommentVNode("",!0),(openBlock(),createBlock(resolveDynamicComponent(a.__config__.tag),mergeProps({rowIndex:o,tableVModel:__props.config.__vModel__,componentVModel:a.__vModel__},{ref_for:!0},getConfById(a.__config__.formId,o),{value:n[e.__vModel__],"onUpdate:value":t=>n[e.__vModel__]=t,formData:__props.formData,onBlur:e=>onFormBlur(o,r,e),onChange:(e,t)=>onFormDataChange(o,r,e,t)}),null,16,["rowIndex","tableVModel","componentVModel","value","onUpdate:value","formData","onBlur","onChange"])),withDirectives(createBaseVNode("div",{class:"error-tip required-sign"},toDisplayString(e.title)+toDisplayString(unref(t)("sys.validate.textRequiredSuffix")),513),[[vShow,!unref(tableFormData)[o][r].valid]]),withDirectives(createBaseVNode("div",{class:"error-tip required-sign"},toDisplayString(unref(tableFormData)[o][r].regErrorText),513),[[vShow,unref(tableFormData)[o][r].valid&&!unref(tableFormData)[o][r].regValid]])])):createCommentVNode("",!0)],64)))),256)),"action"===e.key?(openBlock(),createElementBlock(Fragment,{key:1},[getColumnBtnsList.value.length?(openBlock(),createBlock(s,{key:0},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(getColumnBtnsList.value,(e=>(openBlock(),createBlock(r,{class:"action-btn",type:"link",color:"remove"==e.value?"error":"",onClick:t=>columnBtnsHandle(e,o),size:"small",key:e.value},{default:withCtx((()=>[createTextVNode(toDisplayString(e.labelI18nCode?unref(t)(e.labelI18nCode,e.label):e.label),1)])),_:2},1032,["color","onClick"])))),128))])),_:2},1024)):createCommentVNode("",!0)],64)):createCommentVNode("",!0)])),_:2},[unref(tableFormData).length&&__props.config.showSummary?{name:"summary",fn:withCtx((()=>[createVNode(g,{fixed:""},{default:withCtx((()=>[createVNode(m,null,{default:withCtx((()=>[createVNode(f,{index:0,align:"center"},{default:withCtx((()=>[createTextVNode(toDisplayString(unref(t)("component.table.summary")),1)])),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(getColumnSum.value,((e,t)=>(openBlock(),createBlock(f,{key:t,index:t+1,align:getSummaryCellAlign(t)},{default:withCtx((()=>[createTextVNode(toDisplayString(e),1)])),_:2},1032,["index","align"])))),128)),__props.disabled?createCommentVNode("",!0):(openBlock(),createBlock(f,{key:0,index:getColumnSum.value.length+1},null,8,["index"]))])),_:1})])),_:1})])),key:"0"}:void 0]),1040,["data-source"])),"list"!==__props.config.layoutType&&!__props.disabled&&getFooterBtnsList.value.length?(openBlock(),createBlock(s,{key:3,class:"input-table-footer-btn"},{default:withCtx((()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(getFooterBtnsList.value,(e=>(openBlock(),createBlock(r,{type:"text"==e.btnType?"link":e.btnType,preIcon:e.btnIcon,onClick:t=>footerBtnsHandle(e),key:e.value},{default:withCtx((()=>[createTextVNode(toDisplayString(e.labelI18nCode?unref(t)(e.labelI18nCode,e.label):e.label),1)])),_:2},1032,["type","preIcon","onClick"])))),128))])),_:1})):createCommentVNode("",!0),createVNode(_sfc_main$4,{config:unref(actionConfig),formData:__props.formData,ref_key:"selectModal",ref:selectModal,onSelect:addForSelect},null,8,["config","formData"])],2)}}}),InputTable_vue_vue_type_style_index_0_scoped_db1b1626_lang="",InputTable=_export_sfc(_sfc_main$3,[["__scopeId","data-v-db1b1626"]]),JnpfInputTable=withInstall(InputTable),JnpfInputPassword=Input.Password;JnpfInputPassword.name="JnpfInputPassword";const JnpfInputGroup=Input.Group;JnpfInputGroup.name="JnpfInputGroup";const JnpfInputSearch=Input.Search;JnpfInputSearch.name="JnpfInputSearch";const JnpfEditor=Tinymce;JnpfEditor.name="JnpfEditor";const JnpfGroupTitle=BasicCaption;JnpfGroupTitle.name="JnpfGroupTitle";const JnpfMonthPicker=DatePicker.MonthPicker;JnpfMonthPicker.name="JnpfMonthPicker";const JnpfWeekPicker=DatePicker.WeekPicker;JnpfWeekPicker.name="JnpfWeekPicker";const empty=e=>0===Object.keys(e).length,extend=(e,t)=>e.push.apply(e,t),translate=(e,t)=>e.split("").map((e=>t[e]||e)).join(""),sorted=e=>e.sort(((e,t)=>e.i-t.i||e.j-t.j)),buildRankedDictionary=e=>{const t={};let n=1;return e.forEach((e=>{t[e]=n,n+=1})),t};var dateSplits={4:[[1,2],[2,3]],5:[[1,3],[2,3],[2,4]],6:[[1,2],[2,4],[4,5]],7:[[1,3],[2,3],[4,5],[4,6]],8:[[2,4],[4,6]]};const DATE_MAX_YEAR=2050,DATE_MIN_YEAR=1e3,DATE_SPLITS=dateSplits,BRUTEFORCE_CARDINALITY=10,MIN_GUESSES_BEFORE_GROWING_SEQUENCE=1e4,MIN_SUBMATCH_GUESSES_SINGLE_CHAR=10,MIN_SUBMATCH_GUESSES_MULTI_CHAR=50,MIN_YEAR_SPACE=20,START_UPPER=/^[A-Z\xbf-\xdf][^A-Z\xbf-\xdf]+$/,END_UPPER=/^[^A-Z\xbf-\xdf]+[A-Z\xbf-\xdf]$/,ALL_UPPER=/^[A-Z\xbf-\xdf]+$/,ALL_UPPER_INVERTED=/^[^a-z\xdf-\xff]+$/,ALL_LOWER=/^[a-z\xdf-\xff]+$/,ALL_LOWER_INVERTED=/^[^A-Z\xbf-\xdf]+$/,ONE_LOWER=/[a-z\xdf-\xff]/,ONE_UPPER=/[A-Z\xbf-\xdf]/,ALPHA_INVERTED=/[^A-Za-z\xbf-\xdf]/gi,ALL_DIGIT=/^\d+$/,REFERENCE_YEAR=(new Date).getFullYear(),REGEXEN={recentYear:/19\d\d|200\d|201\d|202\d/g};class MatchDate{match({password:e}){const t=[...this.getMatchesWithoutSeparator(e),...this.getMatchesWithSeparator(e)],n=this.filterNoise(t);return sorted(n)}getMatchesWithSeparator(e){const t=[],n=/^(\d{1,4})([\s/\\_.-])(\d{1,2})\2(\d{1,4})$/;for(let o=0;o<=Math.abs(e.length-6);o+=1)for(let a=o+5;a<=o+9&&!(a>=e.length);a+=1){const r=e.slice(o,+a+1||9e9),s=n.exec(r);if(null!=s){const e=this.mapIntegersToDayMonthYear([parseInt(s[1],10),parseInt(s[3],10),parseInt(s[4],10)]);null!=e&&t.push({pattern:"date",token:r,i:o,j:a,separator:s[2],year:e.year,month:e.month,day:e.day})}}return t}getMatchesWithoutSeparator(e){const t=[],n=/^\d{4,8}$/,o=e=>Math.abs(e.year-REFERENCE_YEAR);for(let a=0;a<=Math.abs(e.length-4);a+=1)for(let r=a+3;r<=a+7&&!(r>=e.length);r+=1){const s=e.slice(a,+r+1||9e9);if(n.exec(s)){const e=[],n=s.length;if(DATE_SPLITS[n].forEach((([t,n])=>{const o=this.mapIntegersToDayMonthYear([parseInt(s.slice(0,t),10),parseInt(s.slice(t,n),10),parseInt(s.slice(n),10)]);null!=o&&e.push(o)})),e.length>0){let n=e[0],l=o(e[0]);e.slice(1).forEach((e=>{const t=o(e);t<l&&(n=e,l=t)})),t.push({pattern:"date",token:s,i:a,j:r,separator:"",year:n.year,month:n.month,day:n.day})}}}return t}filterNoise(e){return e.filter((t=>{let n=!1;const o=e.length;for(let a=0;a<o;a+=1){const o=e[a];if(t!==o&&o.i<=t.i&&o.j>=t.j){n=!0;break}}return!n}))}mapIntegersToDayMonthYear(e){if(e[1]>31||e[1]<=0)return null;let t=0,n=0,o=0;for(let a=0,r=e.length;a<r;a+=1){const r=e[a];if(r>99&&r<DATE_MIN_YEAR||r>DATE_MAX_YEAR)return null;r>31&&(n+=1),r>12&&(t+=1),r<=0&&(o+=1)}return n>=2||3===t||o>=2?null:this.getDayMonth(e)}getDayMonth(e){const t=[[e[2],e.slice(0,2)],[e[0],e.slice(1,3)]],n=t.length;for(let o=0;o<n;o+=1){const[e,n]=t[o];if(DATE_MIN_YEAR<=e&&e<=DATE_MAX_YEAR){const t=this.mapIntegersToDayMonth(n);return null!=t?{year:e,month:t.month,day:t.day}:null}}for(let o=0;o<n;o+=1){const[e,n]=t[o],a=this.mapIntegersToDayMonth(n);if(null!=a)return{year:this.twoToFourDigitYear(e),month:a.month,day:a.day}}return null}mapIntegersToDayMonth(e){const t=[e,e.slice().reverse()];for(let n=0;n<t.length;n+=1){const e=t[n],o=e[0],a=e[1];if(o>=1&&o<=31&&a>=1&&a<=12)return{day:o,month:a}}return null}twoToFourDigitYear(e){return e>99?e:e>50?e+1900:e+2e3}}const peq=new Uint32Array(65536),myers_32=(e,t)=>{const n=e.length,o=t.length,a=1<<n-1;let r=-1,s=0,l=n,i=n;for(;i--;)peq[e.charCodeAt(i)]|=1<<i;for(i=0;i<o;i++){let e=peq[t.charCodeAt(i)];const n=e|s;e|=(e&r)+r^r,s|=~(e|r),r&=e,s&a&&l++,r&a&&l--,s=s<<1|1,r=r<<1|~(n|s),s&=n}for(i=n;i--;)peq[e.charCodeAt(i)]=0;return l},myers_x=(e,t)=>{const n=t.length,o=e.length,a=[],r=[],s=Math.ceil(n/32),l=Math.ceil(o/32);for(let m=0;m<s;m++)r[m]=-1,a[m]=0;let i=0;for(;i<l-1;i++){let s=0,l=-1;const c=32*i,p=Math.min(32,o)+c;for(let t=c;t<p;t++)peq[e.charCodeAt(t)]|=1<<t;for(let e=0;e<n;e++){const n=peq[t.charCodeAt(e)],o=r[e/32|0]>>>e&1,i=a[e/32|0]>>>e&1,c=n|s,p=((n|i)&l)+l^l|n|i;let u=s|~(p|l),d=l&p;u>>>31^o&&(r[e/32|0]^=1<<e),d>>>31^i&&(a[e/32|0]^=1<<e),u=u<<1|o,d=d<<1|i,l=d|~(c|u),s=u&c}for(let t=c;t<p;t++)peq[e.charCodeAt(t)]=0}let c=0,p=-1;const u=32*i,d=Math.min(32,o-u)+u;for(let m=u;m<d;m++)peq[e.charCodeAt(m)]|=1<<m;let f=o;for(let m=0;m<n;m++){const e=peq[t.charCodeAt(m)],n=r[m/32|0]>>>m&1,s=a[m/32|0]>>>m&1,l=e|c,i=((e|s)&p)+p^p|e|s;let u=c|~(i|p),d=p&i;f+=u>>>o-1&1,f-=d>>>o-1&1,u>>>31^n&&(r[m/32|0]^=1<<m),d>>>31^s&&(a[m/32|0]^=1<<m),u=u<<1|n,d=d<<1|s,p=d|~(l|u),c=u&l}for(let m=u;m<d;m++)peq[e.charCodeAt(m)]=0;return f},distance=(e,t)=>{if(e.length<t.length){const n=t;t=e,e=n}return 0===t.length?e.length:e.length<=32?myers_32(e,t):myers_x(e,t)},getUsedThreshold=(e,t,n)=>{const o=e.length<=t.length,a=e.length<=n;return o||a?Math.ceil(e.length/4):n},findLevenshteinDistance=(e,t,n)=>{let o=0;const a=Object.keys(t).find((t=>{const a=getUsedThreshold(e,t,n),r=distance(e,t),s=r<=a;return s&&(o=r),s}));return a?{levenshteinDistance:o,levenshteinDistanceEntry:a}:{}};var l33tTable={a:["4","@"],b:["8"],c:["(","{","[","<"],e:["3"],g:["6","9"],i:["1","!","|"],l:["1","|","7"],o:["0"],s:["$","5"],t:["+","7"],x:["%"],z:["2"]},translationKeys={warnings:{straightRow:"straightRow",keyPattern:"keyPattern",simpleRepeat:"simpleRepeat",extendedRepeat:"extendedRepeat",sequences:"sequences",recentYears:"recentYears",dates:"dates",topTen:"topTen",topHundred:"topHundred",common:"common",similarToCommon:"similarToCommon",wordByItself:"wordByItself",namesByThemselves:"namesByThemselves",commonNames:"commonNames",userInputs:"userInputs",pwned:"pwned"},suggestions:{l33t:"l33t",reverseWords:"reverseWords",allUppercase:"allUppercase",capitalization:"capitalization",dates:"dates",recentYears:"recentYears",associatedYears:"associatedYears",sequences:"sequences",repeated:"repeated",longerKeyboardPattern:"longerKeyboardPattern",anotherWord:"anotherWord",useWords:"useWords",noNeed:"noNeed",pwned:"pwned"},timeEstimation:{ltSecond:"ltSecond",second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",month:"month",months:"months",year:"year",years:"years",centuries:"centuries"}};class Options{constructor(){this.matchers={},this.l33tTable=l33tTable,this.dictionary={userInputs:[]},this.rankedDictionaries={},this.rankedDictionariesMaxWordSize={},this.translations=translationKeys,this.graphs={},this.useLevenshteinDistance=!1,this.levenshteinThreshold=2,this.l33tMaxSubstitutions=100,this.maxLength=256,this.setRankedDictionaries()}setOptions(e={}){e.l33tTable&&(this.l33tTable=e.l33tTable),e.dictionary&&(this.dictionary=e.dictionary,this.setRankedDictionaries()),e.translations&&this.setTranslations(e.translations),e.graphs&&(this.graphs=e.graphs),void 0!==e.useLevenshteinDistance&&(this.useLevenshteinDistance=e.useLevenshteinDistance),void 0!==e.levenshteinThreshold&&(this.levenshteinThreshold=e.levenshteinThreshold),void 0!==e.l33tMaxSubstitutions&&(this.l33tMaxSubstitutions=e.l33tMaxSubstitutions),void 0!==e.maxLength&&(this.maxLength=e.maxLength)}setTranslations(e){if(!this.checkCustomTranslations(e))throw new Error("Invalid translations object fallback to keys");this.translations=e}checkCustomTranslations(e){let t=!0;return Object.keys(translationKeys).forEach((n=>{if(n in e){const o=n;Object.keys(translationKeys[o]).forEach((n=>{n in e[o]||(t=!1)}))}else t=!1})),t}setRankedDictionaries(){const e={},t={};Object.keys(this.dictionary).forEach((n=>{e[n]=this.getRankedDictionary(n),t[n]=this.getRankedDictionariesMaxWordSize(n)})),this.rankedDictionaries=e,this.rankedDictionariesMaxWordSize=t}getRankedDictionariesMaxWordSize(e){const t=this.dictionary[e].map((e=>"string"!=typeof e?e.toString().length:e.length));return 0===t.length?0:t.reduce(((e,t)=>Math.max(e,t)),-Infinity)}getRankedDictionary(e){const t=this.dictionary[e];if("userInputs"===e){const e=[];return t.forEach((t=>{const n=typeof t;"string"!==n&&"number"!==n&&"boolean"!==n||e.push(t.toString().toLowerCase())})),buildRankedDictionary(e)}return buildRankedDictionary(t)}extendUserInputsDictionary(e){this.dictionary.userInputs?this.dictionary.userInputs=[...this.dictionary.userInputs,...e]:this.dictionary.userInputs=e,this.rankedDictionaries.userInputs=this.getRankedDictionary("userInputs"),this.rankedDictionariesMaxWordSize.userInputs=this.getRankedDictionariesMaxWordSize("userInputs")}addMatcher(e,t){this.matchers[e]||(this.matchers[e]=t)}}const zxcvbnOptions=new Options;class MatchReverse{constructor(e){this.defaultMatch=e}match({password:e}){const t=e.split("").reverse().join("");return this.defaultMatch({password:t}).map((t=>({...t,token:t.token.split("").reverse().join(""),reversed:!0,i:e.length-1-t.j,j:e.length-1-t.i})))}}class MatchL33t{constructor(e){this.defaultMatch=e}match({password:e}){const t=[],n=this.enumerateL33tSubs(this.relevantL33tSubtable(e,zxcvbnOptions.l33tTable)),o=Math.min(n.length,zxcvbnOptions.l33tMaxSubstitutions);for(let a=0;a<o;a+=1){const o=n[a];if(empty(o))break;const r=translate(e,o);this.defaultMatch({password:r}).forEach((n=>{const a=e.slice(n.i,+n.j+1||9e9);if(a.toLowerCase()!==n.matchedWord){const e={};Object.keys(o).forEach((t=>{const n=o[t];-1!==a.indexOf(t)&&(e[t]=n)}));const r=Object.keys(e).map((t=>`${t} -> ${e[t]}`)).join(", ");t.push({...n,l33t:!0,token:a,sub:e,subDisplay:r})}}))}return t.filter((e=>e.token.length>1))}relevantL33tSubtable(e,t){const n={},o={};return e.split("").forEach((e=>{n[e]=!0})),Object.keys(t).forEach((e=>{const a=t[e].filter((e=>e in n));a.length>0&&(o[e]=a)})),o}enumerateL33tSubs(e){const t=Object.keys(e);return this.getSubs(t,[[]],e).map((e=>{const t={};return e.forEach((([e,n])=>{t[e]=n})),t}))}getSubs(e,t,n){if(!e.length)return t;const o=e[0],a=e.slice(1),r=[];n[o].forEach((e=>{t.forEach((t=>{let n=-1;for(let o=0;o<t.length;o+=1)if(t[o][0]===e){n=o;break}if(-1===n){const n=t.concat([[e,o]]);r.push(n)}else{const a=t.slice(0);a.splice(n,1),a.push([e,o]),r.push(t),r.push(a)}}))}));const s=this.dedup(r);return a.length?this.getSubs(a,s,n):s}dedup(e){const t=[],n={};return e.forEach((e=>{const o=e.map(((e,t)=>[e,t]));o.sort();const a=o.map((([e,t])=>`${e},${t}`)).join("-");a in n||(n[a]=!0,t.push(e))})),t}}class MatchDictionary{constructor(){this.l33t=new MatchL33t(this.defaultMatch),this.reverse=new MatchReverse(this.defaultMatch)}match({password:e}){const t=[...this.defaultMatch({password:e}),...this.reverse.match({password:e}),...this.l33t.match({password:e})];return sorted(t)}defaultMatch({password:e}){const t=[],n=e.length,o=e.toLowerCase();return Object.keys(zxcvbnOptions.rankedDictionaries).forEach((a=>{const r=zxcvbnOptions.rankedDictionaries[a],s=zxcvbnOptions.rankedDictionariesMaxWordSize[a],l=Math.min(s,n);for(let i=0;i<n;i+=1){const s=Math.min(i+l,n);for(let l=i;l<s;l+=1){const s=o.slice(i,+l+1||9e9),c=s in r;let p={};const u=0===i&&l===n-1;zxcvbnOptions.useLevenshteinDistance&&u&&!c&&(p=findLevenshteinDistance(s,r,zxcvbnOptions.levenshteinThreshold));const d=0!==Object.keys(p).length;if(c||d){const n=r[d?p.levenshteinDistanceEntry:s];t.push({pattern:"dictionary",i:i,j:l,token:e.slice(i,+l+1||9e9),matchedWord:s,rank:n,dictionaryName:a,reversed:!1,l33t:!1,...p})}}}})),t}}class MatchRegex{match({password:e,regexes:t=REGEXEN}){const n=[];return Object.keys(t).forEach((o=>{const a=t[o];a.lastIndex=0;const r=a.exec(e);if(r){const e=r[0];n.push({pattern:"regex",token:e,i:r.index,j:r.index+r[0].length-1,regexName:o,regexMatch:r})}})),sorted(n)}}var utils={nCk(e,t){let n=e;if(t>n)return 0;if(0===t)return 1;let o=1;for(let a=1;a<=t;a+=1)o*=n,o/=a,n-=1;return o},log10:e=>Math.log(e)/Math.log(10),log2:e=>Math.log(e)/Math.log(2),factorial(e){let t=1;for(let n=2;n<=e;n+=1)t*=n;return t}},bruteforceMatcher$1=({token:e})=>{let t,n=BRUTEFORCE_CARDINALITY**e.length;return n===Number.POSITIVE_INFINITY&&(n=Number.MAX_VALUE),t=1===e.length?MIN_SUBMATCH_GUESSES_SINGLE_CHAR+1:MIN_SUBMATCH_GUESSES_MULTI_CHAR+1,Math.max(n,t)},dateMatcher$1=({year:e,separator:t})=>{let n=365*Math.max(Math.abs(e-REFERENCE_YEAR),MIN_YEAR_SPACE);return t&&(n*=4),n};const getVariations=e=>{const t=e.split(""),n=t.filter((e=>e.match(ONE_UPPER))).length,o=t.filter((e=>e.match(ONE_LOWER))).length;let a=0;const r=Math.min(n,o);for(let s=1;s<=r;s+=1)a+=utils.nCk(n+o,s);return a};var uppercaseVariant=e=>{const t=e.replace(ALPHA_INVERTED,"");if(t.match(ALL_LOWER_INVERTED)||t.toLowerCase()===t)return 1;const n=[START_UPPER,END_UPPER,ALL_UPPER_INVERTED],o=n.length;for(let a=0;a<o;a+=1){const e=n[a];if(t.match(e))return 2}return getVariations(t)};const getCounts=({subs:e,subbed:t,token:n})=>{const o=e[t],a=n.toLowerCase().split("");return{subbedCount:a.filter((e=>e===t)).length,unsubbedCount:a.filter((e=>e===o)).length}};var l33tVariant=({l33t:e,sub:t,token:n})=>{if(!e)return 1;let o=1;const a=t;return Object.keys(a).forEach((e=>{const{subbedCount:t,unsubbedCount:r}=getCounts({subs:a,subbed:e,token:n});if(0===t||0===r)o*=2;else{const e=Math.min(r,t);let n=0;for(let o=1;o<=e;o+=1)n+=utils.nCk(r+t,o);o*=n}})),o},dictionaryMatcher$1=({rank:e,reversed:t,l33t:n,sub:o,token:a})=>{const r=e,s=uppercaseVariant(a),l=l33tVariant({l33t:n,sub:o,token:a});return{baseGuesses:r,uppercaseVariations:s,l33tVariations:l,calculation:r*s*l*(t?2:1)}},regexMatcher$1=({regexName:e,regexMatch:t,token:n})=>{const o={alphaLower:26,alphaUpper:26,alpha:52,alphanumeric:62,digits:10,symbols:33};return e in o?o[e]**n.length:"recentYear"===e?Math.max(Math.abs(parseInt(t[0],10)-REFERENCE_YEAR),MIN_YEAR_SPACE):0},repeatMatcher$1=({baseGuesses:e,repeatCount:t})=>e*t,sequenceMatcher$1=({token:e,ascending:t})=>{const n=e.charAt(0);let o=0;return o=["a","A","z","Z","0","1","9"].includes(n)?4:n.match(/\d/)?10:26,t||(o*=2),o*e.length};const calcAverageDegree=e=>{let t=0;return Object.keys(e).forEach((n=>{const o=e[n];t+=o.filter((e=>!!e)).length})),t/=Object.entries(e).length,t},estimatePossiblePatterns=({token:e,graph:t,turns:n})=>{const o=Object.keys(zxcvbnOptions.graphs[t]).length,a=calcAverageDegree(zxcvbnOptions.graphs[t]);let r=0;const s=e.length;for(let l=2;l<=s;l+=1){const e=Math.min(n,l-1);for(let t=1;t<=e;t+=1)r+=utils.nCk(l-1,t-1)*o*a**t}return r};var spatialMatcher$1=({graph:e,token:t,shiftedCount:n,turns:o})=>{let a=estimatePossiblePatterns({token:t,graph:e,turns:o});if(n){const e=t.length-n;if(0===n||0===e)a*=2;else{let t=0;for(let o=1;o<=Math.min(n,e);o+=1)t+=utils.nCk(n+e,o);a*=t}}return Math.round(a)};const getMinGuesses=(e,t)=>{let n=1;return e.token.length<t.length&&(n=1===e.token.length?MIN_SUBMATCH_GUESSES_SINGLE_CHAR:MIN_SUBMATCH_GUESSES_MULTI_CHAR),n},matchers={bruteforce:bruteforceMatcher$1,date:dateMatcher$1,dictionary:dictionaryMatcher$1,regex:regexMatcher$1,repeat:repeatMatcher$1,sequence:sequenceMatcher$1,spatial:spatialMatcher$1},getScoring=(e,t)=>matchers[e]?matchers[e](t):zxcvbnOptions.matchers[e]&&"scoring"in zxcvbnOptions.matchers[e]?zxcvbnOptions.matchers[e].scoring(t):0;var estimateGuesses=(e,t)=>{const n={};if("guesses"in e&&null!=e.guesses)return e;const o=getMinGuesses(e,t),a=getScoring(e.pattern,e);let r=0;"number"==typeof a?r=a:"dictionary"===e.pattern&&(r=a.calculation,n.baseGuesses=a.baseGuesses,n.uppercaseVariations=a.uppercaseVariations,n.l33tVariations=a.l33tVariations);const s=Math.max(r,o);return{...e,...n,guesses:s,guessesLog10:utils.log10(s)}};const scoringHelper={password:"",optimal:{},excludeAdditive:!1,fillArray(e,t){const n=[];for(let o=0;o<e;o+=1){let e=[];"object"===t&&(e={}),n.push(e)}return n},makeBruteforceMatch(e,t){return{pattern:"bruteforce",token:this.password.slice(e,+t+1||9e9),i:e,j:t}},update(e,t){const n=e.j,o=estimateGuesses(e,this.password);let a=o.guesses;t>1&&(a*=this.optimal.pi[o.i-1][t-1]);let r=utils.factorial(t)*a;this.excludeAdditive||(r+=MIN_GUESSES_BEFORE_GROWING_SEQUENCE**(t-1));let s=!1;Object.keys(this.optimal.g[n]).forEach((e=>{const o=this.optimal.g[n][e];parseInt(e,10)<=t&&o<=r&&(s=!0)})),s||(this.optimal.g[n][t]=r,this.optimal.m[n][t]=o,this.optimal.pi[n][t]=a)},bruteforceUpdate(e){let t=this.makeBruteforceMatch(0,e);this.update(t,1);for(let n=1;n<=e;n+=1){t=this.makeBruteforceMatch(n,e);const o=this.optimal.m[n-1];Object.keys(o).forEach((e=>{"bruteforce"!==o[e].pattern&&this.update(t,parseInt(e,10)+1)}))}},unwind(e){const t=[];let n=e-1,o=0,a=Infinity;const r=this.optimal.g[n];for(r&&Object.keys(r).forEach((e=>{const t=r[e];t<a&&(o=parseInt(e,10),a=t)}));n>=0;){const e=this.optimal.m[n][o];t.unshift(e),n=e.i-1,o-=1}return t}};var scoring={mostGuessableMatchSequence(e,t,n=!1){scoringHelper.password=e,scoringHelper.excludeAdditive=n;const o=e.length;let a=scoringHelper.fillArray(o,"array");t.forEach((e=>{a[e.j].push(e)})),a=a.map((e=>e.sort(((e,t)=>e.i-t.i)))),scoringHelper.optimal={m:scoringHelper.fillArray(o,"object"),pi:scoringHelper.fillArray(o,"object"),g:scoringHelper.fillArray(o,"object")};for(let i=0;i<o;i+=1)a[i].forEach((e=>{e.i>0?Object.keys(scoringHelper.optimal.m[e.i-1]).forEach((t=>{scoringHelper.update(e,parseInt(t,10)+1)})):scoringHelper.update(e,1)})),scoringHelper.bruteforceUpdate(i);const r=scoringHelper.unwind(o),s=r.length,l=this.getGuesses(e,s);return{password:e,guesses:l,guessesLog10:utils.log10(l),sequence:r}},getGuesses(e,t){const n=e.length;let o=0;return o=0===e.length?1:scoringHelper.optimal.g[n-1][t],o}};class MatchRepeat{match({password:e,omniMatch:t}){const n=[];let o=0;for(;o<e.length;){const a=this.getGreedyMatch(e,o),r=this.getLazyMatch(e,o);if(null==a)break;const{match:s,baseToken:l}=this.setMatchToken(a,r);if(s){const e=s.index+s[0].length-1,a=this.getBaseGuesses(l,t);n.push(this.normalizeMatch(l,e,s,a)),o=e+1}}return n.some((e=>e instanceof Promise))?Promise.all(n):n}normalizeMatch(e,t,n,o){const a={pattern:"repeat",i:n.index,j:t,token:n[0],baseToken:e,baseGuesses:0,repeatCount:n[0].length/e.length};return o instanceof Promise?o.then((e=>({...a,baseGuesses:e}))):{...a,baseGuesses:o}}getGreedyMatch(e,t){const n=/(.+)\1+/g;return n.lastIndex=t,n.exec(e)}getLazyMatch(e,t){const n=/(.+?)\1+/g;return n.lastIndex=t,n.exec(e)}setMatchToken(e,t){const n=/^(.+?)\1+$/;let o,a="";if(t&&e[0].length>t[0].length){o=e;const t=n.exec(o[0]);t&&(a=t[1])}else o=t,o&&(a=o[1]);return{match:o,baseToken:a}}getBaseGuesses(e,t){const n=t.match(e);if(n instanceof Promise)return n.then((t=>scoring.mostGuessableMatchSequence(e,t).guesses));return scoring.mostGuessableMatchSequence(e,n).guesses}}class MatchSequence{constructor(){this.MAX_DELTA=5}match({password:e}){const t=[];if(1===e.length)return[];let n=0,o=null;const a=e.length;for(let r=1;r<a;r+=1){const a=e.charCodeAt(r)-e.charCodeAt(r-1);if(null==o&&(o=a),a!==o){const s=r-1;this.update({i:n,j:s,delta:o,password:e,result:t}),n=s,o=a}}return this.update({i:n,j:a-1,delta:o,password:e,result:t}),t}update({i:e,j:t,delta:n,password:o,result:a}){if(t-e>1||1===Math.abs(n)){const r=Math.abs(n);if(r>0&&r<=this.MAX_DELTA){const r=o.slice(e,+t+1||9e9),{sequenceName:s,sequenceSpace:l}=this.getSequence(r);return a.push({pattern:"sequence",i:e,j:t,token:o.slice(e,+t+1||9e9),sequenceName:s,sequenceSpace:l,ascending:n>0})}}return null}getSequence(e){let t="unicode",n=26;return ALL_LOWER.test(e)?(t="lower",n=26):ALL_UPPER.test(e)?(t="upper",n=26):ALL_DIGIT.test(e)&&(t="digits",n=10),{sequenceName:t,sequenceSpace:n}}}class MatchSpatial{constructor(){this.SHIFTED_RX=/[~!@#$%^&*()_+QWERTYUIOP{}|ASDFGHJKL:"ZXCVBNM<>?]/}match({password:e}){const t=[];return Object.keys(zxcvbnOptions.graphs).forEach((n=>{const o=zxcvbnOptions.graphs[n];extend(t,this.helper(e,o,n))})),sorted(t)}checkIfShifted(e,t,n){return!e.includes("keypad")&&this.SHIFTED_RX.test(t.charAt(n))?1:0}helper(e,t,n){let o;const a=[];let r=0;const s=e.length;for(;r<s-1;){let l=r+1,i=0,c=0;for(o=this.checkIfShifted(n,e,r);;){const p=t[e.charAt(l-1)]||[];let u=!1,d=-1,f=-1;if(l<s){const t=e.charAt(l),n=p.length;for(let e=0;e<n;e+=1){const n=p[e];if(f+=1,n){const e=n.indexOf(t);if(-1!==e){u=!0,d=f,1===e&&(o+=1),i!==d&&(c+=1,i=d);break}}}}if(!u){l-r>2&&a.push({pattern:"spatial",i:r,j:l-1,token:e.slice(r,l),graph:n,turns:c,shiftedCount:o}),r=l;break}l+=1}}return a}}class Matching{constructor(){this.matchers={date:MatchDate,dictionary:MatchDictionary,regex:MatchRegex,repeat:MatchRepeat,sequence:MatchSequence,spatial:MatchSpatial}}match(e){const t=[],n=[];return[...Object.keys(this.matchers),...Object.keys(zxcvbnOptions.matchers)].forEach((o=>{if(!this.matchers[o]&&!zxcvbnOptions.matchers[o])return;const a=(new(this.matchers[o]?this.matchers[o]:zxcvbnOptions.matchers[o].Matching)).match({password:e,omniMatch:this});a instanceof Promise?(a.then((e=>{extend(t,e)})),n.push(a)):extend(t,a)})),n.length>0?new Promise((e=>{Promise.all(n).then((()=>{e(sorted(t))}))})):sorted(t)}}const SECOND=1,MINUTE=60*SECOND,HOUR=60*MINUTE,DAY=24*HOUR,MONTH=31*DAY,YEAR=12*MONTH,CENTURY=100*YEAR,times={second:SECOND,minute:MINUTE,hour:HOUR,day:DAY,month:MONTH,year:YEAR,century:CENTURY};class TimeEstimates{translate(e,t){let n=e;void 0!==t&&1!==t&&(n+="s");const{timeEstimation:o}=zxcvbnOptions.translations;return o[n].replace("{base}",`${t}`)}estimateAttackTimes(e){const t={onlineThrottling100PerHour:e/(100/3600),onlineNoThrottling10PerSecond:e/10,offlineSlowHashing1e4PerSecond:e/1e4,offlineFastHashing1e10PerSecond:e/1e10},n={onlineThrottling100PerHour:"",onlineNoThrottling10PerSecond:"",offlineSlowHashing1e4PerSecond:"",offlineFastHashing1e10PerSecond:""};return Object.keys(t).forEach((e=>{const o=t[e];n[e]=this.displayTime(o)})),{crackTimesSeconds:t,crackTimesDisplay:n,score:this.guessesToScore(e)}}guessesToScore(e){return e<1005?0:e<1000005?1:e<100000005?2:e<10000000005?3:4}displayTime(e){let t,n="centuries";const o=Object.keys(times),a=o.findIndex((t=>e<times[t]));return a>-1&&(n=o[a-1],0!==a?t=Math.round(e/times[n]):n="ltSecond"),this.translate(n,t)}}var bruteforceMatcher=()=>null,dateMatcher=()=>({warning:zxcvbnOptions.translations.warnings.dates,suggestions:[zxcvbnOptions.translations.suggestions.dates]});const getDictionaryWarningPassword=(e,t)=>{let n="";return!t||e.l33t||e.reversed?e.guessesLog10<=4&&(n=zxcvbnOptions.translations.warnings.similarToCommon):n=e.rank<=10?zxcvbnOptions.translations.warnings.topTen:e.rank<=100?zxcvbnOptions.translations.warnings.topHundred:zxcvbnOptions.translations.warnings.common,n},getDictionaryWarningWikipedia=(e,t)=>{let n="";return t&&(n=zxcvbnOptions.translations.warnings.wordByItself),n},getDictionaryWarningNames=(e,t)=>t?zxcvbnOptions.translations.warnings.namesByThemselves:zxcvbnOptions.translations.warnings.commonNames,getDictionaryWarning=(e,t)=>{let n="";const o=e.dictionaryName,a="lastnames"===o||o.toLowerCase().includes("firstnames");return"passwords"===o?n=getDictionaryWarningPassword(e,t):o.includes("wikipedia")?n=getDictionaryWarningWikipedia(e,t):a?n=getDictionaryWarningNames(e,t):"userInputs"===o&&(n=zxcvbnOptions.translations.warnings.userInputs),n};var dictionaryMatcher=(e,t)=>{const n=getDictionaryWarning(e,t),o=[],a=e.token;return a.match(START_UPPER)?o.push(zxcvbnOptions.translations.suggestions.capitalization):a.match(ALL_UPPER_INVERTED)&&a.toLowerCase()!==a&&o.push(zxcvbnOptions.translations.suggestions.allUppercase),e.reversed&&e.token.length>=4&&o.push(zxcvbnOptions.translations.suggestions.reverseWords),e.l33t&&o.push(zxcvbnOptions.translations.suggestions.l33t),{warning:n,suggestions:o}},regexMatcher=e=>"recentYear"===e.regexName?{warning:zxcvbnOptions.translations.warnings.recentYears,suggestions:[zxcvbnOptions.translations.suggestions.recentYears,zxcvbnOptions.translations.suggestions.associatedYears]}:{warning:"",suggestions:[]},repeatMatcher=e=>{let t=zxcvbnOptions.translations.warnings.extendedRepeat;return 1===e.baseToken.length&&(t=zxcvbnOptions.translations.warnings.simpleRepeat),{warning:t,suggestions:[zxcvbnOptions.translations.suggestions.repeated]}},sequenceMatcher=()=>({warning:zxcvbnOptions.translations.warnings.sequences,suggestions:[zxcvbnOptions.translations.suggestions.sequences]}),spatialMatcher=e=>{let t=zxcvbnOptions.translations.warnings.keyPattern;return 1===e.turns&&(t=zxcvbnOptions.translations.warnings.straightRow),{warning:t,suggestions:[zxcvbnOptions.translations.suggestions.longerKeyboardPattern]}};const defaultFeedback={warning:"",suggestions:[]};class Feedback{constructor(){this.matchers={bruteforce:bruteforceMatcher,date:dateMatcher,dictionary:dictionaryMatcher,regex:regexMatcher,repeat:repeatMatcher,sequence:sequenceMatcher,spatial:spatialMatcher},this.defaultFeedback={warning:"",suggestions:[]},this.setDefaultSuggestions()}setDefaultSuggestions(){this.defaultFeedback.suggestions.push(zxcvbnOptions.translations.suggestions.useWords,zxcvbnOptions.translations.suggestions.noNeed)}getFeedback(e,t){if(0===t.length)return this.defaultFeedback;if(e>2)return defaultFeedback;const n=zxcvbnOptions.translations.suggestions.anotherWord,o=this.getLongestMatch(t);let a=this.getMatchFeedback(o,1===t.length);return null!=a?(a.suggestions.unshift(n),null==a.warning&&(a.warning="")):a={warning:"",suggestions:[n]},a}getLongestMatch(e){let t=e[0];return e.slice(1).forEach((e=>{e.token.length>t.token.length&&(t=e)})),t}getMatchFeedback(e,t){return this.matchers[e.pattern]?this.matchers[e.pattern](e,t):zxcvbnOptions.matchers[e.pattern]&&"feedback"in zxcvbnOptions.matchers[e.pattern]?zxcvbnOptions.matchers[e.pattern].feedback(e,t):defaultFeedback}}const time=()=>(new Date).getTime(),createReturnValue=(e,t,n)=>{const o=new Feedback,a=new TimeEstimates,r=scoring.mostGuessableMatchSequence(t,e),s=time()-n,l=a.estimateAttackTimes(r.guesses);return{calcTime:s,...r,...l,feedback:o.getFeedback(l.score,r.sequence)}},main=(e,t)=>{t&&zxcvbnOptions.extendUserInputsDictionary(t);return(new Matching).match(e)},zxcvbn=(e,t)=>{const n=time(),o=main(e,t);if(o instanceof Promise)throw new Error("You are using a Promised matcher, please use `zxcvbnAsync` for it.");return createReturnValue(o,e,n)},_sfc_main$2=defineComponent({name:"StrengthMeter",components:{InputPassword:Input.Password},props:{value:propTypes.string,showInput:propTypes.bool.def(!0),disabled:propTypes.bool},emits:["score-change","change"],setup(e,{emit:t}){const n=ref(""),{prefixCls:o}=useDesign("strength-meter"),a=computed((()=>{const{disabled:o}=e;if(o)return-1;const a=unref(n)?zxcvbn(unref(n)).score:-1;return t("score-change",a),a}));return watchEffect((()=>{n.value=e.value||""})),watch((()=>unref(n)),(e=>{t("change",e)})),{getPasswordStrength:a,handleChange:function(e){n.value=e.target.value},prefixCls:o,innerValueRef:n}}}),StrengthMeter_vue_vue_type_style_index_0_scoped_04d66e4c_lang="",_hoisted_1=["data-score"];function _sfc_render$2(e,t,n,o,a,r){const s=resolveComponent("InputPassword");return openBlock(),createElementBlock("div",{class:normalizeClass([e.prefixCls,"relative"])},[e.showInput?(openBlock(),createBlock(s,mergeProps({key:0},e.$attrs,{allowClear:"",value:e.innerValueRef,onChange:e.handleChange,disabled:e.disabled}),createSlots({_:2},[renderList(Object.keys(e.$slots),(t=>({name:t,fn:withCtx((n=>[renderSlot(e.$slots,t,normalizeProps(guardReactiveProps(n||{})),void 0,!0)]))})))]),1040,["value","onChange","disabled"])):createCommentVNode("",!0),createBaseVNode("div",{class:normalizeClass(`${e.prefixCls}-bar`)},[createBaseVNode("div",{class:normalizeClass(`${e.prefixCls}-bar--fill`),"data-score":e.getPasswordStrength},null,10,_hoisted_1)],2)],2)}const strengthMeter=_export_sfc(_sfc_main$2,[["render",_sfc_render$2],["__scopeId","data-v-04d66e4c"]]),StrengthMeter=withInstall(strengthMeter);function useCountdown(e){const t=ref(e),n=ref(!1);let o;function a(){o&&window.clearInterval(o)}function r(){n.value=!1,a(),o=null}function s(){unref(n)||o||(n.value=!0,o=setInterval((()=>{1===unref(t)?(r(),t.value=e):t.value-=1}),1e3))}function l(){t.value=e,r()}return tryOnUnmounted((()=>{l()})),{start:s,reset:l,restart:function(){l(),s()},clear:a,stop:r,currentCount:t,isStart:n}}const props$1={value:{type:[Object,Number,String,Array]},count:{type:Number,default:60},beforeStartFunc:{type:Function,default:null}},_sfc_main$1=defineComponent({name:"CountButton",components:{Button:Button},props:props$1,setup(e){const t=ref(!1),{currentCount:n,isStart:o,start:a,reset:r}=useCountdown(e.count),{t:s}=useI18n(),l=computed((()=>unref(o)?s("component.countdown.sendText",[unref(n)]):s("component.countdown.normalText")));return watchEffect((()=>{void 0===e.value&&r()})),{handleStart:async function(){const{beforeStartFunc:n}=e;if(n&&isFunction(n)){t.value=!0;try{await n()&&a()}finally{t.value=!1}}else a()},currentCount:n,loading:t,getButtonText:l,isStart:o}}});function _sfc_render$1(e,t,n,o,a,r){const s=resolveComponent("Button");return openBlock(),createBlock(s,mergeProps(e.$attrs,{disabled:e.isStart,onClick:e.handleStart,loading:e.loading}),{default:withCtx((()=>[createTextVNode(toDisplayString(e.getButtonText),1)])),_:1},16,["disabled","onClick","loading"])}const countButton=_export_sfc(_sfc_main$1,[["render",_sfc_render$1]]);function useRuleFormItem(e,t="value",n="change",o){const a=getCurrentInstance(),r=a?.emit,s=reactive({value:e[t]}),l=readonly(s);watchEffect((()=>{s.value=e[t]}));return[computed({get:()=>s.value,set(e){isEqual(e,l.value)||(s.value=e,setTimeout((()=>{r?.(n,e,...toRaw(unref(o))||[])})))}}),e=>{s.value=e},l]}const props={value:{type:String},size:{type:String,validator:e=>["default","large","small"].includes(e)},count:{type:Number,default:60},sendCodeApi:{type:Function,default:null}},_sfc_main=defineComponent({name:"CountDownInput",components:{CountButton:countButton},inheritAttrs:!1,props:props,setup(e){const{prefixCls:t}=useDesign("countdown-input"),[n]=useRuleFormItem(e);return{prefixCls:t,state:n}}}),CountdownInput_vue_vue_type_style_index_0_lang="";function _sfc_render(e,t,n,o,a,r){const s=resolveComponent("CountButton"),l=resolveComponent("a-input");return openBlock(),createBlock(l,mergeProps(e.$attrs,{class:e.prefixCls,size:e.size,value:e.state}),createSlots({addonAfter:withCtx((()=>[createVNode(s,{size:e.size,count:e.count,value:e.state,beforeStartFunc:e.sendCodeApi},null,8,["size","count","value","beforeStartFunc"])])),_:2},[renderList(Object.keys(e.$slots).filter((e=>"addonAfter"!==e)),(t=>({name:t,fn:withCtx((n=>[renderSlot(e.$slots,t,normalizeProps(guardReactiveProps(n||{})))]))})))]),1040,["class","size","value"])}const countdownInput=_export_sfc(_sfc_main,[["render",_sfc_render]]),CountdownInput=withInstall(countdownInput);withInstall(countButton);const componentMap=new Map;componentMap.set("StrengthMeter",StrengthMeter),componentMap.set("InputCountDown",CountdownInput),componentMap.set("InputGroup",JnpfInputGroup),componentMap.set("InputSearch",JnpfInputSearch),componentMap.set("MonthPicker",JnpfMonthPicker),componentMap.set("WeekPicker",JnpfWeekPicker),componentMap.set("Alert",JnpfAlert),componentMap.set("AreaSelect",JnpfAreaSelect),componentMap.set("AutoComplete",JnpfAutoComplete),componentMap.set("Button",JnpfButton),componentMap.set("Cron",JnpfCron),componentMap.set("Cascader",JnpfCascader),componentMap.set("ColorPicker",JnpfColorPicker),componentMap.set("Checkbox",JnpfCheckbox),componentMap.set("JnpfCheckboxSingle",JnpfCheckboxSingle),componentMap.set("DatePicker",JnpfDatePicker),componentMap.set("DateRange",JnpfDateRange),componentMap.set("TimePicker",JnpfTimePicker),componentMap.set("TimeRange",JnpfTimeRange),componentMap.set("Divider",JnpfDivider),componentMap.set("Editor",JnpfEditor),componentMap.set("GroupTitle",JnpfGroupTitle),componentMap.set("Input",JnpfInput),componentMap.set("InputPassword",JnpfInputPassword),componentMap.set("Textarea",JnpfTextarea),componentMap.set("InputNumber",JnpfInputNumber),componentMap.set("IconPicker",JnpfIconPicker),componentMap.set("Link",JnpfLink),componentMap.set("OrganizeSelect",JnpfOrganizeSelect),componentMap.set("DepSelect",JnpfDepSelect),componentMap.set("PosSelect",JnpfPosSelect),componentMap.set("GroupSelect",JnpfGroupSelect),componentMap.set("RoleSelect",JnpfRoleSelect),componentMap.set("UserSelect",JnpfUserSelect),componentMap.set("UsersSelect",JnpfUsersSelect),componentMap.set("Qrcode",JnpfQrcode),componentMap.set("Barcode",JnpfBarcode),componentMap.set("Radio",JnpfRadio),componentMap.set("Rate",JnpfRate),componentMap.set("Select",JnpfSelect),componentMap.set("Slider",JnpfSlider),componentMap.set("Sign",JnpfSign),componentMap.set("Signature",JnpfSignature),componentMap.set("Switch",JnpfSwitch),componentMap.set("Text",JnpfText),componentMap.set("TreeSelect",JnpfTreeSelect),componentMap.set("UploadFile",JnpfUploadFile),componentMap.set("UploadImg",JnpfUploadImg),componentMap.set("UploadImgSingle",JnpfUploadImgSingle),componentMap.set("BillRule",JnpfInput),componentMap.set("ModifyUser",JnpfInput),componentMap.set("ModifyTime",JnpfInput),componentMap.set("CreateUser",JnpfOpenData),componentMap.set("CreateTime",JnpfOpenData),componentMap.set("CurrOrganize",JnpfOpenData),componentMap.set("CurrPosition",JnpfOpenData),componentMap.set("RelationForm",JnpfRelationForm),componentMap.set("RelationFormAttr",JnpfRelationFormAttr),componentMap.set("PopupSelect",JnpfPopupSelect),componentMap.set("PopupTableSelect",JnpfPopupTableSelect),componentMap.set("PopupAttr",JnpfPopupAttr),componentMap.set("NumberRange",JnpfNumberRange),componentMap.set("Calculate",JnpfCalculate),componentMap.set("InputTable",JnpfInputTable),componentMap.set("Location",JnpfLocation),componentMap.set("Iframe",JnpfIframe);export{JnpfRelationForm as J,_sfc_main$4 as _,getRealProps as a,componentMap as c,getSearchFormSchemas as g};
