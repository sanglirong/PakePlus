import{d as e,u as n,r as a,ad as l,a0 as t,c as o,M as i,k as s,ch as r,a7 as c,e as d,o as u,g as p,i as m,v as f,a4 as h,j as g,l as y,ae as x,ay as v,t as b,fb as w,q as _,aR as k,F as C,h as L,p as D,m as I,V as j,cm as S,n as O,az as N,ah as R}from"./index-920db443.js";import{d as U,g as T,a as P}from"./shortLink-5c58d9bb.js";import{u as K,B as A}from"./useForm-1d28ee0b.js";import{g as F}from"./componentMap-c91676b4.js";import{u as M,B as H}from"./useTable-dc8c9d84.js";import{T as E}from"./TableAction-adbe36f2.js";import{_ as B}from"./index.vue_vue_type_script_setup_true_lang-7118fb3a.js";import{_ as J}from"./ChildTableColumn.vue_vue_type_script_setup_true_lang-1a28ca33.js";import{U as z}from"./UnlockOutlined-a2b443e1.js";const q={class:"jnpf-content-wrapper short-link-wrapper short-link-wrapper-list"},G={class:"short-link-lock-wrapper"},$={class:"short-link-lock-form"},Q={class:"short-link-main"},V={class:"shortLink-tip"},W={class:"short-link-header"},X={class:"jnpf-content-wrapper-center"},Y={key:0,class:"jnpf-content-wrapper-search-box"},Z={class:"jnpf-content-wrapper-content"},ee=e({__name:"index",props:["config","modelId","isPreview"],setup(e){const ee=e,{createMessage:ne}=R(),{t:ae}=n(),le=a(null),te=a(null),oe=l({modelId:"",queryJson:"",superQueryJson:"",encryption:ee.config.encryption}),ie=l({config:{},columnData:{},formConf:{},hasBatchBtn:!1,columnBtnsList:[],customBtnsList:[],columnOptions:[],treeFieldNames:{children:"children",title:"fullName",key:"id",isLeaf:"isLeaf"},leftTreeData:[],leftTreeLoading:!1,treeActiveId:"",treeActiveNodePath:[],columns:[],complexColumns:[],childColumnList:[],exportList:[],cacheList:[],currFlow:{},isCustomCopy:!1,candidateType:1,currRow:{},workFlowFormData:{},expandObj:{},columnSettingList:[],searchSchemas:[],treeRelationObj:null,customRow:null,customCell:null,columnLink:"",btnLoading:!1,key:+new Date,shortLinkId:"",columnPassUse:-1,password:"",realSearchList:[],realColumnList:[]}),{columnData:se,childColumnList:re,searchSchemas:ce,config:de,btnLoading:ue,columnPassUse:pe,password:me}=t(ie),fe=["input","textarea","inputNumber","switch","datePicker","timePicker","colorPicker","rate","slider","editor","link","text","alert","table","collapse","collapseItem","tabItem","tab","row","card","groupTitle","divider","tableGrid","tableGridTr","tableGridTd","location","iframe","steps","stepItem"],he=["radio","checkbox","select","treeSelect","cascader"],[ge,{submit:ye}]=K({baseColProps:{span:6},showActionButtonGroup:!0,showAdvancedButton:!0,compact:!0}),[xe,{reload:ve,setLoading:be,redoHeight:we}]=M({api:U,immediate:!1,clickToRowSelect:!1,resizeHeightOffset:-10,afterFetch:e=>{if(4===ie.columnData.type){const n=e.map((e=>({...e,rowEdit:!1})));return ie.cacheList=o(n),n}let n=e.map((e=>({...e,...ie.expandObj})));return ie.cacheList=o(n),3===ie.columnData.type&&n.map((e=>{e.children&&e.children.length&&(e.children=e.children.map((e=>({...e,...ie.expandObj}))))})),n}}),_e=i((()=>!([3,5].includes(ie.columnData.type)||!ie.columnData.hasPage)&&{pageSize:ie.columnData.pageSize})),ke=i((()=>3==ie.columnData.type||5==ie.columnData.type?1:ie.columnData.childTableStyle)),Ce=i((()=>2==s(ke)||4==ie.columnData.type?ie.columns:ie.complexColumns)),Le=i((()=>{let e=s(Ce);const n=(ie.columnData.defaultSortConfig||[]).map((e=>("desc"===e.sort?"-":"")+e.field)),a={pagination:s(_e),searchInfo:s(oe),defSort:{sidx:n.join(",")},sortFn:e=>{if(Array.isArray(e)){return{sidx:e.map((e=>("descend"===e.order?"-":"")+e.field)).join(",")}}{const{field:n,order:a}=e;return n&&a?{sidx:("descend"===a?"-":"")+n}:{}}},columns:e,clearSelectOnPageChange:!0,ellipsis:!!ie.columnData.showOverflow,isTreeTable:[3,5].includes(ie.columnData.type),bordered:2!=s(ke)&&!!ie.childColumnList?.length||!!ie.columnData.complexHeaderList?.length};return a.actionColumn={width:50,title:ae("component.table.action"),dataIndex:"action",fixed:"right"},ie.customRow&&(a.customRow=ie.customRow),a})),De=i((()=>{let e=s(Ce);if(ie.columnSettingList?.length){for(let n=0;n<e.length;n++)e:for(let a=0;a<ie.columnSettingList.length;a++)if(e[n].dataIndex===ie.columnSettingList[a].dataIndex){e[n].fixed=ie.columnSettingList[a].fixed,e[n].visible=ie.columnSettingList[a].visible;break e}e=e.filter((e=>e.visible))}let n=[];for(let a=0;a<e.length;a++){const l=e[a];if("table"===l.jnpfKey||"complexHeader"===l.jnpfKey?l.children?.length&&n.push(...l.children):n.push(l),l.fixed&&l.children?.length)for(let e=0;e<l.children.length;e++)l.children[e].fixed=l.fixed}return[...n.filter((e=>"left"===e.fixed)),...n.filter((e=>"right"===e.fixed)),...n.filter((e=>"left"!==e.fixed&&"right"!==e.fixed))]})),Ie=i((()=>{const e=[];return s(De).forEach(((n,a)=>{let l=ie.cacheList.reduce(((e,a)=>e+function(e,n){const a=e=>ie.columnData.summaryField.includes(e);if(!ie.columnData.summaryField.length||!a(n))return 0;const l=e[n];if(!l)return 0;return isNaN(l)?0:Number(l)}(a,n.prop)),0);var t;t=n.prop,ie.columnData.summaryField.includes(t)||(l=""),l=Number.isNaN(l)?"":l;const o=l&&!Number.isInteger(l)?Number(l).toFixed(2):l;e[a]=(e=>s(De).some((n=>n.__vModel__===e&&n.thousands)))(n.prop)?r(o):o})),[1,2].includes(ie.columnData.type)&&2===s(ke)&&ie.childColumnList.length&&e.unshift(""),e}));function je(e){return[{label:ae("common.detailText"),onClick:Se.bind(null,"detail",e)}]}function Se(e,n){if("detail"===e)return function(e){const n=o(ie.formConf);n.fields=Oe(n.fields);const a={id:e.id,formConf:n,modelId:ee.modelId,useFormPermission:!1,encryption:ee.config.encryption};te.value?.init(a)}(n)}function Oe(e){let n=e.filter((e=>function(e){if(!e.__config__||!e.__config__.jnpfKey)return!0;const n=e.__config__.jnpfKey;return!!(fe.includes(n)||he.includes(n)&&"static"===e.__config__.dataType)}(e)));return n.forEach((e=>e.__config__?.children&&Array.isArray(e.__config__.children)&&(e.__config__.children=Oe(e.__config__.children)))),n}function Ne(){if(ie.config={modelId:ee.modelId,isPreview:ee.isPreview,...ee.config},oe.modelId=ee.modelId,ie.config.columnData&&("4"==ie.config.webType||ie.config.formData)){if(ie.columnData=JSON.parse(ie.config.columnData),ie.columnData.type=1,ie.columnData.searchList=ie.realSearchList,ie.columnData.columnList=ie.realColumnList,3===ie.columnData.type&&(ie.columnData.columnList=ie.columnData.columnList.filter((e=>e.prop!=ie.columnData.groupField))),ie.hasBatchBtn=ie.columnData.btnsList.some((e=>["batchRemove","batchPrint"].includes(e.value))),ie.formConf=ie.config.formData?JSON.parse(ie.config.formData):{},ie.formConf.popupType="general",ie.columnOptions=ie.columnData.columnOptions||[],be(!0),ie.columnData.funcs.rowStyle&&(ie.customRow=(e,n)=>{const a={row:e,rowIndex:n},l=S(ie.columnData.funcs.rowStyle),t=l?l(a):null;return t?{style:t}:{}}),ie.columnData.funcs.cellStyle&&(ie.customCell=(e,n,a)=>{const l={row:e,rowIndex:n,column:a,columnIndex:a.key},t=S(ie.columnData.funcs.cellStyle),o=t?t(l):null;return o?{style:o}:{}}),function(){if(ie.columnData.treeRelation){for(let e=0;e<ie.columnData.searchList.length;e++){const n=ie.columnData.searchList[e];if(n.id===ie.columnData.treeRelation){ie.treeRelationObj=n;break}}if(!ie.treeRelationObj)for(let e=0;e<ie.columnData.columnOptions.length;e++){const n=ie.columnData.columnOptions[e];if(n.id===ie.columnData.treeRelation){ie.treeRelationObj={...n,searchMultiple:!1,jnpfKey:n.__config__.jnpfKey};break}}}const e=F(ie.columnData.searchList);ie.searchSchemas=e}(),function(){let e=[];e=ie.columnData.columnList,ie.exportList=e;let n=e.map((e=>({...e,title:e.label,dataIndex:e.prop,align:e.align,fixed:"none"!=e.fixed&&e.fixed,sorter:e.sortable,width:e.width||100,customCell:ie.customCell||null})));3!==ie.columnData.type&&5!==ie.columnData.type&&(n=function(e){let n=ie.columnData.complexHeaderList||[];if(!n.length)return e;let a=[],l=[];for(let o=0;o<n.length;o++){const t=n[o];if(t.title=t.fullNameI18nCode?ae(t.fullNameI18nCode,t.fullName):t.fullName,t.align=t.align,t.dataIndex=t.id,t.prop=t.id,t.children=[],t.jnpfKey="complexHeader",t.childColumns?.length){a.push(...t.childColumns);for(let n=0;n<t.childColumns.length;n++){const a=t.childColumns[n];for(let n=0;n<e.length;n++){const l=e[n];l.prop==a&&"left"!==l.fixed&&"right"!==l.fixed&&t.children.push({...l})}}}t.children.length&&l.push(t.children[0].prop)}n=n.filter((e=>e.children.length));let t=[];for(let o=0;o<e.length;o++){const i=e[o];if(a.includes(i.prop)&&"left"!==i.fixed&&"right"!==i.fixed){if(l.includes(i.prop)){const e=n.find((e=>e.childColumns.includes(i.prop)));t.push(e)}}else t.push(i)}return t}(n));ie.columns=n.filter((e=>e.prop.indexOf("-")<0)),function(e){let n=[];for(let a=0;a<e.length;a++){const l=e[a];if(l.prop.includes("-")){let e=l.prop.split("-")[0],a=l.prop.split("-")[1],t=l.label.split("-")[0],o=l.label.replace(t+"-","");l.fullNameI18nCode&&Array.isArray(l.fullNameI18nCode)&&l.fullNameI18nCode[0]&&(t=ae(l.fullNameI18nCode[0],t));let i={align:"center",jnpfKey:"table",prop:e,label:t,title:t,dataIndex:e,children:[],customCell:ie.customCell||null};l.dataIndex=a,l.title=l.__config__?.labelI18nCode?ae(l.__config__.labelI18nCode,o):o,ie.expandObj.hasOwnProperty(`${e}Expand`)||(ie.expandObj[`${e}Expand`]=!1),n.some((n=>n.prop===e))||n.push(i);for(let s=0;s<n.length;s++)if(n[s].prop===e){n[s].children.push(l);break}}else n.push(l)}2!=s(ke)&&function(e){e.forEach((e=>{"table"===e.jnpfKey&&e.children&&e.children.length&&e.children.forEach(((n,a)=>{n.customCell=0==a?(n,a,l)=>({...ie.customCell?ie.customCell(n,a,l):{},rowspan:1,colspan:e.children.length,class:"child-table-box"}):()=>({rowspan:0,colspan:0})}))}))}(n);ie.complexColumns=n,ie.childColumnList=n.filter((e=>"table"===e.jnpfKey))}(n)}(),ee.isPreview)return be(!1);O((()=>{ie.columnData.searchList?.length?ye():ve({page:1})}))}}function Re(e){ie.columnSettingList=e}function Ue(e){let n={};for(let[a,l]of Object.entries(e))l&&(Array.isArray(l)?l.length&&(n[a]=l):n[a]=l);oe.queryJson="{}"===JSON.stringify(n)?"":JSON.stringify(n),ve({page:1})}function Te(){ye()}function Pe(){if(!ie.password)return ne.error(ae("views.dynamicModel.passwordPlaceholder"));ie.btnLoading=!0;const e={id:ie.shortLinkId,type:1,encryption:ee.config.encryption,password:N(ie.password)};P(e).then((()=>{ie.btnLoading=!1,ie.columnPassUse=0,Ne()})).catch((()=>{ie.btnLoading=!1}))}return c((()=>{T(ee.modelId,ee.config.encryption).then((e=>{ie.columnLink=e.data.columnLink||"",ie.shortLinkId=e.data.id||"",ie.columnPassUse=e.data.columnPassUse||0,ie.realSearchList=e.data.columnCondition?JSON.parse(e.data.columnCondition):[],ie.realColumnList=e.data.columnText?JSON.parse(e.data.columnText):[],ie.columnPassUse||Ne()}))})),(e,n)=>{const a=d("a-input-password"),l=d("a-button"),t=d("a-input-group"),o=d("a-popover"),i=d("jnpf-rate"),r=d("jnpf-slider"),c=d("jnpf-input"),S=d("a-table"),O=d("a-tab-pane"),N=d("a-tabs"),R=d("jnpf-input-number"),U=d("jnpf-calculate"),T=d("a-table-summary-cell"),P=d("a-table-summary-row"),K=d("a-table-summary");return u(),p("div",q,[m(h("div",G,[h("div",$,[g(t,{compact:"",class:"enter-y"},{default:y((()=>[g(a,{value:s(me),"onUpdate:value":n[0]||(n[0]=e=>x(me)?me.value=e:null),placeholder:s(ae)("views.dynamicModel.passwordPlaceholder"),onKeyup:n[1]||(n[1]=v((e=>Pe()),["enter"]))},null,8,["value","placeholder"]),g(l,{loading:s(ue),onClick:n[2]||(n[2]=e=>Pe())},{icon:y((()=>[g(s(z))])),_:1},8,["loading"])])),_:1})])],512),[[f,s(pe)]]),m(h("div",Q,[g(o,{placement:"bottomRight"},{content:y((()=>[h("p",V,b(s(ae)("views.dynamicModel.scanAndShare")),1),g(s(w),{value:ie.columnLink,width:154,options:{margin:1},class:"my-5px"},null,8,["value"])])),default:y((()=>[n[3]||(n[3]=h("i",{class:"ym-custom ym-custom-qrcode icon-qrcode"},null,-1))])),_:1,__:[3]}),h("div",W,b(s(de).fullName),1),h("div",X,[s(se).searchList?.length?(u(),p("div",Y,[g(s(A),{onRegister:s(ge),schemas:s(ce),onAdvancedChange:s(we),onSubmit:Ue,onReset:Te,class:"search-form"},null,8,["onRegister","schemas","onAdvancedChange"])])):_("",!0),h("div",Z,[g(s(H),j({onRegister:s(xe)},Le.value,{ref_key:"tableRef",ref:le,onColumnsChange:Re}),k({bodyCell:y((({column:e,record:n})=>[2!==ke.value&&s(re).length?(u(!0),p(C,{key:0},L(s(re),((a,l)=>(u(),p(C,null,[e.id?.includes("-")&&a.children&&a.children[0]&&e.key===a.children[0]?.dataIndex?(u(),D(J,{data:n[a.prop],head:a.children,onToggleExpand:e=>{return l=n,t=`${a.prop}Expand`,void(l[t]=!l[t]);var l,t},expand:n[`${a.prop}Expand`],showOverflow:s(se).showOverflow,key:l},null,8,["data","head","onToggleExpand","expand","showOverflow"])):_("",!0)],64)))),256)):_("",!0),n.top||e.id?.includes("-")?_("",!0):(u(),p(C,{key:1},["inputNumber"===e.jnpfKey?(u(),D(R,{key:0,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,precision:e.precision,thousands:e.thousands,disabled:"",detailed:""},null,8,["value","onUpdate:value","precision","thousands"])):_("",!0),"calculate"===e.jnpfKey?(u(),D(U,{key:1,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,isStorage:e.isStorage,precision:e.precision,thousands:e.thousands,roundType:e.roundType,detailed:""},null,8,["value","onUpdate:value","isStorage","precision","thousands","roundType"])):_("",!0),"rate"===e.jnpfKey?(u(),D(i,{key:2,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,count:e.count,allowHalf:e.allowHalf,disabled:""},null,8,["value","onUpdate:value","count","allowHalf"])):_("",!0),"slider"===e.jnpfKey?(u(),D(r,{key:3,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,min:e.min,max:e.max,step:e.step,disabled:""},null,8,["value","onUpdate:value","min","max","step"])):_("",!0),"input"===e.jnpfKey?(u(),D(c,{key:4,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,useMask:e.useMask,maskConfig:e.maskConfig,showOverflow:s(se).showOverflow,detailed:""},null,8,["value","onUpdate:value","useMask","maskConfig","showOverflow"])):_("",!0)],64)),"action"!==e.key||n.top&&5!=s(se).type?_("",!0):(u(),D(s(E),{key:2,actions:je(n)},null,8,["actions"]))])),_:2},[2===ke.value&&s(re).length?{name:"expandedRowRender",fn:y((({record:e})=>[g(N,{size:"small"},{default:y((()=>[(u(!0),p(C,null,L(s(re),((n,a)=>(u(),D(O,{key:a,tab:n.label,label:n.label},{default:y((()=>[g(S,{size:"small","data-source":e[n.prop],columns:n.children,pagination:!1,scroll:{x:"max-content"}},{bodyCell:y((({column:e,record:n})=>["rate"===e.jnpfKey?(u(),D(i,{key:0,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,count:e.count,allowHalf:e.allowHalf,disabled:""},null,8,["value","onUpdate:value","count","allowHalf"])):_("",!0),"slider"===e.jnpfKey?(u(),D(r,{key:1,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,min:e.min,max:e.max,step:e.step,disabled:""},null,8,["value","onUpdate:value","min","max","step"])):_("",!0),"input"===e.jnpfKey?(u(),D(c,{key:2,value:n[e.dataIndex],"onUpdate:value":a=>n[e.dataIndex]=a,useMask:e.useMask,maskConfig:e.maskConfig,showOverflow:s(se).showOverflow,detailed:""},null,8,["value","onUpdate:value","useMask","maskConfig","showOverflow"])):_("",!0)])),_:2},1032,["data-source","columns"])])),_:2},1032,["tab","label"])))),128))])),_:2},1024)])),key:"0"}:void 0,s(se).showSummary&&[1,2,4].includes(s(se).type)?{name:"summary",fn:y((()=>[g(K,{fixed:""},{default:y((()=>[g(P,null,{default:y((()=>[g(T,{index:0},{default:y((()=>[I(b(s(ae)("component.table.summary")),1)])),_:1}),(u(!0),p(C,null,L(Ie.value,((e,n)=>(u(),D(T,{key:n,index:n+1},{default:y((()=>[I(b(e),1)])),_:2},1032,["index"])))),128)),g(T,{index:Ie.value.length+1},null,8,["index"])])),_:1})])),_:1})])),key:"1"}:void 0]),1040,["onRegister"])])])],512),[[f,!s(pe)]]),g(B,{ref_key:"detailRef",ref:te},null,512)])}}});export{ee as _};
