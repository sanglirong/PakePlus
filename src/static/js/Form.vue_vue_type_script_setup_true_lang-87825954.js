import{a,B as e}from"./index-9c138ba5.js";import{a as t,b as l,d as s}from"./email-d835ba48.js";import{d as o,r as d,ad as i,a0 as n,e as c,o as r,p as u,l as m,j as p,k as b,m as g,q as f,a4 as h,t as C,ae as v,V as y,ah as _}from"./index-920db443.js";const j=o({__name:"Form",emits:["register","reload"],setup(o,{emit:j}){const w=j,x=d(),L=i({dataForm:{recipient:[],cc:[],bcc:[],subject:"",bodyText:"",id:"",attachment:""},rules:{recipient:[{type:"array",required:!0,message:"收件人不能为空",trigger:"blur"}],cc:[{type:"array",required:!0,message:"抄送人不能为空",trigger:"blur"}],bcc:[{type:"array",required:!0,message:"密送人不能为空",trigger:"blur"}],subject:[{required:!0,message:"主题不能为空",trigger:"blur"}]},sendLoading:!1,saveLoading:!1,showCC:!1,showBCC:!1,fileList:[]}),{dataForm:F,rules:k,sendLoading:T,saveLoading:B,showCC:U,showBCC:q,fileList:R}=n(L),{createMessage:A}=_(),[J,{closePopup:N,changeLoading:O}]=a((function(a){x.value?.resetFields(),void(L.dataForm={recipient:[],cc:[],bcc:[],subject:"",bodyText:"",id:"",attachment:""}),L.showCC=!1,L.showBCC=!1,L.sendLoading=!1,L.saveLoading=!1,L.fileList=[],a.id&&(O(!0),t(a.id).then((a=>{L.dataForm={recipient:a.data.recipient?a.data.recipient.split(","):[],cc:a.data.cc?a.data.cc.split(","):[],bcc:a.data.bcc?a.data.bcc.split(","):[],subject:a.data.subject,bodyText:a.data.bodyText,id:a.data.id},L.showCC=!!L.dataForm.cc.length,L.showBCC=!!L.dataForm.bcc.length,L.fileList=a.data.attachment?JSON.parse(a.data.attachment):[],O(!1)})))}));function S(){L.showCC=!L.showCC,L.dataForm.cc=[]}function E(){L.showBCC=!L.showBCC,L.dataForm.bcc=[]}async function M(a=!1){try{if(!(await(x.value?.validate())))return;a?L.sendLoading=!0:L.saveLoading=!0;let e={recipient:L.dataForm.recipient.join(","),subject:L.dataForm.subject,bodyText:L.dataForm.bodyText,attachment:JSON.stringify(L.fileList)};L.showCC&&(e={...e,cc:L.dataForm.cc.join(",")}),L.showBCC&&(e={...e,bcc:L.dataForm.bcc.join(",")}),L.dataForm.id&&(e={...e,id:L.dataForm.id});(a?l:s)(e).then((e=>{A.success(e.msg),a?L.sendLoading=!1:L.saveLoading=!1,N(),w("reload")})).catch((()=>{a?L.sendLoading=!1:L.saveLoading=!1}))}catch(e){}}return(a,t)=>{const l=c("a-button"),s=c("a-select"),o=c("a-form-item"),d=c("a-input"),i=c("jnpf-upload-file"),n=c("jnpf-editor"),_=c("a-form");return r(),u(b(e),y(a.$attrs,{onRegister:b(J),title:"写邮件"}),{insertToolbar:m((()=>[p(l,{type:"primary",onClick:t[0]||(t[0]=a=>M(!0)),loading:b(T),disabled:b(B)},{default:m((()=>t[8]||(t[8]=[g("发送")]))),_:1,__:[8]},8,["loading","disabled"]),p(l,{type:"warning",onClick:t[1]||(t[1]=a=>M()),loading:b(B),disabled:b(T),class:"ml-10px"},{default:m((()=>t[9]||(t[9]=[g("草稿")]))),_:1,__:[9]},8,["loading","disabled"])])),default:m((()=>[p(_,{colon:!1,labelAlign:"right",labelCol:{style:{width:"60px"}},model:b(F),rules:b(k),ref_key:"formElRef",ref:x,class:"!px-10px"},{default:m((()=>[p(o,{label:"收件人",name:"recipient"},{default:m((()=>[p(s,{value:b(F).recipient,"onUpdate:value":t[2]||(t[2]=a=>b(F).recipient=a),mode:"tags","token-separators":[","],placeholder:"收件人",open:!1},null,8,["value"])])),_:1}),b(U)?(r(),u(o,{key:0,label:"抄送人",name:"cc"},{default:m((()=>[p(s,{value:b(F).cc,"onUpdate:value":t[3]||(t[3]=a=>b(F).cc=a),mode:"tags","token-separators":[","],placeholder:"抄送人",open:!1},null,8,["value"])])),_:1})):f("",!0),b(q)?(r(),u(o,{key:1,label:"密送人",name:"bcc"},{default:m((()=>[p(s,{value:b(F).bcc,"onUpdate:value":t[4]||(t[4]=a=>b(F).bcc=a),mode:"tags","token-separators":[","],placeholder:"密送人",open:!1},null,8,["value"])])),_:1})):f("",!0),p(o,{label:" "},{default:m((()=>[h("span",{class:"link-text",onClick:S},C(b(U)?"删除抄送":"添加抄送"),1),t[10]||(t[10]=g("  -  ")),h("span",{class:"link-text",onClick:E},C(b(q)?"删除密送":"添加密送"),1)])),_:1,__:[10]}),p(o,{label:"主题",name:"subject"},{default:m((()=>[p(d,{value:b(F).subject,"onUpdate:value":t[5]||(t[5]=a=>b(F).subject=a),placeholder:"输入主题",allowClear:""},null,8,["value"])])),_:1}),p(o,{label:"附件",name:"attachment"},{default:m((()=>[p(i,{value:b(R),"onUpdate:value":t[6]||(t[6]=a=>v(R)?R.value=a:null),type:"mail"},null,8,["value"])])),_:1}),p(o,{label:"正文",name:"bodyText"},{default:m((()=>[p(n,{value:b(F).bodyText,"onUpdate:value":t[7]||(t[7]=a=>b(F).bodyText=a)},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},16,["onRegister"])}}});export{j as _};
