import{di as e,d as t,ac as o,u as a,r as n,aw as l,a6 as i,ad as s,a0 as r,M as p,e as d,a9 as f,o as u,g as c,j as m,l as g,a4 as v,t as y,k as h,p as w,F as _,h as b,af as L,q as T,m as B,bt as I,i as k,e0 as F,aa as D,ce as C,bl as N,v as x,aS as R,V as A,dE as j,dq as S,n as U,cn as M,cm as P,ah as K,dG as O}from"./index-920db443.js";import{a as E,u as H,B as V}from"./index-9c138ba5.js";import{u as $}from"./index-143f5813.js";import{g as Y,a as q,u as J,c as z,f as G,b as Q,d as W,s as X,e as Z,h as ee,i as te,j as oe,t as ae,k as ne,r as le,l as ie,m as se,n as re,p as pe}from"./task-ee77df5a.js";import{e as de}from"./flowDelegate-3964bb34.js";import{u as fe}from"./useDefineSetting-7df030ff.js";import{_ as ue}from"./OpinionTextarea.vue_vue_type_style_index_0_lang-cb910758.js";import{_ as ce}from"./Sign.vue_vue_type_style_index_0_lang-a3fd8868.js";import{_ as me}from"./FlowFile.vue_vue_type_script_setup_true_lang-ff47ee4a.js";import{_ as ge}from"./Main.vue_vue_type_style_index_0_lang-0afb53a3.js";import{_ as ve}from"./ErrorModal.vue_vue_type_script_setup_true_lang-581230da.js";import{_ as ye}from"./CandidateModal.vue_vue_type_script_setup_true_lang-79d2d529.js";import{_ as he}from"./ActionModal.vue_vue_type_script_setup_true_lang-22457a03.js";import{_ as we}from"./ApprovalModal.vue_vue_type_script_setup_true_lang-8440f311.js";import{_ as _e}from"./ReduceApproverModal.vue_vue_type_script_setup_true_lang-7d94737b.js";import{_ as be}from"./UserListModal.vue_vue_type_script_setup_true_lang-550da35d.js";import{_ as Le}from"./RecordList.vue_vue_type_style_index_0_lang-959f1fc0.js";import{_ as Te}from"./NodeFormParser.vue_vue_type_style_index_0_lang-0828e652.js";import{_ as Be}from"./SubFlowParser.vue_vue_type_style_index_0_lang-20f5de60.js";import{_ as Ie}from"./StartFormParser.vue_vue_type_script_setup_true_lang-0c8077e0.js";import{_ as ke}from"./FlowChart.vue_vue_type_script_setup_true_lang-5aaf6076.js";import{P as Fe,a as De}from"./index.vue_vue_type_script_setup_true_lang-69353133.js";import{_ as Ce}from"./ExtraPanel.vue_vue_type_script_setup_true_lang-7c09275e.js";function Ne(t){return e.get({url:"/api/workflow/monitor",data:t})}function xe(t){return e.delete({url:"/api/workflow/monitor",data:t})}function Re(t,o){return e.post({url:`/api/workflow/monitor/Cancel/${t}`,data:o})}function Ae(t,o){return e.post({url:`/api/workflow/monitor/Assign/${t}`,data:o})}function je(t,o){return e.post({url:`/api/workflow/monitor/Activate/${t}`,data:o})}function Se(t,o){return e.post({url:`/api/workflow/monitor/Pause/${t}`,data:o})}const Ue=["title"],Me={key:0,class:"header-options"},Pe={key:1,class:"header-btn"},Ke={key:0,class:"icon-ym icon-ym-header-fullscreen"},Oe={key:1,class:"icon-ym icon-ym-header-fullscreen-exit"},Ee={class:"jnpf-common-form-wrapper"},He={class:"jnpf-common-form-wrapper__main"},Ve={key:0,class:"approve-result"},$e={key:2,class:"flow-parser-container"},Ye={key:0,class:"flow-top-container"},qe={class:"item"},Je=["title"],ze={class:"item"},Ge=["title"],Qe={class:"item"},We=["title"],Xe={class:"item"},Ze=["title"],et={class:"flow-form-container"},tt={key:1,class:"flow-approval-form"},ot={class:"approval-form"},at={key:2,class:"flow-btn-container"},nt={class:"flow-btn"},lt={class:"flow-btn"},it={class:"flow-btn"},st=t({name:"flow-parser",__name:"FlowParser",props:{defaultFullscreen:{type:Boolean,default:!1},showFullscreen:{type:Boolean,default:!0}},emits:["register","reload","close"],setup(t,{emit:Ne}){const xe=t,rt=Ne,pt=o(),{t:dt}=a(),{createMessage:ft,createConfirm:ut}=K(),[ct,{closePopup:mt,setPopupProps:gt}]=E((function(e){io.hasComment=!1,io.showDataLog=!1,io.isApprovalFile=!1,io.showApprovalForm=!1,io.approvalForm={handleOpinion:"",fileList:[],signImg:"",useSignNext:!1},io.isFullscreen=xe.defaultFullscreen||!1,io.loading=!0,io.btnLoading=!1,io.config=e,io.config.disabled=3!=e.opType&&"-1"!=e.opType,io.flowUrgent=1,io.activeKey=6==e.opType?"2":"1",io.isFlow=e.isFlow||0,function(e){let t={taskNodeId:e.taskNodeId,operatorId:e.operatorId,flowId:e.flowId,opType:2==e.opType?3:e.opType};e.type&&(t.type=e.type);Y(e.id||"0",t).then((t=>{io.formInfo=t.data.formInfo||{},io.taskInfo=t.data.taskInfo||{},io.flowInfo=t.data.flowInfo||{},io.btnInfo=t.data.btnInfo||{},io.lineKeyList=t.data.lineKeyList;const o="-1"==e.opType?io.flowInfo.fullName:io.taskInfo.fullName;if(e.fullName=o,io.thisStep=io.taskInfo.currentNodeName||"",io.flowUrgent=io.taskInfo.flowUrgent||1,e.status=io.taskInfo.status,e.type=io.flowInfo.type,e.draftData=t.data.draftData||null,e.formData=t.data.formData||{},e.formEnCode=io.formInfo.enCode,io.nodeList=t.data.nodeList||[],io.properties=t.data.nodeProperties||{},io.approverText={approverLabel:"processing"===t.data.nodeProperties?.type?"办理意见":"审批意见",approver:"processing"===t.data.nodeProperties?.type?"办理人":"审批人",approverTime:"processing"===t.data.nodeProperties?.type?"办理时间":"审批时间"},io.recordList=(t.data.recordList||[]).reverse(),io.recordTimeList=(t.data.progressList||[]).reverse(),io.approvalData={fileList:[],handleOpinion:"",signImg:"",copyIds:"",backNodeCode:"",backType:io.properties.backType||1},e.formConf=io.formInfo.formData,e.formOperates=t.data.formOperates||[],io.hasComment=io.flowInfo?.flowNodes?.global?.hasComment||!1,io.showDataLog=!(!e.formConf||1!==io.formInfo.type)&&JSON.parse(e.formConf)?.dataLog,0==e.opType)for(let n=0;n<e.formOperates.length;n++)e.formOperates[n].write=!1;if(io.assignNodeList=io.nodeList.filter((t=>6==e.opType&&1==t.type&&("approver"===t.nodeType||"processing"===t.nodeType))),function(){const e=io.properties,t=io.btnInfo;if(io.monitorBtnList=[],io.leftBtnList=[],io.rightBtnList=[],io.todoBtnList=[],6==io.config.opType)t?.hasCancelBtn&&io.monitorBtnList.push({id:"cancel",fullName:"终止",type:"error"}),t?.hasActivateBtn&&io.monitorBtnList.push({id:"resurgence",fullName:"复活",type:"primary"}),t?.hasPauseBtn&&io.monitorBtnList.push({id:"pause",fullName:"暂停",type:"info"}),t?.hasRebootBtn&&io.monitorBtnList.push({id:"reboot",fullName:"恢复"}),t?.hasAssignBtn&&io.monitorBtnList.push({id:"assign",fullName:"指派",type:"warning"}),t?.hasFileBtn&&io.monitorBtnList.push({id:"file",fullName:"归档",type:"primary"});else{if(t?.hasSaveBtn&&!io.config.hideSaveBtn&&io.rightBtnList.push({id:"save",fullName:e.saveBtnText||"暂存",type:""}),t?.hasSubmitBtn&&io.rightBtnList.push({id:"submit",fullName:e.submitBtnText||"提交",type:"primary"}),t?.hasDelegateSubmitBtn&&io.rightBtnList.push({id:"delegateSubmit",fullName:"委托发起",type:"primary"}),t?.hasSignBtn&&io.rightBtnList.push({id:"sign",fullName:t?.proxyMark?"代签":"签收",type:"primary"}),2==io.config.opType){pt?.getSysConfigInfo?.flowSign&&io.flowInfo?.flowNodes?.global?.hasSignFor&&io.todoBtnList.push({id:"cancelSign",fullName:"退签",type:"warning"}),io.todoBtnList.push({id:"startHandle",fullName:t?.proxyMark?"代办":"开始办理",type:"primary"})}t?.hasRecallLaunchBtn&&io.rightBtnList.push({id:"launchRecall",fullName:"撤回",type:"warning"}),t?.hasRecallAuditBtn&&io.rightBtnList.push({id:"auditRecall",fullName:"撤回",type:"warning"}),t?.hasAssistSaveBtn&&io.rightBtnList.push({id:"saveAssist",fullName:"保存"}),t?.hasRejectBtn&&"processing"!=io.properties.type&&io.rightBtnList.push({id:"reject",fullName:e.rejectBtnText||"拒绝",type:"error"}),t?.hasAuditBtn&&io.rightBtnList.push({id:"audit",fullName:e.auditBtnText||("processing"===io.properties.type?"确认办理":"同意"),type:"primary"}),t?.hasReduceApproverBtn&&io.rightBtnList.push({id:"reduceApprover",fullName:e.reduceApproverBtnText||"减签",type:"primary"}),t?.hasRevokeBtn&&io.leftBtnList.push({id:"revoke",fullName:"撤销"}),t?.hasPressBtn&&io.leftBtnList.push({id:"press",fullName:e.pressBtnText||"催办"}),t?.hasAssistBtn&&io.leftBtnList.push({id:"assist",fullName:e.assistBtnText||"协办"}),t?.hasTransferBtn&&io.leftBtnList.push({id:"transfer",fullName:e.transferBtnText||"转审"}),t?.hasFreeApproverBtn&&io.leftBtnList.push({id:"freeApprover",fullName:e.freeApproverBtnText||"加签"}),t?.hasBackBtn&&io.leftBtnList.push({id:"back",fullName:e.backBtnText||"退回"}),t?.hasSaveAuditBtn&&io.leftBtnList.push({id:"saveAudit",fullName:"暂存"}),t?.hasPrintBtn&&io.leftBtnList.push({id:"print",fullName:"打印"}),e?.customBtns?.length&&e?.customBtns.map((e=>{io.leftBtnList.push({id:e.value,fullName:e.label,jsJson:e.jsJson})}))}}(),ia(),6==e.opType)return io.activeKey="2",Go(),void(io.flowKey=+new Date);const a=1==io.formInfo.type?"workFlow/workFlowForm/dynamicForm":io.formInfo.urlAddress?io.formInfo.urlAddress.replace(/\s*/g,""):`workFlow/workFlowForm/${io.formInfo.enCode}`;io.currentView=j(S((()=>O(a)))),io.flowKey=+new Date})).catch((()=>{io.loading=!1}))}(io.config)})),[vt,{openModal:yt,closeModal:ht,setModalProps:wt}]=$(),[_t,{openModal:bt,closeModal:Lt,setModalProps:Tt}]=$(),[Bt,{openModal:It,closeModal:kt,setModalProps:Ft}]=$(),[Dt,{openModal:Ct,closeModal:Nt,setModalProps:xt}]=$(),[Rt,{openPopup:At}]=H(),[jt,{openPopup:St}]=H(),[Ut,{openPopup:Mt}]=H(),[Pt,{openPopup:Kt}]=H(),[Ot,{openModal:Et}]=$(),[Ht,{openModal:Vt}]=$(),[$t,{openModal:Yt}]=$(),[qt,{openPopup:Jt}]=H(),[zt,{openModal:Gt}]=$(),{getFlowStatusContent:Qt,getFlowStatusColor:Wt}=fe(),Xt=[{id:1,fullName:"普通"},{id:2,fullName:"重要"},{id:3,fullName:"紧急"}],Zt=n(null),eo=n(null),to=n(null),oo=l(),ao=n(oo.apiUrl),no=i(),lo=no.getUserInfo,io=s({config:{},properties:{},loading:!1,btnLoading:!1,allBtnDisabled:!1,flowUrgent:1,leftBtnList:[],rightBtnList:[],monitorBtnList:[],todoBtnList:[],activeKey:" 1",taskInfo:{},formInfo:{},flowInfo:{},btnInfo:{},nodeList:[],recordList:[],recordTimeList:[],assignNodeList:[],thisStep:"",endTime:0,currentView:null,formData:{},eventType:"",approvalData:{},resurgenceData:{},flowKey:0,formKey:0,hasComment:!1,showDataLog:!1,isFullscreen:!1,approvalForm:{handleOpinion:"",fileList:[],signImg:"",useSignNext:!1},showApprovalForm:!1,isFlow:0,isApprovalFile:!1,showFlowParser:!1,approverText:{approverLabel:"审批意见",approver:"审批人",approverTime:"审批时间"},lineKeyList:void 0}),{config:so,loading:ro,btnLoading:po,allBtnDisabled:fo,flowKey:uo,formKey:co,taskInfo:mo,monitorBtnList:go,leftBtnList:vo,rightBtnList:yo,todoBtnList:ho,eventType:wo,isFullscreen:_o,approvalForm:bo,showApprovalForm:Lo,properties:To,btnInfo:Bo,showFlowParser:Io}=r(io),ko=p((()=>{if(2===io.flowInfo?.type)return io.flowInfo.fullName||"";const e=io.config.fullName||"";return[4,5,6].includes(io.config.opType)?e:io.thisStep?e+"/"+io.thisStep:e})),Fo=p((()=>{const e=Xt.filter((e=>e.id===io.flowUrgent));return e.length&&e[0].fullName||"普通"})),Do=p((()=>{const e=io.taskInfo.status;return 1==e?"doing":2==e?"adopt":3==e?"reject":4==e?"cancel":5==e?"pause":6==e?"revoking":7==e?"revoke":8==e?"back":9==e?"recall":""})),Co=p((()=>6==io.config.opType&&"2"===io.activeKey&&2!==io.flowInfo?.type)),No=p((()=>"-1"!=io.config.opType&&(io.hasComment||"6"!=io.config.opType)&&!io.loading)),xo=p((()=>({taskId:io.config.id,recordTimeList:io.recordTimeList,showComment:io.hasComment,showRecord:"6"!=io.config.opType,showDataLog:io.showDataLog,modelId:io.formInfo?.id,formDataId:io.config?.formData?.id,auxiliaryInfo:io.properties.auxiliaryInfo||[],formData:io.config?.formData}))),Ro=p((()=>io.isFullscreen?dt("layout.header.tooltipExitFull"):dt("layout.header.tooltipEntryFull")));function Ao(e,t){return io.formData=e,io.formData.flowId=io.flowInfo.flowId,io.formData.id=io.config.id,io.eventType=t,"save"===t||"submit"===t?jo():"delegateSubmit"!==t?"saveAudit"===t||"saveAssist"===t?function(){io.allBtnDisabled=!0,io.btnLoading=!0;("saveAssist"==io.eventType?X:Z)(io.config.operatorId,io.formData).then((e=>{ft.success(e.msg).then((()=>{io.allBtnDisabled=!1,io.btnLoading=!1,Qo(!0)}))})).catch((()=>{io.allBtnDisabled=!1,io.btnLoading=!1}))}():"audit"===t||"reject"===t?async function(){try{if(!(await(eo.value?.validate())))return io.showApprovalForm=!0;io.allBtnDisabled=!0,io.btnLoading=!0,io.formData.handleStatus="audit"===io.eventType?1:0,q(io.config.operatorId,io.formData).then((e=>{io.allBtnDisabled=!1,io.btnLoading=!1;const t=e.data.list.filter((e=>!e.isBranchFlow&&e.isCandidates)),o=e.data.list.filter((e=>e.isBranchFlow));t.length||io.properties.isCustomCopy||3!=e.data.type?bt(!0,{branchList:o,candidateList:t,isCustomCopy:io.properties.isCustomCopy,formData:io.formData,eventType:io.eventType,operatorId:io.config.operatorId}):ut({iconType:"warning",title:"提示",content:"processing"===io.properties.type?"是否确认办理该审批单？":`此操作将${"audit"===io.eventType?"同意":"拒绝"}该审批单，是否继续?`,onOk:()=>{io.approvalData=io.approvalForm,Ko()}})})).catch((()=>{io.allBtnDisabled=!1,io.btnLoading=!1}))}catch(e){io.showApprovalForm=!0}}():"freeApprover"===t?(io.btnLoading=!0,void q(io.config.operatorId,io.formData).then((e=>{io.btnLoading=!1;const t=e.data.list.filter((e=>!e.isBranchFlow&&e.isCandidates)),o=e.data.list.filter((e=>e.isBranchFlow));Ct(!0,{branchList:o,candidateList:t,backNodeCodeList:[],operatorId:io.config.operatorId,formData:io.formData,eventType:io.eventType,properties:io.properties})})).catch((()=>{io.btnLoading=!1}))):void 0:void de(io.flowInfo.id).then((e=>{const t=e.data.list||[];return 1==t.length?$o(t[0].id):t.length?Gt(!0,{userList:t}):void 0}))}function jo(){if(io.formData.status="save"===io.eventType?0:1,io.formData.flowUrgent=io.flowUrgent,delete io.formData.delegateUser,"delegateSubmit"===io.eventType&&(io.formData.delegateUser=io.config.delegateUser),"save"===io.eventType)return So();io.btnLoading=!0,q("0",io.formData).then((e=>{io.btnLoading=!1;const t=e.data.list.filter((e=>!e.isBranchFlow&&e.isCandidates)),o=e.data.list.filter((e=>e.isBranchFlow));t.length||3!=e.data.type?bt(!0,{branchList:o,candidateList:t,isCustomCopy:io.properties.isCustomCopy,formData:io.formData,eventType:io.eventType}):ut({iconType:"warning",title:"提示",content:"您确定要提交当前流程吗, 是否继续?",onOk:()=>{So()}})})).catch((()=>{io.btnLoading=!1}))}function So(e=null){e&&(io.formData={...io.formData,...e}),io.formData.id||delete io.formData.id,io.formData.isFlow=io.isFlow,io.allBtnDisabled=!0,io.btnLoading=!0;(io.formData.id?J:z)(io.formData).then((e=>{Uo(e)})).catch((()=>{Tt({confirmLoading:!1}),wt({confirmLoading:!1}),io.allBtnDisabled=!1,io.btnLoading=!1}))}function Uo(e){const t=e.data?.errorCodeList;t&&Array.isArray(t)&&t.length?(io.allBtnDisabled=!1,io.btnLoading=!1,yt(!0,{errorData:t})):ft.success(e.msg).then((()=>{if(ht(),Lt(),Nt(),kt(),e.data?.isEnd)return io.isApprovalFile=!0,void ea(e.data.taskId);io.allBtnDisabled=!1,io.btnLoading=!1,Qo(!0)}))}function Mo(e){return io.formData.errorRuleUserList=e,"submit"===io.eventType?So():"audit"===io.eventType||"reject"===io.eventType?Ko():void 0}function Po(){Tt({confirmLoading:!1}),xt({confirmLoading:!1}),Ft({confirmLoading:!1}),wt({confirmLoading:!1}),io.allBtnDisabled=!1,io.btnLoading=!1}function Ko(){const e={...io.approvalData,...io.formData};"audit"===io.eventType&&(e.handleStatus=1),"reject"===io.eventType&&(e.handleStatus=0);const t="freeApprover"===io.eventType?G:"back"===io.eventType?Q:W;io.allBtnDisabled=!0,io.btnLoading=!0,t(io.config.operatorId,e).then((t=>{Uo(t),e.useSignNext&&no.setUserInfo({signImg:e.signImg,signId:e.signId})})).catch((()=>{Po()}))}function Oo(e){io.approvalData=e,Ko()}function Eo(e=null){e||(e={handleOpinion:"",signImg:"",fileList:[]});const t=["resurgence","assign","pause","revoke","cancel","launchRecall"].includes(io.eventType)?io.config.id:io.config.operatorId,o="sign"===io.eventType?ee:"cancelSign"===io.eventType?te:"startHandle"===io.eventType?oe:"transfer"===io.eventType?ae:"assist"===io.eventType?ne:"assign"===io.eventType?Ae:"revoke"===io.eventType?le:"launchRecall"===io.eventType?ie:"auditRecall"===io.eventType?se:"cancel"===io.eventType?Re:"pause"===io.eventType?Se:"resurgence"===io.eventType?je:Re;io.allBtnDisabled=!0,io.btnLoading=!0,o(t,e).then((e=>{"startHandle"==io.eventType?function(e){ft.success(e.msg).then((()=>{io.allBtnDisabled=!1,io.btnLoading=!1,rt("reload",!1),io.config.opType=3,io.config.disabled=!1,ia(),io.formKey=+new Date}))}(e):Uo(e)})).catch((()=>{Ft({confirmLoading:!1}),io.allBtnDisabled=!1,io.btnLoading=!1}))}function Ho({key:e}){io.flowUrgent=e}function Vo(t){io.eventType=t;if(["save","submit","delegateSubmit","audit","reject","saveAudit","saveAssist","freeApprover"].includes(t))return o=t,void Zt.value?.dataFormSubmit(o,io.flowUrgent);var o;if("reduceApprover"!=t){if("back"==t)return io.btnLoading=!0,void re(io.config.operatorId).then((e=>{io.btnLoading=!1;const t={backNodeCodeList:e.data.list||[],branchList:[],candidateList:[],operatorId:io.config.operatorId,formData:io.formData,eventType:io.eventType,properties:io.properties};Ct(!0,t)})).catch((()=>{io.btnLoading=!1}));var a;if("press"!=t)return"resurgence"==t?function(e){It(!0,{properties:io.properties,eventType:e})}(t):"pause"==t?function(t){(o=io.config.id,e.get({url:`/api/workflow/monitor/AnySubFlow/${o}`})).then((e=>{It(!0,{properties:io.properties,eventType:t,pauseType:e.data||!1})}));var o}(t):"reboot"==t?(io.allBtnDisabled=!0,io.btnLoading=!0,void(a=io.config.id,e.post({url:`/api/workflow/monitor/Reboot/${a}`})).then((e=>{ft.success(e.msg).then((()=>{io.allBtnDisabled=!1,io.btnLoading=!1,Qo(!0)}))}))):"print"==t?function(){if(!io.properties.printConfig.printIds?.length)return ft.error("未配置打印模板");if(1===io.properties.printConfig.printIds?.length)return Yo(io.properties.printConfig.printIds[0]);Et(!0,io.properties.printConfig.printIds)}():"file"==t?ea():t.includes("btn_")?function(e){return io.leftBtnList.length&&io.leftBtnList.map((t=>{if(t.id===e){const e={flowInfo:io.flowInfo,formData:io.formData,taskInfo:io.taskInfo,onlineUtils:M},o=P(t.jsJson);o&&o(e)}})),null}(t):void function(e){if(io.eventType=e,["sign","cancelSign","startHandle"].includes(e)||"cancel"==e&&2==io.flowInfo?.type){let t="";return"sign"==e&&(t="确定签收，签收后进入待办。"),"cancelSign"==e&&(t="确定退签，确定后进入我的待签。"),"startHandle"==e&&(t="确定开始办理流程"),"cancel"==e&&(t="终止后流程不可恢复，是否继续？"),void ut({iconType:"warning",title:"提示",content:t,onOk:()=>{Eo()}})}It(!0,{properties:io.properties,assignNodeList:io.assignNodeList,eventType:e})}(t);ut({iconType:"warning",title:"提示",content:"此操作将提示该节点尽快处理，是否继续?",onOk:()=>{pe(io.config.id).then((e=>{ft.success(e.msg)}))}})}else Yt(!0,{id:io.config.operatorId})}function $o(e){io.config.delegateUser=e,jo()}function Yo(e){Vt(!0,{id:e,formInfo:[{formId:io.config.formData.id,flowTaskId:io.config.id}]})}function qo(e){At(!0,{...e,flowId:io.flowInfo.flowId})}function Jo(e){const t={opType:io.config.opType,nodeCode:e,taskId:io.config.id};St(!0,t)}function zo(){Mt(!0,{taskId:io.config.id,id:io.config.id,title:io.config.fullName})}function Go(e=!1){io.loading=!!e}function Qo(e=!1){rt("close"),io.currentView=null,mt(),e&&rt("reload")}function Wo(){return rt("close"),io.currentView=null,!0}function Xo(){io.showApprovalForm=!io.showApprovalForm}function Zo(){Kt(!0,{flowInfo:io.flowInfo,nodeList:io.nodeList,opType:io.config.opType,taskId:io.config.id,isRevokeTask:io.taskInfo.isRevokeTask,lineKeyList:io.lineKeyList})}function ea(e){io.allBtnDisabled=!0,io.btnLoading=!0,U((()=>{to.value?.init({id:io.flowInfo?.flowNodes?.global?.fileConfig?.templateId,formInfo:[{formId:io.config.formData.id,flowTaskId:e||io.config.id}],opType:io.config.opType})}))}function ta(){io.allBtnDisabled=!1,io.btnLoading=!1,"6"==io.config.opType&&(io.monitorBtnList=io.monitorBtnList.filter((e=>"file"!=e.id))),io.isApprovalFile&&(io.allBtnDisabled=!1,io.btnLoading=!1,Qo(!0))}function oa(){io.isFullscreen=!io.isFullscreen,gt({defaultFullscreen:io.isFullscreen})}function aa(e){io.approvalForm.useSignNext=e}function na(e,t){io.approvalForm.signId=t}function la(e){if("audit"==io.eventType||"reject"==io.eventType)return io.approvalData={...io.approvalForm,...e},void Ko();So(e)}function ia(){if(io.approvalForm.approvalField=[],3==io.config.opType&&io.properties.hasApprovalField){const e=io.flowInfo?.flowNodes?.global?.approvalFieldList||[];io.properties.approvalField.map((t=>{const o=e.filter((e=>e.id==t));o?.length&&io.approvalForm.approvalField.push({...o[0],value:null})}))}}function sa(e){io.showFlowParser=!0,U((()=>{Jt(!0,{id:e,opType:5,showFullscreen:!1,isFullscreen:io.isFullscreen})}))}return(e,o)=>{const a=d("a-menu-item"),n=d("a-menu"),l=d("a-dropdown"),i=d("a-space"),s=d("a-button"),r=d("a-tab-pane"),p=d("a-tabs"),j=d("JnpfTextTag"),S=d("a-avatar"),U=d("jnpf-input"),M=d("a-form-item"),P=d("a-form"),K=d("a-col"),O=d("a-row"),E=d("jnpf-upload-file"),H=d("jnpf-textarea"),$=d("jnpf-input-number"),Y=f("loading");return u(),c(_,null,[m(h(V),A(e.$attrs,{onRegister:h(ct),showBackIcon:!h(so).hideCancelBtn,showCancelBtn:!1,destroyOnClose:"",closeFunc:Wo,defaultFullscreen:t.defaultFullscreen,class:"full-popup basic-flow-parser"}),{title:g((()=>[m(i,{size:10},{default:g((()=>[v("div",{class:"header-title",title:ko.value},y(ko.value),9,Ue),h(ro)&&!ko.value||2==io.flowInfo?.type?T("",!0):(u(),w(l,{key:0,disabled:"-1"!=h(so).opType},{overlay:g((()=>[m(n,{onClick:Ho},{default:g((()=>[(u(),c(_,null,b(Xt,(e=>m(a,{key:e.id},{default:g((()=>[v("div",{class:L(["flow-urgent-value","urgent"+e.id])},y(e.fullName),3)])),_:2},1024))),64))])),_:1})])),default:g((()=>[v("div",{class:L(["flow-urgent-value","urgent"+io.flowUrgent])},y(Fo.value),3)])),_:1},8,["disabled"]))])),_:1})])),insertToolbar:g((()=>[6==h(so).opType?(u(),c("div",Me,[(u(!0),c(_,null,b(h(go),(e=>(u(),w(s,{color:e.type,onClick:t=>Vo(e.id),loading:h(po)&&h(wo)==e.id,disabled:h(ro)||h(fo)||h(po)&&h(wo)!==e.id},{default:g((()=>[B(y(e.fullName),1)])),_:2},1032,["color","onClick","loading","disabled"])))),256))])):(u(),c("div",Pe,[h(Bo)?.hasViewStartFormBtn?(u(),w(h(I),{key:0,title:"查看发起表单",placement:"bottom"},{default:g((()=>[m(s,{type:"text",onClick:zo},{default:g((()=>o[5]||(o[5]=[v("i",{class:"icon-ym icon-ym-report-icon-preview"},null,-1)]))),_:1,__:[5]})])),_:1})):T("",!0),t.showFullscreen?(u(),w(h(I),{key:1,title:Ro.value,placement:"bottom"},{default:g((()=>[m(s,{type:"text",onClick:oa},{default:g((()=>[h(_o)?(u(),c("i",Oe)):(u(),c("i",Ke))])),_:1})])),_:1},8,["title"])):T("",!0),m(h(I),{title:"流程图",placement:"bottom",onClick:Zo},{default:g((()=>[m(s,{type:"text",disabled:h(ro)},{default:g((()=>o[6]||(o[6]=[v("i",{class:"icon-ym icon-ym-flow-node-condition"},null,-1)]))),_:1,__:[6]},8,["disabled"])])),_:1})]))])),default:g((()=>[k((u(),c("div",Ee,[v("div",He,[Co.value?(u(),c("div",Ve,[v("div",{class:L(["approve-result-img",Do.value])},null,2)])):T("",!0),6==h(so).opType?(u(),w(p,{key:1,activeKey:io.activeKey,"onUpdate:activeKey":o[0]||(o[0]=e=>io.activeKey=e),class:L(["flow-parser-tabs",{"no-head-margin":"3"==io.activeKey}])},{default:g((()=>[m(r,{key:"2",tab:"流程信息",class:"!overflow-hidden"},{default:g((()=>[io.flowInfo.id?(u(),w(ge,{flowInfo:io.flowInfo,nodeList:io.nodeList,isPreview:!0,lineKeyList:io.lineKeyList,key:h(uo),onViewSubFlow:Jo},null,8,["flowInfo","nodeList","lineKeyList"])):T("",!0)])),_:1}),"-1"!=h(so).opType||"-1"==h(so).opType&&7==h(so).status?(u(),w(r,{key:"3",tab:"流转记录",class:"!p-0"},{default:g((()=>["3"==io.activeKey?(u(),w(Le,{key:0,list:io.recordList,opType:h(so).opType,type:io.flowInfo.type,status:io.taskInfo?.status,onViewDetail:qo},null,8,["list","opType","type","status"])):T("",!0)])),_:1})):T("",!0)])),_:1},8,["activeKey","class"])):k((u(),c("div",$e,["-1"!=h(so).opType?(u(),c("div",Ye,[v("div",qe,[o[7]||(o[7]=B(" 流程类型：")),v("span",{class:"content",title:h(mo).flowCategory},y(h(mo).flowCategory),9,Je)]),v("div",ze,[o[8]||(o[8]=B(" 流程状态： ")),v("span",{class:"content",title:h(Qt)(h(mo).status)},[m(j,{content:h(Qt)(h(mo).status),color:h(Wt)(h(mo).status)},null,8,["content","color"])],8,Ge)]),v("div",Qe,[o[9]||(o[9]=B(" 发起人： ")),v("span",{class:"content",title:h(mo).creatorUser},[m(S,{size:24,src:ao.value+h(mo).headIcon},null,8,["src"]),B(" "+y(h(mo).creatorUser),1)],8,We)]),v("div",Xe,[o[10]||(o[10]=B(" 发起时间： ")),v("span",{class:"content",title:h(F)(h(mo).creatorTime,"YYYY-MM-DD HH:mm")},y(h(F)(h(mo).creatorTime,"YYYY-MM-DD HH:mm")),9,Ze)])])):T("",!0),v("div",et,[(u(),w(D(io.currentView),{ref_key:"formRef",ref:Zt,config:h(so),key:h(co),onEventReceiver:Ao,onSetPageLoad:Go,onOpenRevokeFlow:sa},null,40,["config"]))]),"3"==h(so).opType&&(h(Bo)?.hasRejectBtn||h(Bo)?.hasAuditBtn)?(u(),c("div",tt,[m(P,{colon:!1,labelCol:{style:{width:"100px"}},class:"opinion-btn",onClick:Xo},{default:g((()=>[m(M,{label:io.approverText.approverLabel,name:"handleOpinion",required:""},{default:g((()=>[m(U,{disabled:"",placeholder:io.approverText.approverLabel,value:h(bo).handleOpinion,"onUpdate:value":o[1]||(o[1]=e=>h(bo).handleOpinion=e)},null,8,["placeholder","value"])])),_:1},8,["label"]),o[11]||(o[11]=v("div",{class:"cover-btn"},null,-1))])),_:1,__:[11]}),m(h(C),{placement:"bottom",closable:!1,open:h(Lo),"get-container":!1,style:{position:"absolute"},destroyOnClose:""},{default:g((()=>[v("div",ot,[m(P,{colon:!1,labelCol:{style:{width:"100px"}},model:h(bo),ref_key:"formElRef",ref:eo},{default:g((()=>[m(O,{gutter:16},{default:g((()=>[m(K,{span:12},{default:g((()=>[m(M,{label:io.approverText.approver},{default:g((()=>[B(y(h(lo).userName),1)])),_:1},8,["label"])])),_:1}),m(K,{span:12},{default:g((()=>[m(M,{label:io.approverText.approverTime},{default:g((()=>[B(y(h(N)(+new Date)),1)])),_:1},8,["label"])])),_:1})])),_:1}),m(M,{label:io.approverText.approverLabel,name:"handleOpinion",required:""},{default:g((()=>[m(ue,{value:h(bo).handleOpinion,"onUpdate:value":o[2]||(o[2]=e=>h(bo).handleOpinion=e),messageText:"processing"===io.properties?.type?"请先填写办理意见":"请先填写审批意见"},null,8,["value","messageText"])])),_:1},8,["label"]),h(To).hasSign?(u(),w(M,{key:0,label:"签名",name:"signImg",rules:[{required:!0,message:"请签名",trigger:"change"}]},{default:g((()=>[m(ce,{value:h(bo).signImg,"onUpdate:value":o[3]||(o[3]=e=>h(bo).signImg=e),onChange:na,onUseSignNextChange:aa},null,8,["value"])])),_:1})):T("",!0),h(To).hasFile?(u(),w(M,{key:1,label:"附件",name:"fileList"},{default:g((()=>[m(E,{value:h(bo).fileList,"onUpdate:value":o[4]||(o[4]=e=>h(bo).fileList=e),type:"workFlow",limit:3},null,8,["value"])])),_:1})):T("",!0),(u(!0),c(_,null,b(h(bo).approvalField,(e=>(u(),w(M,{label:e.fieldName},{default:g((()=>["input"==e.jnpfKey?(u(),w(U,{key:0,placeholder:"请输入",value:e.value,"onUpdate:value":t=>e.value=t},null,8,["value","onUpdate:value"])):T("",!0),"textarea"==e.jnpfKey?(u(),w(H,{key:1,placeholder:"请输入",value:e.value,"onUpdate:value":t=>e.value=t},null,8,["value","onUpdate:value"])):T("",!0),"inputNumber"==e.jnpfKey?(u(),w($,{key:2,placeholder:"请输入",value:e.value,"onUpdate:value":t=>e.value=t},null,8,["value","onUpdate:value"])):T("",!0)])),_:2},1032,["label"])))),256))])),_:1},8,["model"]),m(h(I),{title:"收起",placement:"bottom"},{default:g((()=>[v("i",{class:"icon-ym icon-ym-report-icon-arrow-down arrow-icon",onClick:Xo})])),_:1})])])),_:1},8,["open"])])):T("",!0),h(vo).length||h(yo).length?(u(),c("div",at,[2!=h(so).opType?(u(),c(_,{key:0},[v("div",nt,[(u(!0),c(_,null,b(h(vo),(e=>(u(),w(s,{type:e.type,onClick:t=>Vo(e.id),loading:h(po)&&h(wo)==e.id,disabled:h(ro)||h(fo)||h(po)&&h(wo)!==e.id},{default:g((()=>[B(y(e.fullName),1)])),_:2},1032,["type","onClick","loading","disabled"])))),256))]),v("div",lt,[(u(!0),c(_,null,b(h(yo),(e=>(u(),w(s,{type:e.type,onClick:t=>Vo(e.id),loading:h(po)&&h(wo)==e.id,disabled:h(ro)||h(fo)||h(po)&&h(wo)!==e.id},{default:g((()=>[B(y(e.fullName),1)])),_:2},1032,["type","onClick","loading","disabled"])))),256))])],64)):(u(),c(_,{key:1},[o[12]||(o[12]=v("div",{class:"flow-btn"},null,-1)),v("div",it,[(u(!0),c(_,null,b(h(ho),(e=>(u(),w(s,{type:e.type,onClick:t=>Vo(e.id),loading:h(po)&&h(wo)==e.id,disabled:h(ro)||h(fo)||h(po)&&h(wo)!==e.id},{default:g((()=>[B(y(e.fullName),1)])),_:2},1032,["type","onClick","loading","disabled"])))),256))])],64))])):T("",!0)],512)),[[x,!h(ro)]])]),No.value?(u(),w(Ce,R(A({key:0},xo.value)),null,16)):T("",!0)])),[[Y,h(ro)]]),m(me,{ref_key:"flowFileRef",ref:to,onFileEnd:ta},null,512)])),_:1},16,["onRegister","showBackIcon","defaultFullscreen"]),m(ve,{onRegister:h(vt),onConfirm:Mo,onClose:Po},null,8,["onRegister"]),m(ye,{onRegister:h(_t),onConfirm:la},null,8,["onRegister"]),m(he,{onRegister:h(Bt),onConfirm:Eo},null,8,["onRegister"]),m(we,{onRegister:h(Dt),onConfirm:Oo},null,8,["onRegister"]),m(Te,{onRegister:h(Rt)},null,8,["onRegister"]),m(Fe,{onRegister:h(Ot),onChange:Yo},null,8,["onRegister"]),m(De,{onRegister:h(Ht)},null,8,["onRegister"]),m(_e,{onRegister:h($t)},null,8,["onRegister"]),m(Be,{defaultFullscreen:h(_o),onRegister:h(jt)},null,8,["defaultFullscreen","onRegister"]),m(Ie,{defaultFullscreen:h(_o),onRegister:h(Ut)},null,8,["defaultFullscreen","onRegister"]),m(ke,{defaultFullscreen:h(_o),onRegister:h(Pt)},null,8,["defaultFullscreen","onRegister"]),h(Io)?(u(),w(st,{key:0,defaultFullscreen:h(_o),showFullscreen:!1,onRegister:h(qt)},null,8,["defaultFullscreen","onRegister"])):T("",!0),m(be,{onRegister:h(zt),onConfirm:$o},null,8,["onRegister"])],64)}}});export{st as _,xe as d,Ne as g};
