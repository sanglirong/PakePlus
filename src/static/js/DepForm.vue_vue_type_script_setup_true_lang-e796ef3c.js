import{d as e,r as a,u as t,fg as r,M as l,k as o,gk as n,e as s,o as d,p as i,l as u,j as m,V as c,gl as p,gm as g,ah as f}from"./index-920db443.js";import{b as h,B as v}from"./index-143f5813.js";import{u as b,B as I}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{f as x}from"./formValidate-c8ab8d29.js";const j=e({__name:"DepForm",emits:["register","reload"],setup(e,{emit:j}){const T=j,[k,{setFieldsValue:M,resetFields:O,validate:P,clearValidate:V}]=b({schemas:[{field:"parentId",label:"所属组织",component:"TreeSelect",slot:"parentId",rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"fullName",label:"部门名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:x("fullName","不能含有特殊符号"),trigger:"blur"}]},{field:"enCode",label:"部门编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:x("enCode","只能输入英文、数字和小数点且小数点不能放在首尾"),trigger:"blur"}]},{field:"managerId",label:"部门主管",component:"UserSelect",componentProps:{placeholder:"请选择"}},{field:"sortCode",label:"排序",defaultValue:0,component:"InputNumber",componentProps:{min:0,max:999999}},{field:"description",label:"说明",component:"Textarea",componentProps:{placeholder:"请输入"}}]}),[_,{closeModal:C,changeLoading:F,changeOkLoading:R}]=h((function(e){O(),S.value=e.id,q.value=[],S.value&&(F(!0),n(S.value).then((e=>{q.value=e.data.organizeIdTree||[],M(e.data),F(!1)})))})),S=a(""),q=a([]),{createMessage:z}=f(),{t:N}=t(),w=r(),B=l((()=>o(S)?N("common.editText"):N("common.addText")));function L(e){M({parentId:e&&e.length?e[e.length-1]:""}),e&&e.length&&V("parentId")}async function U(){const e=await P();if(!e)return;R(!0);const a={enabledMark:1,...e,id:S.value,organizeIdTree:q.value};(S.value?p:g)(a).then((e=>{z.success(e.msg),R(!1),w.resetState(),C(),setTimeout((()=>{T("reload")}),300)})).catch((()=>{R(!1)}))}return(e,a)=>{const t=s("jnpfOrganizeSelect");return d(),i(o(v),c(e.$attrs,{onRegister:o(_),title:B.value,onOk:U}),{default:u((()=>[m(o(I),{onRegister:o(k)},{parentId:u((()=>[m(t,{value:q.value,"onUpdate:value":a[0]||(a[0]=e=>q.value=e),placeholder:"请选择",auth:"",onChange:L,currOrgId:S.value||"0"},null,8,["value","currOrgId"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"])}}});export{j as _};
