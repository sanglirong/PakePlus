import{a as e}from"./authorize-05422727.js";import{d as a,c3 as t,u as l,r as n,ad as o,M as s,bk as r,w as i,e as d,o as u,g as p,j as c,l as m,a4 as f,V as v,aN as g,k as y,aH as b,n as h,ah as w}from"./index-920db443.js";import{B as N}from"./BasicLeftTree-cd55d444.js";import{u as k,B as C}from"./useTable-dc8c9d84.js";const T={class:"common-container"},j={class:"jnpf-content-wrapper"},S={class:"jnpf-content-wrapper-left"},I={class:"jnpf-content-wrapper-center"},F={class:"jnpf-content-wrapper-content"},D=a({inheritAttrs:!1,__name:"FieldModal",props:{value:{default:""},title:{type:String,default:""},popupTitle:{type:String,default:"字段名称"},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!0},size:{type:String,default:"default"},treeData:{type:Array,default:[]},menuType:{type:Number},dataType:{type:Number}},emits:["update:value","change"],setup(a,{emit:D}){const z=a,R=D,_=t.useInjectFormItemContext(),{t:x}=l(),B=n(void 0),A=n(!1),K=o({linkId:"",tableName:"",menuType:0,dataType:0}),{createMessage:L}=w(),P=n(null),M=n(!1),O=n([]),[H,{getForm:U,getSelectRows:E,getSelectRowKeys:V}]=k({api:e,columns:[{title:"名称",dataIndex:"field"},{title:"说明",dataIndex:"fieldName"}],immediate:!1,useSearchForm:!0,formConfig:{baseColProps:{span:8},schemas:[{field:"keyword",label:x("common.keyword"),component:"Input",componentProps:{placeholder:x("common.enterKeyword"),submitOnPressEnter:!0}}]},tableSetting:{size:!1,setting:!1},isCanResizeParent:!0,resizeHeightOffset:-74,rowSelection:{type:"radio"},rowKey:"field"}),q=s((()=>({...r(z,["disabled","size","allowClear"]),placeholder:"请输入",showArrow:!0})));function G(){R("change",B.value)}async function J(){if(!z.disabled){if(!z.treeData.length)return L.warning("请先进行数据连接！");A.value=!0,O.value=z.treeData?z.treeData.map((e=>({fullName:e.tableName,id:e.tableName,dbLink:e.dbLink}))):[],K.tableName=O.value[0].fullName||"",K.linkId=O.value[0].dbLink||"",K.menuType=z.menuType||0,K.dataType=z.dataType||0,h((()=>{const e=y(P);e?.setSelectedKeys([K.tableName]),U().resetFields()}))}}function Q(e){e&&K.tableName!==e&&(K.tableName=e,U().resetFields())}function W(){A.value=!1}function X(){if(!V().length&&!E().length)return;if(!E().length)return R("update:value",B.value),R("change",B.value,K.tableName),_.onFieldChange(),void W();const e=E()[0];B.value=e.field,R("update:value",e.field),R("change",e.field,K.tableName,e.fieldName),_.onFieldChange(),W()}return i((()=>z.value),(e=>{var a;a=e,B.value=a||void 0}),{immediate:!0}),(e,t)=>{const l=d("a-input");return u(),p("div",T,[c(l,v({value:B.value,"onUpdate:value":t[0]||(t[0]=e=>B.value=e)},q.value,{onChange:G}),{addonAfter:m((()=>[f("span",{onClick:J,class:"cursor-pointer"},"选择")])),_:1},16,["value"]),c(y(b),{open:A.value,"onUpdate:open":t[1]||(t[1]=e=>A.value=e),title:a.popupTitle,width:1e3,class:"common-container-modal",onOk:X,onCancel:W,maskClosable:!1,"destroy-on-close":""},{closeIcon:m((()=>[c(g,{canFullscreen:!1,onCancel:W})])),default:m((()=>[f("div",j,[f("div",S,[c(y(N),{ref_key:"leftTreeRef",ref:P,showSearch:!1,treeData:O.value,loading:M.value,onSelect:Q},null,8,["treeData","loading"])]),f("div",I,[f("div",F,[c(y(C),{onRegister:y(H),searchInfo:K,class:"jnpf-sub-table"},null,8,["onRegister","searchInfo"])])])])])),_:1},8,["open","title"])])}}});export{D as _};
