import{b as e,B as o}from"./index-143f5813.js";import{u as a,B as r}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{d as t,ad as s,M as l,u as n,o as p,p as d,l as i,j as m,k as c,V as u,ah as g}from"./index-920db443.js";import{g as f,u as b,c as h}from"./accountConfig-5422c027.js";import{f as y}from"./formValidate-c8ab8d29.js";const T=t({__name:"Form",emits:["register","reload"],setup(t,{emit:T}){const v=s({dataForm:{}}),w=[{field:"fullName",label:"名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"enCode",label:"编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:y("enCode"),trigger:"blur"}]},{field:"webhookType",label:"类型",component:"Select",componentProps:{placeholder:"请选择",onChange:function(e){2==e&&q({approveType:"1",bearer:""});C({field:"approveType",componentProps:{disabled:2==e}})}},rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"webhookAddress",label:"WebHook地址",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"approveType",label:"认证类型",component:"Select",componentProps:{placeholder:"请选择",options:[{fullName:"无需认证",id:"1"},{fullName:"bearer令牌",id:"2"}]},rules:[{required:!0,trigger:"change",message:"必填",type:"string"}]},{ifShow:({values:e})=>"2"==e.approveType,field:"bearer",label:"Bearer令牌",component:"Input",helpMessage:"密钥",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"sortCode",label:"排序",component:"InputNumber",defaultValue:0,componentProps:{min:"0",max:"999999",placeholder:"请输入"}},{field:"enabledMark",label:"状态",component:"Switch",defaultValue:1},{field:"description",label:"说明",component:"Textarea",componentProps:{rows:3,placeholder:"请输入"}}],F=l((()=>v.dataForm.id?x("common.editText"):x("common.addText"))),P=T,{createMessage:k}=g(),{t:x}=n(),[j,{setFieldsValue:q,validate:M,resetFields:N,updateSchema:C}]=a({labelWidth:120,schemas:w}),[I,{closeModal:S,changeLoading:V,changeOkLoading:B}]=e((function(e){N(),v.dataForm.id=e.id,C({field:"approveType",componentProps:{disabled:!1}}),e.categoryList&&C({field:"webhookType",componentProps:{options:e.categoryList}});v.dataForm.id&&(V(!0),f(v.dataForm.id).then((e=>{const o=e.data;v.dataForm=o,q(o),C({field:"approveType",componentProps:{disabled:"2"==o.webhookType}}),V(!1)})))}));async function L(){const e=await M();if(!e)return;B(!0);let o={...e,id:v.dataForm.id,type:6};"1"==o.approveType?(o.bearer="",o.userName="",o.password=""):"2"==o.approveType?(o.userName="",o.password=""):o.bearer="";(v.dataForm.id?b:h)(o).then((e=>{k.success(e.msg),B(!1),S(),P("reload")})).catch((()=>{B(!1)}))}return(e,a)=>(p(),d(c(o),u(e.$attrs,{onRegister:c(I),title:F.value,showOkBtn:"",onOk:L}),{default:i((()=>[m(c(r),{onRegister:c(j)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{T as _};
