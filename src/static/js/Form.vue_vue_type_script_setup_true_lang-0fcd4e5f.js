import{b as e,B as a}from"./index-143f5813.js";import{u as l,B as t}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{f as o}from"./formValidate-c8ab8d29.js";import{d as r,u as s,r as n,M as i,k as d,gR as u,gS as m,o as p,p as c,l as f,j as g,fI as v,V as b,gT as h,gU as x,ah as I}from"./index-920db443.js";const N=r({__name:"Form",emits:["register","reload"],setup(r,{emit:N}){const j=N,{createMessage:w}=I(),{t:L}=s(),M=n(""),R=n([]),D=n({label:"",value:""}),P=i((()=>d(M)?L("common.editText"):L("common.addText"))),S=[{field:"parentId",label:"区域上级",component:"TreeSelect",slot:"parentId",rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"fullName",label:"区域名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:o("fullName","不能含有特殊符号"),trigger:"blur"}]},{field:"enCode",label:"区域编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:o("number"),trigger:"blur"}]},{field:"sortCode",label:"排序",component:"InputNumber",componentProps:{min:"0",max:"999999",placeholder:"请输入"}},{field:"enabledMark",label:"状态",component:"Switch",defaultValue:1},{field:"description",label:"说明",component:"Textarea",componentProps:{rows:3,placeholder:"请输入"}}],[T,{setFieldsValue:V,resetFields:_,validate:k}]=l({labelWidth:80,schemas:S}),[F,{changeLoading:q,closeModal:C,changeOkLoading:y}]=e((function(e){_(),M.value=e.id||0,D.value={label:void 0,value:void 0},q(!0),u("-1",M.value).then((e=>{const a=e.data.list.map((e=>({isLeaf:!1,...e})));R.value=[{fullName:"顶级节点",id:"-1",isLeaf:!0},...a],q(!1),M.value&&(q(!0),m(M.value).then((e=>{D.value={label:e.data.parentName||"顶级节点",value:e.data.parentId},V(e.data),q(!1)})))}))}));function B(e){return new Promise((a=>{const{id:l}=e.dataRef;u(l).then((e=>{const t=e.data.list.map((e=>({...e,pId:l,isLeaf:e.isLeaf})));R.value=[...R.value,...t],a(!0)}))}))}function O(){V({parentId:D.value.value})}async function U(){const e=await k();if(!e)return;y(!0);(M.value?h:x)(e).then((e=>{w.success(e.msg),y(!1),C(),j("reload")})).catch((()=>{y(!1)}))}return(e,l)=>(p(),c(d(a),b(e.$attrs,{onRegister:d(F),title:P.value,onOk:U,"destroy-on-close":""}),{default:f((()=>[g(d(t),{onRegister:d(T)},{parentId:f((()=>[g(d(v),{value:D.value,"onUpdate:value":l[0]||(l[0]=e=>D.value=e),showSearch:"",placeholder:"请选择",treeDefaultExpandAll:!1,treeDataSimpleMode:!0,labelInValue:!0,treeData:R.value,fieldNames:{label:"fullName",value:"id"},loadData:B,onChange:O},null,8,["value","treeData"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{N as _};
