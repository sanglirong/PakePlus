import{_ as e,a}from"./import-e198d900.js";import{b as s,B as t}from"./index-143f5813.js";import{d as i,ad as n,a0 as l,u as o,aw as r,M as c,dD as d,e as p,o as m,p as u,l as f,j as g,k as _,m as x,t as h,a4 as L,e6 as b,ae as v,V as N,h1 as y,h2 as k,ea as w,ah as C}from"./index-920db443.js";const j={class:"import-main"},I={class:"upload"},O={class:"up_right !pt-16px"},R={class:"upload"},T={class:"up_right"},B=i({__name:"ImportModal",emits:["register","reload"],setup(i,{emit:B}){const M=n({fileName:"",fileList:[],btnLoading:!1}),{fileName:U,fileList:z,btnLoading:E}=l(M),G=B,[K,{closeModal:S}]=s((function(){M.fileName="",M.fileList=[],M.btnLoading=!1})),{createMessage:$,createConfirm:A}=C(),{t:D}=o(),F=r(),P=c((()=>F.apiUrl+"/api/system/BaseLang/Uploader")),V=c((()=>({Authorization:d()})));function q(){if(!M.fileList.length||!M.fileName)return $.warning("请先上传文件");M.btnLoading=!0,y({fileName:M.fileName}).then((e=>{M.btnLoading=!1,$.success(e.msg),G("reload"),S()})).catch((()=>{M.btnLoading=!1}))}function H({file:e}){"error"!==e.status?"done"===e.status&&(200===e.response.code?M.fileName=e.response.data.name:$.error(e.response.msg)):$.error("上传失败")}function J(e){const a=e.name.replace(/.+\./,"");if(!(-1!==["xls","xlsx"].indexOf(a.toLowerCase())))return $.error("文件格式不正确"),b.LIST_IGNORE;return!!(e.size/1024<500)||($.error("文件大小超过500KB"),b.LIST_IGNORE)}function Q(e){return new Promise(((a,s)=>{A({iconType:"warning",title:D("common.tipTitle"),content:`确定移除${e.name}?`,onOk:()=>{M.fileName="",a()},onCancel:()=>{s()}})}))}return(s,i)=>{const n=p("a-button");return m(),u(_(t),N(s.$attrs,{onRegister:_(K),title:"批量导入",width:1e3,"show-cancel-btn":!1,"show-ok-btn":!1,destroyOnClose:"",class:"jnpf-import-modal"}),{insertFooter:f((()=>[g(n,{onClick:i[2]||(i[2]=e=>_(S)())},{default:f((()=>[x(h(_(D)("common.cancelText")),1)])),_:1}),g(n,{type:"primary",onClick:q,loading:_(E),disabled:!_(U)},{default:f((()=>i[12]||(i[12]=[x("上传")]))),_:1,__:[12]},8,["loading","disabled"])])),default:f((()=>[L("div",j,[L("div",I,[i[7]||(i[7]=L("div",{class:"up_left"},[L("img",{src:e})],-1)),L("div",O,[i[4]||(i[4]=L("p",{class:"title"},"上传填好的翻译文档",-1)),i[5]||(i[5]=L("p",{class:"tip !my-10px"},"文件后缀名必须是xls或xlsx，文件大小不超过500KB，最多支持导入1000条数据",-1)),i[6]||(i[6]=L("p",{class:"tip !my-10px"},"若文档中的翻译标记已存在库中则直接更新",-1)),g(_(b),{"file-list":_(z),"onUpdate:fileList":i[0]||(i[0]=e=>v(z)?z.value=e:null),class:"upload-area",accept:".xls,.xlsx","max-count":1,action:P.value,headers:V.value,"before-upload":J,onRemove:Q,onChange:H},{default:f((()=>[g(n,{type:"link"},{default:f((()=>i[3]||(i[3]=[x("上传文件")]))),_:1,__:[3]})])),_:1},8,["file-list","action","headers"])])]),L("div",R,[i[11]||(i[11]=L("div",{class:"up_left"},[L("img",{src:a})],-1)),L("div",T,[i[9]||(i[9]=L("p",{class:"title"},"填写翻译文档",-1)),i[10]||(i[10]=L("p",{class:"tip"},"请按照数据模板的格式准备导入数据，模板中的表头名称不可更改，表头行不能删除",-1)),g(n,{type:"link",onClick:i[1]||(i[1]=e=>{k().then((e=>{w({url:e.data?.url})}))})},{default:f((()=>i[8]||(i[8]=[x("下载模板")]))),_:1,__:[8]})])])])])),_:1},16,["onRegister"])}}});export{B as _};
