import{A as e,B as a}from"./visualDev-8f54ab4b.js";import{b as t,B as l}from"./index-143f5813.js";import{d as r,u as o,r as s,ad as d,a0 as n,M as p,fn as c,e as i,o as u,p as m,l as f,j as v,k as y,a4 as M,af as g,be as h,ae as I,q as P,t as k,V as R,ah as F}from"./index-920db443.js";const _={class:"release-item"},b={class:"icon-checked"},C={class:"released"},D={class:"release-item"},S={class:"icon-checked"},w={class:"released"},T=r({__name:"CreateMenuModal",emits:["register","reload"],setup(r,{emit:T}){const j=T,{createMessage:O,createConfirm:N}=F(),{t:q}=o(),[x,{changeOkLoading:J,closeModal:W}]=t((function(a){B.pcModuleParentId=[],B.appModuleParentId=[],e(a.id).then((e=>{B.record=e.data;const a=e.data.platformRelease?JSON.parse(e.data.platformRelease):{};B.dataForm={pc:0===a.pc?0:1,app:0===a.app?0:1,pcModuleParentId:[],appModuleParentId:[]},A.value?.clearValidate()})),t=a.id,c({category:"Web"},t).then((e=>{B.treeData=e.data.list})),function(e){c({category:"App"},e).then((e=>{let a=e.data.list||[];for(let t=0;t<a.length;t++){const e=a[t];0==e.type&&(e.disabled=!0)}B.appTreeData=a}))}(a.id);var t})),A=s(),B=d({dataForm:{pc:1,app:1,pcModuleParentId:[],appModuleParentId:[]},record:{},treeData:[],appTreeData:[],pcModuleParentId:[],appModuleParentId:[]}),{dataForm:U,record:V,treeData:E,appTreeData:L,pcModuleParentId:$,appModuleParentId:z}=n(B),G=p((()=>{let e={pcModuleParentId:[],appModuleParentId:[]};return B.record.pcIsRelease||(e.pcModuleParentId=[{required:!0,message:"必填",trigger:"change",type:"array"}]),B.record.appIsRelease||(e.appModuleParentId=[{required:!0,message:"必填",trigger:"change",type:"array"}]),e}));function H(e){B.dataForm.pcModuleParentId=e.map((e=>e.value))}function K(e){B.dataForm.appModuleParentId=e.map((e=>e.value))}function Q(e){B.dataForm[e]=1===B.dataForm[e]?0:1}async function X(){try{if(!B.dataForm.pc&&!B.dataForm.app)return O.error("请至少选择一种发布类型");if(!(await(A.value?.validate())))return;const e={pc:B.dataForm.pc,app:B.dataForm.app},t={...B.dataForm,platformRelease:JSON.stringify(e)},l=()=>{J(!0),a(B.record.id,t).then((e=>{J(!1),O.success(e.msg),j("reload"),W()})).catch((()=>{J(!1)}))};if(!B.record.isRelease)return l();N({iconType:"warning",title:q("common.tipTitle"),content:"发布确定后会覆盖当前线上版本且进行菜单同步，是否继续?",onOk:l})}catch(e){}}return(e,a)=>{const t=i("a-alert"),r=i("a-form-item"),o=i("JnpfTreeSelect"),s=i("a-form");return u(),m(y(l),R(e.$attrs,{onRegister:y(x),title:"生成菜单",onOk:X,class:"jnpf-release-modal"}),{default:f((()=>[v(t,{message:"将该功能的按钮、列表、表单及数据权限发布至应用菜单",type:"warning","show-icon":""}),v(s,{class:"release-main",colon:!1,model:y(U),rules:G.value,layout:"vertical",ref_key:"formElRef",ref:A},{default:f((()=>[M("div",_,[v(r,null,{default:f((()=>[M("div",{class:g(["top-item",{active:1===y(U).pc}]),onClick:a[0]||(a[0]=e=>Q("pc"))},[a[4]||(a[4]=M("i",{class:"item-icon icon-ym icon-ym-pc"},null,-1)),a[5]||(a[5]=M("p",{class:"item-title"},"桌面端",-1)),M("div",b,[v(y(h))])],2)])),_:1}),y(U).pc?(u(),m(r,{key:0,label:"上级",name:"pcModuleParentId"},{default:f((()=>[v(o,{value:y($),"onUpdate:value":a[1]||(a[1]=e=>I($)?$.value=e:null),options:y(E),treeCheckStrictly:"",multiple:"",dropdownMatchSelectWidth:!1,onChange:H},null,8,["value","options"])])),_:1})):P("",!0),y(V).pcIsRelease?(u(),m(r,{key:1,label:"已发布菜单路径"},{default:f((()=>[M("div",C,k(y(V).pcReleaseName),1)])),_:1})):P("",!0)]),M("div",D,[v(r,null,{default:f((()=>[M("div",{class:g(["top-item",{active:1===y(U).app}]),onClick:a[2]||(a[2]=e=>Q("app"))},[a[6]||(a[6]=M("i",{class:"item-icon icon-ym icon-ym-mobile"},null,-1)),a[7]||(a[7]=M("p",{class:"item-title"},"移动端",-1)),M("div",S,[v(y(h))])],2)])),_:1}),y(U).app?(u(),m(r,{key:0,label:"上级",name:"appModuleParentId"},{default:f((()=>[v(o,{value:y(z),"onUpdate:value":a[3]||(a[3]=e=>I(z)?z.value=e:null),options:y(L),treeCheckStrictly:"",multiple:"",dropdownMatchSelectWidth:!1,onChange:K},null,8,["value","options"])])),_:1})):P("",!0),y(V).appIsRelease?(u(),m(r,{key:1,label:"已发布菜单路径"},{default:f((()=>[M("div",w,k(y(V).appReleaseName),1)])),_:1})):P("",!0)])])),_:1},8,["model","rules"])])),_:1},16,["onRegister"])}}});export{T as _};
