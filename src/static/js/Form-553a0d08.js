import{a as e,B as a}from"./index-9c138ba5.js";import{d as t,ad as o,a0 as l,M as d,u as s,r as u,w as n,k as r,e as i,o as p,p as c,l as m,j as v,a4 as f,t as _,ae as y,g as h,F as g,q as b,V as F,fi as N,ah as j,a5 as x}from"./index-920db443.js";import{u as C,B as w}from"./useTable-dc8c9d84.js";import{g as k,a as L,b as U,_ as T,u as I,c as E}from"./productModal.vue_vue_type_script_setup_true_lang-e7cc7642.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./log-2a5f2c26.js";import"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import"./visualDev-8f54ab4b.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./index-143f5813.js";import"./useWindowSizeFn-05f906e2.js";import"./index-999abbee.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./config-06ca91cd.js";import"./upperFirst-2cd1a2f7.js";import"./useTabs-ceeccdba.js";import"./uniqBy-e868edd7.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";import"./BasicLeftTree-cd55d444.js";const P=["onClick"],O={class:"name"},S=["onClick"],D={class:"order-footer"},W={class:"order-footer-item"},q=x(t({__name:"Form",emits:["register","reload"],setup(t,{emit:x}){const q=o({dataForm:{id:"",address:"",auditDate:"",auditName:"",business:"",code:"",contactTel:"",customerId:"",customerName:"",description:"",discountPrice:"",gatheringType:"",goodsDate:"",goodsName:"",goodsWarehouse:"",harvestMsg:0,harvestWarehouse:"",issuingName:"",partPrice:"",reducedPrice:"",productEntryList:[]},options:[{fullName:"现金",id:"现金"},{fullName:"转帐",id:"转帐"},{fullName:"汇票",id:"汇票"}],storeOptions:[{fullName:"仓库1",id:"仓库1"},{fullName:"仓库2",id:"仓库2"},{fullName:"仓库3",id:"仓库3"}],customOptions:[],productOptions:[],orderTypeOptions:[{fullName:"1",id:"1"},{fullName:"2",id:"2"},{fullName:"3",id:"3"}],orderType:"",total:0}),{dataForm:M,options:B,storeOptions:R,customOptions:z,orderType:A,orderTypeOptions:H,total:G,productOptions:J}=l(q),K=d((()=>q.dataForm.id?$("common.editText"):$("common.addText"))),Q=x,{createMessage:V}=j(),{t:$}=s(),X=u(),[Y]=C({columns:[{title:"操作",dataIndex:"action",width:80},{title:"商品编码",dataIndex:"productCode",width:200},{title:"商品名称",dataIndex:"productName",width:100},{title:"规格型号",dataIndex:"productSpecification",width:100},{title:"订货类型",dataIndex:"type",width:100},{title:"数量",dataIndex:"qty",width:120},{title:"单价",dataIndex:"money",width:120},{title:"金额",dataIndex:"amount",width:120},{title:"备注",dataIndex:"description",width:120}],useSearchForm:!1,resizeHeightOffset:40,showTableSetting:!1,pagination:!1}),[Z,{closePopup:ee,changeLoading:ae,changeOkLoading:te}]=e((function(e){void(q.dataForm={id:"",address:"",auditDate:"",auditName:"",business:"",code:"",contactTel:"",customerId:"",customerName:"",description:"",discountPrice:"",gatheringType:"",goodsDate:"",goodsName:"",goodsWarehouse:"",harvestMsg:0,harvestWarehouse:"",issuingName:"",partPrice:"",reducedPrice:"",productEntryList:[]}),q.dataForm.id=e.id||"",q.dataForm.productEntryList=[],q.dataForm.id?(ae(!0),X.value?.resetFields(),k(q.dataForm.id).then((e=>{q.dataForm=e.data,le(q.dataForm.customerName),ae(!1)}))):(le(""),oe())}));function oe(e){q.dataForm.productEntryList.splice(e+1,0,{productId:"",productCode:"",productName:"",productSpecification:"",qty:1,money:0,amount:0,description:"",type:""}),de("")}function le(e){L({keyword:e}).then((e=>{q.customOptions=e.data.list||[]}))}function de(e){U({keyword:e}).then((e=>{q.productOptions=e.data.list||[]}))}async function se(){const e=q.dataForm.id?I:E;q.dataForm.id||delete q.dataForm.id,te(!0),e(q.dataForm).then((e=>{V.success(e.msg),ee(),Q("reload"),te(!1)})).catch((()=>{te(!1)}))}function ue(e){for(let a=0;a<e.length;a++){const t=e[a];let o={productId:t.id,productCode:t.code,productName:t.fullName,productSpecification:t.productSpecification,qty:1,money:t.money,amount:t.money,description:"",type:t.type};q.dataForm.productEntryList.push(o)}}return n((()=>r(q.dataForm.productEntryList)),(e=>{let a=0;for(let t=0;t<e.length;t++)a+=parseFloat(e[t].amount);q.total=a}),{deep:!0}),(e,t)=>{const o=i("a-input"),l=i("a-form-item"),d=i("a-col"),s=i("a-auto-complete"),u=i("a-row"),n=i("jnpf-select"),j=i("a-textarea"),x=i("a-form"),C=i("a-button"),k=i("a-input-number");return p(),c(r(a),F(e.$attrs,{onRegister:r(Z),title:K.value,showOkBtn:"",onOk:se}),{default:m((()=>[v(x,{colon:!1,labelCol:{style:{width:"90px"}},class:"!mr-10px"},{default:m((()=>[v(u,null,{default:m((()=>[v(d,{span:18},{default:m((()=>[v(u,null,{default:m((()=>[v(d,{span:8},{default:m((()=>[v(l,{label:"订单编码",name:"code"},{default:m((()=>[v(o,{value:r(M).code,"onUpdate:value":t[0]||(t[0]=e=>r(M).code=e),placeholder:"提交后系统自动生成",readonly:""},null,8,["value"])])),_:1})])),_:1}),v(d,{span:16},{default:m((()=>[v(l,{label:"客户名称",name:"customerName"},{default:m((()=>[v(s,{value:r(M).customerName,"onUpdate:value":t[1]||(t[1]=e=>r(M).customerName=e),placeholder:"请输入客户名称",options:r(z),onSearch:le},{option:m((e=>[f("div",{class:"sale-order-popper-item",onClick:a=>function(e){q.dataForm.customerName=e.name,q.dataForm.customerId=e.id,q.dataForm.contactTel=e.contactTel,q.dataForm.address=e.address}(e)},[f("span",null,_(e.code),1),f("span",O,_(e.name),1),f("span",null,_(e.address),1),f("span",null,_(e.customerName),1),f("span",null,_(e.contactTel),1)],8,P)])),_:1},8,["value","options"])])),_:1})])),_:1})])),_:1}),v(u,null,{default:m((()=>[v(d,{span:8},{default:m((()=>[v(l,{label:"联系方式",name:"contactTel"},{default:m((()=>[v(o,{value:r(M).contactTel,"onUpdate:value":t[2]||(t[2]=e=>r(M).contactTel=e),placeholder:"联系方式"},null,8,["value"])])),_:1})])),_:1}),v(d,{span:16},{default:m((()=>[v(l,{label:"送货地址",name:"address"},{default:m((()=>[v(o,{value:r(M).address,"onUpdate:value":t[3]||(t[3]=e=>r(M).address=e),placeholder:"送货地址"},null,8,["value"])])),_:1})])),_:1})])),_:1}),v(u,null,{default:m((()=>[v(d,{span:8},{default:m((()=>[v(l,{label:"发货仓库",name:"goodsWarehouse"},{default:m((()=>[v(n,{value:r(M).goodsWarehouse,"onUpdate:value":t[4]||(t[4]=e=>r(M).goodsWarehouse=e),placeholder:"发货仓库",options:r(R)},null,8,["value","options"])])),_:1})])),_:1}),v(d,{span:8},{default:m((()=>[v(l,{label:"业务员",name:"business"},{default:m((()=>[v(o,{value:r(M).business,"onUpdate:value":t[5]||(t[5]=e=>r(M).business=e),placeholder:"业务员"},null,8,["value"])])),_:1})])),_:1}),v(d,{span:8},{default:m((()=>[v(l,{label:"收款方式",name:"gatheringType"},{default:m((()=>[v(n,{value:r(M).gatheringType,"onUpdate:value":t[6]||(t[6]=e=>r(M).gatheringType=e),placeholder:"选择收款方式",options:r(B)},null,8,["value","options"])])),_:1})])),_:1})])),_:1}),v(u,null,{default:m((()=>[v(d,{span:8},{default:m((()=>[v(l,{label:"让利金额",name:"partPrice"},{default:m((()=>[v(o,{value:r(M).partPrice,"onUpdate:value":t[7]||(t[7]=e=>r(M).partPrice=e),placeholder:"让利金额"},null,8,["value"])])),_:1})])),_:1}),v(d,{span:8},{default:m((()=>[v(l,{label:"优惠金额",name:"reducedPrice"},{default:m((()=>[v(o,{value:r(M).reducedPrice,"onUpdate:value":t[8]||(t[8]=e=>r(M).reducedPrice=e),placeholder:"优惠金额"},null,8,["value"])])),_:1})])),_:1}),v(d,{span:8},{default:m((()=>[v(l,{label:"折后金额",name:"discountPrice"},{default:m((()=>[v(o,{value:r(M).discountPrice,"onUpdate:value":t[9]||(t[9]=e=>r(M).discountPrice=e),placeholder:"折后金额"},null,8,["value"])])),_:1})])),_:1})])),_:1}),v(d,{span:24},{default:m((()=>[v(l,{label:"备注"},{default:m((()=>[v(j,{type:"textarea",value:r(M).description,"onUpdate:value":t[10]||(t[10]=e=>r(M).description=e),placeholder:"备注",rows:3},null,8,["value"])])),_:1})])),_:1})])),_:1}),v(d,{span:6},{default:m((()=>[v(l,{label:"审核人",labelCol:{style:{width:"120px"}},name:"auditName"},{default:m((()=>[v(o,{value:r(M).auditName,"onUpdate:value":t[11]||(t[11]=e=>r(M).auditName=e),disabled:""},null,8,["value"])])),_:1}),v(l,{label:"审核时间",labelCol:{style:{width:"120px"}},name:"auditDate"},{default:m((()=>[v(o,{value:r(M).auditDate,"onUpdate:value":t[12]||(t[12]=e=>r(M).auditDate=e),disabled:""},null,8,["value"])])),_:1}),v(l,{label:"发货通知人",labelCol:{style:{width:"120px"}},name:"goodsName"},{default:m((()=>[v(o,{value:r(M).goodsName,"onUpdate:value":t[13]||(t[13]=e=>r(M).goodsName=e),disabled:""},null,8,["value"])])),_:1}),v(l,{label:"发货通知时间",labelCol:{style:{width:"120px"}},name:"goodsDate"},{default:m((()=>[v(o,{value:r(M).goodsDate,"onUpdate:value":t[14]||(t[14]=e=>r(M).goodsDate=e),disabled:""},null,8,["value"])])),_:1}),v(l,{label:"收货仓库",labelCol:{style:{width:"120px"}},name:"harvestWarehouse"},{default:m((()=>[v(o,{value:r(M).harvestWarehouse,"onUpdate:value":t[15]||(t[15]=e=>r(M).harvestWarehouse=e),disabled:""},null,8,["value"])])),_:1}),v(l,{label:"代发客户",labelCol:{style:{width:"120px"}},name:"issuingName"},{default:m((()=>[v(o,{value:r(M).issuingName,"onUpdate:value":t[16]||(t[16]=e=>r(M).issuingName=e),disabled:""},null,8,["value"])])),_:1})])),_:1})])),_:1}),v(u,{class:"add-btn"},{default:m((()=>[v(d,{span:18},{default:m((()=>[v(T,{onChange:ue})])),_:1}),v(d,{span:6},{default:m((()=>[v(x,{labelCol:{style:{width:"120px"}}},{default:m((()=>[v(l,{label:"订货类型"},{default:m((()=>[v(n,{value:r(A),"onUpdate:value":t[17]||(t[17]=e=>y(A)?A.value=e:null),placeholder:"选择订货类型",options:r(H)},null,8,["value","options"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),v(r(w),{"data-source":r(M).productEntryList,onRegister:r(Y)},{bodyCell:m((({column:e,record:a,index:t})=>["action"===e.key?(p(),h(g,{key:0},[v(C,{type:"link",preIcon:"ym-custom ym-custom-plus",onClick:e=>oe(t)},null,8,["onClick"]),v(C,{type:"link",danger:"",preIcon:"ym-custom ym-custom-minus",onClick:e=>function(e){q.dataForm.productEntryList.splice(e,1)}(a)},null,8,["onClick"])],64)):b("",!0),"productCode"===e.key?(p(),c(s,{key:1,value:a.productCode,"onUpdate:value":e=>a.productCode=e,placeholder:"商品编码",options:r(J),onSearch:de},{option:m((e=>[f("div",{class:"sale-order-popper-item",onClick:a=>function(e,a){q.dataForm.productEntryList[a].productId=e.id,q.dataForm.productEntryList[a].productCode=e.code,q.dataForm.productEntryList[a].productName=e.fullName,q.dataForm.productEntryList[a].productSpecification=e.productSpecification,q.dataForm.productEntryList[a].money=e.money,q.dataForm.productEntryList[a].type=e.type,q.dataForm.productEntryList[a].amount=N(parseFloat(q.dataForm.productEntryList[a].money)*parseFloat(q.dataForm.productEntryList[a].qty))}(e,t)},[f("span",null,_(e.code),1),f("span",null,_(e.fullName),1),f("span",null,_(e.productSpecification),1)],8,S)])),_:2},1032,["value","onUpdate:value","options"])):b("",!0),"qty"===e.key?(p(),c(k,{key:2,value:a.qty,"onUpdate:value":e=>a.qty=e,placeholder:"请输入"},null,8,["value","onUpdate:value"])):b("",!0),"money"===e.key?(p(),c(k,{key:3,value:a.money,"onUpdate:value":e=>a.money=e,placeholder:"请输入"},null,8,["value","onUpdate:value"])):b("",!0)])),_:1},8,["data-source","onRegister"]),f("div",D,[t[18]||(t[18]=f("span",{class:"order-footer-item"},"订单总数：0",-1)),t[19]||(t[19]=f("span",{class:"order-footer-item"},"下单总数：0",-1)),f("span",W,"总金额(元)："+_(r(G)),1)])])),_:1},16,["onRegister","title"])}}}),[["__scopeId","data-v-615fce99"]]);export{q as default};
