import{b as e,B as r}from"./index-143f5813.js";import{u as a,B as t}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{d as o,ad as s,M as l,u as i,o as n,p as m,l as d,j as c,k as p,V as u,ah as g}from"./index-920db443.js";import{g as h,u as f,c as b}from"./projectGantt-30c2203e.js";const P=o({__name:"Form",emits:["register","reload"],setup(o,{emit:P}){const F=s({dataForm:{}}),j=[{field:"fullName",label:"项目名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"enCode",label:"项目编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{pattern:/^\w+$/,message:"请输入正确的项目编码",trigger:"blur"}]},{field:"managerIds",label:"参与人员",component:"UserSelect",componentProps:{placeholder:"请输入",multiple:!0},rules:[{required:!0,trigger:"blur",message:"必填",type:"array"}]},{field:"startTime",label:"开始日期",component:"DatePicker",componentProps:{placeholder:"选择日期"},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:async(e,r)=>k().endTime?k().endTime<r?Promise.reject("开始时间应该小于结束时间"):(L(["endTime"]),Promise.resolve()):Promise.resolve(),trigger:"change"}]},{field:"endTime",label:"结束日期",component:"DatePicker",componentProps:{placeholder:"请选择"},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:(e,r)=>k().startTime&&r&&k().startTime>r?Promise.reject("结束日期应该大于开始日期"):Promise.resolve(),trigger:"change"}]},{field:"timeLimit",label:"项目工期",component:"InputNumber",defaultValue:0,componentProps:{placeholder:"请输入",step:1,min:0,"addon-after":"天"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"schedule",label:"完成进度",component:"InputNumber",defaultValue:0,componentProps:{placeholder:"请输入",step:1,min:0,max:100,"addon-after":"%"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"state",label:"状态",component:"Select",defaultValue:1,componentProps:{placeholder:"请选择",options:[{fullName:"进行中",id:1},{fullName:"已暂停",id:2}]}},{field:"description",label:"项目描述",component:"Textarea",componentProps:{placeholder:"请输入",rows:3}}],x=l((()=>F.dataForm.id?q("common.editText"):q("common.addText"))),I=P,{createMessage:T}=g(),{t:q}=i(),[v,{setFieldsValue:N,getFieldsValue:k,validate:L,resetFields:V}]=a({labelWidth:80,schemas:j}),[w,{closeModal:y,changeLoading:M,changeOkLoading:R}]=e((function(e){V(),F.dataForm.id=e.id,F.dataForm.id&&(M(!0),h(F.dataForm.id).then((e=>{let r=e.data;r.schedule=r.schedule?Number(r.schedule):0,r.timeLimit=r.timeLimit?Number(r.timeLimit):0,r.managerIds=r.managerIds?r.managerIds.split(","):[],F.dataForm=r,N(r),M(!1)})))}));async function _(){const e=await L();if(!e)return;R(!0);const r={...e,managerIds:e.managerIds.join(","),id:F.dataForm.id};(F.dataForm.id?f:b)(r).then((e=>{T.success(e.msg),R(!1),y(),I("reload")})).catch((()=>{R(!1)}))}return(e,a)=>(n(),m(p(r),u(e.$attrs,{onRegister:p(w),title:x.value,showOkBtn:"",onOk:_}),{default:d((()=>[c(p(t),{onRegister:p(v)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{P as _};
