import{d as n,u as o,r as e,ad as a,a0 as r,dl as t,M as i,a7 as s,e as c,o as l,g as f,i as d,v as _,k as m,a4 as u,j as p,l as g,ae as h,ay as k,t as y,fb as w,p as v,q as b,m as C,n as L,az as P,ah as x,co as I,cp as j}from"./index-920db443.js";import{g as T,c as U,a as S}from"./shortLink-5c58d9bb.js";import{c as A}from"./createAsyncComponent-7e8f72ac.js";import{U as D}from"./UnlockOutlined-a2b443e1.js";const M={class:"jnpf-content-wrapper short-link-wrapper"},O={class:"short-link-lock-wrapper"},K={class:"short-link-lock-form"},R={key:0,class:"short-link-main"},B={class:"shortLink-tip"},E={class:"short-link-header"},G={class:"short-link-content short-link-form"},N={class:"short-link-footer"},q=n({__name:"index",props:["config","modelId","isPreview"],setup(n){const q=n,{createMessage:V}=x(),{t:H}=o(),J=e(null),z=a({formLink:"",formConf:{},config:{},loading:!1,btnLoading:!1,key:+new Date,shortLinkId:"",formPassUse:-1,password:""}),{formConf:F,key:Q,loading:W,config:X,btnLoading:Y,formPassUse:Z,password:$}=r(z),nn=A((()=>t((()=>import("./Parser-2e1eddb1.js")),["static/js/Parser-2e1eddb1.js","static/js/Parser.vue_vue_type_script_lang-80b37b11.js","static/js/index-920db443.js","static/css/index-648461a4.css","static/js/config-06ca91cd.js","static/js/componentMap-c91676b4.js","static/js/visualDev-8f54ab4b.js","static/js/index.vue_vue_type_script_setup_true_lang-69353133.js","static/js/index-9c138ba5.js","static/js/ArrowLeftOutlined-3fbf15bc.js","static/js/log-2a5f2c26.js","static/css/index-01bda6b6.css","static/js/index-143f5813.js","static/js/useWindowSizeFn-05f906e2.js","static/css/index-e7d3e030.css","static/js/index-999abbee.js","static/css/index-cddfced7.css","static/js/Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js","static/js/Item.vue_vue_type_script_setup_true_lang-fef56f78.js","static/js/Form.vue_vue_type_script_setup_true_lang-63005a4d.js","static/js/createAsyncComponent-7e8f72ac.js","static/js/DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js","static/js/index-0be8277c.js","static/css/DataLogList-12ff8c0e.css","static/js/jquery-6353a699.js","static/js/useDefineSetting-7df030ff.js","static/js/CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js","static/css/index-c2afac83.css","static/js/upperFirst-2cd1a2f7.js","static/css/componentMap-489cc2b1.css"]))),on=["input","textarea","inputNumber","switch","datePicker","timePicker","colorPicker","rate","slider","editor","link","text","alert","table","collapse","collapseItem","tabItem","tab","row","card","groupTitle","divider","tableGrid","tableGridTr","tableGridTd","location","iframe","steps","stepItem"],en=["radio","checkbox","select","treeSelect","cascader"],an=i((()=>(z.formConf.confirmButtonTextI18nCode?H(z.formConf.confirmButtonTextI18nCode,z.formConf.confirmButtonText):z.formConf.confirmButtonText)||H("common.okText")));function rn(){z.config=q.config,z.formConf=z.config.formData?JSON.parse(z.config.formData):{},z.formConf.fields=tn(z.formConf.fields),function(n,o){const e=new Date,a=n=>{for(let o=0;o<n.length;o++){let r=n[o];r.__vModel__&&r.__config__.defaultCurrent&&("datePicker"===r.__config__.jnpfKey&&(r.__config__.defaultValue=I(e).startOf(j(r.format)).valueOf()),"timePicker"===r.__config__.jnpfKey&&(r.__config__.defaultValue=I(e).format(r.format||"HH:mm:ss"))),r.__config__&&r.__config__.children&&Array.isArray(r.__config__.children)&&a(r.__config__.children)}};a(n.fields),n.formData=o}(z.formConf,{}),L((()=>{z.loading=!1,z.key=+new Date}))}function tn(n){let o=n.filter((n=>function(n){if(!n.__config__||!n.__config__.jnpfKey)return!0;const o=n.__config__.jnpfKey;return!!(on.includes(o)||en.includes(o)&&"static"===n.__config__.dataType)}(n)));return o.forEach((n=>n.__config__?.children&&Array.isArray(n.__config__.children)&&(n.__config__.children=tn(n.__config__.children)))),o}function sn(n,o){if(!n)return;z.btnLoading=!0;const e={data:JSON.stringify(n)};U(q.modelId,e,z.config.encryption).then((n=>{V.success(n.msg),o&&"function"==typeof o&&o(),z.btnLoading=!1,cn()})).catch((()=>{z.btnLoading=!1}))}function cn(){fn().handleReset()}function ln(){if(q.isPreview)return V.warning("功能预览不支持数据保存");fn().handleSubmit()}function fn(){const n=m(J);if(!n)throw new Error("parser is null!");return n}function dn(){if(!z.password)return V.error(H("views.dynamicModel.passwordPlaceholder"));z.btnLoading=!0;const n={id:z.shortLinkId,type:0,encryption:q.config.encryption,password:P(z.password)};S(n).then((()=>{z.btnLoading=!1,z.formPassUse=0,rn()})).catch((()=>{z.btnLoading=!1}))}return s((()=>{z.loading=!0,T(q.modelId,q.config.encryption).then((n=>{z.formLink=n.data.formLink||"",z.shortLinkId=n.data.id||"",z.formPassUse=n.data.formPassUse||0,z.formPassUse||rn()}))})),(n,o)=>{const e=c("a-input-password"),a=c("a-button"),r=c("a-input-group"),t=c("a-popover");return l(),f("div",M,[d(u("div",O,[u("div",K,[p(r,{compact:"",class:"enter-y"},{default:g((()=>[p(e,{value:m($),"onUpdate:value":o[0]||(o[0]=n=>h($)?$.value=n:null),placeholder:m(H)("views.dynamicModel.passwordPlaceholder"),onKeyup:o[1]||(o[1]=k((n=>dn()),["enter"]))},null,8,["value","placeholder"]),p(a,{loading:m(Y),onClick:o[2]||(o[2]=n=>dn())},{icon:g((()=>[p(m(D))])),_:1},8,["loading"])])),_:1})])],512),[[_,m(Z)]]),m(Z)?b("",!0):(l(),f("div",R,[p(t,{placement:"bottomRight"},{content:g((()=>[u("p",B,y(m(H)("views.dynamicModel.scanAndShare")),1),p(m(w),{value:z.formLink,width:154,options:{margin:1},class:"my-5px"},null,8,["value"])])),default:g((()=>[o[3]||(o[3]=u("i",{class:"ym-custom ym-custom-qrcode icon-qrcode"},null,-1))])),_:1,__:[3]}),u("div",E,y(m(X).fullName),1),u("div",G,[m(W)?b("",!0):(l(),v(m(nn),{ref_key:"parserRef",ref:J,formConf:m(F),isShortLink:!0,onSubmit:sn,key:m(Q)},null,8,["formConf"]))]),u("div",N,[p(a,{type:"primary",onClick:ln,loading:m(Y)},{default:g((()=>[C(y(an.value),1)])),_:1},8,["loading"]),p(a,{type:"warning",class:"ml-10px",onClick:cn},{default:g((()=>[C(y(m(H)("common.resetText")),1)])),_:1})])]))])}}});export{q as _};
