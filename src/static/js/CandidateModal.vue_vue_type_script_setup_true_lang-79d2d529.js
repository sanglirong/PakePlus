import{b as a,B as e}from"./index-143f5813.js";import{U as t}from"./index-c37d2476.js";import{o as d}from"./task-ee77df5a.js";import{d as l,r as s,ad as n,a0 as o,e as i,o as r,p as u,l as c,k as m,j as p,q as f,g as h,F as y,h as v,V as C,aP as L,n as g}from"./index-920db443.js";const b=l({__name:"CandidateModal",emits:["register","confirm"],setup(l,{emit:b}){const F=b,k=s(),I=n({dataForm:{copyIds:[],branchList:[],candidateList:[]},defaultCandidateList:[],branchList:[],isCustomCopy:!1,formData:{},eventType:"",loading:!1,operatorId:""}),{dataForm:_,isCustomCopy:j,loading:U,operatorId:x,branchList:w}=o(I),[T,{changeOkLoading:q}]=a((function(a){q(!1),I.loading=!0,I.isCustomCopy=a.isCustomCopy,I.eventType=a.eventType,I.formData=a.formData,I.operatorId=a.operatorId,I.dataForm.copyIds=[],I.dataForm.candidateList=[],I.dataForm.branchList=[],I.branchList=a.branchList.map((a=>({...L(a,["nodeCode","nodeName"]),id:a.nodeCode,fullName:a.nodeName}))),I.defaultCandidateList=a.candidateList.map((a=>({...a,label:"审批人",value:[],rules:a.selected?[]:[{required:!0,message:"必填",trigger:"change",type:"array"}]}))),I.dataForm.candidateList=I.defaultCandidateList,g((()=>{I.loading=!1,k.value?.clearValidate()}))}));async function N(){try{if(!(await(k.value?.validate())))return;let a={};for(let e=0;e<I.dataForm.candidateList.length;e++)a[I.dataForm.candidateList[e].nodeCode]=I.dataForm.candidateList[e].value;q(!0),F("confirm",{candidateList:a,copyIds:I.dataForm.copyIds.join(","),branchList:I.dataForm.branchList,eventType:I.eventType})}catch(a){}}function R(){I.dataForm.copyIds=[],I.dataForm.candidateList=[]}function D(a){if(!a.length)return I.dataForm.candidateList=I.defaultCandidateList;let e=[];for(let t=0;t<a.length;t++)a:for(let d=0;d<I.branchList.length;d++){let l=I.branchList[d];if(a[t]===l.id&&l.isCandidates){e.push({nodeCode:l.id,nodeName:l.fullName,isCandidates:l.isCandidates,hasCandidates:l.hasCandidates,label:"审批人",value:[],rules:l.selected?[]:[{required:!0,message:"必填",trigger:"change",type:"array"}]});break a}}I.dataForm.candidateList=[...I.defaultCandidateList,...e]}return(a,l)=>{const s=i("jnpf-select"),n=i("a-form-item"),o=i("jnpf-user-select"),L=i("jnpf-textarea"),g=i("a-form");return r(),u(m(e),C(a.$attrs,{onRegister:m(T),title:"提交审核",onOk:N,minHeight:52,destroyOnClose:"",onCancel:R}),{default:c((()=>[m(U)?f("",!0):(r(),u(g,{key:0,colon:!1,labelCol:{style:{width:m(_).candidateList.length||m(w).length?"130px":"80px"}},model:m(_),ref_key:"formElRef",ref:k},{default:c((()=>[m(w).length?(r(),u(n,{key:0,label:"分支选择",name:"branchList",rules:[{required:!0,message:"必填",trigger:"change",type:"array"}]},{default:c((()=>[p(s,{value:m(_).branchList,"onUpdate:value":l[0]||(l[0]=a=>m(_).branchList=a),multiple:"",placeholder:"请选择",allowClear:"",onChange:D,options:m(w),showSearch:""},null,8,["value","options"])])),_:1})):f("",!0),(r(!0),h(y,null,v(m(_).candidateList,((a,e)=>(r(),h(y,{key:e},[p(n,{label:a.nodeName+a.label,name:["candidateList",e,"value"],rules:a.rules},{default:c((()=>[a.hasCandidates?(r(),u(m(t),{key:0,value:a.value,"onUpdate:value":e=>a.value=e,multiple:"",query:{...I.formData,nodeCode:a.nodeCode,operatorId:m(x)},api:m(d),modalTitle:"候选人员"},null,8,["value","onUpdate:value","query","api"])):(r(),u(o,{key:1,value:a.value,"onUpdate:value":e=>a.value=e,multiple:"",placeholder:"请选择",modalTitle:"候选人员"},null,8,["value","onUpdate:value"]))])),_:2},1032,["label","name","rules"]),a.selected?(r(),u(n,{key:0,label:"已选审批人",class:"candidate-selected"},{default:c((()=>[p(L,{value:a.selected,"onUpdate:value":e=>a.selected=e,autoSize:{minRows:1,maxRows:4},disabled:""},null,8,["value","onUpdate:value"])])),_:2},1024)):f("",!0)],64)))),128)),m(j)?(r(),u(n,{key:1,label:"抄送人员",name:"copyIds"},{default:c((()=>[p(o,{value:m(_).copyIds,"onUpdate:value":l[1]||(l[1]=a=>m(_).copyIds=a),multiple:"",allowClear:""},null,8,["value"])])),_:1})):f("",!0)])),_:1},8,["labelCol","model"]))])),_:1},16,["onRegister"])}}});export{b as _};
