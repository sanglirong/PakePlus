import{F as e,u as t,B as a}from"./useTable-dc8c9d84.js";import{T as l}from"./TableAction-adbe36f2.js";import{d as o,ad as n,a0 as i,M as r,c as s,n as c,e as u,o as d,p,l as m,j as f,k as h,ae as y,g as v,F as g,h as x,m as b,t as _,af as k,q as C,a4 as S,V as L,bn as w,ah as N,w as U,a5 as I,u as T,aw as R,a7 as A,ab as D,r as j,fs as P,f1 as M,dj as F,f2 as z,f3 as q,K as O,T as V,aY as W,i as K,v as E,aS as $,bb as B,dF as J,aP as H,ft as Y,fu as G,fv as X,fw as Z,am as Q,cl as ee,eO as te,fx as ae,fy as le,fz as oe,aD as ne,fA as ie,fB as re,fC as se,fD as ce}from"./index-920db443.js";import{b as ue,u as de,B as pe}from"./index-143f5813.js";import{a as me,u as fe,g as he,i as ye,_ as ve,b as ge,c as xe,d as be}from"./index.vue_vue_type_style_index_0_scoped_ab412ce5_lang-e8f5a437.js";import{B as _e}from"./BasicLeftTree-cd55d444.js";import{D as ke}from"./index-c37d2476.js";import{E as Ce,_ as Se}from"./ConvertModal.vue_vue_type_script_setup_true_lang-58c36ac6.js";/* empty css                                                     */import{S as Le}from"./sortable.esm-02d0fe44.js";import{u as we,a as Ne}from"./config-06ca91cd.js";import{b as Ue,l as Ie,p as Te,r as Re}from"./dataMap-47db3937.js";import{u as Ae,B as De}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{L as je}from"./index-fea1d737.js";import{_ as Pe}from"./Form.vue_vue_type_script_setup_true_lang-55df66db.js";import{_ as Me}from"./CreateMenuModal.vue_vue_type_script_setup_true_lang-d57ba296.js";import"./useWindowSizeFn-05f906e2.js";import"./SettingOutlined-dd6150a2.js";import"./log-2a5f2c26.js";import"./index-1cfe4e28.js";import"./upperFirst-2cd1a2f7.js";import"./billRule-0363563b.js";import"./import-e198d900.js";import"./tip-b30e67af.js";import"./dataSource-ed26da12.js";import"./dataModel-ea807f46.js";import"./index-999abbee.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./index-3b5bee70.js";import"./CopyOutlined-8d46c8b2.js";import"./vuedraggable.umd-11acc51f.js";import"./BatchOperate-c1982233.js";/* empty css                                                                     */import"./useTabs-ceeccdba.js";import"./uniqBy-e868edd7.js";import"./visualDev-8f54ab4b.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./index-9c138ba5.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./formValidate-c8ab8d29.js";const Fe={key:0,class:"drag-handler icon-ym icon-ym-darg",title:"点击拖动"},ze=["onClick"],qe=o({__name:"QueryModal",emits:["register","confirm"],setup(e,{emit:t}){const a=t,l=n({queryList:[],list:[],fieldOptions:[],activeIndex:0,activeKey:"",sheetList:[],sheetIndex:0}),{queryList:o,fieldOptions:U,activeKey:I}=i(l),[T,{closeModal:R}]=ue((function(e){l.queryList=function(e){const t=e.sheetList.map((e=>({sheet:e.id,sheetName:e.fullName,queryList:[]})));if(!e.queryList?.length)return t;for(let a=0;a<t.length;a++){const l=t[a];for(let o=0;o<e.queryList.length;o++){const n=e.queryList[o];l.sheet==n.sheet&&(t[a].queryList=n.queryList||[])}}return t}(e),l.activeKey=l.queryList[0].sheet,l.fieldOptions=s(e.dataSetList??[]),l.sheetIndex=0,c((()=>{K()}))})),[A,{openModal:D}]=de(),{createMessage:j}=N(),P=["select","date","time","organizeSelect","depSelect","userSelect"],M=["select","depSelect","roleSelect","userSelect","usersSelect","organizeSelect","posSelect","groupSelect"],F=[{title:"拖动",dataIndex:"drag",key:"drag",align:"center",width:50},{title:"字段",dataIndex:"vModel",key:"vModel",width:270},{title:"列名",dataIndex:"label",key:"label",width:200},{title:"输入类型",dataIndex:"type",key:"type",width:200},{title:"条件类型",dataIndex:"searchType",key:"searchType",width:200},{title:"是否多选",dataIndex:"searchMultiple",key:"searchMultiple",width:80,align:"center"},{title:"操作",dataIndex:"action",key:"action",width:80,align:"center"}],z=[{id:1,fullName:"等于查询"},{id:2,fullName:"模糊查询"},{id:3,fullName:"范围查询"}],q=[{id:"input",fullName:"单行输入"},{id:"inputNumber",fullName:"数字输入"},{id:"select",fullName:"下拉选择"},{id:"date",fullName:"日期选择"},{id:"time",fullName:"时间选择"},{id:"organizeSelect",fullName:"组织选择"},{id:"depSelect",fullName:"部门选择"},{id:"roleSelect",fullName:"角色选择"},{id:"posSelect",fullName:"岗位选择"},{id:"groupSelect",fullName:"分组选择"},{id:"userSelect",fullName:"用户选择"}],O=e=>{const t=[...we];return[...Ne,"time","date","inputNumber","calculate","rate","slider"].includes(e)?3:t.includes(e)?2:1},V=r((()=>F.map((e=>({...e,customCell:()=>({class:"align-top"})})))));function W(e){l.sheetIndex=l.queryList.findIndex((t=>t.sheet===e)),c((()=>{K()}))}function K(){const e=document.querySelector(`.columnTable${l.activeKey} .ant-table-tbody`);Le.create(e,{handle:".drag-handler",animation:150,easing:"cubic-bezier(1, 0, 0, 1)",onStart:()=>{},onEnd:({newIndex:e,oldIndex:t})=>{const a=l.queryList[l.sheetIndex].queryList.splice(t,1)[0];l.queryList[l.sheetIndex].queryList.splice(e,0,a)}})}function E(){l.queryList[l.sheetIndex].queryList.push({id:w(),vModel:"",label:"",type:"input",searchType:2,config:{dataType:"static",options:[],dictionaryType:"",propsValue:"id",format:"yyyy-MM-dd",precision:0,thousands:!1}})}function $(e){l.queryList[l.sheetIndex].queryList[l.activeIndex]=e}function B(){const e=[];for(let t=0;t<l.queryList.length;t++){const a=l.queryList[t];for(let t=0;t<a.queryList.length;t++){const l=a.queryList[t];if(!l.vModel)return void j.warning(a.sheetName+`第${t+1}项的字段不能为空`);if(!l.label)return void j.warning(a.sheetName+`第${t+1}项的列名不能为空`);if(e.push({vModel:l.vModel,id:a.sheet}),e.filter((e=>e.vModel==l.vModel&&a.sheet==e.id)).length>1)return void j.warning(a.sheetName+`第${t+1}项的字段重复`)}}a("confirm",l.queryList),c((()=>R()))}return(e,t)=>{const a=u("JnpfTreeSelect"),n=u("a-input"),i=u("JnpfSelect"),r=u("a-checkbox"),c=u("a-button"),w=u("a-table"),N=u("a-tab-pane"),R=u("a-tabs");return d(),p(h(pe),L(e.$attrs,{width:"1200px",class:"jnpf-flow-parameter-modal",onRegister:h(T),title:"查询配置",onOk:B,destroyOnClose:""}),{default:m((()=>[f(R,{activeKey:h(I),"onUpdate:activeKey":t[0]||(t[0]=e=>y(I)?I.value=e:null),class:"pane-tabs approver-pane-tabs",onChange:W},{default:m((()=>[(d(!0),v(g,null,x(h(o),(e=>(d(),p(N,{key:e.sheet},{tab:m((()=>[b(_(e.sheetName),1)])),default:m((()=>[e.sheet==h(I)?(d(),p(w,{key:0,"data-source":e.queryList,rowKey:"id",columns:V.value,size:"small",pagination:!1,class:k(["mt-10px","columnTable"+h(I)])},{bodyCell:m((({column:e,record:o,index:u})=>["drag"===e.key?(d(),v("i",Fe)):C("",!0),"vModel"===e.key?(d(),p(a,{key:1,value:o.vModel,"onUpdate:value":e=>o.vModel=e,placeholder:"请选择",allowClear:"",lastLevel:"",lastLevelKey:"children",options:h(U),fieldNames:{value:"jnpfId"},class:"!w-270px",onChange:(e,t)=>function(e,t,a,o){const{label:n}=a;if(""!==n)return;const i={...a,label:t?.fullName??""};l.queryList[l.sheetIndex].queryList[o]={...i}}(0,t,o,u)},null,8,["value","onUpdate:value","options","onChange"])):C("",!0),"label"===e.key?(d(),p(n,{key:2,value:o.label,"onUpdate:value":e=>o.label=e,placeholder:"请输入",allowClear:"",maxlength:50},null,8,["value","onUpdate:value"])):C("",!0),"type"===e.key?(d(),v(g,{key:3},[f(i,{value:o.type,"onUpdate:value":e=>o.type=e,placeholder:"请选择",options:q,class:"!w-150px",onChange:e=>function(e,t,a){let o={id:t.id,vModel:t.vModel,fullName:t.fullName,label:t.label,prop:t.prop,type:e,searchType:O(e),searchMultiple:(n=e,["select","depSelect","roleSelect","userSelect","usersSelect","organizeSelect","posSelect","groupSelect"].includes(n)),config:{}};var n;"date"===e&&(o.config.format="yyyy-MM-dd"),"time"===e&&(o.config.format="HH:mm:ss"),"select"===e&&(o.options=[],o.props={label:"fullName",value:"id"},o.config={dataType:"static",propsUrl:"",propsName:"",dictionaryType:"",options:[],propsValue:"id"}),["organizeSelect","depSelect","userSelect"].includes(e)&&(o.isIncludeSubordinate=!1),l.queryList[l.sheetIndex].queryList[a]=s(o)}(e,o,u)},null,8,["value","onUpdate:value","onChange"]),P.includes(o.type)?(d(),v("i",{key:0,class:"icon-ym icon-ym-shezhi cursor-pointer ml-8px leading-30px",title:"配置",onClick:e=>function(e,t){l.activeIndex=t,D(!0,{...e})}(o,u)},null,8,ze)):C("",!0)],64)):C("",!0),"searchType"===e.key?(d(),p(i,{key:4,value:o.searchType,"onUpdate:value":e=>o.searchType=e,options:z,disabled:!["input"].includes(o.type)},null,8,["value","onUpdate:value","disabled"])):C("",!0),"searchMultiple"===e.key?(d(),p(r,{key:5,checked:o.searchMultiple,"onUpdate:checked":e=>o.searchMultiple=e,disabled:!M.includes(o.type),onChange:e=>function(e,t){l.list[t].value=(e=>{const t=e.type;return["areaSelect","timePicker","datePicker","inputNumber","organizeSelect","calculate"].includes(t)||e.multiple?[]:void 0})(e)}(o,u)},null,8,["checked","onUpdate:checked","disabled","onChange"])):C("",!0),"action"===e.key?(d(),p(c,{key:6,type:"link",danger:"",onClick:e=>function(e){l.queryList[l.sheetIndex].queryList.splice(e,1)}(u)},{default:m((()=>t[1]||(t[1]=[S("i",{class:"icon-ym icon-ym-app-delete"},null,-1)]))),_:2,__:[1]},1032,["onClick"])):C("",!0)])),_:2},1032,["data-source","columns","class"])):C("",!0)])),_:2},1024)))),128))])),_:1},8,["activeKey"]),S("div",{class:"table-add-action",onClick:E},[f(c,{type:"link",preIcon:"icon-ym icon-ym-btn-add"},{default:m((()=>t[2]||(t[2]=[b("新增")]))),_:1,__:[2]})]),f(Ce,{onRegister:h(A),onConfirm:$},null,8,["onRegister"])])),_:1},16,["onRegister"])}}}),Oe={key:0,class:"drag-handler icon-ym icon-ym-darg",title:"点击拖动"},Ve=o({__name:"SortModal",emits:["register","confirm"],setup(e,{emit:t}){const a=t,l=n({sortList:[],fieldOptions:[],activeKey:"",sheetIndex:0}),{sortList:o,fieldOptions:U,activeKey:I}=i(l),[T,{closeModal:R}]=ue((function(e){l.sortList=function(e){const t=e.sheetList.map((e=>({sheet:e.id,sheetName:e.fullName,sortList:[]})));if(!e.sortList?.length)return t;for(let a=0;a<t.length;a++){const l=t[a];for(let o=0;o<e.sortList.length;o++){const n=e.sortList[o];l.sheet==n.sheet&&(t[a].sortList=n.sortList||[])}}return t}(e),l.activeKey=l.sortList[0].sheet,l.fieldOptions=s(e.dataSetList??[]),c((()=>{F()}))})),{createMessage:A}=N(),D=[{title:"拖动",dataIndex:"drag",key:"drag",align:"center",width:50},{title:"字段",dataIndex:"vModel",key:"vModel",width:270},{title:"类型",dataIndex:"type",key:"type",width:100},{title:"操作",dataIndex:"action",key:"action",width:80,align:"center"}],j=[{id:"asc",fullName:"升序"},{id:"desc",fullName:"降序"}],P=r((()=>D.map((e=>({...e,customCell:()=>({class:"align-top"})})))));function M(e){l.sheetIndex=l.sortList.findIndex((t=>t.sheet===e)),c((()=>{F()}))}function F(){const e=document.querySelector(`.columnTable${l.activeKey} .ant-table-tbody`);Le.create(e,{handle:".drag-handler",animation:150,easing:"cubic-bezier(1, 0, 0, 1)",onStart:()=>{},onEnd:({newIndex:e,oldIndex:t})=>{const a=l.sortList[l.sheetIndex].sortList.splice(t,1)[0];l.sortList[l.sheetIndex].sortList.splice(e,0,a)}})}function z(){l.sortList[l.sheetIndex].sortList.push({id:w(),vModel:"",type:"asc"})}function q(){for(let e=0;e<l.sortList.length;e++){const t=l.sortList[e];for(let e=0;e<t.sortList.length;e++){if(!t.sortList[e].vModel)return void A.warning(t.sheetName+`第${e+1}项的字段不能为空`)}}a("confirm",l.sortList),c((()=>R()))}return(e,t)=>{const a=u("JnpfTreeSelect"),n=u("jnpf-radio"),i=u("a-button"),r=u("a-table"),s=u("a-tab-pane"),c=u("a-tabs");return d(),p(h(pe),L(e.$attrs,{width:"1000px",class:"jnpf-flow-parameter-modal",onRegister:h(T),title:"排序配置",onOk:q,destroyOnClose:""}),{default:m((()=>[f(c,{activeKey:h(I),"onUpdate:activeKey":t[0]||(t[0]=e=>y(I)?I.value=e:null),class:"pane-tabs approver-pane-tabs",onChange:M},{default:m((()=>[(d(!0),v(g,null,x(h(o),(e=>(d(),p(s,{key:e.sheet},{tab:m((()=>[b(_(e.sheetName),1)])),default:m((()=>[e.sheet==h(I)?(d(),p(r,{key:0,"data-source":e.sortList,rowKey:"id",columns:P.value,size:"small",pagination:!1,class:k(["mt-10px","columnTable"+h(I)])},{bodyCell:m((({column:e,record:o,index:r})=>["drag"===e.key?(d(),v("i",Oe)):C("",!0),"vModel"===e.key?(d(),p(a,{key:1,value:o.vModel,"onUpdate:value":e=>o.vModel=e,placeholder:"请选择",allowClear:"",lastLevel:"",lastLevelKey:"children",options:h(U),fieldNames:{value:"jnpfId"},class:"!w-254px"},null,8,["value","onUpdate:value","options"])):C("",!0),"type"===e.key?(d(),p(n,{key:2,value:o.type,"onUpdate:value":e=>o.type=e,options:j,buttonStyle:"solid",class:"!w-160px"},null,8,["value","onUpdate:value"])):C("",!0),"action"===e.key?(d(),p(i,{key:3,type:"link",danger:"",onClick:e=>function(e){l.sortList[l.sheetIndex].sortList.splice(e,1)}(r)},{default:m((()=>t[1]||(t[1]=[S("i",{class:"icon-ym icon-ym-app-delete"},null,-1)]))),_:2,__:[1]},1032,["onClick"])):C("",!0)])),_:2},1032,["data-source","columns","class"])):C("",!0)])),_:2},1024)))),128))])),_:1},8,["activeKey"]),S("div",{class:"table-add-action",onClick:z},[f(i,{type:"link",preIcon:"icon-ym icon-ym-btn-add"},{default:m((()=>t[2]||(t[2]=[b("新增")]))),_:1,__:[2]})])])),_:1},16,["onRegister"])}}}),We=I(o({__name:"ReportDataProperties",props:["dataSource","dataSetList","queryList","getCustomRowNameList","getMaxRows","jnpfUniverRef","cellFromDialogValue","startColumn","startRow"],setup(e){const t=e,a=n({type:""}),l=[{fullName:"纵向",id:"portrait"},{fullName:"横向",id:"landscape"}],o=[{id:"none",fullName:"无"},{id:"sum",fullName:"合计"},{id:"max",fullName:"最大值"},{id:"min",fullName:"最小值"},{id:"count",fullName:"计数"},{id:"avg",fullName:"平均值"}],i=[{id:"1",fullName:"列表"},{id:"2",fullName:"分组"},{id:"3",fullName:"汇总"}],r=[{id:"none",fullName:"无"},{id:"default",fullName:"默认"},{id:"custom",fullName:"自定义"}];function s(e){a.type=e||"";let l={startColumn:t.startColumn,startRow:t.startRow};t.jnpfUniverRef.value?.getCellFromDialogSelect(l)}function c(e){let a=`${e}ParentCellCustomRowName`,l=`${e}ParentCellCustomColName`;if("custom"==t.dataSource[`${e}ParentCellType`]){let o="top"==e?0===t.startRow?0:t.startColumn:0===t.startColumn?0:t.startColumn-1,n="top"==e?0===t.startRow?1:t.startRow:0==t.startColumn?1:t.startRow+1;t.dataSource[a]=t.dataSource[a]||me(o),t.dataSource[l]=t.dataSource[l]||n}}return U((()=>t.cellFromDialogValue),(e=>{if(!e)return;let l=e.match(/[a-zA-Z]+/)[0],o=e.split(l);t.dataSource[`${a.type}ParentCellCustomRowName`]=l,t.dataSource[`${a.type}ParentCellCustomColName`]=o[1]})),(t,a)=>{const n=u("BasicHelp"),h=u("a-radio"),y=u("a-radio-group"),k=u("a-form-item"),S=u("a-select-option"),L=u("a-select"),w=u("a-input-number"),N=u("a-button"),U=u("a-input-group"),I=u("jnpf-tree-select"),T=u("jnpf-radio"),R=u("jnpf-select");return d(),v(g,null,[f(k,{label:"左父格"},{default:m((()=>[f(y,{value:e.dataSource.leftParentCellType,"onUpdate:value":a[0]||(a[0]=t=>e.dataSource.leftParentCellType=t),class:"right-radio",onChange:a[1]||(a[1]=e=>c("left"))},{default:m((()=>[(d(),v(g,null,x(r,(e=>f(h,{value:e.id},{default:m((()=>[b(_(e.fullName),1),"custom"===e.id?(d(),p(n,{key:0,text:"表格位置发生变化后，父格需重新设置"})):C("",!0)])),_:2},1032,["value"]))),64))])),_:1},8,["value"])])),_:1}),"custom"===e.dataSource.leftParentCellType?(d(),p(k,{key:0,class:"-mt-14px"},{default:m((()=>[f(U,{compact:""},{default:m((()=>[f(L,{class:"!w-1/3",value:e.dataSource.leftParentCellCustomRowName,"onUpdate:value":a[2]||(a[2]=t=>e.dataSource.leftParentCellCustomRowName=t)},{default:m((()=>[(d(!0),v(g,null,x(e.getCustomRowNameList,(e=>(d(),p(S,{key:e,value:e},{default:m((()=>[b(_(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"]),f(w,{class:"!w-1/2",min:1,max:e.getMaxRows,value:e.dataSource.leftParentCellCustomColName,"onUpdate:value":a[3]||(a[3]=t=>e.dataSource.leftParentCellCustomColName=t)},null,8,["max","value"]),f(N,{class:"!w-1/6","pre-icon":"icon-ym icon-ym-select-cell",onClick:a[4]||(a[4]=e=>s("left"))})])),_:1})])),_:1})):C("",!0),f(k,{label:"上父格"},{default:m((()=>[f(y,{value:e.dataSource.topParentCellType,"onUpdate:value":a[5]||(a[5]=t=>e.dataSource.topParentCellType=t),class:"right-radio",onChange:a[6]||(a[6]=e=>c("top"))},{default:m((()=>[(d(),v(g,null,x(r,(e=>f(h,{value:e.id},{default:m((()=>[b(_(e.fullName),1),"custom"===e.id?(d(),p(n,{key:0,text:"表格位置发生变化后，父格需重新设置"})):C("",!0)])),_:2},1032,["value"]))),64))])),_:1},8,["value"])])),_:1}),"custom"===e.dataSource.topParentCellType?(d(),p(k,{key:1,class:"-mt-14px"},{default:m((()=>[f(U,{compact:""},{default:m((()=>[f(L,{class:"!w-1/3",value:e.dataSource.topParentCellCustomRowName,"onUpdate:value":a[7]||(a[7]=t=>e.dataSource.topParentCellCustomRowName=t)},{default:m((()=>[(d(!0),v(g,null,x(e.getCustomRowNameList,(e=>(d(),p(S,{key:e,value:e},{default:m((()=>[b(_(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"]),f(w,{class:"!w-1/2",min:1,max:e.getMaxRows,value:e.dataSource.topParentCellCustomColName,"onUpdate:value":a[8]||(a[8]=t=>e.dataSource.topParentCellCustomColName=t)},null,8,["max","value"]),f(N,{class:"!w-1/6","pre-icon":"icon-ym icon-ym-select-cell",onClick:a[9]||(a[9]=e=>s("top"))})])),_:1})])),_:1})):C("",!0),f(k,{label:"字段名称"},{default:m((()=>[f(I,{value:e.dataSource.field,"onUpdate:value":a[10]||(a[10]=t=>e.dataSource.field=t),lastLevel:"",lastLevelKey:"children",options:e.dataSetList,fieldNames:{value:"jnpfId"}},null,8,["value","options"])])),_:1}),f(k,{label:"聚合方式"},{default:m((()=>[f(T,{value:e.dataSource.polymerizationType,"onUpdate:value":a[11]||(a[11]=t=>e.dataSource.polymerizationType=t),options:i,optionType:"button",buttonStyle:"solid",class:"right-radio-more"},null,8,["value"])])),_:1}),"3"===e.dataSource.polymerizationType?(d(),p(k,{key:2,label:"汇总方式"},{default:m((()=>[f(R,{value:e.dataSource.summaryType,"onUpdate:value":a[12]||(a[12]=t=>e.dataSource.summaryType=t),options:o},null,8,["value"])])),_:1})):(d(),p(k,{key:3,label:"扩展方向"},{default:m((()=>[f(T,{value:e.dataSource.fillDirection,"onUpdate:value":a[13]||(a[13]=t=>e.dataSource.fillDirection=t),options:l,optionType:"button",buttonStyle:"solid",class:"right-radio-more"},null,8,["value"])])),_:1}))],64)}}}),[["__scopeId","data-v-3517562a"]]),Ke=o({__name:"ReportChartProperties",props:["chart","dataSetList"],emits:["updateDefaultChart"],setup(e,{emit:t}){const a=t,l=[{id:"bar",fullName:"柱状图"},{id:"line",fullName:"折线图"},{id:"pie",fullName:"饼状图"},{id:"radar",fullName:"雷达图"}];function o(e){a("updateDefaultChart",e)}return(t,a)=>{const n=u("jnpf-select"),i=u("a-form-item"),r=u("a-collapse-panel");return d(),p(r,null,{header:m((()=>a[1]||(a[1]=[b("基础设置")]))),default:m((()=>[f(i,{name:["chart","chartType"],label:"图表类型"},{default:m((()=>[f(n,{value:e.chart.chartType,"onUpdate:value":a[0]||(a[0]=t=>e.chart.chartType=t),options:l,onChange:o},null,8,["value"])])),_:1})])),_:1})}}}),Ee=o({__name:"ReportChartMainTitleProperties",props:["chart","dataSetList"],setup(e){const t=[{id:"left",fullName:"左对齐"},{id:"center",fullName:"居中对齐"},{id:"right",fullName:"右对齐"}];return(a,l)=>{const o=u("jnpf-i18n-input"),n=u("a-form-item"),i=u("a-input-number"),r=u("a-switch"),s=u("jnpf-color-picker"),c=u("jnpf-radio"),h=u("a-collapse-panel");return d(),p(h,null,{header:m((()=>l[7]||(l[7]=[b("标题设置")]))),default:m((()=>[f(n,{label:"标题名称"},{default:m((()=>[f(o,{value:e.chart.title.text,"onUpdate:value":l[0]||(l[0]=t=>e.chart.title.text=t),i18n:e.chart.title.textI18nCode,"onUpdate:i18n":l[1]||(l[1]=t=>e.chart.title.textI18nCode=t),placeholder:"请输入"},null,8,["value","i18n"])])),_:1}),f(n,{label:"字体大小"},{default:m((()=>[f(i,{value:e.chart.title.textStyle.fontSize,"onUpdate:value":l[2]||(l[2]=t=>e.chart.title.textStyle.fontSize=t),placeholder:"请输入",min:12,max:25},null,8,["value"])])),_:1}),f(n,{label:"字体加粗"},{default:m((()=>[f(r,{checked:e.chart.title.textStyle.fontWeight,"onUpdate:checked":l[3]||(l[3]=t=>e.chart.title.textStyle.fontWeight=t),checkedValue:"bold",unCheckedValue:"normal"},null,8,["checked"])])),_:1}),f(n,{label:"字体颜色"},{default:m((()=>[f(s,{value:e.chart.title.textStyle.color,"onUpdate:value":l[4]||(l[4]=t=>e.chart.title.textStyle.color=t),size:"small"},null,8,["value"])])),_:1}),f(n,{label:"字体位置"},{default:m((()=>[f(c,{value:e.chart.title.left,"onUpdate:value":l[5]||(l[5]=t=>e.chart.title.left=t),options:t,optionType:"button","button-style":"solid",class:"right-radio"},null,8,["value"])])),_:1}),f(n,{label:"背景色"},{default:m((()=>[f(s,{value:e.chart.title.titleBgColor,"onUpdate:value":l[6]||(l[6]=t=>e.chart.title.titleBgColor=t),size:"small"},null,8,["value"])])),_:1})])),_:1})}}}),$e=o({__name:"ReportChartSubtitleProperties",props:["chart","dataSetList"],setup:e=>(t,a)=>{const l=u("jnpf-i18n-input"),o=u("a-form-item"),n=u("a-input-number"),i=u("a-switch"),r=u("jnpf-color-picker"),s=u("a-collapse-panel");return d(),p(s,null,{header:m((()=>a[5]||(a[5]=[b("副标题设置")]))),default:m((()=>[f(o,{label:"副标题名称"},{default:m((()=>[f(l,{value:e.chart.title.subtext,"onUpdate:value":a[0]||(a[0]=t=>e.chart.title.subtext=t),i18n:e.chart.title.subtextI18nCode,"onUpdate:i18n":a[1]||(a[1]=t=>e.chart.title.subtextI18nCode=t),placeholder:"请输入"},null,8,["value","i18n"])])),_:1}),f(o,{label:"字体大小"},{default:m((()=>[f(n,{value:e.chart.title.subtextStyle.fontSize,"onUpdate:value":a[2]||(a[2]=t=>e.chart.title.subtextStyle.fontSize=t),placeholder:"请输入",min:12,max:25},null,8,["value"])])),_:1}),f(o,{label:"字体加粗"},{default:m((()=>[f(i,{checked:e.chart.title.subtextStyle.fontWeight,"onUpdate:checked":a[3]||(a[3]=t=>e.chart.title.subtextStyle.fontWeight=t),checkedValue:"bold",unCheckedValue:"normal"},null,8,["checked"])])),_:1}),f(o,{label:"字体颜色"},{default:m((()=>[f(r,{value:e.chart.title.subtextStyle.color,"onUpdate:value":a[4]||(a[4]=t=>e.chart.title.subtextStyle.color=t),size:"small"},null,8,["value"])])),_:1})])),_:1})}}),Be={key:1,class:"my-20px"},Je=o({__name:"ReportChartDataProperties",props:["chart","dataSetList"],setup(e){const t=[{id:"none",fullName:"无"},{id:"sum",fullName:"合计"},{id:"max",fullName:"最大值"},{id:"min",fullName:"最小值"},{id:"count",fullName:"计数"},{id:"avg",fullName:"平均值"}],a=[{fullName:"柱体",id:"bar"},{fullName:"折线",id:"line"}],l=[{title:"系列",key:"title",ellipsis:!0},{title:"类型",key:"type"}];return(o,n)=>{const i=u("jnpf-tree-select"),r=u("a-form-item"),s=u("jnpf-select"),c=u("a-table"),h=u("a-collapse-panel");return d(),p(h,null,{header:m((()=>n[5]||(n[5]=[b("数据设置")]))),default:m((()=>[f(r,{label:"系列"},{default:m((()=>[f(i,{value:e.chart.classifyNameField,"onUpdate:value":n[0]||(n[0]=t=>e.chart.classifyNameField=t),lastLevel:"",lastLevelKey:"children",options:e.dataSetList,fieldNames:{value:"jnpfId"}},null,8,["value","options"])])),_:1}),f(r,{label:"维度"},{default:m((()=>[f(i,{value:e.chart.seriesNameField,"onUpdate:value":n[1]||(n[1]=t=>e.chart.seriesNameField=t),lastLevel:"",lastLevelKey:"children",options:e.dataSetList,fieldNames:{value:"jnpfId"}},null,8,["value","options"])])),_:1}),f(r,{label:"数值"},{default:m((()=>[f(i,{value:e.chart.seriesDataField,"onUpdate:value":n[2]||(n[2]=t=>e.chart.seriesDataField=t),lastLevel:"",lastLevelKey:"children",options:e.dataSetList,fieldNames:{value:"jnpfId"}},null,8,["value","options"])])),_:1}),"radar"==e.chart.chartType?(d(),p(r,{key:0,label:"最大值"},{default:m((()=>[f(i,{value:e.chart.maxField,"onUpdate:value":n[3]||(n[3]=t=>e.chart.maxField=t),lastLevel:"",lastLevelKey:"children",options:e.dataSetList,fieldNames:{value:"jnpfId"}},null,8,["value","options"])])),_:1})):C("",!0),f(r,{label:"汇总方式"},{default:m((()=>[f(s,{value:e.chart.summaryType,"onUpdate:value":n[4]||(n[4]=t=>e.chart.summaryType=t),options:t},null,8,["value"])])),_:1}),7==e.chart.styleType&&"bar"==e.chart.chartType?(d(),v("div",Be,[f(c,{"data-source":e.chart.bar.barTypeList,columns:l,size:"small",pagination:!1},{bodyCell:m((({column:e,record:t})=>["title"===e.key?(d(),v(g,{key:0},[b(_(t[e.key]),1)],64)):C("",!0),"type"===e.key?(d(),p(s,{key:1,value:t[e.key],"onUpdate:value":a=>t[e.key]=a,placeholder:"请选择",options:a,showSearch:""},null,8,["value","onUpdate:value"])):C("",!0)])),_:1},8,["data-source"])])):C("",!0)])),_:1})}}}),He=o({__name:"ReportChartLegendProperties",props:["chart","dataSetList"],setup(e){const t=[{fullName:"横排",id:"horizontal"},{fullName:"竖排",id:"vertical"}];return(a,l)=>{const o=u("a-switch"),n=u("a-form-item"),i=u("a-input-number"),r=u("jnpf-radio"),s=u("a-slider"),c=u("a-collapse-panel");return d(),p(c,null,{header:m((()=>l[5]||(l[5]=[b("图例设置")]))),default:m((()=>[f(n,{label:"显示图例"},{default:m((()=>[f(o,{checked:e.chart.legend.show,"onUpdate:checked":l[0]||(l[0]=t=>e.chart.legend.show=t)},null,8,["checked"])])),_:1}),f(n,{label:"字体大小"},{default:m((()=>[f(i,{value:e.chart.legend.textStyle.fontSize,"onUpdate:value":l[1]||(l[1]=t=>e.chart.legend.textStyle.fontSize=t),placeholder:"请输入",min:12,max:25},null,8,["value"])])),_:1}),f(n,{label:"布局"},{default:m((()=>[f(r,{value:e.chart.legend.orient,"onUpdate:value":l[2]||(l[2]=t=>e.chart.legend.orient=t),options:t,optionType:"button","button-style":"solid",class:"right-radio"},null,8,["value"])])),_:1}),f(n,{label:"上下边距"},{default:m((()=>[f(s,{value:e.chart.legendTop,"onUpdate:value":l[3]||(l[3]=t=>e.chart.legendTop=t),max:100},null,8,["value"])])),_:1}),f(n,{label:"左右边距"},{default:m((()=>[f(s,{value:e.chart.legendLeft,"onUpdate:value":l[4]||(l[4]=t=>e.chart.legendLeft=t),max:100},null,8,["value"])])),_:1})])),_:1})}}}),Ye=o({__name:"ReportChartMarginProperties",props:["chart","dataSetList"],setup(e){const t=e,a=r((()=>["pie","radar"].includes(t.chart.chartType)?"中心坐标设置":"坐标轴边距设置"));return(t,l)=>{const o=u("a-slider"),n=u("a-form-item"),i=u("a-collapse-panel");return d(),p(i,null,{header:m((()=>[b(_(a.value),1)])),default:m((()=>[["bar","line"].includes(e.chart.chartType)?(d(),v(g,{key:0},[f(n,{label:"左边距"},{default:m((()=>[f(o,{value:e.chart.grid.left,"onUpdate:value":l[0]||(l[0]=t=>e.chart.grid.left=t),max:100},null,8,["value"])])),_:1}),f(n,{label:"顶边距"},{default:m((()=>[f(o,{value:e.chart.grid.top,"onUpdate:value":l[1]||(l[1]=t=>e.chart.grid.top=t),max:100},null,8,["value"])])),_:1}),f(n,{label:"右边距"},{default:m((()=>[f(o,{value:e.chart.grid.right,"onUpdate:value":l[2]||(l[2]=t=>e.chart.grid.right=t),max:100},null,8,["value"])])),_:1}),f(n,{label:"底边距"},{default:m((()=>[f(o,{value:e.chart.grid.bottom,"onUpdate:value":l[3]||(l[3]=t=>e.chart.grid.bottom=t),max:100},null,8,["value"])])),_:1})],64)):C("",!0),["pie","radar"].includes(e.chart.chartType)?(d(),v(g,{key:1},[f(n,{label:"上下边距"},{default:m((()=>[f(o,{value:e.chart.seriesCenter.seriesCenterTop,"onUpdate:value":l[4]||(l[4]=t=>e.chart.seriesCenter.seriesCenterTop=t),max:100},null,8,["value"])])),_:1}),f(n,{label:"左右边距"},{default:m((()=>[f(o,{value:e.chart.seriesCenter.seriesCenterLeft,"onUpdate:value":l[5]||(l[5]=t=>e.chart.seriesCenter.seriesCenterLeft=t),max:100},null,8,["value"])])),_:1})],64)):C("",!0)])),_:1})}}}),Ge=o({__name:"ReportChartCommonProperties",props:["chart","dataSetList"],setup(e){const t=e,a=r((()=>{const e=t.chart.chartType;return"bar"==e?Ue.filter((e=>7!=e.id)):"line"==e?Ie:"pie"==e?Te:"radar"==e?Re:void 0}));function l(){const e=t.chart.chartType;return"bar"==e?"柱状图设置":"line"==e?"折线图设置":"pie"==e?"饼图设置":"radar"==e?"雷达图设置":void 0}function o(){let e=[];if(7==t.chart.styleType&&!t.chart.bar.barTypeList.length&&t.dataSetList.length){for(let a=0;a<t.dataSetList.length;a++){const l=t.dataSetList[a];for(let t=0;t<l.children.length;t++){const a=l.children[t];e.push({id:a.jnpfId,title:a.fullName,type:"bar"})}}t.chart.bar.barTypeList=e}}return(t,n)=>{const i=u("jnpf-select"),r=u("a-form-item"),s=u("a-switch"),c=u("a-slider"),h=u("a-input-number"),y=u("jnpf-color-picker"),x=u("a-collapse-panel");return d(),p(x,null,{header:m((()=>[b(_(l()),1)])),default:m((()=>[f(r,{label:"风格类型"},{default:m((()=>[f(i,{value:e.chart.styleType,"onUpdate:value":n[0]||(n[0]=t=>e.chart.styleType=t),options:a.value,placeholder:"请选择",showSearch:"",onChange:o},null,8,["value","options"])])),_:1}),"line"==e.chart.chartType?(d(),v(g,{key:0},[f(r,{label:"面积堆积"},{default:m((()=>[f(s,{checked:e.chart.areaStyle,"onUpdate:checked":n[1]||(n[1]=t=>e.chart.areaStyle=t)},null,8,["checked"])])),_:1}),f(r,{label:"线条宽度"},{default:m((()=>[f(c,{value:e.chart.line.width,"onUpdate:value":n[2]||(n[2]=t=>e.chart.line.width=t),min:1,max:20},null,8,["value"])])),_:1}),f(r,{label:"点的大小"},{default:m((()=>[f(c,{value:e.chart.line.symbolSize,"onUpdate:value":n[3]||(n[3]=t=>e.chart.line.symbolSize=t),max:20},null,8,["value"])])),_:1})],64)):C("",!0),"pie"==e.chart.chartType?(d(),v(g,{key:1},[f(r,{label:"南丁格尔图"},{default:m((()=>[f(s,{checked:e.chart.pie.roseType,"onUpdate:checked":n[4]||(n[4]=t=>e.chart.pie.roseType=t)},null,8,["checked"])])),_:1}),f(r,{label:"自动排序"},{default:m((()=>[f(s,{checked:e.chart.pie.sortable,"onUpdate:checked":n[5]||(n[5]=t=>e.chart.pie.sortable=t)},null,8,["checked"])])),_:1}),f(r,{label:"不展示零"},{default:m((()=>[f(s,{checked:e.chart.pie.showZero,"onUpdate:checked":n[6]||(n[6]=t=>e.chart.pie.showZero=t)},null,8,["checked"])])),_:1})],64)):C("",!0),"radar"==e.chart.chartType?(d(),v(g,{key:2},[f(r,{label:"指示器大小"},{default:m((()=>[f(h,{value:e.chart.radar.axisName.fontSize,"onUpdate:value":n[7]||(n[7]=t=>e.chart.radar.axisName.fontSize=t),min:12,max:25},null,8,["value"])])),_:1}),f(r,{label:"指示器加粗"},{default:m((()=>[f(s,{checked:e.chart.radar.axisName.fontWeight,"onUpdate:checked":n[8]||(n[8]=t=>e.chart.radar.axisName.fontWeight=t)},null,8,["checked"])])),_:1}),f(r,{label:"指示器颜色"},{default:m((()=>[f(y,{value:e.chart.radar.axisName.color,"onUpdate:value":n[9]||(n[9]=t=>e.chart.radar.axisName.color=t),size:"small"},null,8,["value"])])),_:1}),f(r,{label:"区域透明度"},{default:m((()=>[f(c,{value:e.chart.seriesAreaStyleOpacity,"onUpdate:value":n[10]||(n[10]=t=>e.chart.seriesAreaStyleOpacity=t),max:1,step:.1},null,8,["value"])])),_:1})],64)):C("",!0)])),_:1})}}}),Xe=o({__name:"ReportCharBarProperties",props:["chart"],setup:e=>(t,a)=>{const l=u("a-input-number"),o=u("a-form-item"),n=u("a-collapse-panel");return d(),p(n,null,{header:m((()=>a[2]||(a[2]=[b("柱体设置")]))),default:m((()=>[f(o,{label:"宽度"},{default:m((()=>[f(l,{value:e.chart.barWidth,"onUpdate:value":a[0]||(a[0]=t=>e.chart.barWidth=t),min:0,max:100,placeholder:"请输入"},null,8,["value"])])),_:1}),f(o,{label:"弧度"},{default:m((()=>[f(l,{value:e.chart.itemStyle.borderRadius,"onUpdate:value":a[1]||(a[1]=t=>e.chart.itemStyle.borderRadius=t),min:0,max:100,placeholder:"请输入"},null,8,["value"])])),_:1})])),_:1})}}),Ze=o({__name:"ReportChartXAxisProperties",props:["chart"],setup(e){const t=[{fullName:"类型",id:"category"},{fullName:"数值",id:"value"}];return(a,l)=>{const o=u("jnpf-radio"),n=u("a-form-item"),i=u("a-switch"),r=u("jnpf-color-picker"),s=u("a-input"),c=u("a-input-number"),h=u("a-collapse-panel");return d(),p(h,null,{header:m((()=>l[15]||(l[15]=[b("X轴设置")]))),default:m((()=>[f(n,{label:"坐标轴类型"},{default:m((()=>[f(o,{value:e.chart.xAxis.type,"onUpdate:value":l[0]||(l[0]=t=>e.chart.xAxis.type=t),options:t,optionType:"button","button-style":"solid",class:"right-radio"},null,8,["value"])])),_:1}),f(n,{label:"显示坐标轴"},{default:m((()=>[f(i,{checked:e.chart.xAxis.show,"onUpdate:checked":l[1]||(l[1]=t=>e.chart.xAxis.show=t)},null,8,["checked"])])),_:1}),e.chart.xAxis.show?(d(),v(g,{key:0},[f(n,{label:"坐标轴颜色"},{default:m((()=>[f(r,{value:e.chart.xAxis.axisLine.lineStyle.color,"onUpdate:value":l[2]||(l[2]=t=>e.chart.xAxis.axisLine.lineStyle.color=t),size:"small"},null,8,["value"])])),_:1}),f(n,{label:"X轴名称"},{default:m((()=>[f(s,{value:e.chart.xAxis.name,"onUpdate:value":l[3]||(l[3]=t=>e.chart.xAxis.name=t),placeholder:"请输入"},null,8,["value"])])),_:1}),f(n,{label:"字体大小"},{default:m((()=>[f(c,{value:e.chart.xAxis.nameTextStyle.fontSize,"onUpdate:value":l[4]||(l[4]=t=>e.chart.xAxis.nameTextStyle.fontSize=t),placeholder:"请输入",min:12,max:25},null,8,["value"])])),_:1}),f(n,{label:"字体加粗"},{default:m((()=>[f(i,{checked:e.chart.xAxis.nameTextStyle.fontWeight,"onUpdate:checked":l[5]||(l[5]=t=>e.chart.xAxis.nameTextStyle.fontWeight=t)},null,8,["checked"])])),_:1}),f(n,{label:"字体颜色"},{default:m((()=>[f(r,{value:e.chart.xAxis.nameTextStyle.color,"onUpdate:value":l[6]||(l[6]=t=>e.chart.xAxis.nameTextStyle.color=t),size:"small"},null,8,["value"])])),_:1}),f(n,{label:"标签大小"},{default:m((()=>[f(c,{value:e.chart.xAxis.axisLabel.fontSize,"onUpdate:value":l[7]||(l[7]=t=>e.chart.xAxis.axisLabel.fontSize=t),min:12,max:25,placeholder:"请输入"},null,8,["value"])])),_:1}),f(n,{label:"标签加粗"},{default:m((()=>[f(i,{checked:e.chart.xAxis.axisLabel.fontWeight,"onUpdate:checked":l[8]||(l[8]=t=>e.chart.xAxis.axisLabel.fontWeight=t)},null,8,["checked"])])),_:1}),f(n,{label:"标签颜色"},{default:m((()=>[f(r,{value:e.chart.xAxis.axisLabel.color,"onUpdate:value":l[9]||(l[9]=t=>e.chart.xAxis.axisLabel.color=t),size:"small"},null,8,["value"])])),_:1}),f(n,{label:"标签角度"},{default:m((()=>[f(c,{value:e.chart.xAxis.axisLabel.rotate,"onUpdate:value":l[10]||(l[10]=t=>e.chart.xAxis.axisLabel.rotate=t),min:0,max:100,placeholder:"请输入"},null,8,["value"])])),_:1}),f(n,{label:"显示网格线"},{default:m((()=>[f(i,{checked:e.chart.xAxis.splitLine.show,"onUpdate:checked":l[11]||(l[11]=t=>e.chart.xAxis.splitLine.show=t)},null,8,["checked"])])),_:1}),e.chart.xAxis.splitLine.show?(d(),p(n,{key:0,label:"网格线颜色"},{default:m((()=>[f(r,{value:e.chart.xAxis.splitLine.lineStyle.color,"onUpdate:value":l[12]||(l[12]=t=>e.chart.xAxis.splitLine.lineStyle.color=t),size:"small"},null,8,["value"])])),_:1})):C("",!0),f(n,{label:"刻度对齐"},{default:m((()=>[f(i,{checked:e.chart.xAxis.axisTick.alignWithLabel,"onUpdate:checked":l[13]||(l[13]=t=>e.chart.xAxis.axisTick.alignWithLabel=t)},null,8,["checked"])])),_:1})],64)):C("",!0),f(n,{label:"反转"},{default:m((()=>[f(i,{checked:e.chart.xAxis.inverse,"onUpdate:checked":l[14]||(l[14]=t=>e.chart.xAxis.inverse=t)},null,8,["checked"])])),_:1})])),_:1})}}}),Qe=o({__name:"ReportChartYAxisProperties",props:["chart"],setup:e=>(t,a)=>{const l=u("a-switch"),o=u("a-form-item"),n=u("jnpf-color-picker"),i=u("a-input"),r=u("a-input-number"),s=u("a-collapse-panel");return d(),p(s,null,{header:m((()=>a[12]||(a[12]=[b("Y轴设置")]))),default:m((()=>[f(o,{label:"显示坐标轴"},{default:m((()=>[f(l,{checked:e.chart.yAxis.show,"onUpdate:checked":a[0]||(a[0]=t=>e.chart.yAxis.show=t)},null,8,["checked"])])),_:1}),e.chart.yAxis.show?(d(),v(g,{key:0},[f(o,{label:"坐标轴颜色"},{default:m((()=>[f(n,{value:e.chart.yAxis.axisLine.lineStyle.color,"onUpdate:value":a[1]||(a[1]=t=>e.chart.yAxis.axisLine.lineStyle.color=t),size:"small"},null,8,["value"])])),_:1}),f(o,{label:"Y轴名称"},{default:m((()=>[f(i,{value:e.chart.yAxis.name,"onUpdate:value":a[2]||(a[2]=t=>e.chart.yAxis.name=t),placeholder:"请输入"},null,8,["value"])])),_:1}),f(o,{label:"字体大小"},{default:m((()=>[f(r,{value:e.chart.yAxis.nameTextStyle.fontSize,"onUpdate:value":a[3]||(a[3]=t=>e.chart.yAxis.nameTextStyle.fontSize=t),placeholder:"请输入",min:12,max:25},null,8,["value"])])),_:1}),f(o,{label:"字体加粗"},{default:m((()=>[f(l,{checked:e.chart.yAxis.nameTextStyle.fontWeight,"onUpdate:checked":a[4]||(a[4]=t=>e.chart.yAxis.nameTextStyle.fontWeight=t)},null,8,["checked"])])),_:1}),f(o,{label:"字体颜色"},{default:m((()=>[f(n,{value:e.chart.yAxis.nameTextStyle.color,"onUpdate:value":a[5]||(a[5]=t=>e.chart.yAxis.nameTextStyle.color=t),size:"small"},null,8,["value"])])),_:1}),f(o,{label:"标签大小"},{default:m((()=>[f(r,{value:e.chart.yAxis.axisLabel.fontSize,"onUpdate:value":a[6]||(a[6]=t=>e.chart.yAxis.axisLabel.fontSize=t),min:12,max:25,placeholder:"请输入"},null,8,["value"])])),_:1}),f(o,{label:"标签加粗"},{default:m((()=>[f(l,{checked:e.chart.yAxis.axisLabel.fontWeight,"onUpdate:checked":a[7]||(a[7]=t=>e.chart.yAxis.axisLabel.fontWeight=t)},null,8,["checked"])])),_:1}),f(o,{label:"标签颜色"},{default:m((()=>[f(n,{value:e.chart.yAxis.axisLabel.color,"onUpdate:value":a[8]||(a[8]=t=>e.chart.yAxis.axisLabel.color=t),size:"small"},null,8,["value"])])),_:1}),f(o,{label:"显示网格线"},{default:m((()=>[f(l,{checked:e.chart.yAxis.splitLine.show,"onUpdate:checked":a[9]||(a[9]=t=>e.chart.yAxis.splitLine.show=t)},null,8,["checked"])])),_:1}),e.chart.yAxis.splitLine.show?(d(),p(o,{key:0,label:"网格线颜色"},{default:m((()=>[f(n,{value:e.chart.yAxis.splitLine.lineStyle.color,"onUpdate:value":a[10]||(a[10]=t=>e.chart.yAxis.splitLine.lineStyle.color=t),size:"small"},null,8,["value"])])),_:1})):C("",!0)],64)):C("",!0),f(o,{label:"反转"},{default:m((()=>[f(l,{checked:e.chart.yAxis.inverse,"onUpdate:checked":a[11]||(a[11]=t=>e.chart.yAxis.inverse=t)},null,8,["checked"])])),_:1})])),_:1})}}),et=o({__name:"ReportChartLabelProperties",props:["chart"],setup(e){const t=[{fullName:"外侧",id:"outside"},{fullName:"内侧",id:"inside"}],a=[{fullName:"数值",id:"count"},{fullName:"百分比",id:"percent"}];return(l,o)=>{const n=u("a-switch"),i=u("a-form-item"),r=u("jnpf-radio"),s=u("jnpf-checkbox"),c=u("a-input-number"),h=u("jnpf-color-picker"),y=u("a-collapse-panel");return d(),p(y,null,{header:m((()=>o[7]||(o[7]=[b("数值设置")]))),default:m((()=>[f(i,{label:"显示"},{default:m((()=>[f(n,{checked:e.chart.label.show,"onUpdate:checked":o[0]||(o[0]=t=>e.chart.label.show=t)},null,8,["checked"])])),_:1}),e.chart.label.show?(d(),v(g,{key:0},["pie"==e.chart.chartType?(d(),v(g,{key:0},[f(i,{label:"显示位置"},{default:m((()=>[f(r,{value:e.chart.seriesLabelPosition,"onUpdate:value":o[1]||(o[1]=t=>e.chart.seriesLabelPosition=t),options:t,optionType:"button","button-style":"solid",class:"right-radio"},null,8,["value"])])),_:1}),f(i,{label:"显示内容"},{default:m((()=>[f(s,{value:e.chart.seriesLabelShowInfo,"onUpdate:value":o[2]||(o[2]=t=>e.chart.seriesLabelShowInfo=t),options:a,optionType:"button","button-style":"solid",class:"right-radio"},null,8,["value"])])),_:1})],64)):C("",!0),f(i,{label:"字体大小"},{default:m((()=>[f(c,{value:e.chart.label.fontSize,"onUpdate:value":o[3]||(o[3]=t=>e.chart.label.fontSize=t),placeholder:"请输入",min:12,max:25},null,8,["value"])])),_:1}),f(i,{label:"字体加粗"},{default:m((()=>[f(n,{checked:e.chart.label.fontWeight,"onUpdate:checked":o[4]||(o[4]=t=>e.chart.label.fontWeight=t)},null,8,["checked"])])),_:1})],64)):C("",!0),f(i,{label:"字体颜色"},{default:m((()=>[f(h,{value:e.chart.label.color,"onUpdate:value":o[5]||(o[5]=t=>e.chart.label.color=t),size:"small"},null,8,["value"])])),_:1}),f(i,{label:"背景色"},{default:m((()=>[f(h,{value:e.chart.label.backgroundColor,"onUpdate:value":o[6]||(o[6]=t=>e.chart.label.backgroundColor=t),size:"small"},null,8,["value"])])),_:1})])),_:1})}}}),tt=o({__name:"ReportCharColorProperties",props:["chart"],setup(e){const{t:t}=T(),{createMessage:a,createConfirm:l}=N(),o=e,n=r((()=>[{title:"颜色",key:"color1",align:"center"},{title:"渐变色",key:"color2",align:"center"},{title:"操作",key:"action",align:"center"}]));return(i,r)=>{const s=u("jnpf-color-picker"),c=u("a-form-item"),h=u("a-button"),y=u("a-table"),x=u("a-collapse-panel");return d(),p(x,null,{header:m((()=>r[3]||(r[3]=[b("自定义配色设置")]))),default:m((()=>[["bar","line"].includes(e.chart.chartType)?(d(),v(g,{key:0},[f(c,{label:"文字颜色"},{default:m((()=>[f(s,{value:e.chart.color.AxisTextStyleColor,"onUpdate:value":r[0]||(r[0]=t=>e.chart.color.AxisTextStyleColor=t),size:"small"},null,8,["value"])])),_:1}),f(c,{label:"轴线颜色"},{default:m((()=>[f(s,{value:e.chart.color.AxisLineStyleColor,"onUpdate:value":r[1]||(r[1]=t=>e.chart.color.AxisLineStyleColor=t),size:"small"},null,8,["value"])])),_:1})],64)):C("",!0),f(y,{"data-source":e.chart.color.list,columns:n.value,pagination:!1,size:"small"},{bodyCell:m((({column:e,record:n,index:i})=>["color1"===e.key||"color2"===e.key?(d(),p(s,{key:0,value:n[e.key],"onUpdate:value":t=>n[e.key]=t,size:"small"},null,8,["value","onUpdate:value"])):C("",!0),"action"===e.key?(d(),p(h,{key:1,type:"link",danger:"",onClick:e=>function(e){l({iconType:"warning",title:t("common.tipTitle"),content:t("common.delTip"),onOk:()=>{o.chart.color.list.splice(e,1),a.success("删除成功")}})}(i)},{default:m((()=>r[4]||(r[4]=[S("i",{class:"icon-ym icon-ym-delete"},null,-1)]))),_:2,__:[4]},1032,["onClick"])):C("",!0)])),_:1},8,["data-source","columns"]),S("div",{class:"table-add-action mb-15px !mt-unset",onClick:r[2]||(r[2]=e=>{o.chart.color.list.push({color1:"#1890ff",color2:"#4696DD"})})},[f(h,{type:"link",preIcon:"icon-ym icon-ym-btn-add"},{default:m((()=>r[5]||(r[5]=[b("新增")]))),_:1,__:[5]})])])),_:1})}}}),at=o({__name:"ReportCharTooltipProperties",props:["chart"],setup:e=>(t,a)=>{const l=u("a-switch"),o=u("a-form-item"),n=u("a-input-number"),i=u("jnpf-color-picker"),r=u("a-collapse-panel");return d(),p(r,null,{header:m((()=>a[5]||(a[5]=[b("提示语设置")]))),default:m((()=>[f(o,{label:"显示"},{default:m((()=>[f(l,{checked:e.chart.tooltip.show,"onUpdate:checked":a[0]||(a[0]=t=>e.chart.tooltip.show=t)},null,8,["checked"])])),_:1}),e.chart.tooltip.show?(d(),v(g,{key:0},[f(o,{label:"字体大小"},{default:m((()=>[f(n,{value:e.chart.tooltip.textStyleFontSize,"onUpdate:value":a[1]||(a[1]=t=>e.chart.tooltip.textStyleFontSize=t),placeholder:"请输入",min:12,max:25},null,8,["value"])])),_:1}),f(o,{label:"字体加粗"},{default:m((()=>[f(l,{checked:e.chart.tooltip.textStyleFontWeight,"onUpdate:checked":a[2]||(a[2]=t=>e.chart.tooltip.textStyleFontWeight=t)},null,8,["checked"])])),_:1}),f(o,{label:"字体颜色"},{default:m((()=>[f(i,{value:e.chart.tooltip.textStyleColor,"onUpdate:value":a[3]||(a[3]=t=>e.chart.tooltip.textStyleColor=t),size:"small"},null,8,["value"])])),_:1}),f(o,{label:"背景色"},{default:m((()=>[f(i,{value:e.chart.tooltip.bgColor,"onUpdate:value":a[4]||(a[4]=t=>e.chart.tooltip.bgColor=t),size:"small"},null,8,["value"])])),_:1})],64)):C("",!0)])),_:1})}}),lt=o({__name:"ReportImageProperties",props:["floatImage"],setup(e){const t=e,a=R(),l=r((()=>a.reportApiUrl)),o=[{fullName:"本地上传",id:1},{fullName:"URL路径",id:2}];function n(){t.floatImage.option.src="",i()}function i(){t.floatImage.imageType="URL"}return(t,a)=>{const r=u("jnpf-radio"),s=u("a-form-item"),c=u("BasicHelp"),h=u("a-input"),y=u("JnpfUploadImgSingle"),v=u("a-collapse-panel");return d(),p(v,null,{header:m((()=>a[3]||(a[3]=[b("基础设置")]))),default:m((()=>[f(s,{label:"图片来源"},{default:m((()=>[f(r,{value:e.floatImage.option.source,"onUpdate:value":a[0]||(a[0]=t=>e.floatImage.option.source=t),options:o,optionType:"button",buttonStyle:"solid",onChange:n,class:"right-radio-more"},null,8,["value"])])),_:1}),2==e.floatImage.option.source?(d(),p(s,{key:0},{label:m((()=>[a[4]||(a[4]=b("图片地址")),f(c,{text:"地址以http://或https://为开头"})])),default:m((()=>[f(h,{value:e.floatImage.option.src,"onUpdate:value":a[1]||(a[1]=t=>e.floatImage.option.src=t),placeholder:"请输入"},null,8,["value"])])),_:1})):(d(),p(s,{key:1,label:"上传图片"},{default:m((()=>[f(y,{value:e.floatImage.option.src,"onUpdate:value":a[2]||(a[2]=t=>e.floatImage.option.src=t),actionPrefix:l.value,type:"/api/Report/data/upload/file",onChange:i},null,8,["value","actionPrefix"])])),_:1}))])),_:1})}}}),ot=I(o({__name:"ReportTextProperties",props:["text","getCustomRowNameList","getMaxRows","jnpfUniverRef","cellFromDialogValue","startColumn","startRow","dataSetList","queryList"],setup(e){const t=e,a=n({type:""}),l=[{id:"none",fullName:"无"},{id:"default",fullName:"默认"},{id:"custom",fullName:"自定义"}];function o(e){a.type=e||"";let l={startColumn:t.startColumn,startRow:t.startRow};t.jnpfUniverRef.value?.getCellFromDialogSelect(l)}function i(e){let a=`${e}ParentCellCustomRowName`,l=`${e}ParentCellCustomColName`;if("custom"==t.text[`${e}ParentCellType`]){let o="top"==e?0===t.startRow?0:t.startColumn:0===t.startColumn?0:t.startColumn-1,n="top"==e?0===t.startRow?1:t.startRow:0==t.startColumn?1:t.startRow+1;t.text[a]=t.text[a]||me(o),t.text[l]=t.text[l]||n}}return U((()=>t.cellFromDialogValue),(e=>{if(!e)return;let l=e.match(/[a-zA-Z]+/)[0],o=e.split(l);t.text[`${a.type}ParentCellCustomRowName`]=l,t.text[`${a.type}ParentCellCustomColName`]=o[1]})),(t,a)=>{const n=u("BasicHelp"),r=u("a-radio"),s=u("a-radio-group"),c=u("a-form-item"),h=u("a-select-option"),y=u("a-select"),k=u("a-input-number"),S=u("a-button"),L=u("a-input-group");return d(),v(g,null,[f(c,{label:"左父格"},{default:m((()=>[f(s,{value:e.text.leftParentCellType,"onUpdate:value":a[0]||(a[0]=t=>e.text.leftParentCellType=t),class:"right-radio",onChange:a[1]||(a[1]=e=>i("left"))},{default:m((()=>[(d(),v(g,null,x(l,(e=>f(r,{value:e.id},{default:m((()=>[b(_(e.fullName),1),"custom"===e.id?(d(),p(n,{key:0,text:"表格位置发生变化后，父格需重新设置"})):C("",!0)])),_:2},1032,["value"]))),64))])),_:1},8,["value"])])),_:1}),"custom"===e.text.leftParentCellType?(d(),p(c,{key:0,class:"-mt-14px"},{default:m((()=>[f(L,{compact:""},{default:m((()=>[f(y,{class:"!w-1/3",value:e.text.leftParentCellCustomRowName,"onUpdate:value":a[2]||(a[2]=t=>e.text.leftParentCellCustomRowName=t)},{default:m((()=>[(d(!0),v(g,null,x(e.getCustomRowNameList,(e=>(d(),p(h,{key:e,value:e},{default:m((()=>[b(_(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"]),f(k,{class:"!w-1/2",min:1,max:e.getMaxRows,value:e.text.leftParentCellCustomColName,"onUpdate:value":a[3]||(a[3]=t=>e.text.leftParentCellCustomColName=t)},null,8,["max","value"]),f(S,{class:"!w-1/6","pre-icon":"icon-ym icon-ym-select-cell",onClick:a[4]||(a[4]=e=>o("left"))})])),_:1})])),_:1})):C("",!0),f(c,{label:"上父格"},{default:m((()=>[f(s,{value:e.text.topParentCellType,"onUpdate:value":a[5]||(a[5]=t=>e.text.topParentCellType=t),class:"right-radio",onChange:a[6]||(a[6]=e=>i("top"))},{default:m((()=>[(d(),v(g,null,x(l,(e=>f(r,{value:e.id},{default:m((()=>[b(_(e.fullName),1),"custom"===e.id?(d(),p(n,{key:0,text:"表格位置发生变化后，父格需重新设置"})):C("",!0)])),_:2},1032,["value"]))),64))])),_:1},8,["value"])])),_:1}),"custom"===e.text.topParentCellType?(d(),p(c,{key:1,class:"-mt-14px"},{default:m((()=>[f(L,{compact:""},{default:m((()=>[f(y,{class:"!w-1/3",value:e.text.topParentCellCustomRowName,"onUpdate:value":a[7]||(a[7]=t=>e.text.topParentCellCustomRowName=t)},{default:m((()=>[(d(!0),v(g,null,x(e.getCustomRowNameList,(e=>(d(),p(h,{key:e,value:e},{default:m((()=>[b(_(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"]),f(k,{class:"!w-1/2",min:1,max:e.getMaxRows,value:e.text.topParentCellCustomColName,"onUpdate:value":a[8]||(a[8]=t=>e.text.topParentCellCustomColName=t)},null,8,["max","value"]),f(S,{class:"!w-1/6","pre-icon":"icon-ym icon-ym-select-cell",onClick:a[9]||(a[9]=e=>o("top"))})])),_:1})])),_:1})):C("",!0)],64)}}}),[["__scopeId","data-v-1a465568"]]),nt=I(o({__name:"ReportParamProperties",props:["parameter","dataSetList","getCustomRowNameList","getMaxRows","jnpfUniverRef","cellFromDialogValue","startColumn","startRow","queryList"],setup(e){const t=e,a=n({type:""}),l=[{id:"none",fullName:"无"},{id:"default",fullName:"默认"},{id:"custom",fullName:"自定义"}];function o(e){a.type=e||"";let l={startColumn:t.startColumn,startRow:t.startRow};t.jnpfUniverRef.value?.getCellFromDialogSelect(l)}function i(e){let a=`${e}ParentCellCustomRowName`,l=`${e}ParentCellCustomColName`;if("custom"==t.parameter[`${e}ParentCellType`]){let o="top"==e?0===t.startRow?0:t.startColumn:0===t.startColumn?0:t.startColumn-1,n="top"==e?0===t.startRow?1:t.startRow:0==t.startColumn?1:t.startRow+1;t.parameter[a]=t.parameter[a]||me(o),t.parameter[l]=t.parameter[l]||n}}return U((()=>t.cellFromDialogValue),(e=>{if(!e)return;let l=e.match(/[a-zA-Z]+/)[0],o=e.split(l);t.parameter[`${a.type}ParentCellCustomRowName`]=l,t.parameter[`${a.type}ParentCellCustomColName`]=o[1]})),(t,a)=>{const n=u("BasicHelp"),r=u("a-radio"),s=u("a-radio-group"),c=u("a-form-item"),h=u("a-select-option"),y=u("a-select"),k=u("a-input-number"),S=u("a-button"),L=u("a-input-group"),w=u("jnpf-tree-select");return d(),v(g,null,[f(c,{label:"左父格"},{default:m((()=>[f(s,{value:e.parameter.leftParentCellType,"onUpdate:value":a[0]||(a[0]=t=>e.parameter.leftParentCellType=t),class:"right-radio",onChange:a[1]||(a[1]=e=>i("left"))},{default:m((()=>[(d(),v(g,null,x(l,(e=>f(r,{value:e.id},{default:m((()=>[b(_(e.fullName),1),"custom"===e.id?(d(),p(n,{key:0,text:"表格位置发生变化后，父格需重新设置"})):C("",!0)])),_:2},1032,["value"]))),64))])),_:1},8,["value"])])),_:1}),"custom"===e.parameter.leftParentCellType?(d(),p(c,{key:0,class:"-mt-14px"},{default:m((()=>[f(L,{compact:""},{default:m((()=>[f(y,{class:"!w-1/3",value:e.parameter.leftParentCellCustomRowName,"onUpdate:value":a[2]||(a[2]=t=>e.parameter.leftParentCellCustomRowName=t)},{default:m((()=>[(d(!0),v(g,null,x(e.getCustomRowNameList,(e=>(d(),p(h,{key:e,value:e},{default:m((()=>[b(_(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"]),f(k,{class:"!w-1/2",min:1,max:e.getMaxRows,value:e.parameter.leftParentCellCustomColName,"onUpdate:value":a[3]||(a[3]=t=>e.parameter.leftParentCellCustomColName=t)},null,8,["max","value"]),f(S,{class:"!w-1/6","pre-icon":"icon-ym icon-ym-select-cell",onClick:a[4]||(a[4]=e=>o("left"))})])),_:1})])),_:1})):C("",!0),f(c,{label:"上父格"},{default:m((()=>[f(s,{value:e.parameter.topParentCellType,"onUpdate:value":a[5]||(a[5]=t=>e.parameter.topParentCellType=t),class:"right-radio",onChange:a[6]||(a[6]=e=>i("top"))},{default:m((()=>[(d(),v(g,null,x(l,(e=>f(r,{value:e.id},{default:m((()=>[b(_(e.fullName),1),"custom"===e.id?(d(),p(n,{key:0,text:"表格位置发生变化后，父格需重新设置"})):C("",!0)])),_:2},1032,["value"]))),64))])),_:1},8,["value"])])),_:1}),"custom"===e.parameter.topParentCellType?(d(),p(c,{key:1,class:"-mt-14px"},{default:m((()=>[f(L,{compact:""},{default:m((()=>[f(y,{class:"!w-1/3",value:e.parameter.topParentCellCustomRowName,"onUpdate:value":a[7]||(a[7]=t=>e.parameter.topParentCellCustomRowName=t)},{default:m((()=>[(d(!0),v(g,null,x(e.getCustomRowNameList,(e=>(d(),p(h,{key:e,value:e},{default:m((()=>[b(_(e),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"]),f(k,{class:"!w-1/2",min:1,max:e.getMaxRows,value:e.parameter.topParentCellCustomColName,"onUpdate:value":a[8]||(a[8]=t=>e.parameter.topParentCellCustomColName=t)},null,8,["max","value"]),f(S,{class:"!w-1/6","pre-icon":"icon-ym icon-ym-select-cell",onClick:a[9]||(a[9]=e=>o("top"))})])),_:1})])),_:1})):C("",!0),f(c,{label:"参数名称"},{default:m((()=>[f(w,{value:e.parameter.field,"onUpdate:value":a[10]||(a[10]=t=>e.parameter.field=t),lastLevel:"",lastLevelKey:"children",options:e.queryList},null,8,["value","options"])])),_:1})],64)}}}),[["__scopeId","data-v-b34021d3"]]),it={class:"filed-box"},rt=o({__name:"index",props:["activeSheetId","activeData","dataSetList","queryList","defaultEchartOptions","jnpfUniverRef","imageConfig","cellFromDialogValue"],setup(e){const t=e,a=n({activeKey:1}),{activeKey:l}=i(a),o=[{id:"text",fullName:"文本"},{id:"dataSource",fullName:"数据集"},{id:"parameter",fullName:"参数"}],s=[{id:"system",fullName:"系统参数",children:[{id:"@userId",fullName:"@userId（当前用户）"},{id:"@userAndSubordinates",fullName:"@userAndSubordinates（当前用户及下属）"},{id:"@organizeId",fullName:"@organizeId（当前组织）"},{id:"@organizationAndSuborganization",fullName:"@organizationAndSuborganization（当前组织及子组织）"},{id:"@branchManageOrganize",fullName:"@branchManageOrganize（当前分管组织）"}]}],c=r((()=>({dataSetList:t.dataSetList,queryList:h(b),getCustomRowNameList:t.activeData.getCustomRowNameList,getMaxRows:t.activeData.getMaxRows,jnpfUniverRef:t.jnpfUniverRef,startColumn:t.activeData.startColumn,startRow:t.activeData.startRow,cellFromDialogValue:t.cellFromDialogValue}))),x=r((()=>({dataSetList:t.dataSetList,chart:t.activeData.chart}))),b=r((()=>{const e=(t.queryList||[]).filter((e=>e.sheet===t.activeSheetId)).flatMap((e=>(e.queryList||[]).map((e=>({id:e.vModel,fullName:`${e.vModel}（${e.label}）`})))));return e?.length?[...s,{id:"query",fullName:"查询参数",children:e}]:[...s]}));function _(e){const a={...t.defaultEchartOptions[e]||{},classifyNameField:t.activeData.chart.classifyNameField,seriesNameField:t.activeData.chart.seriesNameField,seriesDataField:t.activeData.chart.seriesDataField,maxField:t.activeData.chart.maxField,summaryType:t.activeData.chart.summaryType,chartType:e,title:t.activeData.chart.title,tooltip:t.activeData.chart.tooltip};t.activeData.chart=a}function k(){t.activeData.cellData.v=""}return U((()=>t.activeData.type),(()=>{a.activeKey=1}),{deep:!0}),A((()=>{a.activeKey=1})),(t,a)=>{const n=u("jnpf-select"),i=u("a-form-item"),r=u("a-collapse-panel"),s=u("a-collapse"),b=u("a-form");return d(),v("div",it,[f(h(D),{class:"!pt-0px"},{default:m((()=>[f(b,{model:e.activeData,layout:"vertical",colon:!1},{default:m((()=>[f(s,{activeKey:h(l),"onUpdate:activeKey":a[1]||(a[1]=e=>y(l)?l.value=e:null),accordion:"",ghost:"",expandIconPosition:"end"},{default:m((()=>["chart"==e.activeData.type?(d(),v(g,{key:0},[(d(),p(Ke,L({key:1},x.value,{onUpdateDefaultChart:_}),null,16)),(d(),p(Ge,L({key:2},x.value),null,16)),"bar"==e.activeData.chart.chartType?(d(),p(Xe,L({key:3},x.value),null,16)):C("",!0),(d(),p(Je,L({key:4},x.value),null,16)),(d(),p(Ee,L({key:5},x.value),null,16)),(d(),p($e,L({key:6},x.value),null,16)),["bar","line"].includes(e.activeData.chart.chartType)?(d(),p(Ze,L({key:7},x.value),null,16)):C("",!0),["bar","line"].includes(e.activeData.chart.chartType)?(d(),p(Qe,L({key:8},x.value),null,16)):C("",!0),(d(),p(et,L({key:9},x.value),null,16)),(d(),p(at,L({key:10},x.value),null,16)),(d(),p(Ye,L({key:11},x.value),null,16)),(d(),p(He,L({key:12},x.value),null,16)),(d(),p(tt,L({key:13},x.value),null,16))],64)):"floatImage"==e.activeData.type?(d(),p(lt,{key:1,floatImage:e.activeData.floatImage},null,8,["floatImage"])):(d(),p(r,{key:1,header:"基础设置"},{default:m((()=>[f(i,{name:"type",label:"单元类型"},{default:m((()=>[f(n,{value:e.activeData.type,"onUpdate:value":a[0]||(a[0]=t=>e.activeData.type=t),options:o,onChange:k},null,8,["value"])])),_:1}),"text"===e.activeData.type?(d(),p(ot,L({key:0,text:e.activeData.text},c.value),null,16,["text"])):C("",!0),"dataSource"===e.activeData.type?(d(),p(We,L({key:1,dataSource:e.activeData.dataSource},c.value),null,16,["dataSource"])):C("",!0),"parameter"===e.activeData.type?(d(),p(nt,L({key:2,parameter:e.activeData.parameter},c.value),null,16,["parameter"])):C("",!0)])),_:1}))])),_:1},8,["activeKey"])])),_:1},8,["model"])])),_:1})])}}}),st={class:"jnpf-full-modal-header"},ct={class:"basic-content bg-white"},ut={key:0,class:"query-wrap"},dt={class:"main-warp"},pt=o({name:"reportPreview",__name:"index",setup(e){const{t:t}=T(),[a,{closeModal:l}]=ue((async function(e){g.loading=!1,g.id=e.id,g.versionId=e.versionId,g.sheetIndex=0,g.sheetId=e.sheetId||"",$()})),[o,{openModal:r}]=de(),s=j(),y=R(),g=n({id:"",versionId:"",reportData:{},searchSchemas:[],jnpfUniverAPI:null,allowExport:0,allowPrint:0,sheetId:"",queryList:[],sheetIndex:0,loading:!1,key:""}),{allowExport:x,allowPrint:k,loading:w,key:N}=i(g),[U,{updateSchema:I,submit:A,getFieldsValue:D}]=Ae({baseColProps:{span:6},showActionButtonGroup:!0,showAdvancedButton:!0,compact:!0}),O={updateSchema:I,getFieldsValue:D},{getRealEchart:V,getSearchSchema:W,clearSearchSchema:K,searchSchemas:E}=fe(O);function $(e={}){g.loading=!0;(g.versionId?P:M)(g.versionId?g.versionId:g.id,e).then((e=>{g.reportData=e.data,g.queryList=e.data.queryList?JSON.parse(e.data.queryList):[];const t=e.data.snapshot?JSON.parse(e.data.snapshot):null,a=e.data.cells?JSON.parse(e.data.cells):{},l=e.data.chartData?JSON.parse(e.data.chartData):[],o=V(a.floatEcharts??null,l);let n=a.floatImages,i=he(t.resources,y.reportApiUrl,n);t.resources=i.list,n=i.floatImages,g.allowExport=e.data.allowExport||0,g.allowPrint=e.data.allowPrint||0,W(g.queryList,g.sheetId),g.key=+new Date,c((()=>{!function(e,t,a){const l=h(s)?.handleCreateDesignUnit({mode:"preview",snapshot:e,floatEcharts:t,uiHeader:!1,uiContextMenu:!1,workbookReadonly:!0,defaultActiveSheetId:g.sheetId||"",floatImages:a,loading:!0});g.jnpfUniverAPI=l?l?.jnpfUniverAPI:null,g.jnpfUniverAPI?.onCommandExecuted((e=>{const{id:t}=e??{};"sheet.operation.set-worksheet-active"===t&&(g.sheetIndex=g.queryList.findIndex((t=>t.sheet===e.params.subUnitId)),g.sheetId!=e.params.subUnitId&&(K(),g.queryList?.length&&c((()=>{g.key=+new Date,$({sheetId:e.params.subUnitId})}))),g.sheetId=e.params.subUnitId,c((()=>{W(g.queryList,g.sheetId)})))})),g.jnpfUniverAPI?.getHooks()?.onSteady((()=>{g.loading=!1}))}(t,o,n)}))}))}function B(){h(s)?.handleDisposeUnit(),l()}function J(e){$({...e,sheetId:g.sheetId})}return(e,l)=>{const n=u("a-button"),i=u("a-space");return d(),p(h(pe),L(e.$attrs,{onRegister:h(a),defaultFullscreen:"",footer:null,closable:!1,keyboard:!1,destroyOnClose:"",class:"jnpf-full-modal full-modal designer-modal jnpf-report-preview-modal"}),{title:m((()=>[S("div",st,[l[3]||(l[3]=S("div",{class:"header-title"},[S("img",{src:F,class:"header-logo"}),S("span",{class:"header-dot"}),S("p",{class:"header-txt"},"报表预览")],-1)),f(i,{class:"options",size:10},{default:m((()=>[h(x)?(d(),p(n,{key:0,type:"primary",disabled:h(w),onClick:l[0]||(l[0]=e=>function(){const{snapshot:e}=h(s)?.getPreviewWorkbookData(),t=g.jnpfUniverAPI.getActiveWorkbook()?.getActiveSheet()?.getSheetId(),a={...h(E).length?D():{},sheetId:t,fullName:g.reportData.fullName,snapshot:e?JSON.stringify(e):null};z(g.reportData.versionId,a).then((e=>{q({url:e.data.url})}))}())},{default:m((()=>[b(_(h(t)("common.exportText")),1)])),_:1},8,["disabled"])):C("",!0),h(k)?(d(),p(n,{key:1,type:"primary",disabled:h(w),onClick:l[1]||(l[1]=e=>function(){const{snapshot:e}=h(s)?.getPreviewWorkbookData(),t=g.jnpfUniverAPI.getActiveWorkbook()?.getActiveSheet()?.getSheetId(),a=h(s)?.getActiveWorksheetId(),{xSplit:l=0,ySplit:o=0}=e?.sheets?.[a]?.freeze??{},n=l>0,i=o>0;r(!0,{id:g.reportData.versionId,fullName:g.reportData.fullName,sheetId:t,snapshot:e,hasYFreeze:i,hasXFreeze:n})}())},{default:m((()=>[b(_(h(t)("common.printText")),1)])),_:1},8,["disabled"])):C("",!0),f(n,{onClick:l[2]||(l[2]=e=>B())},{default:m((()=>[b(_(h(t)("common.cancelText")),1)])),_:1})])),_:1})])])),default:m((()=>[S("div",ct,[h(E)?.length?(d(),v("div",ut,[f(h(De),{onRegister:h(U),schemas:h(E),onSubmit:J,onReset:h(A),class:"search-form"},null,8,["onRegister","schemas","onReset"])])):C("",!0),S("div",dt,[(d(),p(h(ye),{ref_key:"jnpfUniverRef",ref:s,key:h(N)}))])]),f(ve,{onRegister:h(o)},null,8,["onRegister"])])),_:1},16,["onRegister"])}}}),mt={class:"design-wrap"},ft={class:"flex-row"},ht={class:"left-side"},yt={class:"tabs-content"},vt={class:"dataSet-content"},gt={class:"dataSet-content-header"},xt={class:"dataSet-content-main",style:{height:"calc(100% - 102px)"}},bt={class:"dataSet-content"},_t=o({name:"reportDesign",__name:"index",props:{dataSetList:{type:Array,default:()=>[]},convertConfig:{type:Array,default:()=>[]},versionState:{type:Number,default:0},customs:{type:String,default:void 0},snapshot:{type:String,default:void 0},echarts:{type:String,default:void 0},queryList:{type:String,default:void 0},cells:{type:String,default:void 0},versionId:{type:String,default:void 0},sortList:{type:String,default:void 0}},emits:["closeVersionPopover","changeModalLoading"],setup(t,{expose:a,emit:l}){const o=t,x=l,_=j();O("getDataSetList",(()=>I.dataSetList));const w=j(),I=n({activeKey:"1",dataSetList:[],convertConfig:[],selectionsInfo:[],firstCellConfig:{},queryList:[],sortList:[],activeData:null,jnpfUniverAPI:null,isInitCell:!0,cellFromDialogValue:"",key:"",sheetId:""}),{activeKey:D,dataSetList:M,key:F}=i(I),{prefixCls:z}=V("report-designer"),{createConfirm:q,createMessage:X}=N(),{t:Z}=T(),[Q,{openModal:ee}]=de(),[te,{openModal:ae}]=de(),[le,{openModal:oe}]=de(),[ne,{openModal:ie}]=de(),[re,{openModal:se}]=de(),ce=W(Qe,200),ue=R(),pe=j([]),fe=j(!1),ve=j([]),Ce=[{render:t=>t.children?B(e,{class:"mr-4px",title:"编辑",onClick:e=>{e.stopPropagation(),Ne(t)}}):null},{render:e=>e.children?B(J,{class:"mr-4px",title:"删除",onClick:t=>{t.stopPropagation(),Ue(e)}}):null}],Le=r((()=>h(_)?.getDefaultFloatEchartOptions()??{})),we=r((()=>({activeData:I.activeData,dataSetList:I.dataSetList,queryList:I.queryList,defaultEchartOptions:h(Le),jnpfUniverRef:_,cellFromDialogValue:I.cellFromDialogValue,activeSheetId:I.jnpfUniverAPI?.getActiveWorkbook()?.getActiveSheet().getSheetId()})));U((()=>I.activeData),(()=>{ce()}),{deep:!0});const Ne=e=>{Ae(H(e,["fullName_title","children"]))},Ue=e=>{q({iconType:"warning",title:Z("common.tipTitle"),content:"确定要删除该数据集吗?",onOk:()=>{I.dataSetList=I.dataSetList.filter((t=>t.jnpfId!==e.jnpfId))}})};function Ie(){Ae()}function Te(){const e=I.dataSetList.map((e=>({...e,disabled:!0,children:e.children?e.children.map((t=>({...t,fullName:e.fullName+"."+t.fullName,id:e.fullName+"."+t.id}))):[]})));ae(!0,{list:I.convertConfig,fieldOptions:e})}function Re(e){I.convertConfig=e}function Ae(e=null){ee(!0,{data:e,list:I.dataSetList})}function De(e){I.dataSetList=e.map((e=>({...e,children:e.children?e.children.map((t=>({...t,jnpfId:e.fullName+"."+t.id,fullName:t.label?`${t.id}（${t.label}）`:t.id}))):[]})))}async function Pe(e,t,a){const l=e[t].imageType,{src:o,source:n}=e[t].option;if(2===n||"BASE64"===l){await Fe(o,t,l||"URL");const e=ve.value.find((e=>e.drawingId===t));a.source=e.url,a.imageSourceType="URL"}else 1===n&&(a.source=o.split(ue.reportApiUrl)[1],a.imageSourceType="URL")}async function Me(e,t,a,l){await Fe(e,t,a);const o=ve.value.find((e=>e.drawingId===t));l.source=o.url,l.imageSourceType="URL"}async function Fe(e,t,a){return new Promise((l=>{pe.value.push({value:e,drawingId:t,imgType:a}),l(ze())}))}async function ze(){if(fe.value||0===pe.value.length)return;fe.value=!0;const e=pe.value.shift();try{let t={imgValue:e.value,imgType:e.imgType};await Y(t).then((t=>{ve.value.push({drawingId:e.drawingId,url:t.data.url})}))}catch(t){X.error(t)}finally{fe.value=!1,ze()}}function Oe(){const e=I.jnpfUniverAPI?.getActiveWorkbook()?.getSheets();return e.map((e=>({id:e.getSheetId(),fullName:e.getSheetName()})))}function We(e,t,a){const l=h(_)?.handleCreateDesignUnit({snapshot:e,floatEcharts:t,floatImages:a});I.jnpfUniverAPI=l?l?.jnpfUniverAPI:null,I.jnpfUniverAPI?.onCommandExecuted((e=>{const{id:t}=e??{};"sheet.command.clear-selection-all"!==t&&"sheet.command.clear-selection-content"!==t||(I.activeData.type="text",I.activeData.cellData.v="",I.activeData.text=be.text,Qe()),"jnpf-sheets.operation.import-excel-file"===t&&function(){const e=document.createElement("input");e.type="file",e.accept=".xlsx,.xls,.csv",e.click(),e.onchange=()=>{const t=e.files?.[0];if(!t)return;const a=new FormData;a.append("file",t),G(a).then((e=>{const t=e.data.snapshot?JSON.parse(e.data.snapshot):null;I.key=+new Date,c((()=>{We(t)}))}))}}(),"sheet.operation.set-worksheet-active"===t&&(I.sheetId=e.params.subUnitId)}))}function Ke(){const e=Oe();oe(!0,{dataSetList:I.dataSetList,queryList:s(I.queryList),sheetList:e})}function Ee(){const e=Oe();se(!0,{dataSetList:I.dataSetList,sortList:s(I.sortList),sheetList:e})}function $e(e){I.queryList=e}function Be(e){I.sortList=e}function Je(e){const t={...e.option,chartType:e.echartType};Ze({drawingId:e.drawingId,type:"chart",custom:t})}function He(e){I.activeData.type="floatImage",I.activeData.floatImage={...e};const t={...e};t.option.source=t.option.source||1,t.option.src&&t.option.src.indexOf(ue.reportApiUrl)>-1&&1==t.option.source&&"URL"==t.imageType&&(t.option.src=t.option.src.split(ue.reportApiUrl)[1]),I.activeData.floatImage=t}function Ye(e){const t=I.jnpfUniverAPI?.getActiveWorkbook()?.getActiveSheet(),a={...e,type:e.cellData?.custom?.type||"text",custom:e.cellData.custom||{},getMaxColumns:t?.getMaxColumns(),getMaxRows:t?.getMaxRows(),getCustomRowNameList:Ge(t?.getMaxColumns())};I.isInitCell=!0,Ze(a)}function Ge(e){let t=[];for(let a=0;a<=e-1;a++){let e=me(a);t.push(e)}return t}function Xe(e){I.cellFromDialogValue=e||""}function Ze(e){const{type:t="text",custom:a={}}=e;I.activeData=e,I.activeData.type=t,I.activeData.text=s("text"===t&&"{}"!==JSON.stringify(a)?a:be.text),I.activeData.chart=s("chart"===t?a:h(Le).bar),I.activeData.parameter=s("parameter"===t?a:be.parameter),I.activeData.dataSource=s("dataSource"===t?a:be.dataSource)}function Qe(){if(I.isInitCell)return I.isInitCell=!1;const e=I.activeData;if(["dataSource","text","parameter"].includes(e.type)){const t={startColumn:e.startColumn,startRow:e.startRow,cellData:{...e.cellData,..."parameter"===e.type?{v:e[e.type].field}:{},..."dataSource"===e.type?{v:e[e.type].field}:{},custom:{...e[e.type],type:e.type}}};h(_)?.updateCellsData([t])}else{if("chart"===e.type){const t=s(e),a=function(e){const t=e.styleType,a=[-5,-20,-36,-10,-10,-20];e.series=e.series.map(((l,o)=>({...l,data:"bar"==e.chartType&&6==t&&1==o?a:l.data,type:e.chartType,...["bar","line"].includes(e.chartType)?{itemStyle:{color:lt(e.color.list,o)}}:{},..."line"===e.chartType?{smooth:2==t,step:3==t,stack:4==t?"total":"",lineStyle:{width:e.line.width},symbolSize:e.line.symbolSize}:{},..."line"===e.chartType&&e.areaStyle?{areaStyle:e.areaStyle}:{},..."bar"===e.chartType?{showBackground:4==t}:"",..."bar"===e.chartType?{stack:5==t?l.name:2==t||6==t?"total":""}:"",..."pie"===e.chartType?{radius:2==t?["30%","60%"]:"50%",center:[e.seriesCenter.seriesCenterLeft+"%",e.seriesCenter.seriesCenterTop+"%"],roseType:e.pie.roseType?"area":"",label:ot(e),color:at(e.color.list),data:nt(e.pie,l.data),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}:{},..."radar"===e.chartType?{color:lt(e.color.list,o),areaStyle:{opacity:e.seriesAreaStyleOpacity}}:{}}))),("bar"===e.chartType||"line"===e.chartType)&&(e.xAxis.type="category"==e.xAxis.type?"category":"value",e.xAxis.nameTextStyle.fontWeight=e.xAxis.nameTextStyle.fontWeight?"bolder":"",e.xAxis.axisLabel.fontWeight=e.xAxis.axisLabel.fontWeight?"bolder":"",e.xAxis.axisLabel.color=e.color.AxisTextStyleColor?e.color.AxisTextStyleColor:e.xAxis.axisLabel.color,e.xAxis.axisLine.show=e.xAxis.show,e.xAxis.axisLine.lineStyle.color=e.color.AxisLineStyleColor?e.color.AxisLineStyleColor:e.xAxis.axisLine.lineStyle.color,e.yAxis.type="category"==e.xAxis.type?"value":"category",e.yAxis.nameTextStyle.fontWeight=e.yAxis.nameTextStyle.fontWeight?"bolder":"",e.yAxis.axisLabel.fontWeight=e.yAxis.axisLabel.fontWeight?"bolder":"",e.yAxis.axisLabel.color=e.color.AxisTextStyleColor?e.color.AxisTextStyleColor:e.yAxis.axisLabel.color,e.yAxis.axisLine.show=e.yAxis.show,e.yAxis.axisLine.lineStyle.color=e.color.AxisLineStyleColor?e.color.AxisLineStyleColor:e.yAxis.axisLine.lineStyle.color,e.label.fontWeight=e.label.fontWeight?"bolder":"","line"===e.chartType&&e.areaStyle&&(e.xAxis.boundaryGap=!1,e.areaStyle={}),e.legend.top=e.legendTop+"%",e.legend.left=e.legendLeft+"%");"radar"===e.chartType&&(e.radar.shape=1==t?"polygon":"circle",e.radar.axisName.fontWeight=e.radar.axisName.fontWeight?"bolder":"normal",e.radar.center=[e.seriesCenter.seriesCenterLeft+"%",e.seriesCenter.seriesCenterTop+"%"]);return e}(t.chart),l={drawingId:t.drawingId,echartType:t.chart.chartType,option:a};h(_)?.updateFloatEchartConfig(l)}if("floatImage"===e.type){const t=s(e.floatImage);1===t.option.source&&"URL"===t.imageType&&t.option.src&&(t.option.src=ue.reportApiUrl+t.option.src),h(_)?.updateFloatImageConfig(t)}}}function et(){x("closeVersionPopover")}function tt(){x("changeModalLoading",!0),P(o.versionId).then((e=>{ie(!0,{id:"",versionId:o.versionId,sheetId:I.sheetId})})).finally((()=>x("changeModalLoading",!1)))}function at(e){let t=[];if(e&&e.length){const a=[];e.map(((t,l)=>{const o=lt(e,l)||"#71B6F5";a.push(o)})),t=a}return t}function lt(e,t){const a=e||[];if(a[t]){const e=a[t].color1,l=a[t].color2;return l&&e?new je(0,0,0,1,[{offset:0,color:e},{offset:1,color:l}]):e}}function ot(e){let t={};t.show=e.label.show,t.position=e.seriesLabelPosition;const a=e.seriesLabelShowInfo;return a&&a.length&&(a.includes("count")&&a.includes("percent")?t.formatter="{b}: {c} ({d}%)":a.includes("count")?t.formatter="{b}: {c} ":a.includes("percent")&&(t.formatter="{b}: ({d}%) ")),t}function nt(e,t){if(e.showZero&&(t=t.filter((e=>0!=e.value))),e.sortable)for(let a=0;a<t.length-1;a++)for(let e=0;e<t.length-1;e++)if(t[e].value>t[e+1].value){let a=t[e];t[e]=t[e+1],t[e+1]=a}return t}return A((()=>{!function(){I.dataSetList=o.dataSetList.map((e=>({...e,jnpfId:e.id,children:e.children?e.children.map((t=>({...t,jnpfId:e.fullName+"."+t.id,fullName:t.label?`${t.id}（${t.label}）`:t.id}))):[]}))),I.convertConfig=o.convertConfig,I.queryList=o.queryList?JSON.parse(o.queryList):[],I.sortList=o.sortList?JSON.parse(o.sortList):[];const e=o.cells?JSON.parse(o.cells):{},t=e.floatEcharts||{};let a=e.floatImages||{};a=xe(a,ue.reportApiUrl);let l=o.snapshot?JSON.parse(o.snapshot):{};if(l.resources?.length){let e=he(l.resources,ue.reportApiUrl);l.resources=e.list}I.key=+new Date,c((()=>{We(l,t,a)}))}()})),a({getData:async()=>new Promise((async e=>{await(h(_)?.setCellEditVisible());const{snapshot:t,floatEcharts:a,customs:l,floatImages:o}=h(_)?.getDesignWorkbookData();let n=await async function(e,t){if(pe.value=[],ve.value=[],!e.length)return;for(let a=0;a<e.length;a++){const l=e[a];if("SHEET_DRAWING_PLUGIN"!=l.name)continue;const o=l.data?JSON.parse(l.data):{};for(const e in o)for(const a in o[e].data){const l=o[e].data[a],{componentKey:n,source:i,imageSourceType:r,drawingId:s}=l;"JnpfUniverFloatEchart"!==n&&(t&&!i?await Pe(t,s,l):i&&"BASE64"===r&&await Me(i,s,r,l),i&&"URL"===r&&(l.source=i.split(ue.reportApiUrl)[1]))}l.data=JSON.stringify(o)}return e}(t.resources,o);t.resources=n;const i=ge(o,ue.reportApiUrl),r={cells:l?.length?l.map((e=>({col:e.col,row:e.row,sheet:e.sheetId,type:e.cellData?.custom?.type,custom:e.cellData?.custom||{}}))):[],floatEcharts:a,floatImages:i};e({dataSetList:I.dataSetList.map((e=>H(e,["fullName_title","children"]))),convertConfig:JSON.stringify(I.convertConfig),queryList:JSON.stringify(I.queryList),sortList:JSON.stringify(I.sortList||[]),snapshot:t?JSON.stringify(t):null,cells:JSON.stringify(r)})})),handleDisposeUnit:()=>{h(_)?.handleDisposeUnit()}}),(e,t)=>{const a=u("a-tab-pane"),l=u("a-tabs"),o=u("a-button"),n=u("a-form-item"),i=u("a-form");return d(),v(g,null,[S("div",{class:k(h(z))},[S("div",mt,[S("div",ft,[S("div",ht,[f(l,{class:"average-tabs",activeKey:h(D),"onUpdate:activeKey":t[0]||(t[0]=e=>y(D)?D.value=e:null),tabBarGutter:12},{default:m((()=>[f(a,{key:"1",tab:"单元属性"}),f(a,{key:"2",tab:"数据源"}),f(a,{key:"3",tab:"报表属性"})])),_:1},8,["activeKey"]),S("div",yt,[K(S("div",null,[I.activeData?(d(),p(rt,$(L({key:0},we.value)),null,16)):C("",!0)],512),[[E,"1"===h(D)]]),K(S("div",vt,[S("div",gt,[f(o,{type:"primary",size:"small",preIcon:"icon-ym icon-ym-btn-add",onClick:Ie},{default:m((()=>t[1]||(t[1]=[b("数据集")]))),_:1,__:[1]}),f(o,{type:"link",size:"small",onClick:Te,class:"!p-0"},{default:m((()=>t[2]||(t[2]=[b("数据转换")]))),_:1,__:[2]})]),S("div",xt,[f(h(_e),{ref_key:"dataSetTreeRef",ref:w,showSearch:!1,treeData:h(M),fieldNames:{key:"jnpfId",title:"fullName"},actionList:Ce},null,8,["treeData"])])],512),[[E,"2"===h(D)]]),K(S("div",bt,[f(i,{colon:!1,layout:"vertical"},{default:m((()=>[f(n,{label:"查询"},{default:m((()=>[f(o,{block:"",onClick:Ke},{default:m((()=>t[3]||(t[3]=[b("查询配置")]))),_:1,__:[3]})])),_:1}),f(n,{label:"排序"},{default:m((()=>[f(o,{block:"",onClick:Ee},{default:m((()=>t[4]||(t[4]=[b("排序配置")]))),_:1,__:[4]})])),_:1})])),_:1})],512),[[E,"3"===h(D)]])])]),S("div",{class:"center-side",onClick:et},[(d(),p(h(ye),{ref_key:"jnpfUniverRef",ref:_,key:h(F),onFocusFloatEchart:Je,onChangeCell:Ye,onFocusFloatImage:He,onChangeDialogSelectCell:Xe,onPreview:tt}))])])])],2),f(h(ke),{onRegister:h(Q),onConfirm:De},null,8,["onRegister"]),f(Se,{onRegister:h(te),onConfirm:Re},null,8,["onRegister"]),f(qe,{onRegister:h(le),onConfirm:$e},null,8,["onRegister"]),f(Ve,{onRegister:h(re),onConfirm:Be},null,8,["onRegister"]),f(pt,{onRegister:h(ne)},null,8,["onRegister"])],64)}}}),kt={class:"jnpf-full-modal-header"},Ct={class:"header-title !w-auto"},St={class:"header-txt"},Lt={class:"w-250px"},wt={class:"version-list"},Nt=["onClick"],Ut={class:"version-name"},It={class:"version-delete"},Tt=["onClick"],Rt={key:1,class:"version-tip ml-0"},At={key:1,class:"reportDesign"},Dt=I(o({__name:"index",emits:["register","reload"],setup(e,{emit:t}){const a=n({dataForm:{},btnLoading:!1,saveBtnLoading:!1,loading:!0,isReload:!1,versionVisible:!1,versionList:[],currentVersion:{},key:0,activeKey:0,allowExport:1,allowPrint:1}),{dataForm:l,btnLoading:o,saveBtnLoading:s,loading:c,versionVisible:w,versionList:U,currentVersion:I,activeKey:R,allowExport:A,allowPrint:D}=i(a),{t:P}=T(),M=j(),{createMessage:z}=N(),q=t,{prefixCls:O}=V("basic-report-designer"),[W,{closeModal:K,changeLoading:E}]=ue((function(e){a.isReload=!1,a.dataForm.id=e.id||"",a.dataForm.fullName=e.fullName||"",a.loading=!0,a.activeKey=0,E(!0),B()})),$=r((()=>({dataSetList:a.dataForm.dataSetList||[],convertConfig:a.dataForm.convertConfig?JSON.parse(a.dataForm.convertConfig):[],versionState:a.currentVersion?.state,snapshot:a.dataForm.snapshot,customs:a.dataForm.customs,queryList:a.dataForm.queryList,cells:a.dataForm.cells,versionId:a.currentVersion?.id,sortList:a.dataForm.sortList,key:a.key})));function B(e=!0){X(a.dataForm.id).then((t=>{a.versionList=t.data||[],e&&(a.currentVersion=a.versionList[0]||{},J())})).catch((()=>{a.loading=!1,E(!1)}))}function J(){a.currentVersion.id&&(E(!0),Z(a.currentVersion.id).then((e=>{a.dataForm={...a.dataForm,...e.data},a.allowExport=e.data.allowExport||0,a.allowPrint=e.data.allowPrint||0,a.loading=!1,E(!1),a.key=+new Date})).catch((()=>{a.loading=!1,E(!1)})))}function H(e){return 0==e?"rgba(247,171,51,0.9)":1==e?"rgba(75, 222, 0, 0.9)":"rgba(152,158,178,0.9)"}function Y(){ae(a.currentVersion.id).then((e=>{const t=e.data;X(a.dataForm.id).then((e=>{if(a.versionList=e.data||[],t){const e=a.versionList.filter((e=>e.id==t));a.currentVersion=e.length?e[0]:a.versionList[0]}J()}))}))}function G(e=0){h(M).getData().then((t=>{const l={...a.dataForm,...t,type:e,allowExport:a.allowExport,allowPrint:a.allowPrint};1==e?a.btnLoading=!0:a.saveBtnLoading=!0,oe(l).then((l=>{z.success(l.msg),a.saveBtnLoading=!1,a.btnLoading=!1,a.isReload=!0,a.dataForm={...a.dataForm,...t},e&&(a.currentVersion.state=1,B(!1))})).catch((()=>{a.saveBtnLoading=!1,a.btnLoading=!1}))})).catch((e=>{e.msg&&z.warning(e.msg)})).finally((()=>{E(!1)}))}function ne(){a.versionVisible=!1}function ie(e){E(e)}return(e,t)=>{const n=u("a-tooltip"),i=u("a-button"),r=u("a-popover"),N=u("a-step"),T=u("a-steps"),j=u("a-space"),V=u("BasicHelp"),E=u("a-switch"),X=u("a-form-item"),Z=u("a-form"),ae=u("a-col"),oe=u("a-row");return d(),p(h(pe),L(e.$attrs,{onRegister:h(W),defaultFullscreen:"",footer:null,closable:!1,keyboard:!1,class:"jnpf-full-modal full-modal designer-modal"}),{title:m((()=>[S("div",kt,[S("div",Ct,[t[10]||(t[10]=S("img",{src:F,class:"header-logo"},null,-1)),t[11]||(t[11]=S("span",{class:"header-dot"},null,-1)),f(n,{title:h(l).fullName},{default:m((()=>[S("p",St,_(h(l).fullName),1)])),_:1},8,["title"]),h(I)?.id?(d(),p(r,{key:0,open:h(w),"onUpdate:open":t[0]||(t[0]=e=>y(w)?w.value=e:null),trigger:"click",placement:"bottom",overlayClassName:"jnpf-version-popover","arrow-point-at-center":"",destroyTooltipOnHide:""},{content:m((()=>[S("div",Lt,[S("div",wt,[(d(!0),v(g,null,x(h(U),(e=>{return d(),v("div",{class:"version-item",onClick:t=>function(e){a.currentVersion.id!=e.id&&(a.versionVisible=!1,a.currentVersion=e,J())}(e)},[S("span",{class:"version-badge",style:Q({background:H(e.state)})},null,4),S("span",Ut,_(e.fullName),1),S("span",{class:"version-state",style:Q({background:H(e.state)})},_((t=e.state,0==t?"设计中":1==t?"启用中":"已归档")),5),S("div",It,[!e.state&&h(U).length>1?(d(),v("i",{key:0,class:"icon-ym icon-ym-app-delete",onClick:ee((t=>{return l=e.id,void le(l).then((e=>{z.success(e.msg),B(a.currentVersion.id===l)}));var l}),["stop"])},null,8,Tt)):C("",!0)])],8,Nt);var t})),256))]),S("div",{class:"add-btn",onClick:Y},[f(i,{type:"link",preIcon:"icon-ym icon-ym-btn-add"},{default:m((()=>t[7]||(t[7]=[b("新增报表版本")]))),_:1,__:[7]})])])])),default:m((()=>[f(i,{type:"text",class:"current-version"},{default:m((()=>[S("span",{class:"version-badge",style:Q({background:H(h(I).state)})},null,4),b(_(h(I)?.fullName)+" ",1),t[8]||(t[8]=S("i",{class:"icon-ym icon-ym-unfold ml-5px font text-10px"},null,-1))])),_:1,__:[8]})])),_:1},8,["open"])):C("",!0),0!=h(I)?.state?(d(),v("div",Rt,[f(h(te),{class:"icon"}),b(" "+_(1==h(I)?.state?"启用中":"已归档")+"的版本不可修改，请 ",1),f(i,{type:"link",class:"px-2px",onClick:Y},{default:m((()=>t[9]||(t[9]=[b("添加新版本")]))),_:1,__:[9]})])):C("",!0)]),f(T,{current:h(R),"onUpdate:current":t[1]||(t[1]=e=>y(R)?R.value=e:null),type:"navigation",size:"small",class:"header-steps tab-steps"},{default:m((()=>[f(N,{title:"报表建模"}),f(N,{title:"报表设置"})])),_:1},8,["current"]),f(j,{class:"options",size:10},{default:m((()=>[1!==h(I)?.state?(d(),p(i,{key:0,shape:"round",type:"primary",onClick:t[2]||(t[2]=e=>G(1)),loading:h(o),disabled:h(s)},{default:m((()=>[b(_(2==h(I)?.state?"启用":"发布"),1)])),_:1},8,["loading","disabled"])):C("",!0),h(I)?.state?C("",!0):(d(),p(i,{key:1,shape:"round",type:"primary",onClick:t[3]||(t[3]=e=>G()),loading:h(s),disabled:h(o)},{default:m((()=>[b(_(h(P)("common.saveText")),1)])),_:1},8,["loading","disabled"])),f(i,{shape:"round",onClick:t[4]||(t[4]=e=>async function(){K(),h(M)?.handleDisposeUnit(),a.isReload&&q("reload")}())},{default:m((()=>[b(_(h(P)("common.closeText")),1)])),_:1})])),_:1})])])),default:m((()=>[S("div",{class:k(["h-full",`${h(O)}`])},[h(c)?C("",!0):(d(),p(_t,L({key:0,ref_key:"reportDesign",ref:M},$.value,{onCloseVersionPopover:ne,onChangeModalLoading:ie}),null,16)),1==h(R)?(d(),v("div",At,[f(oe,{type:"flex",justify:"center",align:"middle",class:"h-full"},{default:m((()=>[f(ae,{span:12,xxl:10,class:"configuration-contain"},{default:m((()=>[f(Z,{model:h(l),colon:!1},{default:m((()=>[f(X,null,{label:m((()=>[t[12]||(t[12]=b("允许导出")),f(V,{text:"禁用后，【设计预览】和【发布到菜单中的报表】导出按钮不显示"})])),default:m((()=>[f(E,{checked:h(A),"onUpdate:checked":t[5]||(t[5]=e=>y(A)?A.value=e:null),checkedValue:1,unCheckedValue:0},null,8,["checked"])])),_:1}),f(X,null,{label:m((()=>[t[13]||(t[13]=b("允许打印")),f(V,{text:"禁用后，【设计预览】和【发布到菜单中的报表】打印按钮不显示"})])),default:m((()=>[f(E,{checked:h(D),"onUpdate:checked":t[6]||(t[6]=e=>y(D)?D.value=e:null),checkedValue:1,unCheckedValue:0},null,8,["checked"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])):C("",!0)],2)])),_:1},16,["onRegister"])}}}),[["__scopeId","data-v-ab412ce5"]]),jt={class:"jnpf-content-wrapper"},Pt={class:"jnpf-content-wrapper-center"},Mt={class:"jnpf-content-wrapper-content"},Ft=o({name:"onlineDev-report",__name:"index",setup(e){const{t:o}=T(),n=ne(),{createMessage:i}=N(),r=j([]),[s,{reload:c,getForm:y}]=t({api:ie,columns:[{title:"名称",dataIndex:"fullName"},{title:"编码",dataIndex:"enCode",width:200},{title:"分类",dataIndex:"category",width:150},{title:"创建人",dataIndex:"creatorUser",width:120},{title:"创建时间",dataIndex:"creatorTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"最后修改时间",dataIndex:"lastModifyTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"排序",dataIndex:"sortCode",width:70,align:"center"},{title:"状态",dataIndex:"state",width:80,align:"center"}],useSearchForm:!0,formConfig:{schemas:[{field:"keyword",label:o("common.keyword"),component:"Input",componentProps:{placeholder:o("common.enterKeyword"),submitOnPressEnter:!0}},{field:"category",label:"分类",component:"Select",componentProps:{placeholder:"请选择"}},{field:"state",label:"状态",component:"Select",componentProps:{placeholder:"请选择",options:[{fullName:"未发布",id:0},{fullName:"已发布",id:1}]}}]},actionColumn:{width:220,title:"操作",dataIndex:"action"}}),[g,{openModal:x}]=de(),[k,{openModal:L}]=de(),[w,{openModal:U}]=de(),[I,{openModal:R}]=de();function D(e){return[{label:o("common.editText"),onClick:M.bind(null,e.id)},{label:"设计",color:"error",onClick:V.bind(null,e)},{label:"生成菜单",disabled:!e.state,onClick:K.bind(null,e)}]}function P(e){return[{label:o("common.previewText"),ifShow:!!e.state,onClick:W.bind(null,e.id)},{label:o("common.copyText"),ifShow:!!e.state,modelConfirm:{content:"您确定要复制该模板, 是否继续?",onOk:z.bind(null,e.id)}},{label:o("common.exportText"),ifShow:!!e.state,modelConfirm:{content:"您确定要导出该模板, 是否继续?",onOk:F.bind(null,e.id)}},{label:o("common.delText"),color:"error",modelConfirm:{onOk:O.bind(null,e.id)}}]}function M(e=""){x(!0,{id:e,categoryList:r.value})}function F(e){re(e).then((e=>{q({url:e.data.url})}))}function z(e){se(e).then((e=>{i.success(e.msg),c()}))}function O(e){ce(e).then((e=>{i.success(e.msg),c()}))}function V(e){L(!0,e)}function W(e){U(!0,{id:e})}function K(e){R(!0,e)}return A((()=>{!async function(){r.value=await n.getDictionaryData("businessType"),y().updateSchema({field:"category",componentProps:{options:r.value}})}()})),(e,t)=>{const n=u("a-button"),i=u("jnpf-upload-btn"),r=u("a-tag");return d(),v("div",jt,[S("div",Pt,[S("div",Mt,[f(h(a),{onRegister:h(s)},{tableTitle:m((()=>[f(n,{type:"primary",preIcon:"icon-ym icon-ym-btn-add",onClick:t[0]||(t[0]=e=>M())},{default:m((()=>[b(_(h(o)("common.addText")),1)])),_:1}),f(i,{url:"/api/Report/Actions/Import",accept:".rp",onOnSuccess:h(c),type:"report"},null,8,["onOnSuccess"])])),bodyCell:m((({column:e,record:t})=>["state"===e.key?(d(),p(r,{key:0,color:1==t.enabledMark?"success":""},{default:m((()=>[b(_(1==t.enabledMark?"已发布":"未发布"),1)])),_:2},1032,["color"])):C("",!0),"action"===e.key?(d(),p(h(l),{key:1,actions:D(t),dropDownActions:P(t)},null,8,["actions","dropDownActions"])):C("",!0)])),_:1},8,["onRegister"])])]),f(Pe,{onRegister:h(g),onReload:h(c),onDesign:V},null,8,["onRegister","onReload"]),f(h(Dt),{onRegister:h(k),onReload:h(c)},null,8,["onRegister","onReload"]),f(h(pt),{onRegister:h(w)},null,8,["onRegister"]),f(Me,{onRegister:h(I)},null,8,["onRegister"])])}}});export{Ft as default};
