import{b as e,B as a}from"./index-143f5813.js";import{e as l,f as s}from"./authorize-72eaa3a6.js";import{i as t}from"./permissionGroup-129512c4.js";import{d as n,u,r as o,ad as r,c3 as i,w as d,n as v,c,e as f,o as p,p as m,l as h,a4 as _,j as g,k as y,e1 as k,t as b,ab as j,g as w,F as C,h as x,dF as F,q as N,V as A,ah as I}from"./index-920db443.js";const R={class:"transfer__body"},S={class:"transfer-pane"},M={class:"transfer-pane__tool"},O={class:"transfer-pane__body transfer-pane__body-tab"},B={class:"transfer-pane right-pane"},D={class:"transfer-pane__tool"},E={class:"transfer-pane__body"},V=["title"],q=n({name:"JnpfFlowAuthSelect",inheritAttrs:!1,__name:"AuthModal",setup(n){const{createMessage:q}=I(),{t:z}=u(),G=o(null),J=o([]),K=o(""),U=o(""),$=o(""),H=o([]),L=o([]),P=o([]),Q=o(!1),T=o([]),W=o([]),X=r({key:"onlyId",title:"fullName"}),Y=i.useInjectFormItemContext(),[Z,{closeModal:ee}]=e((function(e){U.value=e.id,$.value=e.systemId,T.value=[],K.value="",U.value&&(Q.value=!0,l(U.value).then((e=>{W.value=e.data.list,v((()=>async function(){Q.value=!0,t().then((e=>{H.value=e.data.list||[],H.value.map((e=>{W.value.includes(e.id)&&T.value.push(e)})),Q.value=!1}))}())),Q.value=!1})))}));function ae(){if(!W.value||!W.value.length)return J.value=[],P.value=[],void(T.value=[]);const e=W.value;let a=[];for(let l=0;l<e.length;l++)e:for(let s=0;s<L.value.length;s++)if(e[l]===L.value[s].id){a.push(L.value[s]);break e}J.value=a.map((e=>e.id)),P.value=c(a),T.value=c(a)}function le(e){(function(){const e=y(G);if(!e)throw new Error("tree is null!");return e})().setSearchValue(e)}function se(e,{node:a}){if(!e.length)return;T.value.some((e=>e.id===a.id))||T.value.push(a.dataRef)}function te(){T.value=[]}function ne(){const e=y(T).map((e=>e.id));P.value=y(T),J.value=e;let a={ids:e};s(U.value,a).then((e=>{q.success(e.msg),Y.onFieldChange(),ee()}))}return d((()=>W.value),(()=>{ae()}),{immediate:!0}),d((()=>L.value),(()=>{ae()}),{deep:!0}),(e,l)=>{const s=f("a-input-search"),t=f("jnpf-empty");return p(),m(y(a),A(e.$attrs,{onRegister:y(Z),width:800,class:"transfer-modal",title:"选择权限组",showOkBtn:"",onOk:ne,destroyOnClose:""}),{default:h((()=>[_("div",R,[_("div",S,[_("div",M,[g(s,{placeholder:y(z)("common.enterKeyword"),allowClear:"",value:K.value,"onUpdate:value":l[0]||(l[0]=e=>K.value=e),onSearch:le},null,8,["placeholder","value"])]),_("div",O,[g(y(k),{class:"tree-main",treeData:H.value,fieldNames:X,onSelect:se,ref_key:"treeRef",ref:G,defaultExpandAll:"",loading:Q.value},null,8,["treeData","fieldNames","loading"])])]),_("div",B,[_("div",D,[_("span",null,b(y(z)("component.jnpf.common.selected")),1),_("span",{class:"remove-all-btn",onClick:te},"清空列表")]),_("div",E,[g(y(j),null,{default:h((()=>[(p(!0),w(C,null,x(T.value,((e,a)=>(p(),w("div",{key:a,class:"selected-item"},[_("span",{title:e.fullName},b(e.fullName),9,V),g(y(F),{class:"delete-btn",onClick:e=>{return l=a,void T.value.splice(l,1);var l}},null,8,["onClick"])])))),128)),T.value.length?N("",!0):(p(),m(t,{key:0}))])),_:1})])])])])),_:1},16,["onRegister"])}}});export{q as _};
