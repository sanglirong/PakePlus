import{t,e as a}from"./portal-935b0b1b.js";import{_ as e}from"./index-b34d9508.js";import{i as o,r as i}from"./index-fea1d737.js";import{d as r,ad as n,aY as l,r as s,s as p,e5 as c,w as u,n as h,dn as d,ci as m,aE as g,a7 as f,e as v,o as y,p as D,aR as x,l as S,j as b,a4 as T,k as C,g as w,F as M,h as O,am as z,t as A,q as J,a5 as L}from"./index-920db443.js";import{H as k}from"./dataMap-47db3937.js";import{a as F,B as N}from"./index-5aed445a.js";import"./upperFirst-2cd1a2f7.js";const I={class:"portal-card-body h-full"},B=L(r({__name:"index",props:["activeData"],setup(r){const L=n({chart:null,currMapCode:null,geoJson:null,code:"",currOption:{},allAtlasList:[],zoom:1,timeTicket:null,isEmpty:!1,chartData:[],mapData:[],count:0,hashMap:new Map,showBarTitle:!1,chartMapData:[]}),B=l(X,200),W=l(H,200),_=l(X,500),R=s(),j=r,G=p("emitter"),E=c();function P(){const a=j.activeData.option,e=Array.isArray(a.mapType)?a.mapType[a.mapType.length-1]:a.mapType;e&&(L.chart?.dispose(),L.chart=null,L.chart=o(R.value),L.chart.showLoading(),L.currMapCode=e,t({code:e}).then((o=>{L.chart.hideLoading(),L.geoJson=o.data,L.code=e,$(),i(e,L.geoJson),L.chart.setOption(L.currOption,!0),q(),H(),a.autoCarousel&&Q(),K(),L.chart.on("click",(e=>{if(!a.drillDown)return V(e);if(!L.allAtlasList.length)return;const o=L.allAtlasList.find((t=>t.fullName===e.name));if(o){if(L.currMapCode==o.enCode)return V(e);L.currMapCode=o.enCode,t({code:o.enCode}).then((t=>{L.code=o.enCode,$(),i(o.enCode,t.data),L.chart.setOption(L.currOption,!0),q(),H(),L.zoom+=1,U(e.name,o.enCode,t.data)}))}})),L.chart.on("mouseover",(t=>{a.autoCarousel&&(clearInterval(L.timeTicket),L.chart.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:t.dataIndex}))})),L.chart.on("mouseout",(()=>{a.autoCarousel&&Q()})),L.chart.on("georoam",(()=>{W()}))})))}function V(t){if(!j.activeData.option?.urlAddress)return;let a=JSON.parse(JSON.stringify(j.activeData.option.urlAddress));a=a.replace(/\${[^{}]+}/g,(a=>{const e=a.slice(2,-1);let o="";return"name"===e&&(o=t.name),t.value?("value"===e&&(o=t.value[2]),"long"===e&&(o=t.value[0]),"lat"===e&&(o=t.value[1]),o||a):o})),"_self"==j.activeData.option.target?E(`/externalLink?href=${encodeURIComponent(g(a))}`):window.open(a,j.activeData.option.target)}function X(){L.geoJson&&(L.isEmpty="{}"===JSON.stringify(L.currOption),L.isEmpty||($(),i(L.code,L.geoJson),L.chart.setOption(L.currOption,!0),q(),H(),j.activeData.option.autoCarousel&&Q()))}function Y(t){let a=JSON.parse(JSON.stringify(t))||[];if(!j.activeData.mappingConfig||"static"===j.activeData.dataType)return a;let e=j.activeData.mappingConfig[0].value?j.activeData.mappingConfig[0].value:"name",o=j.activeData.mappingConfig[1].value?j.activeData.mappingConfig[1].value:"value",i=j.activeData.mappingConfig[2].value?j.activeData.mappingConfig[2].value:"long",r=j.activeData.mappingConfig[3].value?j.activeData.mappingConfig[3].value:"lat";return a.map((t=>({name:t[e],value:t[o],long:t[i],lat:t[r]})))}function $(){const t=j.activeData.option;let a={show:t.titleText||t.titleSubtext,text:t.titleText,textStyle:{color:t.titleTextStyleColor,fontSize:t.titleTextStyleFontSize,fontWeight:t.titleTextStyleFontWeight?"bolder":""},subtext:t.titleSubtext,subtextStyle:{color:t.titleSubtextStyleColor,fontSize:t.titleSubtextStyleFontSize,fontWeight:t.titleSubtextStyleFontWeight?"bolder":""},left:t.titleLeft,backgroundColor:(t.titleText||t.titleSubtext)&&t.titleBgColor||"#fff"},e={show:t.tooltipShow,backgroundColor:t.tooltipBgColor,textStyle:{color:t.tooltipTextStyleColor,fontSize:t.tooltipTextStyleFontSize,fontWeight:t.tooltipTextStyleFontWeight?"bolder":""}},o={id:"china",map:L.code,show:!0,roam:t.geoRoam,aspectScale:t.geoAspectScale||.75,layoutCenter:[t.seriesCenterLeft+"%",t.seriesCenterTop+"%"],layoutSize:"85%",itemStyle:{areaColor:t.geoAreaColor,borderWidth:t.geoBorderWidth/2,borderColor:t.geoBorderColor,shadowOffsetX:t.geoShadowOffset,shadowOffsetY:t.geoShadowOffset,shadowColor:t.geoShadowColor},zoom:t.mspScale,label:{show:t.geoLabelShow,color:t.geoLabelColor,fontWeight:t.geoLabelFontWeight?"bolder":"normal",fontSize:t.geoLabelFontSize}},i={min:t.visualMapMin,max:t.visualMapMax,type:t.visualMapType,showLabel:!0,realtime:!1,calculable:!0,inRange:{color:["#3BD9FF","#0246FF"]}};L.currOption={title:a,tooltip:e,geo:o,visualMap:i}}function q(){const t=j.activeData.option;3!=t.styleType&&(L.mapData=[],L.chartData&&L.chartData.length&&L.chartData.map((t=>{const a=L.chart.convertToPixel("geo",[t.long,t.lat])||[];L.chart.containPixel("geo",a)&&L.mapData.push({name:t.name,value:[t.long,t.lat,t.value]})})),null==t.showNumber?L.mapData=L.mapData:L.mapData=L.mapData.slice(0,t.showNumber),L.currOption.series=[{type:1==t.styleType||4==t.styleType?t.seriesType:"heatmap",rippleEffect:{brushType:"stroke"},coordinateSystem:"geo",itemStyle:{color:"#1890FF",opacity:t.seriesItemStyleOpacity},pointSize:t.seriesPointSize,blurSize:t.seriesBlurSize,maxOpacity:t.seriesMaxOpacity,tooltip:{show:t.tooltipShow,formatter:function(t){if(t.value.length<3)return t.name;return t.name+"&nbsp&nbsp"+t.value[2]}},symbolSize:a=>{if(t.visualMapMax){let e=Number(t.visualMapMax);return Number(a[2])/e*15}return 10},clip:!0,data:L.mapData}],function(){const t=j.activeData.option;if(4!=t.styleType)return;let a=[];if(j.activeData.mappingConfig&&"static"!==j.activeData.dataType){let t=j.activeData.mappingConfig[0].value?j.activeData.mappingConfig[0].value:"name";a=[[j.activeData.mappingConfig[1].value?j.activeData.mappingConfig[1].value:"value",t]]}else a=[["value","name"]];let e=L.chartData;t.showNumber&&(e=e.slice(0,t.showNumber));for(var o=e.sort((function(t,a){return a.value-t.value})),i=0;i<o.length;i++){const t=o[i];a.push([t.value,t.name])}L.currOption.grid={right:t.berGridRight,top:t.berGridTop,bottom:t.berGridBottom,width:"200"},L.currOption.xAxis={name:"value",show:!1},L.currOption.yAxis={type:"category",inverse:!0,nameGap:16,axisLine:{show:!1,lineStyle:{color:"#303133"}},axisTick:{show:!1},axisLabel:{interval:0,margin:10,textStyle:{fontSize:14}}};let r={name:"柱状图",type:"bar",roam:!1,zlevel:2,barGap:0,encode:{x:"value",y:"name"},label:{normal:{show:!0,position:"right",textBorderWidth:0}},itemStyle:{normal:{borderRadius:2}}};L.currOption.dataset={source:a},L.currOption.visualMap.dimension=0,L.currOption.series.push(r),L.showBarTitle=!0}(),L.chart.setOption(L.currOption),L.timeTicket&&clearInterval(L.timeTicket))}function H(){const t=j.activeData.option;if(3!=t.styleType)return;const a=L.chartData;a&&a.length&&a.map(((a,e)=>{if(!a.long||!a.lat)return;var o=L.chart.convertToPixel("geo",[a.long,a.lat])||[];if(L.chart.containPixel("geo",o)){var i={xAxis:[],yAxis:[],grid:[],series:[],tooltip:{trigger:"item",axisPointer:{type:"none"}}};i.xAxis.push({id:e,gridId:e,show:!1,splitLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},data:[a.name],z:100}),i.yAxis.push({id:e,gridId:e,show:!1,splitLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},z:100}),i.grid.push({id:e,width:t.seriesBarWidth,height:70,left:o&&o[0],top:o&&o[1]-70,z:100}),i.series.push({id:e,type:"bar",xAxisId:e,yAxisId:e,barGap:0,barCategoryGap:0,data:[a.value],z:100,itemStyle:{normal:{borderRadius:t.seriesItemStyleBarBorderRadius,label:{show:!0,position:"insideBottom",textStyle:{color:"#fff",fontSize:10}}}}}),L.chart.setOption(i)}}))}function U(t,a,e){L.hashMap.set(1,function(){const t=j.activeData.option,a=Array.isArray(t.mapType)?t.mapType[t.mapType.length-1]:t.mapType,e=L.allAtlasList.find((t=>t.enCode===a));return e?{name:e.fullName,value:e.enCode,geoJson:L.geoJson}:{name:"中国",value:"10000",geoJson:L.geoJson}}()),L.hashMap.set(L.zoom,{name:t,value:a,geoJson:e}),L.hashMap.forEach(((t,a)=>{a>L.zoom&&L.hashMap.delete(a)})),L.hashMap.delete(L.zoom+1),L.hashMap=new Map(L.hashMap)}function K(){L.hashMap.clear(),L.hashMap.set(1,{name:"中国",value:"10000",geoJson:L.geoJson}),L.hashMap=new Map(L.hashMap)}function Q(){clearInterval(L.timeTicket),L.timeTicket=setInterval((()=>{let t=L.mapData.length,a=L.count%t;L.chart.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:a}),L.count+=1}),j.activeData.option.autoCarouselTime||3e3)}function Z(){const t=j.activeData.option;if("dynamic"===j.activeData.dataType){if(!j.activeData.propsApi)return P();const t={paramList:d(j.activeData.templateJson)};m(j.activeData.propsApi,t).then((t=>{L.chartMapData=JSON.parse(JSON.stringify(t.data)),L.chartData=Y(t.data),P()}))}else setTimeout((()=>{L.chartData=t.defaultValue,P()}),0);G.on("eChart"+j.activeData.i,(()=>{h((()=>{L.chart?.resize(),h((()=>{H()}))}))})),L.allAtlasList=[],a().then((t=>{const a=t=>{if(Array.isArray(t))for(let e=0;e<t.length;e++){const o=t[e];L.allAtlasList.push(o),o.children&&o.children.length&&a(o.children)}};a(t.data)}))}return u((()=>j.activeData.option),(()=>{h((()=>{K(),B()}))}),{deep:!0}),u((()=>j.activeData.option.defaultValue),(t=>{setTimeout((()=>{L.chartData=t,_()}),0)})),u((()=>j.activeData.option.updateMapType),(()=>{const t=j.activeData.option,a=Array.isArray(t.mapType)?t.mapType[t.mapType.length-1]:t.mapType;L.currMapCode!=a&&P()})),u((()=>j.activeData.dataType),(t=>{const a=j.activeData.option;a.defaultValue=[],L.chartData=[],"static"==t&&(a.defaultValue=k)})),u((()=>j.activeData.propsApi),(t=>{if("static"===j.activeData.dataType||!t)return;const a={paramList:d(j.activeData.templateJson)};m(t,a).then((t=>{L.chartMapData=JSON.parse(JSON.stringify(t.data)),L.chartData=Y(t.data),_()}))})),u((()=>j.activeData.mappingConfig),(()=>{L.chartData=Y(L.chartMapData),_()}),{deep:!0}),f((()=>Z())),(t,a)=>{const o=v("a-card");return y(),D(o,{class:"portal-card-box"},x({default:S((()=>[T("div",I,[L.hashMap.size>1?(y(),D(C(F),{key:0,class:"breadcrumb"},{separator:S((()=>a[0]||(a[0]=[T("i",{class:"icon-ym icon-ym-right text-14px"},null,-1)]))),default:S((()=>[(y(!0),w(M,null,O(L.hashMap,(([t,a])=>(y(),D(C(N),{key:t,onClick:e=>function(t,{name:a,value:e,geoJson:o}){e!=L.currMapCode&&(L.code=e,L.currMapCode="",1==t?(L.geoJson?X():P(),K()):($(),i(L.code,o),L.chart.setOption(L.currOption,!0),L.zoom=t,U(a,e,o)))}(t,a)},{default:S((()=>[T("span",{style:z({color:r.activeData.option.drillDownColor,"font-size":r.activeData.option.drillDownFontSize+"px","font-weight":r.activeData.option.drillDownFontWeight?"bolder":"normal"})},A(a.name),5)])),_:2},1032,["onClick"])))),128))])),_:1})):J("",!0),T("div",{ref_key:"chartRef",ref:R,class:"h-full w-full box-inherit p-10px",style:z({background:r.activeData.option.bgColor})},null,4),4==r.activeData.option.styleType&&L.showBarTitle?(y(),w("div",{key:1,class:"bar-title-text",style:z({color:r.activeData.option.barTitleTextStyleColor,"font-size":r.activeData.option.barTitleTextStyleFontSize+"px","font-weight":r.activeData.option.barTitleTextStyleFontWeight?"bolder":"normal"})},A(r.activeData.option.barTitleText),5)):J("",!0)])])),_:2},[r.activeData.title?{name:"title",fn:S((()=>[b(e,{title:r.activeData.title,card:r.activeData.card},null,8,["title","card"])])),key:"0"}:void 0]),1024)}}}),[["__scopeId","data-v-df629371"]]);export{B as default};
