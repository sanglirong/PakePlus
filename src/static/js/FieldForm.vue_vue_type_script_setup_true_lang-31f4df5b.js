import{b as e,B as a}from"./index-143f5813.js";import{u as l,B as t}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{d as r,u as i,ad as o,M as d,eg as s,o as u,p as n,l as m,j as p,k as c,V as f,n as g}from"./index-920db443.js";const b=r({__name:"FieldForm",props:{type:{type:Number,default:0}},emits:["register","reload"],setup(r,{emit:b}){const h=b,{t:v}=i(),y=r,P=o({list:[],type:"add",dataForm:{id:"",defaultValue:"",field:"",dataType:"",required:0,fieldName:""}}),V=[{field:"field",label:"参数名称",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:(e,a)=>{let l=!0;if(!/(^([A-Za-z]?)*$)|(^[A-Za-z](_?[A-Za-z0-9])*_?$)/.test(a))return Promise.reject("只能以字母开头且仅包含字母、数字、下划线");for(let t=0;t<P.list.length;t++)if(a===P.list[t].field&&P.dataForm.id!==P.list[t].id){l=!1;break}return l?Promise.resolve():Promise.reject("参数名称重复")},trigger:"blur"}]},{field:"dataType",label:"参数类型",component:"Select",componentProps:{placeholder:"请选择",options:[{fullName:"字符串",id:"varchar"},{fullName:"整型",id:"int"},{fullName:"日期时间",id:"datetime"},{fullName:"浮点",id:"decimal"}],onChange:function(){j({defaultValue:""})}},defaultValue:"varchar",rules:[{required:!0,trigger:"blur",message:"必填"}]},{ifShow:({values:e})=>"varchar"==e.dataType,field:"defaultValue",label:"默认值",defaultValue:"",component:"Input",componentProps:{placeholder:"请输入"},dynamicRules:({values:e})=>0==e.required?[]:[{required:!0,trigger:"blur",message:"必填"}]},{ifShow:({values:e})=>["int","decimal"].includes(e.dataType),field:"defaultValue",label:"默认值",defaultValue:"",component:"InputNumber",componentProps:{placeholder:"请输入"},dynamicRules:({values:e})=>0==e.required?[]:[{required:!0,trigger:"blur",message:"必填"}]},{ifShow:({values:e})=>"datetime"==e.dataType,field:"defaultValue",label:"默认值",defaultValue:"",component:"DatePicker",componentProps:{placeholder:"请选择",format:"YYYY-MM-DD HH:mm:ss"},dynamicRules:({values:e})=>0==e.required?[]:[{required:!0,trigger:"blur",message:"必填"}]},{field:"required",label:"必填",defaultValue:0,component:"Switch",componentProps:{onChange:function(e){g((()=>R("defaultValue")))}}},{field:"fieldName",label:"参数说明",defaultValue:"",component:"Input",componentProps:{placeholder:"请输入"}}],q=[{field:"field",label:"字段名称",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:(e,a)=>{let l=!0;for(let t=0;t<P.list.length;t++)if(a===P.list[t].field&&P.dataForm.id!==P.list[t].id){l=!1;break}return l?Promise.resolve():Promise.reject("字段名称重复")},trigger:"blur"}]},{field:"defaultValue",label:"映射字段",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:(e,a)=>{let l=!0;for(let t=0;t<P.list.length;t++)if(a===P.list[t].defaultValue&&P.dataForm.id!==P.list[t].id){l=!1;break}return l?Promise.resolve():Promise.reject("映射字段重复")},trigger:"blur"}]}],[F,{setFieldsValue:j,resetFields:N,clearValidate:R,validate:T,updateSchema:k}]=l({labelWidth:80,schemas:0===y.type?V:q}),[w,{closeModal:x}]=e((function(e){N(),R(),P.list=e.list,e.item?(P.dataForm=e.item,P.type="edit",j(e.item)):(P.dataForm.id=s(),P.type="add")})),I=d((()=>"add"===P.type?v("common.addText"):v("common.editText")));async function S(){const e=await T();e&&(h("reload",P.type,{id:P.dataForm.id,...e}),x())}return(e,l)=>(u(),n(c(a),f(e.$attrs,{onRegister:c(w),title:I.value,onOk:S}),{default:m((()=>[p(c(t),{onRegister:c(F)},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{b as _};
