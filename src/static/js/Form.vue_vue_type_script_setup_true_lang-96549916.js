import{a as e,B as o}from"./index-9c138ba5.js";import{u as s,B as a}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{a as n,u as t,c as l}from"./message-22b8b6a8.js";import{g as i}from"./sendConfig-5e58278e.js";import{d,r,ad as c,aD as p,M as m,k as f,u as g,e as u,o as C,p as I,l as h,j as v,V as N,ah as b}from"./index-920db443.js";import{_ as y}from"./MsgModal.vue_vue_type_script_setup_true_lang-65704aaa.js";const P=d({__name:"Form",emits:["register","reload"],setup(d,{emit:P}){const x=r(""),_=c({sendConfigId:"",sendConfigName:""}),S=p(),U=m((()=>f(x)?M("common.editText"):M("common.addText"))),j=P,{createMessage:w}=b(),{t:M}=g(),[V,{setFieldsValue:D,validate:k,resetFields:F,updateSchema:O,clearValidate:T}]=s({labelWidth:100,schemas:[{field:"title",label:"标题",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"toUserIds",label:"用户",component:"UsersSelect",componentProps:{placeholder:"全部用户",multiple:!0}},{field:"category",label:"类型",component:"Select",defaultValue:"1",componentProps:{placeholder:"请选择",showSearch:!0,fieldNames:{value:"enCode"}},rules:[{required:!0,trigger:"change",message:"必填"}],colProps:{span:12}},{field:"expirationTime",label:"失效时间",helpMessage:"当前时间超过失效时间，状态更新已过期",component:"DatePicker",componentProps:{placeholder:"请选择",format:"YYYY-MM-DD HH:mm:ss"},colProps:{span:12}},{field:"files",label:"附件",component:"UploadFile"},{field:"coverImage",label:"封面图片",helpMessage:"门户公告通知缩略图展示，无设置则系统默认图片",component:"UploadImgSingle"},{field:"bodyText",label:"内容",component:"Editor",defaultValue:""},{field:"excerpt",label:"摘要",component:"Input",defaultValue:"",componentProps:{placeholder:"请输入"}},{field:"remindCategory",label:"提醒方式",component:"Select",defaultValue:1,componentProps:{placeholder:"请选择",options:[{id:1,fullName:"默认"},{id:2,fullName:"自定义"},{id:3,fullName:"不提醒"}],allowClear:!1},rules:[{required:!0,trigger:"change",message:"必填",type:"number"}],colProps:{span:12}},{ifShow:({values:e})=>2===e.remindCategory,field:"sendConfigId",label:"发送配置",component:"Select",slot:"sendConfigId",rules:[{required:!0,trigger:"change",message:"必填"}],colProps:{span:12}}]}),[q,{closePopup:R,changeLoading:Y,changeOkLoading:B}]=e((async function(e){F(),x.value=e.id,_.sendConfigId="",_.sendConfigName="",D({files:[],coverImage:void 0});const o=await S.getDictionaryData("NoticeType");O({field:"category",componentProps:{options:o}}),x.value&&(Y(!0),n(x.value).then((e=>{const o={...e.data,files:e.data.files?JSON.parse(e.data.files):[],toUserIds:e.data.toUserIds?e.data.toUserIds.split(","):[]};_.sendConfigId=o.sendConfigId||"",function(){if(!_.sendConfigId)return;i(_.sendConfigId).then((e=>{_.sendConfigName=e.data.fullName}))}(),D(o),Y(!1)})))}));function H(e,o){if(!e)return _.sendConfigId="",_.sendConfigName="",void D({sendConfigId:_.sendConfigId});_.sendConfigId!==e&&(_.sendConfigId=e,_.sendConfigName=o.fullName,D({sendConfigId:_.sendConfigId}),T("sendConfigId"))}async function J(){const e=await k();if(!e)return;B(!0);const o={...e,id:x.value,files:JSON.stringify(e.files),toUserIds:e.toUserIds?e.toUserIds.join(","):""};(x.value?t:l)(o).then((e=>{w.success(e.msg),B(!1),R(),j("reload")})).catch((()=>{B(!1)}))}return(e,s)=>{const n=u("a-alert");return C(),I(f(o),N(e.$attrs,{onRegister:f(q),title:U.value,showOkBtn:"",onOk:J}),{default:h((()=>[v(n,{message:"提醒方式设置在【消息中心】-【消息发送配置】维护；选择默认则站内信提醒，选择自定义则取自定义模板配置。",type:"warning","show-icon":""}),v(f(a),{onRegister:f(V),class:"!px-10px !mt-10px"},{sendConfigId:h((({model:e,field:o})=>[v(y,{value:e[o],title:_.sendConfigName,placeholder:"请选择",messageSource:"1",onChange:H},null,8,["value","title"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"])}}});export{P as _};
