import{b as e,B as l}from"./index-143f5813.js";import{u as o,B as i}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{g as t,u as n,c as a}from"./dataAuthorize-004cfc95.js";import{d,ad as s,a0 as m,M as r,u,e as c,o as p,p as f,l as y,j as b,k as g,m as N,t as h,q as T,V as S,c as x,ah as M}from"./index-920db443.js";import{g as v}from"./authorize-05422727.js";import{_ as P}from"./FieldModal.vue_vue_type_script_setup_true_lang-f57eee1d.js";const O=d({__name:"FieldForm",emits:["register","reload"],setup(d,{emit:O}){const k=s({moduleId:"",id:"",menuType:0,dataType:0,treeData:[],fieldRuleOptions:[{value:0,label:"主表规则"},{value:1,label:"副表规则"},{value:2,label:"子表规则"}],conditionTextOptions:[],symbolOptions:[]}),{fieldRuleOptions:w,treeData:I,menuType:_,dataType:H}=m(k),C=[{id:"==",fullName:"等于"},{id:"<>",fullName:"不等于"},{id:"like",fullName:"包含"},{id:"notLike",fullName:"不包含"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],R=[{id:">=",fullName:"大于等于"},{id:">",fullName:"大于"},{id:"==",fullName:"等于"},{id:"<=",fullName:"小于等于"},{id:"<",fullName:"小于"},{id:"<>",fullName:"不等于"},{id:"between",fullName:"介于"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],j=[{id:"==",fullName:"等于"},{id:"<>",fullName:"不等于"},{id:"in",fullName:"包含任意一个"},{id:"notIn",fullName:"不包含任意一个"},{id:"null",fullName:"为空"},{id:"notNull",fullName:"不为空"}],q=[{id:"input",fullName:"任意文本"},{id:"@userId",fullName:"当前用户"},{id:"@organizeId",fullName:"当前组织"}],F=[{id:"@userAndSubordinates",fullName:"当前用户及下属"},{id:"@organizationAndSuborganization",fullName:"当前组织及子组织"},{id:"@branchManageOrganize",fullName:"当前分管组织"},{id:"organizeSelect",fullName:"组织选择"},{id:"depSelect",fullName:"部门选择"},{id:"posSelect",fullName:"岗位选择"},{id:"roleSelect",fullName:"角色选择"},{id:"groupSelect",fullName:"分组选择"},{id:"userSelect",fullName:"用户选择"}],z=[{id:"inputNumber",fullName:"数字输入"}],D=[{id:"datePicker",fullName:"日期选择"},{id:"@currentTime",fullName:"当前时间"}],V=[{field:"enCode",label:"字段名称",component:"Input",slot:"enCode",componentProps:{placeholder:"请输入",maxlength:200},rules:[{required:!0,trigger:"change",message:"必填"}]},{ifShow:({values:e})=>e.bindTable,field:"bindTable",label:"数据库表",component:"Input",componentProps:{placeholder:"请输入",disabled:!0}},{field:"fieldRule",label:"字段规则",component:"Select",slot:"fieldRule",defaultValue:0,componentProps:{placeholder:"请选择"},rules:[{required:!0,trigger:"blur",message:"必填",type:"number"}]},{ifShow:({values:e})=>2===e.fieldRule,field:"childTableKey",label:"子表控件名",component:"Input",componentProps:{placeholder:"请输入"},helpMessage:"输入表单设计内设计子表的控件字段名，例：tableField107",rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"fullName",label:"字段说明",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"type",label:"字段类型",component:"Select",componentProps:{placeholder:"请选择",options:[{id:"string",fullName:"string"},{id:"int",fullName:"int"},{id:"double",fullName:"double"},{id:"varchar",fullName:"varchar"},{id:"datetime",fullName:"datetime"},{id:"text",fullName:"text"},{id:"bigint",fullName:"bigint"}],showSearch:!0,allowClear:!1,onChange:function(e){te(e),$({conditionText:"",conditionSymbol:[],format:""}),W(["conditionText","conditionSymbol"]),G([{field:"conditionText",componentProps:{options:k.conditionTextOptions}},{field:"conditionSymbol",componentProps:{options:[]}}])}},rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"conditionText",label:"条件内容",component:"Select",componentProps:{placeholder:"请选择",showSearch:!0,onChange:function(e){ne(Q().type,e),$({conditionSymbol:[]}),W(["conditionSymbol"]),G({field:"conditionSymbol",componentProps:{options:k.symbolOptions}}),$({format:"datePicker"===e?"yyyy-MM-dd HH:mm:ss":""})}},rules:[{required:!0,trigger:"change",message:"必填"}]},{ifShow:({values:e})=>"datePicker"===e.conditionText,field:"format",label:" ",component:"Select",componentProps:{options:[{id:"yyyy",fullName:"yyyy"},{id:"yyyy-MM",fullName:"yyyy-MM"},{id:"yyyy-MM-dd",fullName:"yyyy-MM-dd"},{id:"yyyy-MM-dd HH:mm",fullName:"yyyy-MM-dd HH:mm"},{id:"yyyy-MM-dd HH:mm:ss",fullName:"yyyy-MM-dd HH:mm:ss"}],allowClear:!1}},{field:"conditionSymbol",label:"条件符号",component:"Select",componentProps:{placeholder:"请选择",multiple:!0,showSearch:!0},rules:[{required:!0,trigger:"change",message:"必填",type:"array"}]},{field:"description",label:"备注",component:"Textarea",componentProps:{rows:3}}],B=r((()=>k.id?K("common.editText"):K("common.addText"))),L=O,{createMessage:A}=M(),{t:K}=u(),[U,{setFieldsValue:$,validate:E,resetFields:J,clearValidate:W,updateSchema:G,getFieldsValue:Q}]=o({labelWidth:100,schemas:V}),[X,{closeModal:Y,changeLoading:Z,changeOkLoading:ee}]=e((function(e){J(),k.id=e.id,k.moduleId=e.moduleId,k.menuType=e.type,k.dataType=e.dataType,k.conditionTextOptions=[],k.symbolOptions=[],G([{field:"conditionSymbol",componentProps:{options:[]}},{field:"conditionText",componentProps:{options:[]}}]),Z(!0),v(k.moduleId,3).then((e=>{let l=[];for(const o in e?.data?.linkTables){const i={tableName:e.data.linkTables[o],dbLink:e.data.linkId};l.push(i)}k.treeData=l,Z(!1)})).then((()=>{Z(!1)})),k.id&&(Z(!0),t(k.id).then((e=>{const l=e.data;var o,i;l.conditionSymbol=l.conditionSymbol?l.conditionSymbol.split(","):[],$(l),o=l.type,i=l.conditionText,te(o),ne(o,i),G([{field:"conditionText",componentProps:{options:k.conditionTextOptions}},{field:"conditionSymbol",componentProps:{options:k.symbolOptions}}]),Z(!1)})).then((()=>{Z(!1)})))}));async function le(){const e=await E();if(!e)return;ee(!0);const l={...e,conditionSymbol:e.conditionSymbol.join(),moduleId:k.moduleId,id:k.id};(k.id?n:a)(l).then((e=>{A.success(e.msg),ee(!1),Y(),L("reload")})).catch((()=>{ee(!1)}))}function oe(e,l,o){$({enCode:e||""}),l&&$({bindTable:l}),o&&$({fullName:o}),e&&W()}function ie(){$({childTableKey:""})}function te(e){let l=[];["int","bigint","double"].includes(e)&&(l=z),"datetime"===e&&(l=D),"text"===e&&(l=q),["string","varchar"].includes(e)&&(l=[...q,...F]),k.conditionTextOptions=l}function ne(e,l){if(k.symbolOptions=[],!e||!l)return;let o=[];["inputNumber","datePicker"].includes(l)&&(o=R),"@currentTime"==l&&(o=x(R).filter((e=>"between"!==e.id))),["string","varchar","text"].includes(e)&&q.some((e=>e.id===l))&&(o=C),["string","varchar"].includes(e)&&F.some((e=>e.id===l))&&(o=j),k.symbolOptions=o}return(e,o)=>{const t=c("BasicHelp"),n=c("a-select");return p(),f(g(l),S(e.$attrs,{onRegister:g(X),title:B.value,showOkBtn:"",onOk:le,"destroy-on-close":""}),{default:y((()=>[b(g(i),{onRegister:g(U)},{enCode:y((({model:e,field:l})=>[b(P,{value:e[l],onChange:oe,treeData:g(I),menuType:g(_),dataType:g(H)},null,8,["value","treeData","menuType","dataType"])])),fieldRule:y((({model:e,field:l})=>[b(n,{value:e[l],"onUpdate:value":o=>e[l]=o,options:g(w),placeholder:"请选择字段规则",onChange:ie},{option:y((({value:e,label:l})=>[N(h(l),1),0!=e?(p(),f(t,{key:0,text:`与主表是一对${1==e?"一":"多"}的主从关系`},null,8,["text"])):T("",!0)])),_:2},1032,["value","onUpdate:value","options"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"])}}});export{O as _};
