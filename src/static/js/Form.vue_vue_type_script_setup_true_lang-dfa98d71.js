import{b as e,B as a}from"./index-143f5813.js";import{u as t,B as o}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{a as r,d as n,u as i,c as l}from"./schedule-74da51ff.js";import{d as s,ad as d,a0 as m,a6 as c,aD as p,u,M as f,co as g,k as b,n as h,e as y,o as F,g as D,j as T,aR as v,l as P,m as w,V as S,t as k,a4 as _,ae as C,F as N,h as x,p as Y,aH as L,ah as M}from"./index-920db443.js";import{_ as j}from"./MsgModal.vue_vue_type_script_setup_true_lang-65704aaa.js";import{C as U,x as V,z as q,A as I,B as H,y as O,D as E,E as R}from"./define-8efdf20f.js";const B={class:"mx-50px my-20px"},J={class:"mb-20px"},z=s({__name:"Form",emits:["register","reload"],setup(s,{emit:z}){const A=d({dataForm:{category:0},btnLoading:!1,visible:!1,isEdit:!1,checked:1,repetitionState:!1}),{btnLoading:W,visible:$,isEdit:G,checked:K,dataForm:Q}=m(A),X=c(),Z=p(),{t:ee}=u(),{createMessage:ae,createConfirm:te}=M(),oe=z,[re,{closeModal:ne,changeLoading:ie,changeOkLoading:le}]=e((function(e){if(pe(),A.repetitionState=!1,A.dataForm.id=e.id||"",A.dataForm.send="",A.dataForm.sendName="",async function(){const e=await Z.getDictionaryData("scheduleType");fe([{field:"category",componentProps:{options:e||[]}}]),e?.length&&!A.dataForm.id&&de({category:e[0].id})}(),A.dataForm.id)ie(!0),r(A.dataForm.id).then((e=>{A.dataForm=e.data,A.dataForm.files=e.data.files?JSON.parse(e.data.files):[];const a=A.dataForm.allDay?O:q;fe([{field:"reminderTime",componentProps:{options:a}}]),de(A.dataForm),1!==A.dataForm.repetition&&(A.repetitionState=!0),ie(!1)})).catch((()=>{ie(!1)}));else{let a=g().format("HH");de({duration:e.duration||60,creatorUserId:b(be).userId,toUserIds:[],files:[],startDay:e.startTime,endDay:e.startTime,startTime:Number(a)+1<10?"0"+(Number(a)+1)+":00":Number(a)+1+":00",endTime:Number(a)+2<10?"0"+(Number(a)+2)+":00":Number(a)+2+":00"})}})),[se,{setFieldsValue:de,getFieldsValue:me,clearValidate:ce,resetFields:pe,validate:ue,updateSchema:fe}]=t({labelWidth:100,schemas:[{field:"category",label:"类型",component:"Select",componentProps:{placeholder:"请选择",allowClear:!1},rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"urgent",label:"紧急程度",component:"Select",defaultValue:"1",componentProps:{placeholder:"请选择",options:U,allowClear:!1}},{field:"title",label:"标题",component:"Input",componentProps:{placeholder:"请输入"},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"content",label:"内容",component:"Textarea",componentProps:{placeholder:"请输入",rows:3}},{field:"files",label:"附件",component:"UploadFile"},{field:"allDay",label:"全天",component:"Switch",defaultValue:0,componentProps:{onChange:function(e){if(e){const e=me();de({endDay:e.startDay})}de({reminderTime:""});fe([{field:"reminderTime",componentProps:{options:e?O:q}}]),h((()=>ce("duration")))}}},{field:"startDay",label:"开始时间",component:"DatePicker",componentProps:{placeholder:"请选择",format:"YYYY-MM-DD"},colProps:{span:16},rules:[{required:!0,trigger:"change",message:"必填"}]},{ifShow:({values:e})=>!e.allDay,field:"startTime",label:"",component:"TimePicker",componentProps:{placeholder:"请选择",format:"HH:mm",minuteStep:5},colProps:{span:8}},{ifShow:({values:e})=>-1!==e.duration&&!e.allDay,field:"duration",label:"时长",component:"Select",componentProps:{placeholder:"请选择",options:V,allowClear:!1,onChange:function(){h((()=>{A.dataForm={...A.dataForm,...me()};let e=A.dataForm.startTime.split(":"),a=Number(e[0])+1;24==Number(a)&&(a=0),A.dataForm.endDay=A.dataForm.startDay,A.dataForm.endTime=a<10?"0"+a+":"+e[1]:a+":"+e[1],de({endDay:A.dataForm.endDay,endTime:A.dataForm.endTime,duration:A.dataForm.duration})}))}},rules:[{required:!0,trigger:"change",message:"必填",type:"number"}]},{ifShow:({values:e})=>-1===e.duration||!!e.allDay,field:"endDay",label:"结束时间",component:"DatePicker",componentProps:{placeholder:"请选择",format:"YYYY-MM-DD"},colProps:{span:16},rules:[{required:!0,trigger:"change",validator:(e,a)=>{const t=me();return""===a?Promise.reject("结束时间不能为空"):t.startDay==a&&t.startTime>t.endTime||t.startDay>a?Promise.reject("结束时间必须晚于开始时间"):Promise.resolve()}}]},{ifShow:({values:e})=>-1==e.duration&&!e.allDay,field:"endTime",label:"",component:"TimePicker",componentProps:{placeholder:"请选择",format:"HH:mm",minuteStep:5},colProps:{span:8}},{field:"creatorUserId",label:"创建人",component:"UserSelect",componentProps:{placeholder:"请选择",disabled:!0}},{field:"toUserIds",label:"参与人",component:"UserSelect",componentProps:{placeholder:"请选择",multiple:!0}},{field:"color",label:"标签颜色",component:"ColorPicker",defaultValue:"#188ae2",componentProps:{predefine:["#188ae2","#35b8e0","#26bf8c","#f9c851","#ff5b5b","#5b69bc","#ff8acc","#3b3e47","#282828"]}},{field:"reminderTime",label:"提醒时间",component:"Select",defaultValue:-2,componentProps:{placeholder:"请选择",options:q,allowClear:!1}},{ifShow:({values:e})=>-2!==e.reminderTime,field:"reminderType",label:"提醒方式",component:"Select",defaultValue:1,componentProps:{placeholder:"请选择",options:I,allowClear:!1},rules:[{required:!0,trigger:"change",message:"必填",type:"number"}]},{ifShow:({values:e})=>-2!==e.reminderTime&&2==e.reminderType,field:"send",label:"发送配置",component:"Input",slot:"send",rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"repetition",label:"重复提醒",component:"Select",defaultValue:1,componentProps:{placeholder:"请选择",allowClear:!1,options:H,onChange:function(e){if(1===e)return;let a=new Date;a.setFullYear(a.getFullYear()+1),de({repeatTime:a.getTime()})}}},{ifShow:({values:e})=>1!==e.repetition,field:"repeatTime",label:"结束重复",component:"DatePicker",componentProps:{placeholder:"请选择",format:"YYYY-MM-DD"},rules:[{required:!0,trigger:"change",message:"必填"}]}]}),ge=f((()=>A.dataForm.id?ee("common.editText"):ee("common.addText"))),be=f((()=>X.getUserInfo||{}));function he(e,a){if(e){if(A.dataForm.send===e)return;A.dataForm.send=e,A.dataForm.sendName=a.fullName}else A.dataForm.send="",A.dataForm.sendName="";de({send:A.dataForm.send,sendName:A.dataForm.sendName})}function ye(){if(A.checked=1,A.repetitionState)return A.btnLoading=!1,A.isEdit=!1,void(A.visible=!0);te({iconType:"warning",title:ee("common.tipTitle"),content:"此操作将永久删除此日程，同时删除所有参与人的日程，是否继续？",onOk:()=>{Fe()}})}function Fe(){A.btnLoading=!0;const e=me();if(!A.checked&&1!=e.repetition)return ae.warning("请选择日程");n(A.dataForm.id,1!=e.repetition?A.checked:3).then((e=>{ae.success(e.msg),A.visible=!1,ne(),oe("reload")}))}async function De(e){if(1==e&&!A.checked)return ae.warning("请选择日程");const a=await ue();if(!a)return;if(0==a.allDay){if(!a.startTime)return ae.warning("开始时间不能为空");if(!a.endTime&&-1==a.duration)return ae.warning("结束时间不能为空")}if(-1!=a.duration&&0==a.allDay&&a.startDay==a.endDay&&a.endTime&&-1==a.duration)return ae.warning("结束时间不能为空");if(1!=a.repetition&&a.startDay>a.repeatTime)return ae.warning("结束重复必须晚于开始时间");const t=A.dataForm.id?i:l;a.files=JSON.stringify(a.files);const o={...a,id:A.dataForm.id};A.dataForm.id&&A.repetitionState?A.visible?(A.btnLoading=!0,t(o,A.checked).then((e=>{ae.success(e.msg),A.visible=!1,A.btnLoading=!1,ne(),oe("reload")})).catch((()=>{A.btnLoading=!1}))):(A.checked=1,A.btnLoading=!1,A.isEdit=!0,A.visible=!0):(A.btnLoading=!0,le(!0),t(a,3).then((e=>{ae.success(e.msg),A.visible=!1,A.btnLoading=!1,le(!1),ne(),oe("reload")})).catch((()=>{A.btnLoading=!1,le(!1)})))}return(e,t)=>{const r=y("a-button"),n=y("a-radio"),i=y("a-radio-group");return F(),D(N,null,[T(b(a),S(e.$attrs,{onRegister:b(re),title:ge.value,onOk:De,destroyOnClose:""}),v({default:P((()=>[T(b(o),{onRegister:b(se)},{send:P((({model:e,field:a})=>[T(j,{value:e[a],title:A.dataForm.sendName,messageSource:"4",onChange:he},null,8,["value","title"])])),_:1},8,["onRegister"])])),_:2},[b(Q).id?{name:"insertFooter",fn:P((()=>[T(r,{type:"primary",danger:"",onClick:ye},{default:P((()=>t[4]||(t[4]=[w("删除")]))),_:1,__:[4]})])),key:"0"}:void 0]),1040,["onRegister","title"]),T(b(L),{open:b($),"onUpdate:open":t[3]||(t[3]=e=>C($)?$.value=e:null),width:"380px",title:b(G)?"编辑确认":"删除确认",centered:"",destroyOnClose:""},{footer:P((()=>[T(r,{onClick:t[1]||(t[1]=e=>$.value=!1)},{default:P((()=>[w(k(b(ee)("common.cancelText")),1)])),_:1}),T(r,{type:"primary",loading:b(W),onClick:t[2]||(t[2]=e=>b(G)?De(1):Fe())},{default:P((()=>[w(k(b(ee)("common.okText")),1)])),_:1},8,["loading"])])),default:P((()=>[_("div",B,[_("p",J,k(b(G)?"此为重复日程，将修改应用于":"此为重复日程，将删除（含参与人）应用于"),1),T(i,{value:b(K),"onUpdate:value":t[0]||(t[0]=e=>C(K)?K.value=e:null)},{default:P((()=>[(F(!0),D(N,null,x(b(G)?b(E):b(R),(e=>(F(),Y(n,{value:e.id,class:"!flex !mb-10px"},{default:P((()=>[w(k(e.fullName),1)])),_:2},1032,["value"])))),256))])),_:1},8,["value"])])])),_:1},8,["open","title"])],64)}}});export{z as _};
