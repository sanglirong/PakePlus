import{d as e,u as n,a6 as o,r as t,ad as a,a0 as i,dl as _,M as r,n as f,e as s,o as l,p as c,l as u,j as d,k as g,m,t as p,a4 as I,am as y,q as h,V as C,ah as j,co as k,cp as S}from"./index-920db443.js";import{e as V}from"./visualDev-8f54ab4b.js";import{c as b}from"./createAsyncComponent-7e8f72ac.js";import{a as w,B as x}from"./index-9c138ba5.js";const K=e({__name:"FormPopup",emits:["register"],setup(e){const{createMessage:K}=j(),{t:L}=n(),v=o(),[D,{changeLoading:T}]=w((function(e){T(!0),A.loading=!0,A.config=e,A.formConf=e.formData?JSON.parse(e.formData):{},H(A.formConf,{}),f((()=>{T(!1),A.loading=!1,A.key=+new Date}))})),P=t(null),A=a({formConf:{},config:{},loading:!1,btnLoading:!1,key:+new Date}),{formConf:B,key:O,loading:R,config:z,btnLoading:E}=i(A),M=b((()=>_((()=>import("./Parser-2e1eddb1.js")),["static/js/Parser-2e1eddb1.js","static/js/Parser.vue_vue_type_script_lang-80b37b11.js","static/js/index-920db443.js","static/css/index-648461a4.css","static/js/config-06ca91cd.js","static/js/componentMap-c91676b4.js","static/js/visualDev-8f54ab4b.js","static/js/index.vue_vue_type_script_setup_true_lang-69353133.js","static/js/index-9c138ba5.js","static/js/ArrowLeftOutlined-3fbf15bc.js","static/js/log-2a5f2c26.js","static/css/index-01bda6b6.css","static/js/index-143f5813.js","static/js/useWindowSizeFn-05f906e2.js","static/css/index-e7d3e030.css","static/js/index-999abbee.js","static/css/index-cddfced7.css","static/js/Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js","static/js/Item.vue_vue_type_script_setup_true_lang-fef56f78.js","static/js/Form.vue_vue_type_script_setup_true_lang-63005a4d.js","static/js/createAsyncComponent-7e8f72ac.js","static/js/DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js","static/js/index-0be8277c.js","static/css/DataLogList-12ff8c0e.css","static/js/jquery-6353a699.js","static/js/useDefineSetting-7df030ff.js","static/js/CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js","static/css/index-c2afac83.css","static/js/upperFirst-2cd1a2f7.js","static/css/componentMap-489cc2b1.css"]))),N=r((()=>(A.formConf.confirmButtonTextI18nCode?L(A.formConf.confirmButtonTextI18nCode,A.formConf.confirmButtonText):A.formConf.confirmButtonText)||L("common.okText")));function H(e,n){const o=v.getUserInfo,t=new Date,a=e=>{for(let n=0;n<e.length;n++){let i=e[n];i.__vModel__&&i.__config__.defaultCurrent&&("datePicker"===i.__config__.jnpfKey&&(i.__config__.defaultValue=k(t).startOf(S(i.format)).valueOf()),"timePicker"===i.__config__.jnpfKey&&(i.__config__.defaultValue=k(t).format(i.format||"HH:mm:ss")),"organizeSelect"===i.__config__.jnpfKey&&o.organizeIdList?.length&&(i.__config__.defaultValue=i.multiple?[o.organizeIdList]:o.organizeIdList),"depSelect"===i.__config__.jnpfKey&&o.departmentId&&(i.__config__.defaultValue=i.multiple?[o.departmentId]:o.departmentId),"userSelect"===i.__config__.jnpfKey&&o.userId&&(i.__config__.defaultValue=i.multiple?[o.userId]:o.userId),"usersSelect"===i.__config__.jnpfKey&&o.userId&&(i.__config__.defaultValue=i.multiple?[o.userId+"--user"]:o.userId+"--user"),"posSelect"===i.__config__.jnpfKey&&o.positionIds?.length&&(i.__config__.defaultValue=i.multiple?o.positionIds.map((e=>e.id)):o.positionIds[0].id),"roleSelect"===i.__config__.jnpfKey&&o.roleIds?.length&&(i.__config__.defaultValue=i.multiple?o.roleIds:o.roleIds[0]),"groupSelect"===i.__config__.jnpfKey&&o.groupIds?.length&&(i.__config__.defaultValue=i.multiple?o.groupIds:o.groupIds[0]),"sign"===i.__config__.jnpfKey&&o.signImg&&(i.__config__.defaultValue=o.signImg)),i.__config__&&i.__config__.children&&Array.isArray(i.__config__.children)&&a(i.__config__.children)}};a(e.fields),e.formData=n}function J(e,n){if(!e)return;A.btnLoading=!0;const o={data:JSON.stringify(e)};V(A.config.modelId,o).then((e=>{K.success(e.msg),n&&"function"==typeof n&&n(),A.btnLoading=!1,q()})).catch((()=>{A.btnLoading=!1}))}function q(){H(A.formConf,{}),f((()=>{G().handleReset()}))}function F(){if(A.config.isPreview)return K.warning("功能预览不支持数据保存");G().handleSubmit()}function G(){const e=g(P);if(!e)throw new Error("parser is null!");return e}return(e,n)=>{const o=s("a-button");return l(),c(g(x),C(e.$attrs,{onRegister:g(D),"show-back-icon":!1,"show-cancel-btn":!1,title:g(z).fullName}),{insertToolbar:u((()=>[d(o,{type:"primary",onClick:F,loading:g(E)},{default:u((()=>[m(p(N.value),1)])),_:1},8,["loading"]),d(o,{type:"warning",class:"ml-10px",onClick:q},{default:u((()=>[m(p(g(L)("common.resetText")),1)])),_:1})])),default:u((()=>[I("div",{class:"p-10px",style:y({margin:"0 auto",width:g(B).fullScreenWidth||"100%"})},[g(R)?h("",!0):(l(),c(g(M),{ref_key:"parserRef",ref:P,formConf:g(B),onSubmit:J,key:g(O)},null,8,["formConf"]))],4)])),_:1},16,["onRegister","title"])}}});export{K as _};
