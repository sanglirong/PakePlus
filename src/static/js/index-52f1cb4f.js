import{a as e,d as t,c as a}from"./log-ce7b44c2.js";import{u as n,B as o}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{d as i,u as r,ad as l,a0 as s,M as d,co as c,w as m,n as p,a7 as u,e as f,o as h,g as y,a4 as g,j as w,k as _,l as I,m as x,t as b,af as v,q as T,p as k,ae as j,ah as D}from"./index-920db443.js";import{u as M,B as C}from"./useTable-dc8c9d84.js";import{T as Y}from"./TableAction-adbe36f2.js";import{u as H}from"./index-999abbee.js";import K from"./Detail-33143f1c.js";import"./useTabs-ceeccdba.js";import"./upperFirst-2cd1a2f7.js";import"./log-2a5f2c26.js";import"./uniqBy-e868edd7.js";import"./index-143f5813.js";import"./useWindowSizeFn-05f906e2.js";import"./visualDev-8f54ab4b.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./index-9c138ba5.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./config-06ca91cd.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";const R={class:"jnpf-content-wrapper"},P={class:"jnpf-content-wrapper-center"},A={class:"jnpf-content-wrapper-search-box"},N={class:"jnpf-content-wrapper-content bg-white"},S={key:0,class:"login-type-box"},q=i({name:"system-log",__name:"index",setup(i){const{createMessage:q,createConfirm:E}=D(),{t:F}=r(),O=l({activeKey:"1",searchInfo:{}}),{activeKey:B}=s(O),[L]=n({baseColProps:{span:6},showActionButtonGroup:!0,showAdvancedButton:!0,compact:!0,fieldMapToTime:[["pickerVal",["startTime","endTime"]]]}),U=[{title:"类型",dataIndex:"loginType",width:100},{title:"时间",dataIndex:"creatorTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"用户",dataIndex:"userName",width:120},{title:"IP地址",dataIndex:"ipAddress",width:120},{title:"地点",dataIndex:"ipAddressName",width:120},{title:"浏览器",dataIndex:"browser",width:120},{title:"操作系统",dataIndex:"platForm",width:120},{title:"耗时(毫秒)",dataIndex:"requestDuration",width:90,align:"center"},{title:"状态",dataIndex:"loginMark",width:70,align:"center"},{title:"说明",dataIndex:"abstracts",width:200}],V=[{title:"请求时间",dataIndex:"creatorTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"用户",dataIndex:"userName",width:120},{title:"IP地址",dataIndex:"ipAddress",width:120},{title:"地点",dataIndex:"ipAddressName",width:120},{title:"浏览器",dataIndex:"browser",width:120},{title:"操作系统",dataIndex:"platForm",width:120},{title:"请求方式",dataIndex:"requestMethod",width:80},{title:"耗时(毫秒)",dataIndex:"requestDuration",width:90,align:"center"},{title:"请求地址",dataIndex:"requestUrl",width:200}],G=[{title:"操作时间",dataIndex:"creatorTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"用户",dataIndex:"userName",width:120},{title:"IP地址",dataIndex:"ipAddress",width:160},{title:"地点",dataIndex:"ipAddressName",width:120},{title:"浏览器",dataIndex:"browser",width:120},{title:"操作系统",dataIndex:"platForm",width:120},{title:"操作模块",dataIndex:"moduleName",width:80},{title:"请求方式",dataIndex:"requestMethod",width:80},{title:"耗时(毫秒)",dataIndex:"requestDuration",width:90,align:"center"},{title:"请求地址",dataIndex:"requestUrl",width:200}],W=[{title:"操作时间",dataIndex:"creatorTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"用户",dataIndex:"userName",width:120},{title:"IP地址",dataIndex:"ipAddress",width:160},{title:"地点",dataIndex:"ipAddressName",width:120},{title:"浏览器",dataIndex:"browser",width:120},{title:"操作系统",dataIndex:"platForm",width:120},{title:"请求方式",dataIndex:"requestMethod",width:80},{title:"请求地址",dataIndex:"requestUrl",width:200}],z={api:e,rowSelection:{type:"checkbox"},immediate:!1,clickToRowSelect:!1,clearSelectOnPageChange:!0},J={width:60,title:"操作",dataIndex:"action"},[Q,{reload:X,getSelectRows:Z,redoHeight:$}]=M(z),[ee,{reload:te,getSelectRows:ae}]=M({...z,actionColumn:J}),[ne,{reload:oe,getSelectRows:ie}]=M({...z,actionColumn:J}),[re,{reload:le,getSelectRows:se}]=M({...z,actionColumn:J}),[de,{openDrawer:ce}]=H(),me=d((()=>({category:O.activeKey,...O.searchInfo}))),pe=d((()=>{const e={field:"keyword",label:F("common.keyword"),component:"Input",componentProps:{placeholder:F("common.enterKeyword"),submitOnPressEnter:!0}},t=[{field:"loginType",label:"类型",component:"Select",componentProps:{placeholder:"请选择",options:[{fullName:"登录",id:0},{fullName:"退出",id:1}]}},{field:"loginMark",label:"状态",component:"Select",componentProps:{placeholder:"请选择",options:[{fullName:"成功",id:1},{fullName:"失败",id:0}]}},{field:"pickerVal",label:"时间",component:"DateRange",componentProps:{format:"YYYY-MM-DD HH:mm:ss",showTime:{defaultValue:[c("00:00:00","HH:mm:ss"),c("23:59:59","HH:mm:ss")]},placeholder:["开始时间","结束时间"]}}],a=[{field:"requestMethod",label:"请求方式",component:"Select",componentProps:{placeholder:"请选择",options:[{fullName:"GET",id:"GET"},{fullName:"POST",id:"POST"},{fullName:"PUT",id:"PUT"},{fullName:"DELETE",id:"DELETE"}]}},{field:"pickerVal",label:"5"==O.activeKey?"请求时间":"操作时间",component:"DateRange",componentProps:{format:"YYYY-MM-DD HH:mm:ss",showTime:{defaultValue:[c("00:00:00","HH:mm:ss"),c("23:59:59","HH:mm:ss")]},placeholder:["开始时间","结束时间"]}}];return"1"==O.activeKey?[e,...t]:[e,...a]}));function ue(e){let t={};for(let[a,n]of Object.entries(e))(n||0==n)&&(Array.isArray(n)?n.length&&(t[a]=n):t[a]=n);O.searchInfo=t,he()}function fe(){O.searchInfo={},he()}function he(){p((()=>{we()}))}function ye(){const e=function(){if("1"===O.activeKey)return Z();if("5"===O.activeKey)return ae();if("3"===O.activeKey)return ie();if("4"===O.activeKey)return se()}()||[];if(!e.length)return q.error(F("common.selectDataTip"));const a={ids:e.map((e=>e.id))};E({iconType:"warning",title:F("common.tipTitle"),content:F("common.batchDelTip"),onOk:()=>{t(a).then((e=>{q.success(e.msg),we()}))}})}function ge(){E({iconType:"warning",title:F("common.tipTitle"),content:"此操作会将所有日志删除，是否继续?",onOk:()=>{a(O.activeKey).then((e=>{q.success(e.msg),we()}))}})}function we(){"1"===O.activeKey&&X({page:1}),"5"===O.activeKey&&te({page:1}),"3"===O.activeKey&&oe({page:1}),"4"===O.activeKey&&le({page:1})}function _e(e){return[{label:F("common.detailText"),onClick:Ie.bind(null,e.id)}]}function Ie(e){ce(!0,{id:e,activeKey:O.activeKey})}return m((()=>O.activeKey),(()=>{p((()=>we()))})),u((()=>{we()})),(e,t)=>{const a=f("a-button"),n=f("a-tag"),i=f("a-tab-pane"),r=f("a-tabs");return h(),y("div",R,[g("div",P,[g("div",A,[w(_(o),{class:"search-form",onRegister:_(L),schemas:pe.value,onAdvancedChange:_($),labelWidth:"1"==_(B)?50:70,onSubmit:ue,onReset:fe},null,8,["onRegister","schemas","onAdvancedChange","labelWidth"])]),g("div",N,[w(r,{activeKey:_(B),"onUpdate:activeKey":t[0]||(t[0]=e=>j(B)?B.value=e:null),class:"jnpf-content-wrapper-tabs tabs-contain",destroyInactiveTabPane:""},{default:I((()=>[w(i,{key:"1",tab:"登录日志"},{default:I((()=>[w(_(C),{onRegister:_(Q),columns:U,searchInfo:me.value},{tableTitle:I((()=>[w(a,{type:"error",preIcon:"icon-ym icon-ym-btn-clearn",onClick:ye},{default:I((()=>[x(b(_(F)("common.delText")),1)])),_:1}),w(a,{type:"link",danger:"",onClick:ge},{default:I((()=>t[1]||(t[1]=[x("一键清空")]))),_:1,__:[1]})])),bodyCell:I((({column:e,record:t})=>["loginType"===e.key?(h(),y("div",S,[g("span",{class:v(["circle-box",0==t.loginType?"circle-box-primary":"circle-box-error"])},null,2),x(" "+b(0==t.loginType?"登录":"退出"),1)])):T("",!0),"loginMark"===e.key?(h(),k(n,{key:1,color:1==t.loginMark?"success":"error"},{default:I((()=>[x(b(1==t.loginMark?"成功":"失败"),1)])),_:2},1032,["color"])):T("",!0)])),_:1},8,["onRegister","searchInfo"])])),_:1}),w(i,{key:"5",tab:"请求日志"},{default:I((()=>[w(_(C),{onRegister:_(ee),columns:V,searchInfo:me.value},{tableTitle:I((()=>[w(a,{type:"error",preIcon:"icon-ym icon-ym-btn-clearn",onClick:ye},{default:I((()=>[x(b(_(F)("common.delText")),1)])),_:1}),w(a,{type:"link",danger:"",onClick:ge},{default:I((()=>t[2]||(t[2]=[x("一键清空")]))),_:1,__:[2]})])),bodyCell:I((({column:e,record:t})=>["action"===e.key?(h(),k(_(Y),{key:0,actions:_e(t)},null,8,["actions"])):T("",!0)])),_:1},8,["onRegister","searchInfo"])])),_:1}),w(i,{key:"3",tab:"操作日志"},{default:I((()=>[w(_(C),{onRegister:_(ne),columns:G,searchInfo:me.value},{tableTitle:I((()=>[w(a,{type:"error",preIcon:"icon-ym icon-ym-btn-clearn",onClick:ye},{default:I((()=>[x(b(_(F)("common.delText")),1)])),_:1}),w(a,{type:"link",danger:"",onClick:ge},{default:I((()=>t[3]||(t[3]=[x("一键清空")]))),_:1,__:[3]})])),bodyCell:I((({column:e,record:t})=>["action"===e.key?(h(),k(_(Y),{key:0,actions:_e(t)},null,8,["actions"])):T("",!0)])),_:1},8,["onRegister","searchInfo"])])),_:1}),w(i,{key:"4",tab:"异常日志"},{default:I((()=>[w(_(C),{onRegister:_(re),columns:W,searchInfo:me.value},{tableTitle:I((()=>[w(a,{type:"error",preIcon:"icon-ym icon-ym-btn-clearn",onClick:ye},{default:I((()=>[x(b(_(F)("common.delText")),1)])),_:1}),w(a,{type:"link",danger:"",onClick:ge},{default:I((()=>t[4]||(t[4]=[x("一键清空")]))),_:1,__:[4]})])),bodyCell:I((({column:e,record:t})=>["action"===e.key?(h(),k(_(Y),{key:0,actions:_e(t)},null,8,["actions"])):T("",!0)])),_:1},8,["onRegister","searchInfo"])])),_:1})])),_:1},8,["activeKey"])])]),w(K,{onRegister:_(de)},null,8,["onRegister"])])}}});export{q as default};
