import{di as e,d as a,r as t,ad as d,a0 as s,u as l,a6 as r,M as i,w as n,n as u,k as o,e as y,a9 as m,o as c,p as b,l as L,j as h,ae as g,i as k,g as v,F as p,a4 as f,af as I,m as A,t as S,q as U,e1 as E,V as D,ah as _}from"./index-920db443.js";import{b as P,B as x}from"./index-143f5813.js";import{_ as C}from"./GradeUserSelect.vue_vue_type_script_setup_true_lang-c9328d11.js";function F(a){return e.get({url:"/api/permission/organizeAdminIsTrator",data:a})}function w(a="0",t){return e.get({url:`/api/permission/organizeAdminIsTrator/SelectAsyncList/${a||"0"}?userId=${t}`})}function N(a){return e.delete({url:"/api/permission/organizeAdminIsTrator/"+a})}const z=a({__name:"Form",emits:["register","reload"],setup(a,{emit:F}){const N=F,z=t(),G=[{title:"组织架构",dataIndex:"fullName",key:"fullName"},{title:"组织操作权限(本层级)",dataIndex:"thisLayer",key:"thisLayer",width:280},{title:"子组织操作权限(子层级)",dataIndex:"subLayer",key:"subLayer",width:280}],K=d({dataForm:{id:"",userId:"",managerGroup:""},dataRule:{userId:[{required:!0,message:"必填",trigger:"change"}],managerGroup:[{required:!0,message:"必填",trigger:"blur"}]},loading:!1,key:+new Date,moduleIds:[],modulePermissionList:[],orgAdminList:[],systemIds:[],systemPermissionList:[],activeName:"module",orgParentId:"0"}),{dataForm:T,dataRule:M,orgAdminList:R,loading:j,key:$,activeName:q}=s(K),O=t(null),[V,{closeModal:B,changeOkLoading:H}]=P((function(e){K.dataForm.id=e.id,K.dataForm.userId=e.id||"",K.dataForm.managerGroup="",K.orgParentId="0",K.orgAdminList=[],K.activeName="module",u((()=>{z.value?.clearValidate(),ae(!0)}))})),{createMessage:J}=_(),{t:Q}=l(),W=r(),X=i((()=>K.dataForm.id?Q("common.editText"):Q("common.addText"))),Y=i((()=>!!W.getUserInfo?.isAdministrator)),Z=i((()=>K[K.activeName+"PermissionList"]));function ee(e){K.orgParentId="0",K.orgAdminList=[],K.moduleIds=[],K.modulePermissionList=[],K.systemIds=[],K.systemPermissionList=[],e&&ae()}function ae(a=!1){var t;K.loading=!0,(t=K.dataForm.userId,e.get({url:`/api/permission/organizeAdminIsTrator/organizeSelector?userId=${t}`})).then((e=>{K.moduleIds=e.data.moduleIds||[],K.modulePermissionList=e.data.modulePermissionList||[],K.systemIds=e.data.systemIds||[],K.systemPermissionList=e.data.systemPermissionList||[],a&&(K.dataForm.managerGroup=e.data.managerGroup||""),K.loading=!1,w(K.orgParentId,K.dataForm.userId).then((e=>{K.orgAdminList=e.data||[]})),te()})).catch((()=>{K.loading=!1,K.dataForm.userId=""}))}function te(){K.key=+new Date,"gradeManage"!==K.activeName&&u((()=>{const e=de().getParentKeys(),a="module"===K.activeName?K.moduleIds.filter((a=>!e.includes(a))):K.systemIds;de().setCheckedKeys(a)}))}function de(){const e=o(O);if(!e)throw new Error("tree is null!");return e}function se(){const e=de().getCheckedKeys()||[],a=[...de().getHalfCheckedKeys()||[],...e];K[K.activeName+"Ids"]=a}async function le(e,a){if(e){if(a.children?.length)return;K.orgParentId=a.organizeId;const e=((await w(K.orgParentId,K.dataForm.userId)).data||[]).map((e=>{const a=e;return a.hasChildren&&(a.children=[]),a}));a.children=e}}async function re(){try{if(!(await(z.value?.validate())))return;H(!0);const t={...K.dataForm,orgAdminModel:K.orgAdminList,systemIds:K.systemIds,moduleIds:K.moduleIds};(a=t,e.post({url:"/api/permission/organizeAdminIsTrator",data:a})).then((e=>{J.success(e.msg),H(!1),B(),N("reload")})).catch((()=>{H(!1)}))}catch(t){}var a}return n((()=>K.activeName),(()=>te())),(e,a)=>{const t=y("a-input"),d=y("a-form-item"),s=y("jnpf-user-select"),l=y("a-form"),r=y("a-tab-pane"),i=y("a-tabs"),n=y("JnpfCheckboxSingle"),u=y("a-table"),_=m("loading");return c(),b(o(x),D(e.$attrs,{onRegister:o(V),title:X.value,width:900,onOk:re,class:"grade-modal"}),{default:L((()=>[h(l,{colon:!1,labelCol:{style:{width:"100px"}},model:o(T),rules:o(M),ref_key:"formElRef",ref:z},{default:L((()=>[h(d,{label:"管理组",name:"managerGroup"},{default:L((()=>[h(t,{value:o(T).managerGroup,"onUpdate:value":a[0]||(a[0]=e=>o(T).managerGroup=e),placeholder:"请输入"},null,8,["value"])])),_:1}),h(d,{label:"管理员",name:"userId"},{default:L((()=>[Y.value?(c(),b(s,{key:0,value:o(T).userId,"onUpdate:value":a[1]||(a[1]=e=>o(T).userId=e),placeholder:"请选择",onChange:ee,disabled:!!o(T).id},null,8,["value","disabled"])):(c(),b(C,{key:1,value:o(T).userId,"onUpdate:value":a[2]||(a[2]=e=>o(T).userId=e),placeholder:"请选择",onChange:ee,disabled:!!o(T).id},null,8,["value","disabled"]))])),_:1})])),_:1},8,["model","rules"]),h(i,{activeKey:o(q),"onUpdate:activeKey":a[3]||(a[3]=e=>g(q)?q.value=e:null)},{default:L((()=>[h(r,{key:"module",tab:"开发平台"}),h(r,{key:"system",tab:"应用权限"}),h(r,{key:"gradeManage",tab:"组织权限"})])),_:1},8,["activeKey"]),"gradeManage"===o(q)?k((c(),b(u,{"data-source":o(R),columns:G,size:"small",pagination:!1,rowKey:"organizeId",scroll:{y:"400px"},key:o($),onExpand:le},{bodyCell:L((({column:e,record:a})=>["fullName"===e.key?(c(),v(p,{key:0},[f("i",{class:I(a.icon)},null,2),A(" "+S(a.fullName),1)],64)):U("",!0),"thisLayer"===e.key?(c(),v(p,{key:1},[2===a.thisLayerSelect?(c(),b(n,{key:0,label:"查看",checked:"",disabled:""})):U("",!0),3===a.thisLayerSelect?(c(),b(n,{key:1,label:"查看",disabled:""})):U("",!0),0===a.thisLayerSelect||1===a.thisLayerSelect?(c(),b(n,{key:2,label:"查看",value:a.thisLayerSelect,"onUpdate:value":e=>a.thisLayerSelect=e,onChange:e=>function(e,a){e||(1===a.thisLayerAdd&&(a.thisLayerAdd=0),1===a.thisLayerEdit&&(a.thisLayerEdit=0),1===a.thisLayerDelete&&(a.thisLayerDelete=0))}(e,a)},null,8,["value","onUpdate:value","onChange"])):U("",!0),2===a.thisLayerAdd?(c(),b(n,{key:3,label:"添加",checked:"",disabled:""})):U("",!0),3===a.thisLayerAdd?(c(),b(n,{key:4,label:"添加",disabled:""})):U("",!0),0===a.thisLayerAdd||1===a.thisLayerAdd?(c(),b(n,{key:5,label:"添加",value:a.thisLayerAdd,"onUpdate:value":e=>a.thisLayerAdd=e,disabled:!a.thisLayerSelect},null,8,["value","onUpdate:value","disabled"])):U("",!0),2===a.thisLayerEdit?(c(),b(n,{key:6,label:"编辑",checked:"",disabled:""})):U("",!0),3===a.thisLayerEdit?(c(),b(n,{key:7,label:"编辑",disabled:""})):U("",!0),0===a.thisLayerEdit||1===a.thisLayerEdit?(c(),b(n,{key:8,label:"编辑",value:a.thisLayerEdit,"onUpdate:value":e=>a.thisLayerEdit=e,disabled:!a.thisLayerSelect},null,8,["value","onUpdate:value","disabled"])):U("",!0),2===a.thisLayerDelete?(c(),b(n,{key:9,label:"删除",checked:"",disabled:""})):U("",!0),3===a.thisLayerDelete?(c(),b(n,{key:10,label:"删除",disabled:""})):U("",!0),0===a.thisLayerDelete||1===a.thisLayerDelete?(c(),b(n,{key:11,label:"删除",value:a.thisLayerDelete,"onUpdate:value":e=>a.thisLayerDelete=e,disabled:!a.thisLayerSelect},null,8,["value","onUpdate:value","disabled"])):U("",!0)],64)):U("",!0),"subLayer"===e.key?(c(),v(p,{key:2},[2===a.subLayerSelect?(c(),b(n,{key:0,label:"查看",checked:"",disabled:""})):U("",!0),3===a.subLayerSelect?(c(),b(n,{key:1,label:"查看",disabled:""})):U("",!0),0===a.subLayerSelect||1===a.subLayerSelect?(c(),b(n,{key:2,label:"查看",value:a.subLayerSelect,"onUpdate:value":e=>a.subLayerSelect=e,onChange:e=>function(e,a){e||(1===a.subLayerAdd&&(a.subLayerAdd=0),1===a.subLayerEdit&&(a.subLayerEdit=0),1===a.subLayerDelete&&(a.subLayerDelete=0))}(e,a)},null,8,["value","onUpdate:value","onChange"])):U("",!0),2===a.subLayerAdd?(c(),b(n,{key:3,label:"添加",checked:"",disabled:""})):U("",!0),3===a.subLayerAdd?(c(),b(n,{key:4,label:"添加",disabled:""})):U("",!0),0===a.subLayerAdd||1===a.subLayerAdd?(c(),b(n,{key:5,label:"添加",value:a.subLayerAdd,"onUpdate:value":e=>a.subLayerAdd=e,disabled:!a.subLayerSelect},null,8,["value","onUpdate:value","disabled"])):U("",!0),2===a.subLayerEdit?(c(),b(n,{key:6,label:"编辑",checked:"",disabled:""})):U("",!0),3===a.subLayerEdit?(c(),b(n,{key:7,label:"编辑",disabled:""})):U("",!0),0===a.subLayerEdit||1===a.subLayerEdit?(c(),b(n,{key:8,label:"编辑",value:a.subLayerEdit,"onUpdate:value":e=>a.subLayerEdit=e,disabled:!a.subLayerSelect},null,8,["value","onUpdate:value","disabled"])):U("",!0),2===a.subLayerDelete?(c(),b(n,{key:9,label:"删除",checked:"",disabled:""})):U("",!0),3===a.subLayerDelete?(c(),b(n,{key:10,label:"删除",disabled:""})):U("",!0),0===a.subLayerDelete||1===a.subLayerDelete?(c(),b(n,{key:11,label:"删除",value:a.subLayerDelete,"onUpdate:value":e=>a.subLayerDelete=e,disabled:!a.subLayerSelect},null,8,["value","onUpdate:value","disabled"])):U("",!0)],64)):U("",!0)])),_:1},8,["data-source"])),[[_,o(j)]]):(c(),b(o(E),{ref_key:"treeRef",ref:O,defaultExpandAll:"",checkable:"",clickRowToExpand:"",treeData:Z.value,loading:o(j),fieldNames:{key:"id"},key:o($)+1,onCheck:se},null,8,["treeData","loading"]))])),_:1},16,["onRegister","title"])}}});export{z as _,N as d,F as g};
