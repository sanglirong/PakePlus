import{a as e,b as t,s as a,n,d as o}from"./flowDelegate-3964bb34.js";import{u as s,B as i}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{d as r,u as d,ad as l,a0 as c,w as u,M as m,a7 as f,aA as p,n as y,e as w,o as h,g,a4 as v,j as b,k as x,l as k,F as I,h as K,ae as _,aR as j,m as Y,p as R,t as M,q as T,ah as C}from"./index-920db443.js";import{u as N,B as S}from"./useTable-dc8c9d84.js";import{T as D}from"./TableAction-adbe36f2.js";import{u as H}from"./index-143f5813.js";import{_ as F}from"./Form.vue_vue_type_script_setup_true_lang-95c2157d.js";const O={class:"jnpf-content-wrapper mt-10px"},A={class:"jnpf-content-wrapper-center"},B={class:"jnpf-content-wrapper-search-box"},L={class:"jnpf-content-wrapper-content bg-white"},P=r({name:"workFlow-entrust",__name:"index",setup(r){const{createMessage:P}=C(),{t:U}=d(),[q,{openModal:E}]=H(),G=l({activeKey:1,keyword:"",userList:[],activeUser:""}),{activeKey:z}=c(G),J=[{fullName:"我的委托",id:1},{fullName:"委托给我",id:2},{fullName:"我的代理",id:3},{fullName:"代理给我",id:4}],[Q,{resetFields:V}]=s({baseColProps:{span:6},showActionButtonGroup:!0,showAdvancedButton:!0,compact:!0,schemas:[{field:"keyword",label:U("common.keyword"),component:"Input",componentProps:{placeholder:U("common.enterKeyword"),submitOnPressEnter:!0}}]}),[W,{reload:X}]=N({api:e,actionColumn:{width:150,title:"操作",dataIndex:"action"},immediate:!1,rowKey:"jnpfId",afterFetch:e=>e.map((e=>({...e,jnpfId:e.id+Math.random()}))),onExpand:function(e,a){if(!e||a.userList?.length)return;t(a.id).then((e=>{a.userList=e.data}))}}),[Z]=N({columns:[{title:"",dataIndex:"entrust",width:38},{title:"序号",dataIndex:"index",width:50,align:"center",customRender:({index:e})=>e+1},{title:"受委托人",dataIndex:"toUserName",width:650},{title:"流程状态",dataIndex:"status",width:120,align:"center"},{title:"",dataIndex:"flow"}],showHeader:!1,showTableSetting:!1,pagination:!1,showIndexColumn:!1,immediate:!1});u((()=>G.activeKey),(()=>{V()}));const $=m((()=>({keyword:G.keyword,type:G.activeKey}))),ee=m((()=>{const e=[{title:"受委托人",dataIndex:"toUserName",width:200},{title:"委托流程",dataIndex:"flowName",width:150},{title:"开始时间",dataIndex:"startTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"结束时间",dataIndex:"endTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"状态",dataIndex:"status",width:120,align:"center"},{title:"委托说明",dataIndex:"description"}],t=[{title:"委托人",dataIndex:"userName",width:200},{title:"委托流程",dataIndex:"flowName",width:150},{title:"开始时间",dataIndex:"startTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"结束时间",dataIndex:"endTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"生效状态",dataIndex:"status",width:120,align:"center"},{title:"委托说明",dataIndex:"description"},{title:"确认状态",dataIndex:"confirmStatus",width:120,align:"center"}];if(1===G.activeKey)return e;if(2===G.activeKey)return t;if(3===G.activeKey||4===G.activeKey){let a=3===G.activeKey?e:t;return a[0].title=3===G.activeKey?"代理人":"被代理人",a[1].title="代理流程",a[5].title="代理说明",a}}));function te(e){return 1===G.activeKey||3===G.activeKey?[{label:U("common.editText"),disabled:0!==e.status||!e.isEdit,onClick:re.bind(null,e.id)},{label:U("common.delText"),color:"error",disabled:1===e.status,modelConfirm:{onOk:de.bind(null,e.id)}},{ifShow:1===e.status,label:"终止",color:"error",modelConfirm:{onOk:ae.bind(null,e.id),content:"终止后，流程不再进行委托！"}}]:[{ifShow:2!==e.status&&0===e.confirmStatus,label:"接受",modelConfirm:{onOk:ne.bind(null,e.id,1),content:"您确认要接受请求吗，是否继续？"}},{ifShow:2!==e.status&&0===e.confirmStatus,label:"拒绝",color:"error",modelConfirm:{onOk:ne.bind(null,e.id,2),content:"您确认要拒绝请求吗，是否继续？"}}]}function ae(e){a(e).then((e=>{P.success(e.msg),X()}))}function ne(e,t){n(e,t).then((e=>{P.success(e.msg),X()}))}function oe(e){G.keyword=e?.keyword||"",ie()}function se(){G.keyword="",ie()}function ie(){y((()=>X({page:1})))}function re(e=""){E(!0,{id:e,type:1===G.activeKey?0:1})}function de(e){o(e).then((e=>{P.success(e.msg),X()}))}function le(e){return 0===e?"未生效":1===e?"生效中":"已失效"}function ce(e){return 0===e?"待确认":1===e?"已接受":"已拒绝"}function ue(e){return 0===e?"":1===e?"success":"error"}return f((()=>{const e=p();e.query.config?(G.activeKey=Number(e.query.config)||1,y((()=>X({page:1})))):X({page:1})})),(e,t)=>{const a=w("a-tab-pane"),n=w("a-tabs"),o=w("a-alert"),s=w("a-button"),r=w("a-tag");return h(),g("div",O,[v("div",A,[v("div",B,[b(x(i),{class:"search-form",onRegister:x(Q),onSubmit:oe,onReset:se},null,8,["onRegister"])]),v("div",L,[b(n,{activeKey:x(z),"onUpdate:activeKey":t[0]||(t[0]=e=>_(z)?z.value=e:null),class:"jnpf-content-wrapper-tabs",destroyInactiveTabPane:""},{default:k((()=>[(h(),g(I,null,K(J,(e=>b(a,{key:e.id,tab:e.fullName},null,8,["tab"]))),64))])),_:1},8,["activeKey"]),b(x(S),{onRegister:x(W),searchInfo:$.value,columns:ee.value},j({bodyCell:k((({column:e,record:t})=>{return["status"===e.key?(h(),R(r,{key:0,color:(a=t.status,0===a?"":1===a?"processing":"error")},{default:k((()=>[Y(M(le(t.status)),1)])),_:2},1032,["color"])):T("",!0),"confirmStatus"===e.key?(h(),R(r,{key:1,color:ue(t.confirmStatus)},{default:k((()=>[Y(M(ce(t.confirmStatus)),1)])),_:2},1032,["color"])):T("",!0),"action"===e.key?(h(),R(x(D),{key:2,actions:te(t)},null,8,["actions"])):T("",!0)];var a})),_:2},[1==x(z)||3==x(z)?{name:"headerTop",fn:k((()=>[b(o,{message:1==x(z)?"委托是指允许受委托人代替委托人在系统中发起流程。":"代理是指允许代理人代替被代理人在系统中处理流程审批。",showIcon:"",type:"warning",class:"mt-12px"},null,8,["message"])])),key:"0"}:void 0,1==x(z)||3==x(z)?{name:"tableTitle",fn:k((()=>[b(s,{type:"primary",preIcon:"icon-ym icon-ym-btn-add",onClick:t[1]||(t[1]=e=>re())},{default:k((()=>t[2]||(t[2]=[Y("新建")]))),_:1,__:[2]})])),key:"1"}:void 0,1==x(z)||3==x(z)?{name:"expandedRowRender",fn:k((({record:e})=>[b(x(S),{onRegister:x(Z),"data-source":e.userList},{bodyCell:k((({column:e,record:t})=>["status"===e.key?(h(),R(r,{key:0,color:ue(t.status)},{default:k((()=>{return[Y(M((e=t.status,0===e?"待确认":1===e?"已接受":"已拒绝")),1)];var e})),_:2},1032,["color"])):T("",!0)])),_:2},1032,["onRegister","data-source"])])),key:"2"}:void 0]),1032,["onRegister","searchInfo","columns"])])]),b(F,{onRegister:x(q),onReload:x(X)},null,8,["onRegister","onReload"])])}}});export{P as _};
