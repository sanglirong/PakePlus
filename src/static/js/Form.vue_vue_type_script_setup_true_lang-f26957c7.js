import{d as e,r as a,u as o,aD as t,fg as n,M as r,k as l,gv as s,e as i,o as d,p as u,l as c,j as g,V as m,gw as p,gx as f,ah as h}from"./index-920db443.js";import{b as v,B as b}from"./index-143f5813.js";import{u as I,B as x}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{f as z}from"./formValidate-c8ab8d29.js";const T=e({__name:"Form",emits:["register","reload"],setup(e,{emit:T}){const j=T,[P,{setFieldsValue:S,resetFields:w,validate:y,clearValidate:M,updateSchema:V}]=I({schemas:[{field:"organizeId",label:"所属组织",component:"TreeSelect",slot:"organizeId",rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"fullName",label:"岗位名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:z("fullName","不能含有特殊符号"),trigger:"blur"}]},{field:"enCode",label:"岗位编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:z("enCode","只能输入英文、数字和小数点且小数点不能放在首尾"),trigger:"blur"}]},{field:"type",label:"岗位类型",component:"Select",componentProps:{placeholder:"请选择",fieldNames:{value:"enCode"},showSearch:!0},rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"sortCode",label:"排序",defaultValue:0,component:"InputNumber",componentProps:{min:0,max:999999}},{field:"enabledMark",label:"状态",component:"Switch",defaultValue:1},{field:"description",label:"说明",component:"Textarea",componentProps:{placeholder:"请输入"}}]}),[k,{closeModal:C,changeLoading:_,changeOkLoading:q}]=v((function(e){_(!0),w(),F.value=e.id,async function(){const e=await O.getDictionaryData("PositionType");V({field:"type",componentProps:{options:e}})}(),F.value?s(F.value).then((e=>{N.value=e.data.organizeIdTree||[],S(e.data),_(!1)})):(S({organizeId:e.organizeId||""}),N.value=e.organizeIdTree||[],_(!1))})),F=a(""),N=a([]),{createMessage:R}=h(),{t:D}=o(),O=t(),B=n(),L=r((()=>l(F)?D("common.editText"):D("common.addText")));function U(e){S({organizeId:e&&e.length?e[e.length-1]:""}),e&&e.length&&M("organizeId")}async function $(){const e=await y();if(!e)return;q(!0);const a={enabledMark:1,...e,id:F.value,organizeIdTree:N.value};(F.value?p:f)(a).then((e=>{R.success(e.msg),q(!1),B.resetState(),C(),j("reload")})).catch((()=>{q(!1)}))}return(e,a)=>{const o=i("jnpfOrganizeSelect");return d(),u(l(b),m(e.$attrs,{onRegister:l(k),title:L.value,onOk:$}),{default:c((()=>[g(l(x),{onRegister:l(P)},{organizeId:c((()=>[g(o,{value:N.value,"onUpdate:value":a[0]||(a[0]=e=>N.value=e),placeholder:"请选择",auth:"",onChange:U},null,8,["value"])])),_:1},8,["onRegister"])])),_:1},16,["onRegister","title"])}}});export{T as _};
