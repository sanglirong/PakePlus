import{g as e,a as t,e as o,f as n}from"./dataModel-ea807f46.js";import{g as a}from"./dataSource-ed26da12.js";import{u as i,B as l}from"./useTable-dc8c9d84.js";import{T as r}from"./TableAction-adbe36f2.js";import{d as s,u as d,r as p,k as c,M as u,a7 as m,e as _,a9 as b,o as f,g,a4 as j,j as h,l as y,m as v,t as x,i as w,p as k,q as T,ea as I,ah as R}from"./index-920db443.js";import{u as C}from"./index-999abbee.js";import{u as S}from"./index-9c138ba5.js";import F from"./Form-f91a552b.js";import{_ as L}from"./index.vue_vue_type_script_setup_true_lang-d0e3f05a.js";import{_ as M}from"./Preview.vue_vue_type_script_setup_true_lang-242650cf.js";import"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import"./visualDev-8f54ab4b.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./index-143f5813.js";import"./useWindowSizeFn-05f906e2.js";import"./log-2a5f2c26.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./jquery-6353a699.js";import"./useDefineSetting-7df030ff.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./config-06ca91cd.js";import"./upperFirst-2cd1a2f7.js";import"./useTabs-ceeccdba.js";import"./uniqBy-e868edd7.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./commonFields-6e52637f.js";import"./Form.vue_vue_type_script_setup_true_lang-a8a1e6a7.js";import"./formValidate-c8ab8d29.js";const P={class:"jnpf-content-wrapper"},D={class:"jnpf-content-wrapper-center"},O={class:"jnpf-content-wrapper-content"},A=s({name:"systemData-dataModel",__name:"index",setup(s){const{createMessage:A}=R(),{t:N}=d(),[B,{openPopup:q}]=S(),[z,{openDrawer:E}]=C(),[Q,{openPopup:K}]=S(),V=p("0"),$=p("MySQL"),[G,{reload:H,getForm:J}]=i({api:e,columns:[{title:"表名",dataIndex:"table",width:300},{title:"说明",dataIndex:"tableName"}],useSearchForm:!0,expandRowByClick:!0,formConfig:{schemas:[{field:"keyword",label:N("common.keyword"),component:"Input",componentProps:{placeholder:N("common.enterKeyword"),submitOnPressEnter:!0}},{field:"linkId",label:"数据连接",component:"Select",defaultValue:c(V),componentProps:{placeholder:"请选择",allowClear:!1,showSearch:!0,fieldNames:{options:"children"},onChange:function(e,t){V.value=e,$.value=t.dbType,setTimeout((()=>{H({page:1})}),0)}}}]},actionColumn:{width:150,title:"操作",dataIndex:"action"},afterFetch:e=>e.map((e=>({...e,id:e.table+Math.random()}))),onExpand:function(e,o){if(!e||o.childTable?.length)return;o.childTableLoading=!0,t(c(V),o.table).then((e=>{o.childTableLoading=!1,o.childTable=e.data.list})).catch((()=>{o.childTableLoading=!1}))}}),[W]=i({columns:[{title:"字段",dataIndex:"field"},{title:"说明",dataIndex:"fieldName"},{title:"类型",dataIndex:"dataType"},{title:"长度",dataIndex:"dataLength"},{title:"允许空",dataIndex:"allowNull",width:60,align:"center"},{title:"默认值",dataIndex:"defaults"}],pagination:!1,showTableSetting:!1,canResize:!1,scroll:{x:void 0}}),U=u((()=>`/api/system/DataModel/${c(V)}/Actions/Import`));function X(e){return[{label:N("common.editText"),onClick:Z.bind(null,e.table)},{label:N("common.delText"),color:"error",modelConfirm:{onOk:ee.bind(null,e.table)}}]}function Y(e){return[{label:"打开数据",onClick:te.bind(null,e.table)},{label:N("common.exportText"),modelConfirm:{content:"您确定要导出该表, 是否继续?",onOk:oe.bind(null,e.table)}}]}function Z(e=""){q(!0,{table:e,linkId:c(V),dbType:c($)})}function ee(e){o(c(V),e).then((e=>{A.success(e.msg),H()}))}function te(e){K(!0,{table:e,linkId:c(V)})}function oe(e){n(c(V),e).then((e=>{I({url:e.data.url})}))}return m((()=>{!async function(){const e=(await a()).data.list.filter((e=>e.children&&e.children.length));e[0]&&e[0].children&&e[0].children.length&&(e[0]=e[0].children[0]),delete e[0].children,$.value=e[0].dbType||"MySQL",J().updateSchema({field:"linkId",componentProps:{options:e}})}()})),(e,t)=>{const o=_("a-button"),n=_("jnpf-upload-btn"),a=_("a-checkbox"),i=b("loading");return f(),g("div",P,[j("div",D,[j("div",O,[h(c(l),{onRegister:c(G)},{tableTitle:y((()=>[h(o,{type:"primary",preIcon:"icon-ym icon-ym-btn-add",onClick:t[0]||(t[0]=e=>Z())},{default:y((()=>[v(x(c(N)("common.addText")),1)])),_:1}),h(n,{url:U.value,accept:".bdb",onOnSuccess:c(H)},null,8,["url","onOnSuccess"]),h(o,{type:"link",preIcon:"icon-ym icon-ym-btn-common",onClick:t[1]||(t[1]=e=>{E(!0)})},{default:y((()=>t[2]||(t[2]=[v("常用字段")]))),_:1,__:[2]})])),expandedRowRender:y((({record:e})=>[w((f(),k(c(l),{onRegister:c(W),"data-source":e.childTable},{bodyCell:y((({column:e,record:t})=>["allowNull"===e.key?(f(),k(a,{key:0,checked:1===t.allowNull},null,8,["checked"])):T("",!0)])),_:2},1032,["onRegister","data-source"])),[[i,e.childTableLoading]])])),bodyCell:y((({column:e,record:t})=>["action"===e.key?(f(),k(c(r),{key:0,stopButtonPropagation:"",actions:X(t),dropDownActions:Y(t)},null,8,["actions","dropDownActions"])):T("",!0)])),_:1},8,["onRegister"])])]),h(F,{onRegister:c(B),onReload:c(H)},null,8,["onRegister","onReload"]),h(L,{onRegister:c(z)},null,8,["onRegister"]),h(M,{onRegister:c(Q)},null,8,["onRegister"])])}}});export{A as default};
