import{f as e,a as t,e as a,h as n,i}from"./dataAuthorize-004cfc95.js";import{g as o}from"./dataSource-ed26da12.js";import{b as d}from"./authorize-05422727.js";import{a as l,B as s}from"./index-999abbee.js";import{u as r,B as c}from"./useTable-dc8c9d84.js";import{T as m}from"./TableAction-adbe36f2.js";import{u}from"./index-143f5813.js";import{d as p,ad as y,a0 as _,u as f,n as b,e as g,o as h,g as I,j as v,l as x,k,ae as C,p as T,m as j,t as R,bN as w,q as K,V as N,F as L,ah as F}from"./index-920db443.js";import{_ as M}from"./SchemeForm.vue_vue_type_script_setup_true_lang-d9eed4bb.js";import{_ as O}from"./FieldForm.vue_vue_type_script_setup_true_lang-04134232.js";import{_ as S}from"./Form.vue_vue_type_script_setup_true_lang-d579ecae.js";const z=p({__name:"index",setup(p){const z=y({title:"",type:"",activeKey:1,dataList:{},tableName:"",loading:!1,dbOptions:[]}),{title:A,activeKey:B,type:D,loading:$}=_(z),{createMessage:q}=F(),{t:G}=f(),[J]=l((function(e){z.activeKey=1,z.title=`数据权限 - ${e.fullName}`,W.moduleId=e.id,z.type=e.type,b((()=>{Y(),"2"==z.type&&(o().then((e=>{let t=e.data.list||[];t=t.filter((e=>e.children&&e.children.length)),t[0]&&t[0].children&&t[0].children.length&&(t[0]=t[0].children[0]),delete t[0].children,z.dbOptions=t})),ae())}))})),[P,{openModal:U}]=u(),[V,{openModal:E}]=u(),[H,{openModal:Q}]=u(),W=y({moduleId:""}),[X,{reload:Y}]=r({api:e,searchInfo:W,columns:[{title:"方案编码",dataIndex:"enCode",width:160},{title:"方案名称",dataIndex:"fullName",width:160},{title:"过滤条件",dataIndex:"conditionText"}],pagination:!1,immediate:!1,actionColumn:{width:100,title:"操作",dataIndex:"action"}}),[Z,{reload:ee}]=r({api:t,searchInfo:W,columns:[{title:"数据库表",dataIndex:"bindTable",width:100},{title:"字段名称",dataIndex:"enCode",width:100},{title:"字段说明",dataIndex:"fullName",width:80},{title:"字段类型",dataIndex:"type",width:80},{title:"条件符号",dataIndex:"conditionSymbolName",width:80},{title:"条件内容",dataIndex:"conditionName",width:100}],pagination:!1,immediate:!1,actionColumn:{width:100,title:"操作",dataIndex:"action"}});function te(){b((()=>{1===z.activeKey&&Y(),2===z.activeKey&&ee()}))}function ae(){d(W.moduleId,3).then((e=>{z.dataList=e.data||{},z.tableName=z.dataList.linkTables||""}))}function ne(e){z.tableName=e||"",ae()}function ie(){let e={moduleId:W.moduleId,enCode:"jnpf_alldata",fullName:"全部数据",allData:1};z.loading=!0,a(e).then((e=>{q.success(e.msg),z.loading=!1,te()})).catch((()=>{z.loading=!1}))}function oe(e){return[{label:G("common.editText"),disabled:"jnpf_alldata"===e.enCode&&1==z.activeKey,onClick:le.bind(null,e.id)},{label:G("common.delText"),color:"error",disabled:1==e.isMain,modelConfirm:{onOk:de.bind(null,e.id)}}]}function de(e){(1==z.activeKey?n:i)(e).then((e=>{q.success(e.msg),te()}))}function le(e=""){1==z.activeKey?U(!0,{moduleId:W.moduleId,id:e,type:z.type,dataType:3}):E(!0,{moduleId:W.moduleId,id:e,type:z.type,dataType:3})}function se(){Q(!0,{moduleId:W.moduleId,dataList:z.dataList,dbOptions:z.dbOptions,dataType:3})}return(e,t)=>{const a=g("a-button"),n=g("a-menu-item"),i=g("a-menu"),o=g("a-dropdown"),d=g("a-tab-pane"),l=g("a-tabs");return h(),I(L,null,[v(k(s),N(e.$attrs,{onRegister:k(J),title:k(A),width:700,class:"full-drawer"}),{default:x((()=>[v(l,{activeKey:k(B),"onUpdate:activeKey":t[2]||(t[2]=e=>C(B)?B.value=e:null),onChange:te,class:"jnpf-content-wrapper-tabs tabs-contain",destroyInactiveTabPane:""},{default:x((()=>[(h(),T(d,{key:1,tab:"方案管理"},{default:x((()=>[v(k(c),{onRegister:k(X)},{tableTitle:x((()=>[v(a,{type:"primary",preIcon:"icon-ym icon-ym-btn-add",onClick:t[0]||(t[0]=e=>le())},{default:x((()=>[j(R(k(G)("common.addText")),1)])),_:1}),v(o,null,{overlay:x((()=>[v(i,null,{default:x((()=>[v(n,{onClick:ie},{default:x((()=>t[3]||(t[3]=[j("全部数据")]))),_:1,__:[3]})])),_:1})])),default:x((()=>[v(a,{type:"link",loading:k($),preIcon:"icon-ym icon-ym-btn-add"},{default:x((()=>[t[4]||(t[4]=j("常用方案")),v(k(w))])),_:1,__:[4]},8,["loading"])])),_:1})])),bodyCell:x((({column:e,record:t})=>["action"===e.key?(h(),T(k(m),{key:0,actions:oe(t)},null,8,["actions"])):K("",!0)])),_:1},8,["onRegister"])])),_:1})),(h(),T(d,{key:2,tab:"字段管理"},{default:x((()=>[v(k(c),{onRegister:k(Z)},{tableTitle:x((()=>[v(a,{type:"primary",preIcon:"icon-ym icon-ym-btn-add",onClick:t[1]||(t[1]=e=>le())},{default:x((()=>[j(R(k(G)("common.addText")),1)])),_:1}),"2"==k(D)?(h(),T(a,{key:0,type:"link",preIcon:"icon-ym icon-ym-dbLink",onClick:se},{default:x((()=>t[5]||(t[5]=[j("数据连接")]))),_:1,__:[5]})):K("",!0)])),bodyCell:x((({column:e,record:t})=>["action"===e.key?(h(),T(k(m),{key:0,actions:oe(t)},null,8,["actions"])):K("",!0)])),_:1},8,["onRegister"])])),_:1}))])),_:1},8,["activeKey"])])),_:1},16,["onRegister","title"]),v(M,{onRegister:k(P),onReload:te},null,8,["onRegister"]),v(O,{onRegister:k(V),onReload:te},null,8,["onRegister"]),v(S,{onRegister:k(H),onReload:ne},null,8,["onRegister"])],64)}}});export{z as _};
