import{d as e,u as a,ad as t,r as o,a0 as l,e as s,o as r,p as n,l as d,a4 as i,dj as m,k as p,g as c,t as u,j as f,ae as g,m as b,i as h,v as F,q as _,V as v,ah as y}from"./index-920db443.js";import{q as x,r as D,t as j}from"./visualDev-8f54ab4b.js";import{b as k,B as C}from"./index-143f5813.js";import{u as P,B as S}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{f as w}from"./formValidate-c8ab8d29.js";import{_ as R}from"./FieldForm.vue_vue_type_script_setup_true_lang-48e53dae.js";const N={class:"jnpf-full-modal-header"},A={class:"header-title"},I={key:0,class:"header-txt"},L={class:"header-txt"},M=e({__name:"Form",emits:["register","reload"],setup(e,{emit:M}){const U=M,[q,{setFieldsValue:T,resetFields:V,validate:B}]=P({schemas:[{field:"fullName",label:"表单名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"enCode",label:"表单编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:w("enCode"),trigger:"blur"}]},{field:"type",label:"表单类型",component:"Select",componentProps:{options:[{id:2,fullName:"系统导入"}],disabled:!0,showArrow:!1},rules:[{required:!0,trigger:"change",message:"必填",type:"number"}]},{field:"urlAddress",label:"Web地址",helpMessage:"Web地址配置为前端物理地址",component:"Input",componentProps:{placeholder:"请输入",addonBefore:"@/views/"}},{field:"appUrlAddress",label:"App地址",helpMessage:"APP地址配置为前端物理地址，需与代码同步更新",component:"Input",componentProps:{placeholder:"请输入"}},{field:"interfaceUrl",label:"接口地址",helpMessage:["后端接口请求地址"," 系统将会请求地址中的saveData(post方法), getData(get方法)","接口例：/api/example/UserController"],component:"Input",componentProps:{placeholder:"请输入"}},{field:"sortCode",label:"表单排序",defaultValue:0,component:"InputNumber",componentProps:{min:0,max:999999}},{field:"description",label:"表单说明",component:"Textarea",componentProps:{placeholder:"请输入"}}]}),[z,{closeModal:J,changeLoading:O}]=k((function(e){E.isReload=!1,E.activeStep=0,E.loading=!0,E.formData=null,O(!0),V(),E.dataForm.id=e.id||"",E.dataForm.id?x(E.dataForm.id).then((e=>{E.dataForm=e.data,T(E.dataForm),E.formData=E.dataForm.formData&&JSON.parse(E.dataForm.formData),E.loading=!1,O(!1)})):(T({type:2}),E.loading=!1,O(!1))})),{createMessage:W}=y(),{t:$}=a(),E=t({activeStep:0,loading:!1,btnLoading:!1,dataForm:{id:"",fullName:"",enCode:"",type:2,webType:1,dbLinkId:"0",sortCode:0,state:1,category:"",description:"",tables:"",urlAddress:"",appUrlAddress:"",interfaceUrl:""},formData:null,isReload:!1}),G=o(null),{activeStep:H,loading:K,btnLoading:Q,formData:X,dataForm:Y}=l(E);function Z(){E.activeStep-=1}async function ee(){if(E.activeStep<1){const e=await B();if(!e)return;E.dataForm={...E.dataForm,...e},E.activeStep+=1}}function ae(){E.btnLoading=!0;const e={...E.dataForm,formData:E.formData?JSON.stringify(E.formData):null};(E.dataForm.id?D:j)(e).then((e=>{W.success(e.msg),E.btnLoading=!1,E.isReload=!0,E.dataForm.id||(E.dataForm.id=e.data)})).catch((()=>{E.btnLoading=!1}))}return(e,a)=>{const t=s("a-tooltip"),o=s("a-step"),l=s("a-steps"),y=s("a-button"),x=s("a-space-compact"),D=s("a-space"),j=s("a-col"),k=s("a-row");return r(),n(p(C),v(e.$attrs,{onRegister:p(z),defaultFullscreen:"",footer:null,closable:!1,keyboard:!1,class:"jnpf-full-modal full-modal designer-modal"}),{title:d((()=>[i("div",N,[i("div",A,[a[3]||(a[3]=i("img",{src:m,class:"header-logo"},null,-1)),a[4]||(a[4]=i("span",{class:"header-dot"},null,-1)),p(H)?(r(),n(t,{key:1,title:p(Y).fullName},{default:d((()=>[i("p",L,u(p(Y).fullName),1)])),_:1},8,["title"])):(r(),c("p",I,"表单设计"))]),f(l,{current:p(H),"onUpdate:current":a[0]||(a[0]=e=>g(H)?H.value=e:null),type:"navigation",size:"small",class:"header-steps tab-steps"},{default:d((()=>[f(o,{title:"基础设置"}),f(o,{title:"表单设计",disabled:""})])),_:1},8,["current"]),f(D,{class:"options",size:10},{default:d((()=>[f(x,{block:""},{default:d((()=>[f(y,{shape:"round",onClick:Z,disabled:p(H)<=0||p(Q)},{default:d((()=>[b(u(p($)("common.prev")),1)])),_:1},8,["disabled"]),f(y,{shape:"round",onClick:ee,disabled:p(H)>=1||p(K)||p(Q)},{default:d((()=>[b(u(p($)("common.next")),1)])),_:1},8,["disabled"])])),_:1}),f(y,{shape:"round",type:"primary",onClick:a[1]||(a[1]=e=>async function(){if(E.activeStep<1){const e=await B();if(!e)return;E.dataForm={...E.dataForm,...e},ae()}else p(G).getData().then((e=>{E.formData=e.formData,ae()})).catch((e=>{e.msg&&W.warning(e.msg)}))}()),disabled:p(K),loading:p(Q)},{default:d((()=>[b(u(p($)("common.saveText")),1)])),_:1},8,["disabled","loading"]),f(y,{shape:"round",onClick:a[2]||(a[2]=e=>(J(),void(E.isReload&&U("reload"))))},{default:d((()=>[b(u(p($)("common.closeText")),1)])),_:1})])),_:1})])])),default:d((()=>[h(f(k,{type:"flex",justify:"center",align:"middle",class:"basic-content"},{default:d((()=>[f(j,{span:12,xxl:10,class:"basic-form"},{default:d((()=>[f(p(S),{onRegister:p(q)},null,8,["onRegister"])])),_:1})])),_:1},512),[[F,!p(H)]]),1==p(H)?(r(),n(k,{key:0,type:"flex",justify:"center",align:"middle",class:"basic-content"},{default:d((()=>[f(j,{span:12,xxl:10,class:"basic-form"},{default:d((()=>[f(R,{ref_key:"fieldFormRef",ref:G,conf:p(X)},null,8,["conf"])])),_:1})])),_:1})):_("",!0)])),_:1},16,["onRegister"])}}});export{M as _};
