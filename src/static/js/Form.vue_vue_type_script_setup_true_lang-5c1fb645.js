import{d as e,u as o,aD as n,r as l,M as t,k as a,gH as r,gI as p,gJ as i,o as s,p as c,l as d,j as m,V as h,ah as u,gK as g,gL as f}from"./index-920db443.js";import{a as P,B as I}from"./index-9c138ba5.js";import{u as b,B as x}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{f as T}from"./formValidate-c8ab8d29.js";const v=e({__name:"Form",emits:["register","reload"],setup(e,{emit:v}){const y=v,{createMessage:S}=u(),{t:w}=o(),D=n(),N=[{field:"groupTitleField1",label:"",component:"GroupTitle",componentProps:{content:"账户信息"},colProps:{sm:24,span:24}},{field:"account",label:"账户",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:T("fullName","不能含有特殊符号"),trigger:"blur"}]},{field:"realName",label:"姓名",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:T("fullName","不能含有特殊符号"),trigger:"blur"}]},{field:"gender",label:"性别",component:"Select",componentProps:{placeholder:"请选择",fieldNames:{value:"enCode"},showSearch:!0},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"email",label:"电子邮箱",component:"Input",componentProps:{placeholder:"请输入",maxlength:50}},{field:"organizeIdTree",label:"所属组织",component:"OrganizeSelect",componentProps:{placeholder:"请选择",multiple:!0,auth:!0,onChange:function(e){if(z({positionId:[],roleId:[]}),O.value=e||[],!e||!e.length)return;L(e)}},rules:[{required:!0,trigger:"blur",message:"必填",type:"array"}]},{field:"managerId",label:"直属主管",component:"UserSelect",componentProps:{placeholder:"请选择"}},{field:"positionId",label:"岗位",component:"Select",componentProps:{placeholder:"请选择",multiple:!0,showSearch:!0,fieldNames:{options:"children"},onDropdownVisibleChange:B}},{field:"ranks",label:"职级",component:"Select",componentProps:{placeholder:"请选择",showSearch:!0}},{field:"roleId",label:"角色",component:"Select",componentProps:{placeholder:"请选择",multiple:!0,showSearch:!0,fieldNames:{options:"children"},onDropdownVisibleChange:B}},{field:"sortCode",label:"排序",defaultValue:0,component:"InputNumber",componentProps:{min:0,max:999999}},{field:"enabledMark",label:"状态",defaultValue:1,component:"Select",componentProps:{placeholder:"请选择",options:[{fullName:"启用",id:1},{fullName:"锁定",id:2},{fullName:"禁用",id:0}]}},{field:"description",label:"说明",component:"Textarea",colProps:{sm:24,span:24},componentProps:{placeholder:"请输入",maxlength:300}},{field:"groupTitleField2",label:"",component:"GroupTitle",componentProps:{content:"个人资料"},colProps:{sm:24,span:24}},{field:"headIcon",label:"头像",component:"UploadImgSingle",componentProps:{tipText:"上传头像",type:"userAvatar"},colProps:{sm:24,span:24}},{field:"nation",label:"民族",component:"Select",componentProps:{placeholder:"请选择",showSearch:!0}},{field:"nativePlace",label:"籍贯",component:"Input",componentProps:{placeholder:"请输入",maxlength:50}},{field:"certificatesType",label:"证件类型",component:"Select",componentProps:{placeholder:"请选择",showSearch:!0}},{field:"entryDate",label:"入职时间",component:"DatePicker",componentProps:{placeholder:"请选择"}},{field:"certificatesNumber",label:"证件号码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50}},{field:"education",label:"文化程度",component:"Select",componentProps:{placeholder:"请选择",showSearch:!0}},{field:"birthday",label:"出生年月",component:"DatePicker",componentProps:{placeholder:"请选择"}},{field:"telePhone",label:"办公电话",component:"Input",componentProps:{placeholder:"请输入",maxlength:20}},{field:"landline",label:"办公座机",component:"Input",componentProps:{placeholder:"请输入",maxlength:50}},{field:"mobilePhone",label:"手机号码",component:"Input",componentProps:{placeholder:"请输入",maxlength:20}},{field:"urgentContacts",label:"紧急联系",component:"Input",componentProps:{placeholder:"请输入",maxlength:50}},{field:"urgentTelePhone",label:"紧急电话",component:"Input",componentProps:{placeholder:"请输入",maxlength:50}},{field:"postalAddress",label:"通讯地址",component:"Textarea",colProps:{sm:24,span:24},componentProps:{placeholder:"请输入",maxlength:300}}],[k,{setFieldsValue:z,resetFields:j,validate:A,updateSchema:C}]=b({baseColProps:{sm:12,xs:24},schemas:N}),[V,{closePopup:F,changeLoading:R,changeOkLoading:q}]=P((function(e){R(!0),j(),M.value=e.id,C({field:"account",componentProps:{readonly:!!a(M)}}),async function(){const e=await D.getDictionaryData("sex");C({field:"gender",componentProps:{options:e}});const o=await D.getDictionaryData("Nation");C({field:"nation",componentProps:{options:o}});const n=await D.getDictionaryData("Education");C({field:"education",componentProps:{options:n}});const l=await D.getDictionaryData("certificateType");C({field:"certificatesType",componentProps:{options:l}});const t=await D.getDictionaryData("Rank");C({field:"ranks",componentProps:{options:t}})}(),M.value?r(M.value).then((e=>{const o={...e.data,roleId:e.data.roleId?e.data.roleId.split(","):[],positionId:e.data.positionId?e.data.positionId.split(","):[]};O.value=e.data.organizeIdTree||[],e.data.organizeIdTree?.length&&L(e.data.organizeIdTree),z(o),R(!1)})):(O.value=e.organizeIdTree?.length?[e.organizeIdTree]:[],O.value?.length&&L(O.value),z({organizeIdTree:O.value}),C({field:"positionId",componentProps:{options:[]}}),C({field:"roleId",componentProps:{options:[]}}),R(!1))})),M=l(""),O=l([]),_=t((()=>a(M)?w("common.editText"):w("common.addText")));function B(e){e&&(O.value&&O.value.length||(C({field:"positionId",componentProps:{options:[]}}),S.warning("请先选择所属组织")))}function L(e){const o=e.map((e=>e[e.length-1]));p(o).then((e=>{const o=e.data.list.filter((e=>e.children&&Array.isArray(e.children)&&e.children.length));C({field:"positionId",componentProps:{options:o}})})),i(o).then((e=>{const o=e.data.list.filter((e=>e.children&&Array.isArray(e.children)&&e.children.length));C({field:"roleId",componentProps:{options:o}})}))}async function G(){const e=await A();if(!e)return;q(!0);const o=e.organizeIdTree.map((e=>e[e.length-1])),n={...e,id:M.value,organizeId:o.join(),positionId:e.positionId&&e.positionId.length?e.positionId.join():"",roleId:e.roleId&&e.roleId.length?e.roleId.join():""};(M.value?g:f)(n).then((e=>{S.success(e.msg),q(!1),F(),y("reload")})).catch((()=>{q(!1)}))}return(e,o)=>(s(),c(a(I),h(e.$attrs,{onRegister:a(V),title:_.value,showOkBtn:"",onOk:G}),{default:d((()=>[m(a(x),{onRegister:a(k),class:"!px-30px"},null,8,["onRegister"])])),_:1},16,["onRegister","title"]))}});export{v as _};
