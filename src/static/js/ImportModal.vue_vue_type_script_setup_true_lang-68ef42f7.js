import{d as e,u as t,aw as a,ad as i,a0 as s,M as l,dD as n,e as o,o as d,p as r,l as c,k as u,m as p,t as m,q as f,a4 as k,j as y,ae as v,i as h,e6 as g,v as x,g as w,F as _,h as b,V as N,ea as I,ah as L}from"./index-920db443.js";import{_ as C,a as S}from"./import-e198d900.js";import{_ as T,a as j}from"./tip-b30e67af.js";import{b as R,B as P}from"./index-143f5813.js";import{i as U,a as z,t as O}from"./employee-882117ce.js";const M={class:"header-steps"},A={class:"import-main"},B={class:"upload"},E={class:"up_right"},F={class:"upload"},G={class:"up_right"},K={class:"import-main"},W={class:"import-main"},$={key:0,class:"success"},q={class:"success-tip"},D={key:1,class:"unsuccess"},V={class:"upload error-show"},H={class:"up_right"},J={class:"tip success-tip"},Q={class:"tip error-tip"},X=e({__name:"ImportModal",emits:["register","reload"],setup(e,{emit:X}){const Y=X,[Z,{closeModal:ee}]=R((function(){de.activeStep=0,de.fileName="",de.fileList=[],de.btnLoading=!1,de.skipPreview=!1})),{createMessage:te,createConfirm:ae}=L(),{t:ie}=t(),se=[{title:"工号",dataIndex:"enCode",key:"enCode",width:150},{title:"姓名",dataIndex:"fullName",key:"fullName",width:150},{title:"性别",dataIndex:"gender",key:"gender",width:150},{title:"部门",dataIndex:"departmentName",key:"departmentName",width:150},{title:"岗位",dataIndex:"positionName",key:"positionName",width:150},{title:"用工性质",dataIndex:"workingNature",key:"workingNature",width:150},{title:"身份证号",dataIndex:"idNumber",key:"idNumber",width:150},{title:"联系电话",dataIndex:"telephone",key:"telephone",width:150},{title:"出生年月",dataIndex:"birthday",key:"birthday",width:150},{title:"参加工作",dataIndex:"attendWorkTime",key:"attendWorkTime",width:150},{title:"最高学历",dataIndex:"education",key:"education",width:150},{title:"所学专业",dataIndex:"major",key:"major",width:150},{title:"毕业院校",dataIndex:"graduationAcademy",key:"graduationAcademy",width:150},{title:"毕业时间",dataIndex:"graduationTime",key:"graduationTime",width:150}],le=[{width:50,title:"序号",align:"center",customRender:({index:e})=>e+1},...se,{title:"操作",dataIndex:"action",key:"action",width:50,fixed:"right"}],ne=[{width:50,title:"序号",align:"center",customRender:({index:e})=>e+1},...se],oe=a(),de=i({activeStep:0,fileName:"",fileList:[],btnLoading:!1,list:[],result:{},resultList:[],skipPreview:!1}),{activeStep:re,fileName:ce,fileList:ue,btnLoading:pe,list:me,result:fe,resultList:ke,skipPreview:ye}=s(de),ve=l((()=>oe.apiUrl+"/api/extend/Employee/Uploader")),he=l((()=>({Authorization:n()})));function ge(){0!=de.activeStep&&(de.activeStep-=1)}function xe(){if(0==de.activeStep)return de.fileList.length&&de.fileName?de.skipPreview?we():(de.btnLoading=!0,void U({fileName:de.fileName}).then((e=>{de.list=e.data.dataRow||[],de.btnLoading=!1,de.activeStep+=1})).catch((()=>{de.btnLoading=!1}))):te.warning("请先上传文件");if(1==de.activeStep){if(!de.list.length)return te.warning("导入数据为空");we()}}function we(){de.btnLoading=!0;let e={list:de.list};de.skipPreview&&(e={...e,type:de.skipPreview,fileName:de.fileName}),z(e).then((e=>{de.result=e.data,de.resultList=e.data.failResult,de.activeStep+=1,de.skipPreview&&(de.activeStep=2),de.btnLoading=!1})).catch((()=>{de.btnLoading=!1}))}function _e({file:e}){"error"!==e.status?"done"===e.status&&(200===e.response.code?de.fileName=e.response.data.name:te.error(e.response.msg)):te.error("上传失败")}function be(e){const t=e.name.replace(/.+\./,"");if(!(-1!==["xls","xlsx"].indexOf(t.toLowerCase())))return te.error("文件格式不正确"),g.LIST_IGNORE;return!!(e.size/1024<500)||(te.error("文件大小超过500KB"),g.LIST_IGNORE)}function Ne(e){return new Promise(((t,a)=>{ae({iconType:"warning",title:ie("common.tipTitle"),content:`确定移除${e.name}?`,onOk:()=>{de.fileName="",t()},onCancel:()=>{a()}})}))}function Ie(e=!1){ee(),e&&Y("reload")}return(e,t)=>{const a=o("a-step"),i=o("a-steps"),s=o("a-button"),l=o("a-switch"),n=o("a-form-item"),L=o("a-input"),R=o("a-table");return d(),r(u(P),N(e.$attrs,{onRegister:u(Z),title:"批量导入",width:1e3,"show-cancel-btn":!1,"show-ok-btn":!1,destroyOnClose:"",class:"jnpf-import-modal"}),{insertFooter:c((()=>[0==u(re)?(d(),r(s,{key:0,onClick:t[4]||(t[4]=e=>Ie())},{default:c((()=>[p(m(u(ie)("common.cancelText")),1)])),_:1})):f("",!0),1===u(re)?(d(),r(s,{key:1,onClick:ge},{default:c((()=>[p(m(u(ie)("common.prev")),1)])),_:1})):f("",!0),u(re)<2?(d(),r(s,{key:2,type:"primary",onClick:xe,loading:u(pe),disabled:0===u(re)&&!u(ce)},{default:c((()=>[p(m(u(ie)("common.next")),1)])),_:1},8,["loading","disabled"])):(d(),r(s,{key:3,type:"primary",onClick:t[5]||(t[5]=e=>Ie(!0))},{default:c((()=>t[21]||(t[21]=[p("关闭")]))),_:1,__:[21]}))])),default:c((()=>[k("div",M,[y(i,{current:u(re),"onUpdate:current":t[0]||(t[0]=e=>v(re)?re.value=e:null),type:"navigation",size:"small"},{default:c((()=>[y(a,{title:"上传文件",disabled:""}),y(a,{title:"数据预览",disabled:""}),y(a,{title:"导入数据",disabled:""})])),_:1},8,["current"])]),h(k("div",A,[k("div",B,[t[9]||(t[9]=k("div",{class:"up_left"},[k("img",{src:C})],-1)),k("div",E,[t[7]||(t[7]=k("p",{class:"title"},"上传填好的数据表",-1)),t[8]||(t[8]=k("p",{class:"tip"},"文件后缀名必须是xls或xlsx，文件大小不超过500KB，最多支持导入1000条数据",-1)),y(u(g),{"file-list":u(ue),"onUpdate:fileList":t[1]||(t[1]=e=>v(ue)?ue.value=e:null),class:"upload-area",accept:".xls,.xlsx","max-count":1,action:ve.value,headers:he.value,"before-upload":be,onRemove:Ne,onChange:_e},{default:c((()=>[y(s,{type:"link"},{default:c((()=>t[6]||(t[6]=[p("上传文件")]))),_:1,__:[6]})])),_:1},8,["file-list","action","headers"])])]),k("div",F,[t[13]||(t[13]=k("div",{class:"up_left"},[k("img",{src:S})],-1)),k("div",G,[t[11]||(t[11]=k("p",{class:"title"},"填写导入数据信息",-1)),t[12]||(t[12]=k("p",{class:"tip"},"请按照数据模板的格式准备导入数据，模板中的表头名称不可更改，表头行不能删除",-1)),y(s,{type:"link",onClick:t[2]||(t[2]=e=>{O().then((e=>{I({url:e.data?.url})}))})},{default:c((()=>t[10]||(t[10]=[p("下载模板")]))),_:1,__:[10]})])]),y(n,{colon:!1,label:"跳过数据预览"},{default:c((()=>[y(l,{checked:u(ye),"onUpdate:checked":t[3]||(t[3]=e=>v(ye)?ye.value=e:null)},null,8,["checked"])])),_:1})],512),[[x,0==u(re)]]),h(k("div",K,[y(R,{"data-source":u(me),columns:le,size:"small",pagination:!1,scroll:{x:"max-content",y:"420px"},class:"import-preview-table"},{bodyCell:c((({column:e,record:a,index:i})=>[(d(),w(_,null,b(se,(t=>(d(),w(_,null,[e.key===t.key?(d(),r(L,{key:0,value:a[e.key],"onUpdate:value":t=>a[e.key]=t},null,8,["value","onUpdate:value"])):f("",!0)],64)))),64)),"action"===e.key?(d(),r(s,{key:0,class:"action-btn",type:"link",color:"error",onClick:e=>function(e){de.list.splice(e,1)}(i),size:"small"},{default:c((()=>t[14]||(t[14]=[p("删除")]))),_:2,__:[14]},1032,["onClick"])):f("",!0)])),_:1},8,["data-source"])],512),[[x,1==u(re)]]),h(k("div",W,[u(fe).resultType?f("",!0):(d(),w("div",$,[t[15]||(t[15]=k("img",{src:T},null,-1)),t[16]||(t[16]=k("p",{class:"success-title"},"批量导入成功",-1)),k("p",q,"您已成功导入"+m(u(fe).snum)+"条数据",1)])),u(fe).resultType?(d(),w("div",D,[k("div",V,[t[19]||(t[19]=k("div",{class:"up_left"},[k("img",{src:j})],-1)),k("div",H,[k("p",J,[t[17]||(t[17]=p(" 正常数据条数：")),k("span",null,m(u(fe).snum)+"条",1)]),k("p",Q,[t[18]||(t[18]=p(" 异常数据条数：")),k("span",null,m(u(fe).fnum)+"条",1)])])]),t[20]||(t[20]=k("div",{class:"conTips"},[k("p",null,"以下文件数据为导入异常数据")],-1)),y(R,{"data-source":u(ke),columns:ne,size:"small",pagination:!1,scroll:{x:"max-content",y:"205px"}},null,8,["data-source"])])):f("",!0)],512),[[x,2==u(re)]])])),_:1},16,["onRegister"])}}});export{X as _};
