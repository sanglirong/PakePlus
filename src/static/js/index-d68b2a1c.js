import{g as e,_ as t,d as o}from"./FlowParser.vue_vue_type_style_index_0_lang-43859d45.js";import{g as n,d as s,r as a}from"./TaskLogModal.vue_vue_type_style_index_0_lang-859a07eb.js";import{j as r}from"./template-c6142676.js";import{u as i,B as l}from"./useTable-dc8c9d84.js";import{T as p}from"./TableAction-adbe36f2.js";import{u,B as m}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{d as c,r as _,aD as d,u as y,co as f,c as g,a7 as v,e as j,o as w,g as h,a4 as x,p as b,k,j as T,l as I,m as S,t as C,q as M,F as D,n as P,ah as H}from"./index-920db443.js";import{u as R}from"./index-9c138ba5.js";import{u as F}from"./useDefineSetting-7df030ff.js";import"./index-143f5813.js";import"./useWindowSizeFn-05f906e2.js";import"./log-2a5f2c26.js";import"./task-ee77df5a.js";import"./flowDelegate-3964bb34.js";import"./OpinionTextarea.vue_vue_type_style_index_0_lang-cb910758.js";import"./commonWords-8e03a6e1.js";import"./CommonWordsPopover.vue_vue_type_style_index_0_lang-3ee4c861.js";import"./Sign.vue_vue_type_style_index_0_lang-a3fd8868.js";import"./FlowFile.vue_vue_type_script_setup_true_lang-ff47ee4a.js";import"./jquery-6353a699.js";import"./document-763aa4ad.js";import"./Main.vue_vue_type_style_index_0_lang-0afb53a3.js";import"./componentMap-7e15a185.js";import"./ErrorModal.vue_vue_type_script_setup_true_lang-581230da.js";import"./CandidateModal.vue_vue_type_script_setup_true_lang-79d2d529.js";import"./index-c37d2476.js";import"./BasicLeftTree-cd55d444.js";import"./billRule-0363563b.js";import"./config-06ca91cd.js";import"./import-e198d900.js";import"./tip-b30e67af.js";import"./dataSource-ed26da12.js";import"./dataModel-ea807f46.js";import"./index-999abbee.js";import"./ArrowLeftOutlined-3fbf15bc.js";import"./index-3b5bee70.js";import"./CopyOutlined-8d46c8b2.js";import"./ActionModal.vue_vue_type_script_setup_true_lang-22457a03.js";import"./ApprovalModal.vue_vue_type_script_setup_true_lang-8440f311.js";import"./ReduceApproverModal.vue_vue_type_script_setup_true_lang-7d94737b.js";import"./UserListModal.vue_vue_type_script_setup_true_lang-550da35d.js";import"./RecordList.vue_vue_type_style_index_0_lang-959f1fc0.js";import"./LogErrorModal.vue_vue_type_script_setup_true_lang-326503f1.js";import"./NodeFormParser.vue_vue_type_style_index_0_lang-0828e652.js";import"./SubFlowParser.vue_vue_type_style_index_0_lang-20f5de60.js";import"./Form.vue_vue_type_script_setup_true_lang-63005a4d.js";import"./visualDev-8f54ab4b.js";import"./createAsyncComponent-7e8f72ac.js";import"./DataLogList.vue_vue_type_script_setup_true_lang-c225eb8c.js";import"./index-0be8277c.js";import"./StartFormParser.vue_vue_type_script_setup_true_lang-0c8077e0.js";import"./FlowChart.vue_vue_type_script_setup_true_lang-5aaf6076.js";import"./index.vue_vue_type_script_setup_true_lang-69353133.js";import"./Parser.vue_vue_type_script_setup_true_lang-6ddfe448.js";import"./Item.vue_vue_type_script_setup_true_lang-fef56f78.js";import"./CustomForm.vue_vue_type_script_setup_true_lang-1aa664f4.js";import"./ExtraPanel.vue_vue_type_script_setup_true_lang-7c09275e.js";import"./RecordTimeList.vue_vue_type_style_index_0_lang-23988eb1.js";import"./RecordModal.vue_vue_type_style_index_0_lang-2d2d9b22.js";import"./emoji-a68b5251.js";import"./AuxiliaryList-441188d6.js";import"./pdf-3f972d03.js";import"./ViewModal.vue_vue_type_script_setup_true_lang-3d1fe22e.js";import"./Preview.vue_vue_type_style_index_0_lang-6567fb9c.js";import"./sortable.esm-02d0fe44.js";import"./SettingOutlined-dd6150a2.js";import"./index-1cfe4e28.js";import"./useTabs-ceeccdba.js";import"./upperFirst-2cd1a2f7.js";import"./uniqBy-e868edd7.js";const Y={class:"jnpf-content-wrapper"},A={class:"jnpf-content-wrapper-center"},L={class:"jnpf-content-wrapper-search-box"},U={class:"jnpf-content-wrapper-content bg-white"},N=c({name:"workFlow-flowMonitor",__name:"index",setup(c){const N=_(0),O=_({}),V=_(0),{createMessage:B,createConfirm:K}=H(),E=d(),{t:q}=y(),{flowStatusList:z,flowUrgentList:G,getUrgentText:W,getUrgentTextColor:J,getFlowStatusContent:$,getFlowStatusColor:Q}=F(),[X,{openPopup:Z}]=R(),ee=[{field:"keyword",label:q("common.keyword"),component:"Input",componentProps:{placeholder:q("common.enterKeyword"),submitOnPressEnter:!0}},{field:"pickerVal",label:"发起时间",component:"DateRange",componentProps:{format:"YYYY-MM-DD HH:mm:ss",showTime:{defaultValue:[f("00:00:00","HH:mm:ss"),f("23:59:59","HH:mm:ss")]},placeholder:["开始时间","结束时间"]}},{field:"flowCategory",label:"分类",component:"Select",componentProps:{showSearch:!0}},{field:"templateId",label:"所属流程",component:"TreeSelect",componentProps:{lastLevel:!0}},{field:"creatorUserId",label:"发起人员",component:"UserSelect"},{field:"status",label:"流程状态",component:"Select",componentProps:{showSearch:!0,options:g(z).filter((e=>6!=e.id))}},{field:"flowUrgent",label:"紧急程度",component:"Select",componentProps:{showSearch:!0,options:G}},{field:"isFile",label:"是否归档",component:"Select",componentProps:{showSearch:!0,options:[{fullName:"是",id:1},{fullName:"否",id:0}]}}],te=[{field:"keyword",label:q("common.keyword"),component:"Input",componentProps:{placeholder:q("common.enterKeyword"),submitOnPressEnter:!0}},{field:"pickerVal",label:"发起时间",component:"DateRange",componentProps:{format:"YYYY-MM-DD HH:mm:ss",showTime:{defaultValue:[f("00:00:00","HH:mm:ss"),f("23:59:59","HH:mm:ss")]},placeholder:["开始时间","结束时间"]}}],oe={rowSelection:{type:"checkbox"},immediate:!1,clickToRowSelect:!1,clearSelectOnPageChange:!0,actionColumn:{width:60,title:"操作",dataIndex:"action"}},[ne,{reload:se,getSelectRowKeys:ae,redoHeight:re}]=i({...oe,columns:[{title:"流程标题",dataIndex:"fullName",width:200},{title:"所属流程",dataIndex:"flowName",width:150},{title:"发起时间",dataIndex:"startTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"发起人员",dataIndex:"creatorUser",width:120},{title:"审批节点",dataIndex:"currentNodeName",width:150},{title:"是否归档",dataIndex:"isFile",width:100,align:"center"},{title:"紧急程度",dataIndex:"flowUrgent",width:100,align:"center"},{title:"流程版本",dataIndex:"flowVersion",width:70,align:"center"},{title:"流程状态",dataIndex:"status",width:120,align:"center"}],api:e}),[ie,{reload:le,getSelectRowKeys:pe}]=i({...oe,columns:[{title:"实例ID",dataIndex:"id",width:200},{title:"流程标题",dataIndex:"fullName"},{title:"发起时间",dataIndex:"startTime",width:150,format:"date|YYYY-MM-DD HH:mm:ss"},{title:"流程状态",dataIndex:"status",width:120,align:"center"}],api:n,actionColumn:{width:100,title:"操作",dataIndex:"action"}}),[ue,{updateSchema:me}]=u({baseColProps:{span:6},showActionButtonGroup:!0,showAdvancedButton:!0,compact:!0,fieldMapToTime:[["pickerVal",["startTime","endTime"]]]});function ce(e){return[{label:q("common.detailText"),onClick:ye.bind(null,e)}]}function _e(e){return[{label:q("common.detailText"),onClick:ye.bind(null,e)},{ifShow:10===e.status,label:"重试",color:"error",disabled:1!=e.templateStatus,modelConfirm:{content:"确定要将本实例进行重试, 是否继续?",onOk:fe.bind(null,e.id)}}]}function de(){const e=0==N.value?ae():pe();if(!e.length)return B.error(q("common.selectDataTip"));K({iconType:"warning",title:q("common.tipTitle"),content:q("common.batchDelTip"),onOk:()=>{(0==N.value?o:s)({ids:e}).then((e=>{B.success(e.msg),we()}))}})}function ye(e){let t={id:e.id,flowId:e.flowId,opType:6};1==N.value&&(t.type=2),Z(!0,t)}function fe(e){a(e).then((e=>{B.success(e.msg),we()})).catch((()=>{we()}))}async function ge(){const e=await E.getDictionaryData("businessType");me({field:"flowCategory",componentProps:{options:e}}),r().then((e=>{me({field:"templateId",componentProps:{options:e.data.list||[]}})}))}function ve(e){let t={};for(let[o,n]of Object.entries(e))(n||0==n)&&(Array.isArray(n)?n.length&&(t[o]=n):t[o]=n);O.value=t,we()}function je(){O.value={},we()}function we(){P((()=>0==N.value?se():le()))}function he(e=0){return 1===e?"进行中":2===e?"已完成":4===e?"终止":10===e?"异常":void 0}function xe(e=0){return 1===e?"#F09437":2===e?"rgba(35,162,5,0.39)":4===e||10===e?"rgba(241,61,61,0.85)":void 0}function be(e){V.value=+new Date,0==e&&ge(),je()}return v((()=>{we(),ge()})),(e,o)=>{const n=j("a-button"),s=j("JnpfTextTag"),a=j("a-tag"),r=j("a-tab-pane"),i=j("BasicHelp"),u=j("a-tabs");return w(),h("div",Y,[x("div",A,[x("div",L,[(w(),b(k(m),{class:"search-form",onRegister:k(ue),schemas:0===N.value?ee:te,onAdvancedChange:k(re),onSubmit:ve,onReset:je,key:V.value},null,8,["onRegister","schemas","onAdvancedChange"]))]),x("div",U,[T(u,{activeKey:N.value,"onUpdate:activeKey":o[0]||(o[0]=e=>N.value=e),class:"jnpf-content-wrapper-tabs",destroyInactiveTabPane:"",onChange:be},{default:I((()=>[(w(),b(r,{key:0,tab:"标准/简单流程监控"},{default:I((()=>[T(k(l),{onRegister:k(ne),searchInfo:O.value},{tableTitle:I((()=>[T(n,{type:"error",preIcon:"icon-ym icon-ym-delete",onClick:de},{default:I((()=>[S(C(k(q)("common.delText")),1)])),_:1})])),bodyCell:I((({column:e,record:t})=>["flowUrgent"===e.key?(w(),b(s,{key:0,content:k(W)(t.flowUrgent),color:k(J)(t.flowUrgent),showTag:!1,showTextColor:""},null,8,["content","color"])):M("",!0),"flowVersion"===e.key?(w(),b(a,{key:1,color:"processing"},{default:I((()=>[S("V:"+C(t.flowVersion),1)])),_:2},1024)):M("",!0),"status"===e.key?(w(),b(s,{key:2,content:k($)(t.status),color:k(Q)(t.status)},null,8,["content","color"])):M("",!0),"action"===e.key?(w(),b(k(p),{key:3,actions:ce(t)},null,8,["actions"])):M("",!0)])),_:1},8,["onRegister","searchInfo"])])),_:1})),(w(),b(r,{key:1,tab:"任务流程监控"},{default:I((()=>[T(k(l),{onRegister:k(ie),searchInfo:O.value},{tableTitle:I((()=>[T(n,{type:"error",preIcon:"icon-ym icon-ym-delete",onClick:de},{default:I((()=>[S(C(k(q)("common.delText")),1)])),_:1})])),bodyCell:I((({column:e,record:t})=>["fullName"===e.key?(w(),h(D,{key:0},[S(C(t.fullName)+" ",1),t.isRetry?(w(),h(D,{key:0},[T(a,{color:"blue",class:"!mx-8px"},{default:I((()=>o[1]||(o[1]=[S("重试")]))),_:1,__:[1]}),T(i,{text:[`原实例ID：${t.parentId}`,`原实例执行时间：${k(f)(t.parentTime).format("YYYY-MM-DD HH:mm:ss")}`]},{default:I((()=>o[2]||(o[2]=[x("i",{class:"icon-ym icon-ym-generator-link"},null,-1)]))),_:2},1032,["text"])],64)):M("",!0)],64)):M("",!0),"status"===e.key?(w(),b(s,{key:1,content:he(t.status),color:xe(t.status)},null,8,["content","color"])):M("",!0),"action"===e.key?(w(),b(k(p),{key:2,actions:_e(t)},null,8,["actions"])):M("",!0)])),_:1},8,["onRegister","searchInfo"])])),_:1}))])),_:1},8,["activeKey"])])]),T(t,{onRegister:k(X),onReload:we},null,8,["onRegister"])])}}});export{N as default};
