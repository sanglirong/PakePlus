import{d as e,cd as a,u as t,r as o,ad as r,a0 as s,k as l,e as n,o as i,p as d,l as m,a4 as c,dj as f,g as u,t as p,j as g,ae as b,q as h,m as y,i as F,v,V as _,ah as D}from"./index-920db443.js";import{g as S,_ as k,u as x,c as L}from"./FormGenerator.vue_vue_type_script_setup_true_lang-948e37f5.js";import{b as j,B as T}from"./index-143f5813.js";import{u as R,B as C}from"./useForm-1d28ee0b.js";import"./componentMap-c91676b4.js";import{f as I}from"./formValidate-c8ab8d29.js";import{V as N}from"./index-c37d2476.js";const P={class:"jnpf-full-modal-header"},w={class:"header-title"},V={key:0,class:"header-txt"},M={class:"header-txt"},q=e({__name:"Form",emits:["register","reload"],setup(e,{emit:q}){const J=q,[O,{setFieldsValue:B,resetFields:z,validate:A,updateSchema:K}]=R({schemas:[{field:"fullName",label:"模板名称",component:"Input",componentProps:{placeholder:"请输入",maxlength:100},rules:[{required:!0,trigger:"blur",message:"必填"}]},{field:"enCode",label:"模板编码",component:"Input",componentProps:{placeholder:"请输入",maxlength:50},rules:[{required:!0,trigger:"blur",message:"必填"},{validator:I("enCode"),trigger:"blur"}]},{field:"category",label:"模板分类",component:"Select",componentProps:{placeholder:"请选择",showSearch:!0},rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"icon",label:"模板图标",component:"IconPicker",rules:[{required:!0,trigger:"change",message:"必填"}]},{field:"sortCode",label:"模板排序",defaultValue:0,component:"InputNumber",componentProps:{min:0,max:999999}},{field:"enabledMark",label:"模板状态",component:"Switch",defaultValue:1},{field:"description",label:"模板说明",component:"Textarea",componentProps:{placeholder:"请输入"}}]}),[G,{closeModal:H,changeLoading:Q}]=j((function(e){X.isReload=!1,X.activeStep=0,X.loading=!0,X.formData=null,X.errorList=[],K([{field:"category",componentProps:{options:e.categoryList}}]),Q(!0),z(),X.dataForm.id=e.id,X.dataForm.id?S(X.dataForm.id).then((e=>{X.dataForm=e.data,B(X.dataForm),X.formData=X.dataForm.formData&&JSON.parse(X.dataForm.formData),ne(),X.loading=!1,Q(!1)})):(X.loading=!1,Q(!1))})),{createMessage:U}=D(),$=a(),{t:E}=t(),W=o(null),X=r({activeStep:0,loading:!1,btnLoading:!1,tables:[],dataForm:{id:"",fullName:"",enCode:"",icon:"",sortCode:0,enabledMark:1,category:"",description:""},formData:null,dbType:"MySQL",isReload:!1,errorList:[]}),Y=o(null),{activeStep:Z,loading:ee,btnLoading:ae,dbType:te,formData:oe,dataForm:re,errorList:se}=s(X);function le(){X.activeStep-=1}async function ne(){if(X.activeStep<1){const e=await A();if(!e)return;X.dataForm={...X.dataForm,...e,isKit:!0},$.setHasTable(!1),$.setAllTable([]),$.setFormItemList([]),X.activeStep+=1}else 1===X.activeStep&&l(Y).getData().then((e=>{X.formData=e.formData,X.dataForm.formData=X.formData?JSON.stringify(X.formData):null,X.activeStep+=1})).catch((e=>{e.msg&&U.warning(e.msg)}))}function ie(){X.btnLoading=!0;const e={...X.dataForm,formData:X.formData?JSON.stringify(X.formData):null};(X.dataForm.id?x:L)(e).then((e=>{U.success(e.msg),X.btnLoading=!1,X.isReload=!0,X.dataForm.id||(X.dataForm.id=e.data)})).catch((()=>{X.btnLoading=!1}))}function de(e){l(Y)?.setTabActiveKey("field"),l(Y)?.activeFormItemById(e)}return(e,a)=>{const t=n("a-tooltip"),o=n("a-step"),r=n("a-steps"),s=n("a-button"),D=n("a-space-compact"),S=n("a-space"),x=n("a-col"),L=n("a-row");return i(),d(l(T),_(e.$attrs,{onRegister:l(G),defaultFullscreen:"",footer:null,closable:!1,keyboard:!1,class:"jnpf-full-modal full-modal designer-modal","destroy-on-close":""}),{title:m((()=>[c("div",P,[c("div",w,[a[3]||(a[3]=c("img",{src:f,class:"header-logo"},null,-1)),a[4]||(a[4]=c("span",{class:"header-dot"},null,-1)),l(Z)?(i(),d(t,{key:1,title:l(re).fullName},{default:m((()=>[c("p",M,p(l(re).fullName),1)])),_:1},8,["title"])):(i(),u("p",V,"模板设计"))]),g(r,{current:l(Z),"onUpdate:current":a[0]||(a[0]=e=>b(Z)?Z.value=e:null),type:"navigation",size:"small",class:"header-steps"},{default:m((()=>[g(o,{title:"基础设计"}),g(o,{title:"模板设计",disabled:l(Z)<=1},null,8,["disabled"])])),_:1},8,["current"]),g(S,{class:"options",size:10},{default:m((()=>[1==l(Z)?(i(),d(l(N),{key:0,ref_key:"validatePopoverRef",ref:W,errorList:l(se),onSelect:de},null,8,["errorList"])):h("",!0),g(D,{block:""},{default:m((()=>[g(s,{shape:"round",onClick:le,disabled:l(Z)<=0||l(ae)},{default:m((()=>[y(p(l(E)("common.prev")),1)])),_:1},8,["disabled"]),g(s,{shape:"round",onClick:ne,disabled:l(Z)>=1||l(ee)||l(ae)},{default:m((()=>[y(p(l(E)("common.next")),1)])),_:1},8,["disabled"])])),_:1}),g(s,{shape:"round",type:"primary",onClick:a[1]||(a[1]=e=>async function(){if(X.activeStep<1){const e=await A();if(!e)return;X.dataForm={...X.dataForm,...e},ie()}else l(Y).getData().then((e=>{X.errorList=e.errorList||[],X.errorList.length?setTimeout((()=>{l(W)?.setVisible(!0)}),10):(X.formData=e.formData,X.dataForm.formData=X.formData?JSON.stringify(X.formData):null,ie())})).catch((e=>{e.msg&&U.warning(e.msg)}))}()),disabled:l(Z)<=0||l(ee),loading:l(ae)},{default:m((()=>[y(p(l(E)("common.saveText")),1)])),_:1},8,["disabled","loading"]),g(s,{shape:"round",onClick:a[2]||(a[2]=e=>(H(),void(X.isReload&&J("reload"))))},{default:m((()=>[y(p(l(E)("common.closeText")),1)])),_:1})])),_:1})])])),default:m((()=>[F(g(L,{type:"flex",justify:"center",align:"middle",class:"basic-content"},{default:m((()=>[g(x,{span:12,xxl:10,class:"basic-form"},{default:m((()=>[g(l(C),{onRegister:l(O)},null,8,["onRegister"])])),_:1})])),_:1},512),[[v,!l(Z)]]),1==l(Z)?(i(),d(l(k),{key:0,ref_key:"generatorRef",ref:Y,conf:l(oe),formInfo:l(re),dbType:l(te)},null,8,["conf","formInfo","dbType"])):h("",!0)])),_:1},16,["onRegister"])}}});export{q as _};
