import{a as e}from"./template-c6142676.js";import{d as a,ad as l,c3 as n,u as o,r as t,M as s,bk as i,w as u,e as c,a9 as d,o as r,g as p,p as v,l as f,j as m,V as w,m as h,aN as g,a4 as y,k,aH as C,i as b,n as I}from"./index-920db443.js";import{u as _,B as j}from"./useTable-dc8c9d84.js";import{_ as F}from"./Main.vue_vue_type_style_index_0_lang-0afb53a3.js";import{g as S}from"./task-ee77df5a.js";const x={class:"common-container"},R={class:"jnpf-content-wrapper"},L={class:"jnpf-content-wrapper-center"},N={class:"jnpf-content-wrapper-content"},P={class:"jnpf-content-wrapper"},z={class:"jnpf-content-wrapper-center"},O={class:"jnpf-content-wrapper-content"},T=a({inheritAttrs:!1,__name:"FlowModal",props:{value:{default:""},title:{type:String,default:""},placeholder:{type:String,default:"请选择"},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!0},size:{type:String,default:"default"},isCheckSubFlow:{type:Number,default:0}},emits:["update:value","change"],setup(a,{emit:T}){const U=l({flowInfo:{},nodeList:[],opType:"-1",taskId:"",key:+new Date,isRevokeTask:!1}),A=a,B=T,K=n.useInjectFormItemContext(),{t:M}=o(),D=t(void 0),H=t(!1),E=t(!1),V=t(!1),q=t([]),[G,{getForm:J,getSelectRows:Q,setSelectedRowKeys:W,getSelectRowKeys:X}]=_({api:e,columns:[{title:"流程名称",dataIndex:"fullName"},{title:"流程编码",dataIndex:"enCode"}],immediate:!1,searchInfo:{isAuthority:0},useSearchForm:!0,formConfig:{baseColProps:{span:8},schemas:[{field:"keyword",label:M("common.keyword"),component:"Input",componentProps:{placeholder:M("common.enterKeyword"),submitOnPressEnter:!0}}]},tableSetting:{size:!1,setting:!1},isCanResizeParent:!0,resizeHeightOffset:-74,rowSelection:{type:"radio"}}),Y=s((()=>({...i(A,["disabled","size","allowClear","placeholder"]),fieldNames:{label:"fullName",value:"id"},open:!1,showSearch:!1,showArrow:!0})));function Z(){q.value=[],B("change","",{})}async function $(){A.disabled||(H.value=!0,I((()=>{J().resetFields(),W(D.value?[D.value]:[])})))}function ee(){V.value=!0,E.value=!0;let e={flowId:D.value};S(0,e).then((e=>{const a=e.data;V.value=!1,U.flowInfo=a.flowInfo,U.nodeList=a.nodeList,U.opType="0",U.key=+new Date})).catch((()=>{V.value=!1}))}function ae(){H.value=!1,E.value=!1}function le(){if(!X().length&&!Q().length)return;if(!Q().length)return B("update:value",D.value),B("change",D.value,q.value[0]),K.onFieldChange(),void ae();const e=Q()[0];q.value=Q(),D.value=e.id,B("update:value",e.id),B("change",e.id,e),K.onFieldChange(),ae()}return u((()=>A.value),(e=>{var a;a=e,D.value=a||void 0,q.value=[{id:D.value,fullName:A.title}]}),{immediate:!0}),(e,l)=>{const n=c("a-select"),o=c("a-button"),t=c("a-input-group"),s=d("loading");return r(),p("div",x,[a.isCheckSubFlow&&D.value?(r(),v(t,{key:0,compact:""},{default:f((()=>[m(n,w({style:{width:"calc(100% - 90px)"},value:D.value,"onUpdate:value":l[0]||(l[0]=e=>D.value=e)},Y.value,{options:q.value,onChange:Z,onClick:$}),null,16,["value","options"]),m(o,{onClick:ee},{default:f((()=>l[4]||(l[4]=[h("查看流程")]))),_:1,__:[4]})])),_:1})):(r(),v(n,w({key:1,value:D.value,"onUpdate:value":l[1]||(l[1]=e=>D.value=e)},Y.value,{options:q.value,onChange:Z,onClick:$}),null,16,["value","options"])),m(k(C),{open:H.value,"onUpdate:open":l[2]||(l[2]=e=>H.value=e),title:"选择流程",width:800,class:"common-container-modal",onCancel:ae,onOk:le,maskClosable:!1},{closeIcon:f((()=>[m(g,{canFullscreen:!1,onCancel:ae})])),default:f((()=>[y("div",R,[y("div",L,[y("div",N,[m(k(j),{onRegister:k(G),class:"jnpf-sub-table"},null,8,["onRegister"])])])])])),_:1},8,["open"]),m(k(C),{open:E.value,"onUpdate:open":l[3]||(l[3]=e=>E.value=e),title:"流程图",width:"80%",class:"common-container-modal",onCancel:ae,footer:null,maskClosable:!1},{closeIcon:f((()=>[m(g,{canFullscreen:!1,onCancel:ae})])),default:f((()=>[b((r(),p("div",P,[y("div",z,[y("div",O,[(r(),v(F,{class:"p-10px",flowInfo:U.flowInfo,nodeList:U.nodeList,isPreview:!0,openPreview:!0,handleOpenFlowInfo:"",key:U.key},null,8,["flowInfo","nodeList"]))])])])),[[s,V.value]])])),_:1},8,["open"])])}}});export{T as _};
